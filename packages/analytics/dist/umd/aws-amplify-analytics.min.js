!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("aws_amplify_core")):"function"==typeof define&&define.amd?define("aws_amplify_analytics",["aws_amplify_core"],t):"object"==typeof exports?exports.aws_amplify_analytics=t(require("aws_amplify_core")):e.aws_amplify_analytics=t(e.aws_amplify_core)}(this,(e=>(()=>{"use strict";var t={556:t=>{t.exports=e}},n={};function i(e){var r=n[e];if(void 0!==r)return r.exports;var s=n[e]={exports:{}};return t[e](s,s.exports,i),s.exports}i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};i.r(r),i.d(r,{AnalyticsError:()=>Pt,configureAutoTrack:()=>rn,disable:()=>cn,enable:()=>an,flushEvents:()=>on,identifyUser:()=>Bt,record:()=>Mt});var s,o=i(556);!function(e){e.DEBUG="DEBUG",e.ERROR="ERROR",e.INFO="INFO",e.WARN="WARN",e.VERBOSE="VERBOSE",e.NONE="NONE"}(s||(s={}));const a={VERBOSE:1,DEBUG:2,INFO:3,WARN:4,ERROR:5,NONE:6};class c{constructor(e,t=s.WARN){this.name=e,this.level=t,this._pluggables=[]}_padding(e){return e<10?"0"+e:""+e}_ts(){const e=new Date;return[this._padding(e.getMinutes()),this._padding(e.getSeconds())].join(":")+"."+e.getMilliseconds()}configure(e){return e?(this._config=e,this._config):this._config}_log(e,...t){let n=this.level;if(c.LOG_LEVEL&&(n=c.LOG_LEVEL),"undefined"!=typeof window&&window.LOG_LEVEL&&(n=window.LOG_LEVEL),!(a[e]>=a[n]))return;let i=console.log.bind(console);e===s.ERROR&&console.error&&(i=console.error.bind(console)),e===s.WARN&&console.warn&&(i=console.warn.bind(console)),c.BIND_ALL_LOG_LEVELS&&(e===s.INFO&&console.info&&(i=console.info.bind(console)),e===s.DEBUG&&console.debug&&(i=console.debug.bind(console)));const r=`[${e}] ${this._ts()} ${this.name}`;let o="";if(1===t.length&&"string"==typeof t[0])o=`${r} - ${t[0]}`,i(o);else if(1===t.length)o=`${r} ${t[0]}`,i(r,t[0]);else if("string"==typeof t[0]){let e=t.slice(1);1===e.length&&(e=e[0]),o=`${r} - ${t[0]} ${e}`,i(`${r} - ${t[0]}`,e)}else o=`${r} ${t}`,i(r,t);for(const e of this._pluggables){const t={message:o,timestamp:Date.now()};e.pushLogs([t])}}log(...e){this._log(s.INFO,...e)}info(...e){this._log(s.INFO,...e)}warn(...e){this._log(s.WARN,...e)}error(...e){this._log(s.ERROR,...e)}debug(...e){this._log(s.DEBUG,...e)}verbose(...e){this._log(s.VERBOSE,...e)}addPluggable(e){e&&"Logging"===e.getCategoryName()&&(this._pluggables.push(e),e.configure(this._config))}listPluggables(){return this._pluggables}}c.LOG_LEVEL=null,c.BIND_ALL_LOG_LEVELS=!1;class u extends Error{constructor({message:e,name:t,recoverySuggestion:n,underlyingError:i}){super(e),this.name=t,this.underlyingError=i,this.recoverySuggestion=n,this.constructor=u,Object.setPrototypeOf(this,u.prototype)}}const d="undefined"!=typeof Symbol?Symbol("amplify_default"):"@@amplify_default",l=new c("Hub");class h{constructor(e){this.listeners=new Map,this.protectedChannels=["core","auth","api","analytics","interactions","pubsub","storage","ui","xr"],this.name=e}_remove(e,t){const n=this.listeners.get(e);n?this.listeners.set(e,[...n.filter((({callback:e})=>e!==t))]):l.warn(`No listeners for ${e}`)}dispatch(e,t,n,i){"string"==typeof e&&this.protectedChannels.indexOf(e)>-1&&(i===d||l.warn(`WARNING: ${e} is protected and dispatching on it can have unintended consequences`));const r={channel:e,payload:{...t},source:n,patternInfo:[]};try{this._toListeners(r)}catch(e){l.error(e)}}listen(e,t,n="noname"){let i;if("function"!=typeof t)throw new u({name:"NoHubcallbackProvidedException",message:"No callback supplied to Hub"});i=t;let r=this.listeners.get(e);return r||(r=[],this.listeners.set(e,r)),r.push({name:n,callback:i}),()=>{this._remove(e,i)}}_toListeners(e){const{channel:t,payload:n}=e,i=this.listeners.get(t);i&&i.forEach((i=>{l.debug(`Dispatching to ${t} with `,n);try{i.callback(e)}catch(e){l.error(e)}}))}}var p,f,g,y,m,v,w,S,b,I,E,A,C,x,N;new h("__default__"),new h("internal-hub"),function(e){e.WebUnknown="0",e.React="1",e.NextJs="2",e.Angular="3",e.VueJs="4",e.Nuxt="5",e.Svelte="6",e.ServerSideUnknown="100",e.ReactSSR="101",e.NextJsSSR="102",e.AngularSSR="103",e.VueJsSSR="104",e.NuxtSSR="105",e.SvelteSSR="106",e.ReactNative="201",e.Expo="202"}(p||(p={})),(N=f||(f={})).AI="ai",N.API="api",N.Auth="auth",N.Analytics="analytics",N.DataStore="datastore",N.Geo="geo",N.InAppMessaging="inappmessaging",N.Interactions="interactions",N.Predictions="predictions",N.PubSub="pubsub",N.PushNotification="pushnotification",N.Storage="storage",function(e){e.CreateConversation="1",e.GetConversation="2",e.ListConversations="3",e.DeleteConversation="4",e.SendMessage="5",e.ListMessages="6",e.OnMessage="7",e.Generation="8",e.UpdateConversation="9"}(g||(g={})),function(e){e.Record="1",e.IdentifyUser="2"}(y||(y={})),function(e){e.GraphQl="1",e.Get="2",e.Post="3",e.Put="4",e.Patch="5",e.Del="6",e.Head="7"}(m||(m={})),function(e){e.SignUp="1",e.ConfirmSignUp="2",e.ResendSignUpCode="3",e.SignIn="4",e.FetchMFAPreference="6",e.UpdateMFAPreference="7",e.SetUpTOTP="10",e.VerifyTOTPSetup="11",e.ConfirmSignIn="12",e.DeleteUserAttributes="15",e.DeleteUser="16",e.UpdateUserAttributes="17",e.FetchUserAttributes="18",e.ConfirmUserAttribute="22",e.SignOut="26",e.UpdatePassword="27",e.ResetPassword="28",e.ConfirmResetPassword="29",e.FederatedSignIn="30",e.RememberDevice="32",e.ForgetDevice="33",e.FetchDevices="34",e.SendUserAttributeVerificationCode="35",e.SignInWithRedirect="36",e.StartWebAuthnRegistration="37",e.CompleteWebAuthnRegistration="38",e.ListWebAuthnCredentials="39",e.DeleteWebAuthnCredential="40"}(v||(v={})),function(e){e.Subscribe="1",e.GraphQl="2"}(w||(w={})),function(e){e.SearchByText="0",e.SearchByCoordinates="1",e.SearchForSuggestions="2",e.SearchByPlaceId="3",e.SaveGeofences="4",e.GetGeofence="5",e.ListGeofences="6",e.DeleteGeofences="7"}(S||(S={})),function(e){e.SyncMessages="1",e.IdentifyUser="2",e.NotifyMessageInteraction="3"}(b||(b={})),function(e){e.None="0"}(I||(I={})),function(e){e.Convert="1",e.Identify="2",e.Interpret="3"}(E||(E={})),function(e){e.Subscribe="1"}(A||(A={})),function(e){e.InitializePushNotifications="1",e.IdentifyUser="2"}(C||(C={})),function(e){e.UploadData="1",e.DownloadData="2",e.List="3",e.Copy="4",e.Remove="5",e.GetProperties="6",e.GetUrl="7",e.GetDataAccess="8",e.ListCallerAccessGrants="9"}(x||(x={}));const k={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let _;const R=new Uint8Array(16);function P(){if(!_&&(_="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!_))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return _(R)}const T=[];for(let e=0;e<256;++e)T.push((e+256).toString(16).slice(1));const L=function(e,t,n){if(k.randomUUID&&!t&&!e)return k.randomUUID();const i=(e=e||{}).random||(e.rng||P)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=i[e];return t}return function(e,t=0){return T[e[t+0]]+T[e[t+1]]+T[e[t+2]]+T[e[t+3]]+"-"+T[e[t+4]]+T[e[t+5]]+"-"+T[e[t+6]]+T[e[t+7]]+"-"+T[e[t+8]]+T[e[t+9]]+"-"+T[e[t+10]]+T[e[t+11]]+T[e[t+12]]+T[e[t+13]]+T[e[t+14]]+T[e[t+15]]}(i)};var O;!function(e){e.NoEndpointId="NoEndpointId",e.PlatformNotSupported="PlatformNotSupported",e.Unknown="Unknown",e.NetworkError="NetworkError"}(O||(O={}));class $ extends u{constructor(){super({name:O.PlatformNotSupported,message:"Function not supported on current platform"})}}class z{constructor(e){this.storage=e}async setItem(e,t){if(!this.storage)throw new $;this.storage.setItem(e,t)}async getItem(e){if(!this.storage)throw new $;return this.storage.getItem(e)}async removeItem(e){if(!this.storage)throw new $;this.storage.removeItem(e)}async clear(){if(!this.storage)throw new $;this.storage.clear()}}class U{constructor(){this.storage=new Map}get length(){return this.storage.size}key(e){return e>this.length-1?null:Array.from(this.storage.keys())[e]}setItem(e,t){this.storage.set(e,t)}getItem(e){return this.storage.get(e)??null}removeItem(e){this.storage.delete(e)}clear(){this.storage.clear()}}const D=new c("CoreStorageUtils"),V={keyPrefix:"aws-amplify-cache",capacityInBytes:1048576,itemMaxSize:21e4,defaultTTL:2592e5,defaultPriority:5,warningThreshold:.8},M="CurSize";function B(e){let t=0;t=e.length;for(let n=e.length;n>=0;n-=1){const i=e.charCodeAt(n);i>127&&i<=2047?t+=1:i>2047&&i<=65535&&(t+=2),i>=56320&&i<=57343&&(n-=1)}return t}function j(){return(new Date).getTime()}const F=e=>`${e}${M}`,G=(e,t=u)=>(n,i,r)=>{const{message:s,recoverySuggestion:o}=e[i];if(!n)throw new t({name:i,message:r?`${s} ${r}`:s,recoverySuggestion:o})};var q;!function(e){e.NoCacheItem="NoCacheItem",e.NullNextNode="NullNextNode",e.NullPreviousNode="NullPreviousNode"}(q||(q={}));const W=G({[q.NoCacheItem]:{message:"Item not found in the cache storage."},[q.NullNextNode]:{message:"Next node is null."},[q.NullPreviousNode]:{message:"Previous node is null."}}),H=new c("StorageCache");class J{constructor({config:e,keyValueStorage:t}){this.config={...V,...e},this.keyValueStorage=t,this.sanitizeConfig()}getModuleName(){return"Cache"}configure(e){return e&&(e.keyPrefix&&H.warn("keyPrefix can not be re-configured on an existing Cache instance."),this.config={...this.config,...e}),this.sanitizeConfig(),this.config}async getCurrentCacheSize(){let e=await this.getStorage().getItem(F(this.config.keyPrefix));return e||(await this.getStorage().setItem(F(this.config.keyPrefix),"0"),e="0"),Number(e)}async setItem(e,t,n){if(H.debug(`Set item: key is ${e}, value is ${t} with options: ${n}`),!e||e===M)return void H.warn(`Invalid key: should not be empty or reserved key: '${M}'`);if(void 0===t)return void H.warn("The value of item should not be undefined!");const i={priority:void 0!==n?.priority?n.priority:this.config.defaultPriority,expires:void 0!==n?.expires?n.expires:this.config.defaultTTL+j()};if(i.priority<1||i.priority>5)return void H.warn("Invalid parameter: priority due to out or range. It should be within 1 and 5.");const r=`${this.config.keyPrefix}${e}`,s=this.fillCacheItem(r,t,i);if(s.byteSize>this.config.itemMaxSize)H.warn(`Item with key: ${e} you are trying to put into is too big!`);else try{const e=await this.getStorage().getItem(r);if(e&&await this.removeCacheItem(r,JSON.parse(e).byteSize),await this.isCacheFull(s.byteSize)){const e=await this.clearInvalidAndGetRemainingKeys();if(await this.isCacheFull(s.byteSize)){const t=await this.sizeToPop(s.byteSize);await this.popOutItems(e,t)}}return this.setCacheItem(r,s)}catch(e){H.warn(`setItem failed! ${e}`)}}async getItem(e,t){let n;if(H.debug(`Get item: key is ${e} with options ${t}`),!e||e===M)return H.warn(`Invalid key: should not be empty or reserved key: '${M}'`),null;const i=`${this.config.keyPrefix}${e}`;try{if(n=await this.getStorage().getItem(i),null!=n){if(!await this.isExpired(i))return(await this.updateVisitedTime(JSON.parse(n),i)).data;await this.removeCacheItem(i,JSON.parse(n).byteSize)}if(t?.callback){const n=t.callback();return null!==n&&await this.setItem(e,n,t),n}return null}catch(e){return H.warn(`getItem failed! ${e}`),null}}async removeItem(e){if(H.debug(`Remove item: key is ${e}`),!e||e===M)return void H.warn(`Invalid key: should not be empty or reserved key: '${M}'`);const t=`${this.config.keyPrefix}${e}`;try{const e=await this.getStorage().getItem(t);e&&await this.removeCacheItem(t,JSON.parse(e).byteSize)}catch(e){H.warn(`removeItem failed! ${e}`)}}async getAllKeys(){try{return await this.getAllCacheKeys()}catch(e){return H.warn(`getAllkeys failed! ${e}`),[]}}getStorage(){return this.keyValueStorage}async isExpired(e){const t=await this.getStorage().getItem(e);W(null!==t,q.NoCacheItem,`Key: ${e}`);const n=JSON.parse(t);return j()>=n.expires}async removeCacheItem(e,t){const n=await this.getStorage().getItem(e);W(null!==n,q.NoCacheItem,`Key: ${e}`);const i=t??JSON.parse(n).byteSize;await this.decreaseCurrentSizeInBytes(i);try{await this.getStorage().removeItem(e)}catch(e){await this.increaseCurrentSizeInBytes(i),H.error(`Failed to remove item: ${e}`)}}fillCacheItem(e,t,n){const i={key:e,data:t,timestamp:j(),visitedTime:j(),priority:n.priority??0,expires:n.expires??0,type:typeof t,byteSize:0};return i.byteSize=B(JSON.stringify(i)),i.byteSize=B(JSON.stringify(i)),i}sanitizeConfig(){this.config.itemMaxSize>this.config.capacityInBytes&&(H.error("Invalid parameter: itemMaxSize. It should be smaller than capacityInBytes. Setting back to default."),this.config.itemMaxSize=V.itemMaxSize),(this.config.defaultPriority>5||this.config.defaultPriority<1)&&(H.error("Invalid parameter: defaultPriority. It should be between 1 and 5. Setting back to default."),this.config.defaultPriority=V.defaultPriority),(Number(this.config.warningThreshold)>1||Number(this.config.warningThreshold)<0)&&(H.error("Invalid parameter: warningThreshold. It should be between 0 and 1. Setting back to default."),this.config.warningThreshold=V.warningThreshold),this.config.capacityInBytes>5242880&&(H.error("Cache Capacity should be less than 5MB. Setting back to default. Setting back to default."),this.config.capacityInBytes=V.capacityInBytes)}async increaseCurrentSizeInBytes(e){const t=await this.getCurrentCacheSize();await this.getStorage().setItem(F(this.config.keyPrefix),(t+e).toString())}async decreaseCurrentSizeInBytes(e){const t=await this.getCurrentCacheSize();await this.getStorage().setItem(F(this.config.keyPrefix),(t-e).toString())}async updateVisitedTime(e,t){return e.visitedTime=j(),await this.getStorage().setItem(t,JSON.stringify(e)),e}async setCacheItem(e,t){await this.increaseCurrentSizeInBytes(t.byteSize);try{await this.getStorage().setItem(e,JSON.stringify(t))}catch(e){await this.decreaseCurrentSizeInBytes(t.byteSize),H.error(`Failed to set item ${e}`)}}async sizeToPop(e){const t=await this.getCurrentCacheSize()+e-this.config.capacityInBytes,n=(1-this.config.warningThreshold)*this.config.capacityInBytes;return t>n?t:n}async isCacheFull(e){return e+await this.getCurrentCacheSize()>this.config.capacityInBytes}async popOutItems(e,t){const n=[];let i=t;for(const t of e){const e=await this.getStorage().getItem(t);if(null!=e){const t=JSON.parse(e);n.push(t)}}n.sort(((e,t)=>e.priority>t.priority?-1:e.priority<t.priority?1:e.visitedTime<t.visitedTime?-1:1));for(const e of n)if(await this.removeCacheItem(e.key,e.byteSize),i-=e.byteSize,i<=0)return}async clearInvalidAndGetRemainingKeys(){const e=[],t=await this.getAllCacheKeys({omitSizeKey:!0});for(const n of t)await this.isExpired(n)?await this.removeCacheItem(n):e.push(n);return e}async clear(){H.debug("Clear Cache");try{const e=await this.getAllKeys();for(const t of e){const e=`${this.config.keyPrefix}${t}`;await this.getStorage().removeItem(e)}}catch(e){H.warn(`clear failed! ${e}`)}}}const K=new c("StorageCache");class X extends J{constructor(e){const t=(()=>{try{if("undefined"!=typeof window&&window.localStorage)return window.localStorage}catch(e){D.info("localStorage not found. InMemoryStorage is used as a fallback.")}return new U})();super({config:e,keyValueStorage:new z(t)}),this.storage=t,this.getItem=this.getItem.bind(this),this.setItem=this.setItem.bind(this),this.removeItem=this.removeItem.bind(this)}async getAllCacheKeys(e){const{omitSizeKey:t}=e??{},n=[];for(let e=0;e<this.storage.length;e++){const i=this.storage.key(e);t&&i===F(this.config.keyPrefix)||i?.startsWith(this.config.keyPrefix)&&n.push(i.substring(this.config.keyPrefix.length))}return n}createInstance(e){return e.keyPrefix&&e.keyPrefix!==V.keyPrefix||(K.error("invalid keyPrefix, setting keyPrefix with timeStamp"),e.keyPrefix=j.toString()),new X(e)}}const Z=new X,Q=G({[O.NoEndpointId]:{message:"Endpoint ID was not found and was unable to be created."},[O.PlatformNotSupported]:{message:"Function not supported on current platform."},[O.Unknown]:{message:"An unknown error occurred."},[O.NetworkError]:{message:"A network error has occurred."}}),Y=new c("getClientInfo");Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var ee=64,te=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ne=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],ie=Math.pow(2,53)-1,re=function(){function e(){this.state=Int32Array.from(ne),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return e.prototype.update=function(e){if(this.finished)throw new Error("Attempted to update an already finished hash.");var t=0,n=e.byteLength;if(this.bytesHashed+=n,8*this.bytesHashed>ie)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;n>0;)this.buffer[this.bufferLength++]=e[t++],n--,this.bufferLength===ee&&(this.hashBuffer(),this.bufferLength=0)},e.prototype.digest=function(){if(!this.finished){var e=8*this.bytesHashed,t=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),n=this.bufferLength;if(t.setUint8(this.bufferLength++,128),n%ee>=56){for(var i=this.bufferLength;i<ee;i++)t.setUint8(i,0);this.hashBuffer(),this.bufferLength=0}for(i=this.bufferLength;i<56;i++)t.setUint8(i,0);t.setUint32(56,Math.floor(e/4294967296),!0),t.setUint32(60,e),this.hashBuffer(),this.finished=!0}var r=new Uint8Array(32);for(i=0;i<8;i++)r[4*i]=this.state[i]>>>24&255,r[4*i+1]=this.state[i]>>>16&255,r[4*i+2]=this.state[i]>>>8&255,r[4*i+3]=this.state[i]>>>0&255;return r},e.prototype.hashBuffer=function(){for(var e=this.buffer,t=this.state,n=t[0],i=t[1],r=t[2],s=t[3],o=t[4],a=t[5],c=t[6],u=t[7],d=0;d<ee;d++){if(d<16)this.temp[d]=(255&e[4*d])<<24|(255&e[4*d+1])<<16|(255&e[4*d+2])<<8|255&e[4*d+3];else{var l=this.temp[d-2],h=(l>>>17|l<<15)^(l>>>19|l<<13)^l>>>10,p=((l=this.temp[d-15])>>>7|l<<25)^(l>>>18|l<<14)^l>>>3;this.temp[d]=(h+this.temp[d-7]|0)+(p+this.temp[d-16]|0)}var f=(((o>>>6|o<<26)^(o>>>11|o<<21)^(o>>>25|o<<7))+(o&a^~o&c)|0)+(u+(te[d]+this.temp[d]|0)|0)|0,g=((n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10))+(n&i^n&r^i&r)|0;u=c,c=a,a=o,o=s+f|0,s=r,r=i,i=n,n=f+g|0}t[0]+=n,t[1]+=i,t[2]+=r,t[3]+=s,t[4]+=o,t[5]+=a,t[6]+=c,t[7]+=u},e}(),se="undefined"!=typeof Buffer&&Buffer.from?function(e){return Buffer.from(e,"utf8")}:e=>(new TextEncoder).encode(e);function oe(e){return e instanceof Uint8Array?e:"string"==typeof e?se(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(e)}var ae=function(){function e(e){this.secret=e,this.hash=new re,this.reset()}return e.prototype.update=function(e){var t;if(("string"==typeof(t=e)?0!==t.length:0!==t.byteLength)&&!this.error)try{this.hash.update(oe(e))}catch(e){this.error=e}},e.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},e.prototype.digest=function(){return e=this,t=void 0,i=function(){return function(e,t){var n,i,r,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,(function(e){return[2,this.digestSync()]}))},new((n=void 0)||(n=Promise))((function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}));var e,t,n,i},e.prototype.reset=function(){if(this.hash=new re,this.secret){this.outer=new re;var e=function(e){var t=oe(e);if(t.byteLength>ee){var n=new re;n.update(t),t=n.digest()}var i=new Uint8Array(ee);return i.set(t),i}(this.secret),t=new Uint8Array(ee);t.set(e);for(var n=0;n<ee;n++)e[n]^=54,t[n]^=92;for(this.hash.update(e),this.outer.update(t),n=0;n<e.byteLength;n++)e[n]=0}},e}();const ce={},ue={};for(let e=0;e<256;e++){let t=e.toString(16).toLowerCase();1===t.length&&(t=`0${t}`),ce[e]=t,ue[t]=e}const de=(e,t)=>{if(t?.aborted)return Promise.resolve();let n,i;const r=new Promise((t=>{i=t,n=setTimeout(t,e)}));return t?.addEventListener("abort",(function e(r){clearTimeout(n),t?.removeEventListener("abort",e),i()})),r},le=(e,t)=>{"[object Object]"===Object.prototype.toString.call(e)&&(e.$metadata={...e.$metadata??{},attempts:t})},he=e=>Object.keys(e).map((e=>e.toLowerCase())).sort().join(";"),pe="X-Amz-Date".toLowerCase(),fe="X-Amz-Security-Token".toLowerCase(),ge="aws4_request",ye="AWS4-HMAC-SHA256",me=(e,t)=>{const n=new ae(e??void 0);return n.update(t),n.digestSync()},ve=(e,t)=>function(e){let t="";for(let n=0;n<e.byteLength;n++)t+=ce[e[n]];return t}(me(e,t)),we=e=>Object.entries(e).map((([e,t])=>({key:e.toLowerCase(),value:t?.trim().replace(/\s+/g," ")??""}))).sort(((e,t)=>e.key<t.key?-1:1)).map((e=>`${e.key}:${e.value}\n`)).join(""),Se=e=>encodeURIComponent(e).replace(/[!'()*]/g,be),be=e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`,Ie=(e,t=!0)=>e?t?encodeURIComponent(e).replace(/%2F/g,"/"):e:"/",Ee=e=>null==e?"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855":Ae(e)?ve(null,e):"UNSIGNED-PAYLOAD",Ae=e=>"string"==typeof e||ArrayBuffer.isView(e)||Ce(e),Ce=e=>"function"==typeof ArrayBuffer&&e instanceof ArrayBuffer||"[object ArrayBuffer]"===Object.prototype.toString.call(e),xe=e=>new Date(Date.now()+e),Ne=e=>{let t;return()=>(t||(t=e()),t)},ke=e=>!["HEAD","GET","DELETE"].includes(e.toUpperCase()),_e=(Re=async({url:e,method:t,headers:n,body:i},{abortSignal:r,cache:s,withCrossDomainCredentials:o})=>{let a;try{a=await fetch(e,{method:t,headers:n,body:ke(t)?i:void 0,signal:r,cache:s,credentials:o?"include":"same-origin"})}catch(e){if(e instanceof TypeError)throw new u({name:O.NetworkError,message:"A network error has occurred.",underlyingError:e});throw e}const c={};return a.headers?.forEach(((e,t)=>{c[t.toLowerCase()]=e})),{statusCode:a.status,headers:c,body:null,body:Object.assign(a.body??{},{text:Ne((()=>a.text())),blob:Ne((()=>a.blob())),json:Ne((()=>a.json()))})}},Pe=[({userAgentHeader:e="x-amz-user-agent",userAgentValue:t=""})=>n=>async function(i){if(0===t.trim().length)return await n(i);{const r=e.toLowerCase();return i.headers[r]=i.headers[r]?`${i.headers[r]} ${t}`:t,await n(i)}},({maxAttempts:e=3,retryDecider:t,computeDelay:n,abortSignal:i})=>{if(e<1)throw new Error("maxAttempts must be greater than 0");return(r,s)=>async function(o){let a,c,u=s.attemptsCount??0;const d=()=>{if(c)return le(c,u),c;throw le(a,u),a};for(;!i?.aborted&&u<e;){try{c=await r(o),a=void 0}catch(e){a=e,c=void 0}u=(s.attemptsCount??0)>u?s.attemptsCount??0:u+1,s.attemptsCount=u;const{isCredentialsExpiredError:l,retryable:h}=await t(c,a,s);if(!h)return d();if(s.isCredentialsExpired=!!l,!i?.aborted&&u<e){const e=n(u);await de(e,i)}}if(i?.aborted)throw new Error("Request aborted.");return d()}},({credentials:e,region:t,service:n,uriEscapePath:i=!0})=>{let r;return(s,o)=>async function(a){r=r??0;const c={credentials:"function"==typeof e?await e({forceRefresh:!!o?.isCredentialsExpired}):e,signingDate:xe(r),signingRegion:t,signingService:n,uriEscapePath:i},u=await((e,t)=>{const n=(({credentials:e,signingDate:t=new Date,signingRegion:n,signingService:i,uriEscapePath:r=!0})=>{const{accessKeyId:s,secretAccessKey:o,sessionToken:a}=e,{longDate:c,shortDate:u}=(e=>{const t=e.toISOString().replace(/[:-]|\.\d{3}/g,"");return{longDate:t,shortDate:t.slice(0,8)}})(t);return{accessKeyId:s,credentialScope:`${u}/${n}/${i}/${ge}`,longDate:c,secretAccessKey:o,sessionToken:a,shortDate:u,signingRegion:n,signingService:i,uriEscapePath:r}})(t),{accessKeyId:i,credentialScope:r,longDate:s,sessionToken:o}=n,a={...e.headers};a.host=e.url.host,a[pe]=s,o&&(a[fe]=o);const c={...e,headers:a},u=((e,{credentialScope:t,longDate:n,secretAccessKey:i,shortDate:r,signingRegion:s,signingService:o,uriEscapePath:a})=>{const c=(({body:e,headers:t,method:n,url:i},r=!0)=>{return[n,Ie(i.pathname,r),(s=i.searchParams,Array.from(s).sort((([e,t],[n,i])=>e===n?t<i?-1:1:e<n?-1:1)).map((([e,t])=>`${Se(e)}=${Se(t)}`)).join("&")),we(t),he(t),Ee(e)].join("\n");var s})(e,a),u=((e,t,n)=>[ye,e,t,n].join("\n"))(n,t,ve(null,c)),d=ve(((e,t,n,i)=>{const r=me(`AWS4${e}`,t),s=me(r,n),o=me(s,i);return me(o,ge)})(i,r,s,o),u);return d})(c,n),d=`Credential=${i}/${r}`,l=`SignedHeaders=${he(a)}`,h=`Signature=${u}`;return a.authorization=`${ye} ${d}, ${l}, ${h}`,c})(a,c),d=await s(u),l=(({headers:e}={})=>e?.date??e?.Date??e?.["x-amz-date"])(d);return l&&(r=((e,t)=>((e,t)=>Math.abs(xe(t).getTime()-e)>=3e5)(e,t)?e-Date.now():t)(Date.parse(l),r)),d}}],(e,t)=>{const n={};let i=e=>Re(e,t);for(let e=Pe.length-1;e>=0;e--)i=(0,Pe[e])(t)(i,n);return i(e)});var Re,Pe;const Te=(e,t,n,i)=>async(r,s)=>{const o={...i,...r},a=await o.endpointResolver(o,s),c=await t(s,a),u=await e(c,{...o});return n(u)},Le=e=>encodeURIComponent(e).replace(/[!'()*]/g,Oe),Oe=e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`,$e=e=>{const{headers:t,statusCode:n}=e;return{...ze(e)?e.$metadata:{},httpStatusCode:n,requestId:t["x-amzn-requestid"]??t["x-amzn-request-id"]??t["x-amz-request-id"],extendedRequestId:t["x-amz-id-2"],cfId:t["x-amz-cf-id"]}},ze=e=>"object"==typeof e?.$metadata,Ue=async e=>{if(!e||e.statusCode<300)return;const t=await De(e),n=(e=>{const[t]=e.toString().split(/[,:]+/);return t.includes("#")?t.split("#")[1]:t})(e.headers["x-amzn-errortype"]??t.code??t.__type??"UnknownError"),i=t.message??t.Message??"Unknown error",r=new Error(i);return Object.assign(r,{name:n,$metadata:$e(e)})},De=async e=>{if(!e.body)throw new Error("Missing response payload");const t=await e.body.json();return Object.assign(t,{$metadata:$e(e)})},Ve=URL,Me={id:"aws",outputs:{dnsSuffix:"amazonaws.com"},regionRegex:"^(us|eu|ap|sa|ca|me|af)\\-\\w+\\-\\d+$",regions:["aws-global"]},Be={partitions:[Me,{id:"aws-cn",outputs:{dnsSuffix:"amazonaws.com.cn"},regionRegex:"^cn\\-\\w+\\-\\d+$",regions:["aws-cn-global"]}]},je=e=>{const{partitions:t}=Be;for(const{regions:n,outputs:i,regionRegex:r}of t){const t=new RegExp(r);if(n.includes(e)||t.test(e))return i.dnsSuffix}return Me.outputs.dnsSuffix},Fe=3e5,Ge=["AuthFailure","InvalidSignatureException","RequestExpired","RequestInTheFuture","RequestTimeTooSkewed","SignatureDoesNotMatch","BadRequestException"],qe=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException"],We=["TimeoutError","RequestTimeout","RequestTimeoutException"],He=(e,t)=>429===e||!!t&&qe.includes(t),Je=e=>[O.NetworkError,"ERR_NETWORK"].includes(e?.name),Ke=(e,t)=>!!e&&[500,502,503,504].includes(e)||!!t&&We.includes(t),Xe="6.10.2",Ze=()=>"undefined"!=typeof global,Qe=()=>"undefined"!=typeof window,Ye=()=>"undefined"!=typeof document,et=()=>"undefined"!=typeof process,tt=(e,t)=>!!Object.keys(e).find((e=>e.startsWith(t))),nt=[{platform:p.Expo,detectionMethod:function(){return Ze()&&void 0!==global.expo}},{platform:p.ReactNative,detectionMethod:function(){return"undefined"!=typeof navigator&&void 0!==navigator.product&&"ReactNative"===navigator.product}},{platform:p.NextJs,detectionMethod:function(){return Qe()&&window.next&&"object"==typeof window.next}},{platform:p.Nuxt,detectionMethod:function(){return Qe()&&(void 0!==window.__NUXT__||void 0!==window.$nuxt)}},{platform:p.Angular,detectionMethod:function(){const e=Boolean(Ye()&&document.querySelector("[ng-version]")),t=Boolean(Qe()&&void 0!==window.ng);return e||t}},{platform:p.React,detectionMethod:function(){const e=e=>e.startsWith("_react")||e.startsWith("__react");return Ye()&&Array.from(document.querySelectorAll("[id]")).some((t=>Object.keys(t).find(e)))}},{platform:p.VueJs,detectionMethod:function(){return Qe()&&tt(window,"__VUE")}},{platform:p.Svelte,detectionMethod:function(){return Qe()&&tt(window,"__SVELTE")}},{platform:p.WebUnknown,detectionMethod:function(){return Qe()}},{platform:p.NextJsSSR,detectionMethod:function(){return Ze()&&(tt(global,"__next")||tt(global,"__NEXT"))}},{platform:p.NuxtSSR,detectionMethod:function(){return Ze()&&void 0!==global.__NUXT_PATHS__}},{platform:p.ReactSSR,detectionMethod:function(){return et()&&void 0!==process.env&&!!Object.keys(process.env).find((e=>e.includes("react")))}},{platform:p.VueJsSSR,detectionMethod:function(){return Ze()&&tt(global,"__VUE")}},{platform:p.AngularSSR,detectionMethod:function(){return et()&&"object"==typeof process.env&&process.env.npm_lifecycle_script?.startsWith("ng ")||!1}},{platform:p.SvelteSSR,detectionMethod:function(){return et()&&void 0!==process.env&&!!Object.keys(process.env).find((e=>e.includes("svelte")))}}];let it;const rt=[];let st=!1;const ot=()=>{if(!it){if(it=nt.find((e=>e.detectionMethod()))?.platform||p.ServerSideUnknown,st)for(;rt.length;)rt.pop()?.();else rt.forEach((e=>{e()}));at(p.ServerSideUnknown,10),at(p.WebUnknown,10)}return it};function at(e,t){it!==e||st||setTimeout((()=>{it=void 0,st=!0,setTimeout(ot,1e3)}),t)}const ct={},ut="aws-amplify",dt=e=>e.replace(/\+.*/,"");new class{constructor(){this.userAgent=`${ut}/${dt(Xe)}`}get framework(){return ot()}get isReactNative(){return this.framework===p.ReactNative||this.framework===p.Expo}observeFrameworkChanges(e){(e=>{st||rt.push(e)})(e)}};const lt=e=>(({category:e,action:t}={})=>{const n=[[ut,dt(Xe)]];if(e&&n.push([e,t]),n.push(["framework",ot()]),e&&t){const i=((e,t)=>ct[e]?.[t]?.additionalDetails)(e,t);i&&i.forEach((e=>{n.push(e)}))}return n})(e).map((([e,t])=>e&&t?`${e}/${t}`:e)).join(" "),ht={service:"mobiletargeting",endpointResolver:({region:e})=>({url:new Ve(`https://pinpoint.${e}.${je(e)}`)}),retryDecider:(pt=Ue,async(e,t)=>{const n=t??await pt(e)??void 0,i=n?.code||n?.name,r=e?.statusCode;return{retryable:Je(t)||He(r,i)||(e=>!!e&&Ge.includes(e))(i)||Ke(r,i)}}),computeDelay:e=>{const t=function(e=3e5){return t=>{const n=2**t*100+100*Math.random();return!(n>e)&&n}}(Fe),n=t(e);return!1===n?Fe:n},userAgentValue:lt()};var pt;const ft=Te(_e,(({ApplicationId:e="",EndpointId:t="",EndpointRequest:n},i)=>{const r=new Ve(i.url);return r.pathname=`v1/apps/${Le(e)}/endpoints/${Le(t)}`,{method:"PUT",headers:{"content-type":"application/json"},url:r,body:JSON.stringify(n)}}),(async e=>{if(e.statusCode>=300)throw await Ue(e);{const{Message:t,RequestID:n}=await De(e);return{MessageBody:{Message:t,RequestID:n},$metadata:$e(e)}}}),ht),gt=(e,t)=>`${t}:pinpoint:${e}`,yt={},mt=async(e,t)=>{const n=gt(e,t);return await Z.getItem(n)??void 0},vt=async({address:e,appId:t,category:n,channelType:i,credentials:r,identityId:s,optOut:o,region:a,userAttributes:c,userId:u,userProfile:d,userAgentValue:l})=>{const h=await mt(t,n),p=h?void 0:((e,t)=>{const n=gt(e,t);return yt[n]||(yt[n]=L()),yt[n]})(t,n),{customProperties:f,demographic:g,email:y,location:m,metrics:v,name:w,plan:S}=d??{},b={},I=p?u??s:u;if(p){const e="undefined"==typeof window?{}:function(){if("undefined"==typeof window)return Y.warn("No window object available to get browser client info"),{};const e=window.navigator;if(!e)return Y.warn("No navigator object available to get browser client info"),{};const{platform:t,product:n,vendor:i,userAgent:r,language:s}=e,o=function(e){const t=/.+(Opera[\s[A-Z]*|OPR[\sA-Z]*)\/([0-9.]+).*/i.exec(e);if(t)return{type:t[1],version:t[2]};const n=/.+(Trident|Edge|Edg|EdgA|EdgiOS)\/([0-9.]+).*/i.exec(e);if(n)return{type:n[1],version:n[2]};const i=/.+(Chrome|CriOS|Firefox|FxiOS)\/([0-9.]+).*/i.exec(e);if(i)return{type:i[1],version:i[2]};const r=/.+(Safari)\/([0-9.]+).*/i.exec(e);if(r)return{type:r[1],version:r[2]};const s=/.+(AppleWebKit)\/([0-9.]+).*/i.exec(e);if(s)return{type:s[1],version:s[2]};const o=/.*([A-Z]+)\/([0-9.]+).*/i.exec(e);return o?{type:o[1],version:o[2]}:{type:"",version:""}}(r),a=function(){const e=/\(([A-Za-z\s].*)\)/.exec((new Date).toString());return e&&e[1]||""}();return{platform:t,make:n||i,model:o.type,version:o.version,appVersion:[o.type,o.version].join("/"),language:s,timezone:a}}();b.appVersion=e.appVersion,b.make=e.make,b.model=e.model,b.modelVersion=e.version,b.platform=e.platform}const E={...b,...g},A={...y&&{email:[y]},...w&&{name:[w]},...S&&{plan:[S]},...f},C=p||g,x=y||f||w||S,N=I||c,k={ApplicationId:t,EndpointId:h??p,EndpointRequest:{RequestId:L(),EffectiveDate:(new Date).toISOString(),ChannelType:i,Address:e,...x&&{Attributes:A},...C&&{Demographic:{AppVersion:E.appVersion,Locale:E.locale,Make:E.make,Model:E.model,ModelVersion:E.modelVersion,Platform:E.platform,PlatformVersion:E.platformVersion,Timezone:E.timezone}},...m&&{Location:{City:m.city,Country:m.country,Latitude:m.latitude,Longitude:m.longitude,PostalCode:m.postalCode,Region:m.region}},Metrics:v,OptOut:o,...N&&{User:{UserId:I,UserAttributes:c}}}};try{await ft({credentials:r,region:a,userAgentValue:l},k),p&&await(async(e,t,n)=>{const i=gt(e,t),r=(new Date).getTime()+31536e8;return Z.setItem(i,n,{expires:r,priority:1})})(t,n,p)}finally{p&&((e,t)=>{const n=gt(e,t);delete yt[n]})(t,n)}};var wt;!function(e){e.NoAppId="NoAppId"}(wt||(wt={}));const St=G({[wt.NoAppId]:{message:"Missing application id."}}),bt=Te(_e,(({ApplicationId:e,EventsRequest:t},n)=>{St(!!e,wt.NoAppId);const i=new Ve(n.url);return i.pathname=`v1/apps/${Le(e)}/events`,{method:"POST",headers:{"content-type":"application/json"},url:i,body:JSON.stringify(t??{})}}),(async e=>{if(e.statusCode>=300)throw await Ue(e);{const{Results:t}=await De(e);return{EventsResponse:{Results:t},$metadata:$e(e)}}}),ht),It=new c("PinpointEventBuffer"),Et=[429,500],At=[202];class Ct{constructor(e){this._interval=void 0,this._pause=!1,this._flush=!1,this._buffer=[],this._config=e,this._sendBatch=this._sendBatch.bind(this),this._startLoop()}push(e){this._buffer.length>=this._config.bufferSize?It.debug("Exceeded Pinpoint event buffer limits, event dropped.",{eventId:e.eventId}):this._buffer.push({[e.eventId]:e})}pause(){this._pause=!0}resume(){this._pause=!1}flush(){this._flush=!0}identityHasChanged(e){return this._config.identityId!==e}flushAll(){this._putEvents(this._buffer.splice(0,this._buffer.length))}_startLoop(){this._interval&&clearInterval(this._interval);const{flushInterval:e}=this._config;this._interval=setInterval(this._sendBatch,e)}_sendBatch(){const e=this._buffer.length;if(this._flush&&!e&&this._interval&&clearInterval(this._interval),this._pause||!e)return;const{flushSize:t}=this._config,n=Math.min(t,e),i=this._buffer.splice(0,n);this._putEvents(i)}async _putEvents(e){const t=this._bufferToMap(e),n=this._generateBatchEventParams(t);try{const{credentials:e,region:i,userAgentValue:r}=this._config,s=await bt({credentials:e,region:i,userAgentValue:r},n);this._processPutEventsSuccessResponse(s,t)}catch(e){this._handlePutEventsFailure(e,t)}}_generateBatchEventParams(e){const t={};return Object.values(e).forEach((e=>{const{event:n,timestamp:i,endpointId:r,eventId:s,session:o}=e,{name:a,attributes:c,metrics:u}=n;t[r]={Endpoint:{...t[r]?.Endpoint},Events:{...t[r]?.Events,[s]:{EventType:a,Timestamp:new Date(i).toISOString(),Attributes:c,Metrics:u,Session:o}}}})),{ApplicationId:this._config.appId,EventsRequest:{BatchItem:t}}}_handlePutEventsFailure(e,t){It.debug("putEvents call to Pinpoint failed.",e);const n=e.$metadata&&e.$metadata.httpStatusCode;if(Et.includes(n)){const e=Object.values(t);this._retry(e)}}_processPutEventsSuccessResponse(e,t){const{Results:n={}}=e.EventsResponse??{},i=[];Object.entries(n).forEach((([e,n])=>{const r=n.EventsItemResponse??{};Object.entries(r).forEach((([e,n])=>{const r=t[e];if(!r)return;const{StatusCode:s,Message:o}=n??{};if(s&&At.includes(s))return;if(s&&Et.includes(s))return void i.push(r);const{name:a}=r.event;It.warn("Pinpoint event failed to send.",{eventId:e,name:a,message:o})}))})),i.length&&this._retry(i)}_retry(e){const t=[];e.forEach((e=>{const{eventId:n}=e,{name:i}=e.event;if(e.resendLimit-- >0)return It.debug("Resending event.",{eventId:n,name:i,remainingAttempts:e.resendLimit}),void t.push({[n]:e});It.debug("No retry attempts remaining for event.",{eventId:n,name:i})})),this._buffer.unshift(...t)}_bufferToMap(e){return e.reduce(((e,t)=>{const[[n,i]]=Object.entries(t);return e[n]=i,e}),{})}}const xt={},Nt=({appId:e,region:t,credentials:n,bufferSize:i,flushInterval:r,flushSize:s,resendLimit:o,identityId:a,userAgentValue:c})=>{if(xt[t]?.[e]){const n=xt[t][e];if(!n.identityHasChanged(a))return n;n.flush()}const u=new Ct({appId:e,bufferSize:i,credentials:n,flushInterval:r,flushSize:s,identityId:a,region:t,resendLimit:o,userAgentValue:c});return xt[t]||(xt[t]={}),xt[t][e]=u,u},kt="_session.start",_t="_session.stop";let Rt;class Pt extends u{constructor(e){super(e),this.constructor=Pt,Object.setPrototypeOf(this,Pt.prototype)}}var Tt;!function(e){e.NoAppId="NoAppId",e.NoCredentials="NoCredentials",e.NoEventName="NoEventName",e.NoRegion="NoRegion",e.InvalidTracker="InvalidTracker",e.UnsupportedPlatform="UnsupportedPlatform",e.NoTrackingId="NoTrackingId",e.InvalidFlushSize="InvalidFlushSize"}(Tt||(Tt={}));const Lt={[Tt.NoAppId]:{message:"Missing application id."},[Tt.NoCredentials]:{message:"Credentials should not be empty."},[Tt.NoEventName]:{message:"Events must specify a name."},[Tt.NoRegion]:{message:"Missing region."},[Tt.InvalidTracker]:{message:"Invalid tracker type specified."},[Tt.UnsupportedPlatform]:{message:"Only session tracking is supported on React Native."},[Tt.InvalidFlushSize]:{message:"Invalid FlushSize, it should be smaller than BufferSize"},[Tt.NoTrackingId]:{message:"A trackingId is required to use Amazon Personalize"}};function Ot(e,t,n){const{message:i,recoverySuggestion:r}=Lt[t];if(!e)throw new Pt({name:t,message:n??i,recoverySuggestion:r})}let $t=!0;function zt(e){return lt({category:f.Analytics,action:e})}const Ut=()=>{const{appId:e,region:t,bufferSize:n,flushSize:i,flushInterval:r,resendLimit:s}=o.Amplify.getConfig().Analytics?.Pinpoint??{};return Ot(!!e,Tt.NoAppId),Ot(!!t,Tt.NoRegion),{appId:e,region:t,bufferSize:n,flushSize:i,flushInterval:r,resendLimit:s}},Dt=async()=>{const{credentials:e,identityId:t}=await(0,o.fetchAuthSession)();return Ot(!!e,Tt.NoCredentials),{credentials:e,identityId:t}},Vt=new o.ConsoleLogger("Analytics"),Mt=e=>{const{appId:t,region:n,bufferSize:i,flushSize:r,flushInterval:s,resendLimit:a}=Ut();$t?(Ot(!!e.name,Tt.NoEventName),Dt().then((({credentials:c,identityId:u})=>{o.Hub.dispatch("analytics",{event:"record",data:e,message:"Recording Analytics event"},"Analytics",d),(async({appId:e,category:t,channelType:n,credentials:i,event:r,identityId:s,region:o,userAgentValue:a,bufferSize:c,flushInterval:u,flushSize:d,resendLimit:l})=>{let h=Rt;const p=new Date,f=p.toISOString(),g=L(),y=Nt({appId:e,region:o,credentials:i,bufferSize:c??1e3,flushInterval:u??5e3,flushSize:d??100,resendLimit:l??5,identityId:s,userAgentValue:a}),m=await(async({address:e,appId:t,category:n,channelType:i,credentials:r,identityId:s,region:o,userAgentValue:a})=>{let c=await mt(t,n);return c||(await vt({address:e,appId:t,category:n,channelType:i,credentials:r,identityId:s,region:o,userAgentValue:a}),c=await mt(t,n)),Q(!!c,O.NoEndpointId),c})({appId:e,category:t,channelType:n,credentials:i,identityId:s,region:o,userAgentValue:a});if(!h||r.name===kt){const e=L();Rt={Id:e,StartTimestamp:f},h=Rt}Rt&&r.name===_t&&(h={...Rt,StopTimestamp:f,Duration:p.getTime()-new Date(Rt.StartTimestamp).getTime()},Rt=void 0),y.push({eventId:g,endpointId:m,event:r,session:h,timestamp:f,resendLimit:l??5})})({appId:t,category:"Analytics",credentials:c,event:e,identityId:u,region:n,userAgentValue:zt(y.Record),bufferSize:i,flushSize:r,flushInterval:s,resendLimit:a})})).catch((e=>{Vt.warn("Failed to record event.",e)}))):Vt.debug("Analytics is disabled, event will not be recorded.")},Bt=async({userId:e,userProfile:t,options:n})=>{const{credentials:i,identityId:r}=await Dt(),{appId:s,region:o}=Ut(),{userAttributes:a}=n??{};await vt({appId:s,category:"Analytics",credentials:i,identityId:r,region:o,userAttributes:a,userId:e,userProfile:t,userAgentValue:zt(y.IdentifyUser)})},jt=()=>"undefined"!=typeof window&&void 0!==window.document,Ft=["click"],Gt=new o.ConsoleLogger("EventTracker");class qt{constructor(e,t){this.options={},this.trackerActive=!1,this.eventRecorder=e,this.handleDocEvent=this.handleDocEvent.bind(this),this.configure(e,t)}configure(e,t){this.eventRecorder=e,this.cleanup(),this.options={attributes:t?.attributes??void 0,events:t?.events??Ft,selectorPrefix:t?.selectorPrefix??"data-amplify-analytics-"},jt()&&(this.options.events?.forEach((e=>{document.addEventListener(e,this.handleDocEvent,{capture:!0})})),this.trackerActive=!0)}cleanup(){this.trackerActive&&this.options.events?.forEach((e=>{document.removeEventListener(e,this.handleDocEvent,{capture:!0})}))}handleDocEvent(e){const t=`[${this.options.selectorPrefix}on]`,n=`${this.options.selectorPrefix}attrs`,i=`${this.options.selectorPrefix}name`,r=e.target;if(this.options.events?.includes(e.type)&&r instanceof HTMLElement){const s=r.closest(t);if(s){const t=s.getAttribute(i)||"event",r={},o=s.getAttribute(n);o?.split(/\s*,\s*/).forEach((e=>{const t=e.trim().split(/\s*:\s*/);r[t[0]]=t[1]}));const a=Object.assign({type:e.type,target:`${s.localName} with id ${s.id}`},this.options.attributes,r);Gt.debug("Recording automatically tracked DOM event",{eventName:t,attributes:a}),this.eventRecorder(t,a)}}}}const Wt=new o.ConsoleLogger("PageViewTracker"),Ht="pageView",Jt=()=>window.location.origin+window.location.pathname,Kt="aws-amplify-analytics-prevUrl";class Xt{constructor(e,t){this.options={},this.trackerActive=!0,this.eventRecorder=e,this.spaTrackingActive=!1,this.handleLocationChange=this.handleLocationChange.bind(this),this.configure(e,t)}configure(e,t){this.eventRecorder=e,this.cleanup(),this.options={appType:t?.appType??"singlePage",attributes:t?.attributes??void 0,eventName:this.options?.eventName??Ht,urlProvider:this.options?.urlProvider??Jt},jt()&&("singlePage"===this.options.appType?this.setupSPATracking():this.setupMPATracking(),this.trackerActive=!0)}cleanup(){this.trackerActive&&this.spaTrackingActive&&(window.history.pushState=this.originalPushState,window.history.replaceState=this.originalReplaceState,this.pushStateProxy?.revoke(),this.replaceStateProxy?.revoke(),window.removeEventListener("popstate",this.handleLocationChange),this.spaTrackingActive=!1)}setupSPATracking(){this.spaTrackingActive||(this.pushStateProxy=Proxy.revocable(window.history.pushState,{apply:(e,t,n)=>{e.apply(t,n),this.handleLocationChange()}}),this.replaceStateProxy=Proxy.revocable(window.history.replaceState,{apply:(e,t,n)=>{e.apply(t,n),this.handleLocationChange()}}),this.originalPushState=window.history.pushState,this.originalReplaceState=window.history.replaceState,window.history.pushState=this.pushStateProxy.proxy,window.history.replaceState=this.replaceStateProxy.proxy,window.addEventListener("popstate",this.handleLocationChange),sessionStorage.removeItem(Kt),this.spaTrackingActive=!0)}setupMPATracking(){this.handleLocationChange()}handleLocationChange(){const e=this.options.urlProvider(),t=this.options.eventName||Ht;if(this.urlHasChanged()){sessionStorage.setItem(Kt,e);const n=Object.assign({url:e},this.options.attributes);Wt.debug("Recording automatically tracked page view event",{eventName:t,attributes:n}),this.eventRecorder(t,n)}}urlHasChanged(){const e=sessionStorage.getItem(Kt);return this.options.urlProvider()!==e}}const Zt=new Set,Qt=new class{constructor(){this.listenerActive=!1,this.handleVisibilityChange=this.handleVisibilityChange.bind(this),jt()&&(document.addEventListener("visibilitychange",this.handleVisibilityChange,!1),this.listenerActive=!0)}addStateChangeListener(e,t=!1){this.listenerActive&&(Zt.add(e),t&&e(this.getSessionState()))}removeStateChangeListener(e){this.listenerActive&&Zt.delete(e)}handleVisibilityChange(){this.notifyHandlers()}notifyHandlers(){const e=this.getSessionState();Zt.forEach((t=>{t(e)}))}getSessionState(){return jt()&&"hidden"!==document.visibilityState?"started":"ended"}},Yt=new o.ConsoleLogger("SessionTracker");class en{constructor(e,t){this.options={},this.eventRecorder=e,this.sessionTrackingActive=!1,this.initialEventSent=!1,this.handleStateChange=this.handleStateChange.bind(this),this.configure(e,t)}configure(e,t){this.eventRecorder=e,this.cleanup(),this.options={attributes:t?.attributes??{}},this.sessionTrackingActive||(Qt.addStateChangeListener(this.handleStateChange,!this.initialEventSent),this.sessionTrackingActive=!0)}cleanup(){this.sessionTrackingActive&&Qt.removeStateChangeListener(this.handleStateChange),this.sessionTrackingActive=!1}handleStateChange(e){"started"===e?this.sessionStarted():this.sessionStopped()}sessionStarted(){const e=this.options.attributes??{};Yt.debug("Recording automatically tracked page view event",{SESSION_START_EVENT:kt,attributes:e}),this.eventRecorder(kt,e),this.initialEventSent||(this.initialEventSent=!0)}sessionStopped(){const e=this.options.attributes??{};Yt.debug("Recording automatically tracked page view event",{SESSION_STOP_EVENT:_t,attributes:e}),this.eventRecorder(_t,e)}}const tn={},nn=(e,t)=>{Mt({name:e,attributes:t})},rn=e=>{(e=>{Ot("event"===e.type||"pageView"===e.type||"session"===e.type,Tt.InvalidTracker)})(e),((e,t,n)=>{let i;const r=e.type,s=n[r];e.enable?s?s.configure(t,e.options):("event"===r?i=new qt(t,e.options):"pageView"===r?i=new Xt(t,e.options):"session"===r&&(i=new en(t,e.options)),i&&(n[r]=i)):s&&(s.cleanup(),delete n[r])})(e,nn,tn)},sn=new o.ConsoleLogger("Analytics"),on=()=>{const{appId:e,region:t,bufferSize:n,flushSize:i,flushInterval:r,resendLimit:s}=Ut();Dt().then((({credentials:o,identityId:a})=>{(({appId:e,region:t,credentials:n,bufferSize:i,flushInterval:r,flushSize:s,resendLimit:o,identityId:a,userAgentValue:c})=>{Nt({appId:e,region:t,credentials:n,bufferSize:i??1e3,flushInterval:r??5e3,flushSize:s??100,resendLimit:o??5,identityId:a,userAgentValue:c}).flushAll()})({appId:e,region:t,credentials:o,identityId:a,bufferSize:n,flushSize:i,flushInterval:r,resendLimit:s,userAgentValue:zt(y.Record)})})).catch((e=>{sn.warn("Failed to flush events",e)}))},an=()=>{$t=!0},cn=()=>{$t=!1};return r})()));
//# sourceMappingURL=aws-amplify-analytics.min.js.map