!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("aws_amplify_core"),require("graphql")):"function"==typeof define&&define.amd?define("aws_amplify_api",["aws_amplify_core","graphql"],t):"object"==typeof exports?exports.aws_amplify_api=t(require("aws_amplify_core"),require("graphql")):e.aws_amplify_api=t(e.aws_amplify_core,e.graphql)}(this,((e,t)=>(()=>{"use strict";var n={556:t=>{t.exports=e},49:e=>{e.exports=t}},r={};function o(e){var t=r[e];if(void 0!==t)return t.exports;var i=r[e]={exports:{}};return n[e](i,i.exports,o),i.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};o.r(i),o.d(i,{ApiError:()=>Sn,CONNECTION_STATE_CHANGE:()=>zr,ConnectionState:()=>mo,GraphQLAuthError:()=>St,del:()=>$r,events:()=>s,generateClient:()=>ci,get:()=>Mr,head:()=>qr,isCancelError:()=>Tn,patch:()=>Ur,post:()=>Dr,put:()=>Lr});var s={};o.r(s),o.d(s,{closeAll:()=>mi,connect:()=>yi,post:()=>bi});var a=o(556);function c(e){return"function"==typeof e}function u(e){return function(t){if(function(e){return c(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}Symbol();var l=function(e,t){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},l(e,t)};function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}l(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function p(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function h(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function f(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function y(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function b(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}function m(e){return this instanceof m?(this.v=e,this):new m(e)}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var g,S=((g=function(e){var t;t=this,Error.call(t),t.stack=(new Error).stack,this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}).prototype=Object.create(Error.prototype),g.prototype.constructor=g,g);function v(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var w=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,n,r,o;if(!this.closed){this.closed=!0;var i=this._parentage;if(i)if(this._parentage=null,Array.isArray(i))try{for(var s=f(i),a=s.next();!a.done;a=s.next())a.value.remove(this)}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else i.remove(this);var u=this.initialTeardown;if(c(u))try{u()}catch(e){o=e instanceof S?e.errors:[e]}var l=this._finalizers;if(l){this._finalizers=null;try{for(var d=f(l),p=d.next();!p.done;p=d.next()){var h=p.value;try{T(h)}catch(e){o=null!=o?o:[],e instanceof S?o=b(b([],y(o)),y(e.errors)):o.push(e)}}}catch(e){n={error:e}}finally{try{p&&!p.done&&(r=d.return)&&r.call(d)}finally{if(n)throw n.error}}}if(o)throw new S(o)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)T(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&v(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&v(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}();function E(e){return e instanceof w||e&&"closed"in e&&c(e.remove)&&c(e.add)&&c(e.unsubscribe)}function T(e){c(e)?e():e.unsubscribe()}w.EMPTY;var A=null,C=null,N=void 0,O=!1,_=!1,k={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=k.delegate;return(null==o?void 0:o.setTimeout)?o.setTimeout.apply(o,b([e,t],y(n))):setTimeout.apply(void 0,b([e,t],y(n)))},clearTimeout:function(e){var t=k.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function I(e){k.setTimeout((function(){if(!A)throw e;A(e)}))}function R(){}var x=P("C",void 0,void 0);function P(e,t,n){return{kind:e,value:t,error:n}}var M=null,D=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,E(t)&&t.add(n)):n.destination=K,n}return d(t,e),t.create=function(e,t,n){return new U(e,t,n)},t.prototype.next=function(e){this.isStopped?G(function(e){return P("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?G(P("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?G(x,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(w),L=Function.prototype.bind;function $(e,t){return L.call(e,t)}var q=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){j(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){j(e)}else j(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){j(e)}},e}(),U=function(e){function t(t,n,r){var o,i,s=e.call(this)||this;return c(t)||!t?o={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:s&&_?((i=Object.create(t)).unsubscribe=function(){return s.unsubscribe()},o={next:t.next&&$(t.next,i),error:t.error&&$(t.error,i),complete:t.complete&&$(t.complete,i)}):o=t,s.destination=new q(o),s}return d(t,e),t}(D);function j(e){var t;O?(t=e,O&&M&&(M.errorThrown=!0,M.error=t)):I(e)}function G(e,t){var n=C;n&&k.setTimeout((function(){return n(e,t)}))}var K={closed:!0,next:R,error:function(e){throw e},complete:R};function F(e,t,n,r,o){return new W(e,t,n,r,o)}var W=function(e){function t(t,n,r,o,i,s){var a=e.call(this,t)||this;return a.onFinalize=i,a.shouldUnsubscribe=s,a._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,a._error=o?function(e){try{o(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return d(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(D);function H(e,t){return u((function(n,r){var o=0;n.subscribe(F(r,(function(n){r.next(e.call(t,n,o++))})))}))}function B(e){const t=new Set;for(const r of e.attributes||[])if(n=r,"auth"===n?.type&&"object"==typeof n?.properties&&Array.isArray(n?.properties?.rules)&&(n?.properties?.rules).every((e=>!!e.allow)))for(const e of r.properties.rules)"owner"===e.allow?t.add(e.ownerField||"owner"):"groups"===e.allow&&void 0!==e.groupsField&&t.add(e.groupsField);var n;return Array.from(t)}function z(e){return`${e[0].toUpperCase()}${e.slice(1)}`}function Q(e){let t,n;const r=new Promise(((e,r)=>{t=e,n=r}));return e(r).then((e=>{t(e)})).catch((e=>{n(e)})),r}const V=new WeakMap;function J(e,t){return V.set(t,e),e.finally((()=>{V.delete(t)}))}const Y={HAS_ONE:"HAS_ONE",HAS_MANY:"HAS_MANY",BELONGS_TO:"BELONGS_TO"},X={ID:"ID",String:"String",AWSDate:"String",AWSTime:"String",AWSDateTime:"String",AWSTimestamp:"Int",AWSEmail:"String",AWSPhone:"String",AWSURL:"String",AWSIPAddress:"String",AWSJSON:"String",Boolean:"Boolean",Int:"Int",Float:"Float"},Z=e=>1===e.length?e[0]:e.reduce(((e,t,n)=>0===n?t:e+z(t)),""),ee=(e,t,n)=>{if(!n)return null;const r={};for(const[i,s]of Object.entries(n)){const n=t?e.models[t]?.fields[i]:void 0,a={fieldDef:n,value:s};o=a,"object"==typeof o.fieldDef?.type&&"model"in o.fieldDef.type&&"string"==typeof o.fieldDef.type.model&&o.fieldDef.isArray&&Array.isArray(o.value?.items)?r[i]=a.value.items.map((t=>ee(e,a.fieldDef.type.model,t))):te(n)?r[i]=ee(e,n.type.model,s):r[i]=s}var o;return r};function te(e){return"object"==typeof e?.type&&"model"in e.type&&"string"==typeof e.type.model}function ne(e,t,n,r,o,i,s=!1){const a=r.models[t],c=a.fields,u=Object.entries(c).filter((([e,t])=>void 0!==t?.type?.model)).map((([e])=>e));return n.map((t=>{if(null==t)return t;const n={};for(const l of u){const u=c[l],d=u?.type,p=d.model,h=r.models[p],f=h.primaryKeyInfo.primaryKeyFieldName,y=h.primaryKeyInfo.sortKeyFieldNames,b=u.association?.connectionType;let m=[];u.association&&"associatedWith"in u.association&&(m=u.association.associatedWith);const g=[];switch(u.association&&"targetNames"in u.association&&g.push(...u.association.targetNames),b){case Y.BELONGS_TO:{const r=y.reduce(((e,n)=>{if(t[n])return e[n]=t[n]}),{});if(void 0===e.models[p]?.get)break;n[l]=s?(n,s)=>t[g[0]]?e.models[p].get(n,{[f]:t[g[0]],...r},{authMode:s?.authMode||o,authToken:s?.authToken||i}):{data:null}:n=>t[g[0]]?e.models[p].get({[f]:t[g[0]],...r},{authMode:n?.authMode||o,authToken:n?.authToken||i}):{data:null};break}case Y.HAS_ONE:case Y.HAS_MANY:{const r=b===Y.HAS_ONE?e=>({data:e?.data.shift()||null,errors:e.errors,extensions:e.extensions}):e=>e,c=a.primaryKeyInfo.primaryKeyFieldName,u=a.primaryKeyInfo.sortKeyFieldNames,d=h.fields[m[0]];if(d.type.model){let a=[];d.association&&"targetNames"in d.association&&(a=d.association?.targetNames);const h=a.map(((e,n)=>0===n?{[e]:{eq:t[c]}}:{[e]:{eq:t[u[n-1]]}}));if(void 0===e.models[p]?.list)break;n[l]=s?(n,s)=>t[c]?Q((async t=>{const a=J(e.models[p].list(n,{filter:{and:h},limit:s?.limit,nextToken:s?.nextToken,authMode:s?.authMode||o,authToken:s?.authToken||i}),t);return r(await a)})):[]:n=>t[c]?Q((async t=>{const s=J(e.models[p].list({filter:{and:h},limit:n?.limit,nextToken:n?.nextToken,authMode:n?.authMode||o,authToken:n?.authToken||i}),t);return r(await s)})):[];break}const f=m.map(((e,n)=>0===n?{[e]:{eq:t[c]}}:{[e]:{eq:t[u[n-1]]}}));if(void 0===e.models[p]?.list)break;n[l]=s?(n,s)=>t[c]?Q((async t=>{const a=J(e.models[p].list(n,{filter:{and:f},limit:s?.limit,nextToken:s?.nextToken,authMode:s?.authMode||o,authToken:s?.authToken||i}),t);return r(await a)})):[]:n=>t[c]?Q((async t=>{const s=J(e.models[p].list({filter:{and:f},limit:n?.limit,nextToken:n?.nextToken,authMode:n?.authMode||o,authToken:n?.authToken||i}),t);return r(await s)})):[];break}}}return{...t,...n}}))}const re={CREATE:{operationPrefix:"create",usePlural:!1},GET:{operationPrefix:"get",usePlural:!1},UPDATE:{operationPrefix:"update",usePlural:!1},DELETE:{operationPrefix:"delete",usePlural:!1},LIST:{operationPrefix:"list",usePlural:!0},INDEX_QUERY:{operationPrefix:"",usePlural:!1},ONCREATE:{operationPrefix:"onCreate",usePlural:!1},ONUPDATE:{operationPrefix:"onUpdate",usePlural:!1},ONDELETE:{operationPrefix:"onDelete",usePlural:!1},OBSERVEQUERY:{operationPrefix:"observeQuery",usePlural:!1}},oe="*",ie=(e,t)=>{const{fields:n}=e,r=Object.values(n).map((({type:e,name:n})=>"string"==typeof e.enum?[n,ae]:"string"==typeof e.nonModel?[n,ie(t.nonModels[e.nonModel],t)]:"string"==typeof e?[n,ae]:void 0)).filter((e=>void 0!==e));return Object.fromEntries(r)},se=(e,t)=>{const{fields:n}=e,r=Object.values(n).map((({type:e,name:n})=>"string"==typeof e.enum||"string"==typeof e?[n,ae]:"string"==typeof e.nonModel?[n,ie(t.nonModels[e.nonModel],t)]:void 0)).filter((e=>void 0!==e)),o=B(e).map((e=>[e,ae]));return Object.fromEntries(r.concat(o))},ae="";function ce(e,t,n){const r=(t,n)=>{const[o,...i]=t.split("."),s=i[0],a=e.models[n]??e.nonModels[n],c=a?.fields,u=c?.[o]?.type?.model,l=e.models[u],d=c?.[o]?.type?.nonModel,p=e.nonModels[d],h=l?"model":p?"nonModel":"field";if("nonModel"===h){let t={};if(!s)throw Error(`${o} must declare a wildcard (*) or a field of custom type ${d}`);return t=s===oe?{[o]:ie(p,e)}:{[o]:r(i.join("."),d)},t}if("model"===h){let t={};if(!s)throw Error(`${o} must declare a wildcard (*) or a field of model ${u}`);if(s===oe){const n=e.models[u];t={[o]:se(n,e)}}else t={[o]:r(i.join("."),u)};return c[o]?.isArray&&(t={[o]:{items:t[o]}}),t}{const t=c?.[o],r=e.nonModels[n],i=r?.fields?.[o];if(r){if(!i)throw Error(`${o} is not a field of custom type ${n}`)}else{const e=B(a).includes(o);if(!t&&!e)throw Error(`${o} is not a field of model ${n}`)}return{[o]:ae}}};return n.reduce(((e,n)=>le(r(n,t),e)),{})}function ue(e){const t=[];return Object.entries(e).forEach((([e,n])=>{n===ae?t.push(e):"object"==typeof n&&null!==n&&(n?.items?t.push(e,"{","items","{",ue(n.items),"}","}"):t.push(e,"{",ue(n),"}"))})),t.join(" ")}function le(e,t){for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(Object.prototype.hasOwnProperty.call(t,r)&&(n=t[r])&&"object"==typeof n?le(e[r],t[r]):t[r]=e[r]);var n;return t}function de(e,t,n){const r=e.models[t],o=ce(e,t,n??function(e){const{fields:t}=e,n=Object.values(t).map((({type:e,name:t})=>{if("string"==typeof e)return t;if("object"==typeof e){if("string"==typeof e?.enum)return t;if("string"==typeof e?.nonModel)return`${t}.${oe}`}})).filter(Boolean),r=B(e);return Array.from(new Set(n.concat(r)))}(r));return ue(o)}function pe(e,t,n,r,o){const i=e.models[t],{name:s,pluralName:a,fields:c,primaryKeyInfo:{isCustomPrimaryKey:u,primaryKeyFieldName:l,sortKeyFieldNames:d},attributes:p}=i,h=s.charAt(0).toUpperCase()+s.slice(1),f=a.charAt(0).toUpperCase()+a.slice(1),{operationPrefix:y,usePlural:b}=re[n],{selectionSet:m}=r||{};let g,S,v,w,E;if(y)g=`${y}${b?f:h}`;else{if(!o)throw new Error("Error generating GraphQL Document - invalid operation name");{const{queryField:e,pk:n,sk:r=[]}=o;g=e;let i={};if(1===r.length){const[e]=r,t="string"==typeof c[e].type?c[e].type:"String",n=X[t];i={[e]:`Model${n}KeyConditionInput`}}else if(r.length>1){const n=Z(r),o=p?.find((t=>t?.properties?.queryField===e))?.properties?.name;i={[n]:`Model${z(t)}${z(o)}CompositeKeyConditionInput`}}S={[n]:`${Object.prototype.hasOwnProperty.call(c[n].type,"enum")?c[n].type.enum:c[n].type}!`,...i}}}const T=de(e,t,m),A={[l]:`${c[l].type}!`},C={},N=e=>{if(0===d.length)return{};if("get"===e)return d.reduce(((t,n)=>{const r=c[n].type;return"get"===e&&(t[n]=`${r}!`),t}),{});if(1===d.length){const[e]=d,t="string"==typeof c[e].type?c[e].type:"String",n=X[t];return{[e]:`Model${n}KeyConditionInput`}}{const e=Z(d);return{[e]:`Model${z(t)}PrimaryCompositeKeyConditionInput`}}};switch(u&&(Object.assign(A,N("get")),Object.assign(C,{[l]:`${c[l].type}`,sortDirection:"ModelSortDirection"},N("list"))),n){case"CREATE":case"UPDATE":case"DELETE":E??(E={input:`${y.charAt(0).toLocaleUpperCase()+y.slice(1)}${h}Input!`}),v??(v="mutation");case"GET":E??(E=A),w??(w=T);case"LIST":E??(E={...C,filter:`Model${h}FilterInput`,limit:"Int",nextToken:"String"}),v??(v="query"),w??(w=`items { ${T} } nextToken __typename`);case"INDEX_QUERY":E??(E={...S,filter:`Model${h}FilterInput`,sortDirection:"ModelSortDirection",limit:"Int",nextToken:"String"}),v??(v="query"),w??(w=`items { ${T} } nextToken __typename`);case"ONCREATE":case"ONUPDATE":case"ONDELETE":E??(E={filter:`ModelSubscription${h}FilterInput`}),v??(v="subscription"),w??(w=T);break;default:throw new Error("Internal error: Attempted to generate graphql document for observeQuery. Please report this error.")}return`${v}${E?`(${Object.entries(E).map((([e,t])=>`$${e}: ${t}`))})`:""} { ${g}${E?`(${Object.keys(E).map((e=>`${e}: $${e}`))})`:""} { ${w} } }`}function he(e,t,n,r,o){const{fields:i,primaryKeyInfo:{isCustomPrimaryKey:s,primaryKeyFieldName:a,sortKeyFieldNames:c}}=e,u=c?.length&&Z(c);let l={};switch(t){case"CREATE":l={input:n?fe(n,e,r):{}};break;case"UPDATE":l={input:n?Object.fromEntries(Object.entries(fe(n,e,r)).filter((([e])=>{const{isReadOnly:t}=i[e];return!t}))):{}};break;case"GET":case"DELETE":n&&(l=s?[a,...c].reduce(((e,t)=>(e[t]=n[t],e)),{}):{[a]:n[a]}),"DELETE"===t&&(l={input:l});break;case"LIST":n?.filter&&(l.filter=n.filter),n?.sortDirection&&(l.sortDirection=n.sortDirection),n&&n[a]&&(l[a]=n[a]),u&&n&&n[u]&&(l[u]=n[u]),n?.nextToken&&(l.nextToken=n.nextToken),n?.limit&&(l.limit=n.limit);break;case"INDEX_QUERY":{const{pk:e,sk:t=[]}=o,r=t?.length&&Z(t);l[e]=n[e],r&&n&&n[r]&&(l[r]=n[r]),n?.filter&&(l.filter=n.filter),n?.sortDirection&&(l.sortDirection=n.sortDirection),n?.nextToken&&(l.nextToken=n.nextToken),n?.limit&&(l.limit=n.limit);break}case"ONCREATE":case"ONUPDATE":case"ONDELETE":n?.filter&&(l={filter:n.filter});break;case"OBSERVEQUERY":throw new Error("Internal error: Attempted to build variables for observeQuery. Please report this error.");default:throw new Error(`Unhandled operation case: ${t}`)}return l}function fe(e,t,n){const{fields:r}=t,o={};return Object.entries(e).forEach((([e,t])=>{const i=r[e]?.type,s=i?.model;if(s){const i=r[e]?.association,a=n.models[s].primaryKeyInfo;if(i?.connectionType===Y.HAS_ONE){const e=i;e.targetNames.forEach(((n,r)=>{const i=e.associatedWith[r];o[n]=t[i]}))}i?.connectionType===Y.BELONGS_TO&&i.targetNames.forEach(((e,n)=>{if(0===n){const n=a.primaryKeyFieldName;o[e]=t[n]}else{const r=a.sortKeyFieldNames[n-1];o[e]=t[r]}}))}else o[e]=t})),o}function ye(e,t,n={}){const r=t(e);return{authMode:n.authMode||r.authMode,authToken:n.authToken||r.authToken}}function be(e,t,n){let r=t(e).headers||{};return n&&(r=n),r}function me(e){if(e?.errors)return{...e,data:[]};throw e}function ge(e){if(e.errors)return{...e,data:null};throw e}const Se=Symbol("INTERNAL_USER_AGENT_OVERRIDE");var ve;!function(e){e.CreateConversation="1",e.GetConversation="2",e.ListConversations="3",e.DeleteConversation="4",e.SendMessage="5",e.ListMessages="6",e.OnMessage="7",e.Generation="8"}(ve||(ve={}));const we=e=>({category:"ai",action:e});function Ee(e){return e?{[Se]:e}:void 0}const Te=e=>"symbol"==typeof e?.token?.value;function Ae(e,t,n,r,o,i,s){const a=void 0!==r.arguments;return(...c)=>{const u=c[c.length-1];let l,d;if(o){if(!Te(c[0]))throw new Error(`Invalid first argument passed to ${r.name}. Expected contextSpec`);l=c[0]}return a&&(d=o?c[1]:c[0]),"subscription"===n?function(e,t,n,r,o,i,s){const{name:a}=n,c=ye(e,r,i),u=be(e,r,i?.headers),l=Ne(n),d=Oe(n),p=_e(t,n),h=Ce(n.type,"model")?n.type.model:void 0,f=`\n    ${"subscription".toLocaleLowerCase()}${l} {\n      ${a}${d} ${p}\n    }\n  `,y=ke(n,o),b=Ee(s);return e.graphql({...c,query:f,variables:y,...b},u).pipe(H((n=>{const[r]=Object.keys(n.data),o=n.data[r],[i]=h?ne(e,h,[o],t,c.authMode,c.authToken):[o];return i})))}(e,t,r,i,d,u,s):function(e,t,n,r,o,i,s,a,c){return Q((async u=>{const{name:l}=r,d=ye(e,o,s),p=be(e,o,s?.headers),h=Ne(r),f=Oe(r),y=_e(t,r),b=Ce(r.type,"model")?r.type.model:void 0,m=`\n    ${n.toLocaleLowerCase()}${h} {\n      ${l}${f} ${y}\n    }\n  `,g=ke(r,i),S=Ee(c);try{const n=J(a?e.graphql(a,{...d,query:m,variables:g},p):e.graphql({...d,query:m,variables:g,...S},p),u),{data:r,extensions:o}=await n;if(r){const[n]=Object.keys(r),i=Array.isArray(r[n]),s=i?r[n].filter((e=>e)):r[n],c=b?ne(e,b,i?s:[s],t,d.authMode,d.authToken,!!a):s;return{data:!i&&Array.isArray(c)?c.shift():c,extensions:o}}return{data:null,extensions:o}}catch(n){const{data:r,errors:o}=n;if(r&&0!==Object.keys(r).length&&o){const[i]=Object.keys(r),s=Array.isArray(r[i]),c=s?r[i].filter((e=>e)):r[i];if(c){const n=b?ne(e,b,s?c:[c],t,d.authMode,d.authToken,!!a):c;return{data:!s&&Array.isArray(n)?n.shift():n,errors:o}}return ge(n)}return ge(n)}}))}(e,t,n,r,i,d,u,l,s)}}function Ce(e,t){return"string"==typeof e[t]}function Ne(e){if(void 0===e.arguments)return"";const t=Object.entries(e.arguments).map((([e,t])=>{const n=function({type:e,isRequired:t}){const n=t?"!":"";return function(e){return e instanceof Object&&"enum"in e}(e)?`${e.enum}${n}`:function(e){return e instanceof Object&&"input"in e}(e)?`${e.input}${n}`:`${e}${n}`}(t);return`$${e}: ${t.isArray?`[${n}]${t.isArrayNullable?"":"!"}`:n}`})).join(", ");return t.length>0?`(${t})`:""}function Oe(e){if(void 0===e.arguments)return"";const t=Object.keys(e.arguments).map((e=>`${e}: $${e}`)).join(", ");return t.length>0?`(${t})`:""}function _e(e,t){if(Ce(t,"type")||Ce(t.type,"enum"))return"";if(Ce(t.type,"nonModel")){const n=e.nonModels[t.type.nonModel];return`{${ue(ie(n,e))}}`}return Ce(t.type,"model")?`{${de(e,t.type.model)}}`:""}function ke(e,t={}){const n={};if(void 0===e.arguments)return n;for(const r of Object.values(e.arguments))if(void 0!==t[r.name])n[r.name]=t[r.name];else if(r.isRequired)throw new Error(`${e.name} requires arguments '${r.name}'`);return n}const Ie={queries:"query",mutations:"mutation",subscriptions:"subscription"};function Re(e,t,n,r){if(!t)return{};const o=t.modelIntrospection;if(!o)return{};const i=o[n];if(!i)return{};const s={},a=null===r(e).amplify;for(const t of Object.values(i))s[t.name]=Ae(e,o,Ie[n],t,a,r);return s}function xe(e,t,n,r,o,i=!1,s){return i?(i,a,c)=>Pe(e,t,n,a,c,r,o,i,s):(i,a)=>Pe(e,t,n,i,a,r,o,void 0,s)}function Pe(e,t,n,r,o,i,s,a,c){return Q((async u=>{const{name:l}=n,d=pe(t,l,i,o),p=he(n,i,r,t),h=ye(e,s,o),f=be(e,s,o?.headers),y=Ee(c);try{const n=J(a?e.graphql(a,{...h,query:d,variables:p},f):e.graphql({...h,query:d,variables:p,...y},f),u),{data:r,extensions:i}=await n;if(r){const[n]=Object.keys(r),s=ee(t,l,r[n]);if(null===s)return{data:null,extensions:i};if(o?.selectionSet)return{data:s,extensions:i};{const[n]=ne(e,l,[s],t,h.authMode,h.authToken,!!a);return{data:n,extensions:i}}}return{data:null,extensions:i}}catch(n){const{data:r,errors:i}=n;if(r&&0!==Object.keys(r).length&&i){const[s]=Object.keys(r),c=ee(t,l,r[s]);if(c){if(o?.selectionSet)return{data:c,errors:i};{const[n]=ne(e,l,[c],t,h.authMode,h.authToken,!!a);return{data:n,errors:i}}}return ge(n)}return ge(n)}}))}function Me(e,t,n,r,o=!1,i){return o?(o,s)=>De(e,t,n,r,s,o,i):o=>De(e,t,n,r,o,void 0,i)}function De(e,t,n,r,o,i,s){return Q((async a=>{const{name:c}=n,u=pe(t,c,"LIST",o),l=he(n,"LIST",o,t),d=ye(e,r,o),p=be(e,r,o?.headers),h=Ee(s);try{const n=J(i?e.graphql(i,{...d,query:u,variables:l},p):e.graphql({...d,query:u,variables:l,...h},p),a),{data:r,extensions:s}=await n;if(void 0!==r){const[n]=Object.keys(r);if(r[n].items){const a=r[n].items.map((e=>ee(t,c,e)));return o?.selectionSet?{data:a,nextToken:r[n].nextToken,extensions:s}:{data:ne(e,c,a,t,d.authMode,d.authToken,!!i),nextToken:r[n].nextToken,extensions:s}}return{data:r[n],nextToken:r[n].nextToken,extensions:s}}}catch(n){const{data:r,errors:s}=n;if(null!=r&&0!==Object.keys(r).length&&s){const[a]=Object.keys(r);if(r[a]?.items){const n=r[a].items.map((e=>ee(t,c,e)));return n?o?.selectionSet?{data:n,nextToken:r[a]?.nextToken,errors:s}:{data:ne(e,c,n,t,d.authMode,d.authToken,!!i),nextToken:r[a]?.nextToken,errors:s}:{data:r[a],nextToken:r[a]?.nextToken,errors:s}}return me(n)}return me(n)}}))}const Le={},$e=new Array(64);for(let e=0,t="A".charCodeAt(0),n="Z".charCodeAt(0);e+t<=n;e++){const n=String.fromCharCode(e+t);Le[n]=e,$e[e]=n}for(let e=0,t="a".charCodeAt(0),n="z".charCodeAt(0);e+t<=n;e++){const n=String.fromCharCode(e+t),r=e+26;Le[n]=r,$e[r]=n}for(let e=0;e<10;e++){Le[e.toString(10)]=e+52;const t=e.toString(10),n=e+52;Le[t]=n,$e[n]=t}Le["+"]=62,$e[62]="+",Le["/"]=63,$e[63]="/";const qe=e=>{let t=e.length/4*3;"=="===e.slice(-2)?t-=2:"="===e.slice(-1)&&t--;const n=new ArrayBuffer(t),r=new DataView(n);for(let t=0;t<e.length;t+=4){let n=0,o=0;for(let r=t,i=t+3;r<=i;r++)if("="!==e[r]){if(!(e[r]in Le))throw new TypeError(`Invalid character ${e[r]} in base64 string.`);n|=Le[e[r]]<<6*(i-r),o+=6}else n>>=6;const i=t/4*3;n>>=o%8;const s=Math.floor(o/8);for(let e=0;e<s;e++){const t=8*(s-e-1);r.setUint8(i+e,(n&255<<t)>>t)}}return new Uint8Array(n)};function Ue(e){let t;t="string"==typeof e?(e=>(new TextEncoder).encode(e))(e):e;const n="object"==typeof t&&"number"==typeof t.length,r="object"==typeof t&&"number"==typeof t.byteOffset&&"number"==typeof t.byteLength;if(!n&&!r)throw new Error("@smithy/util-base64: toBase64 encoder function only accepts string | Uint8Array.");let o="";for(let e=0;e<t.length;e+=3){let n=0,r=0;for(let o=e,i=Math.min(e+3,t.length);o<i;o++)n|=t[o]<<8*(i-o-1),r+=8;const i=Math.ceil(r/6);n<<=6*i-r;for(let e=1;e<=i;e++){const t=6*(i-e);o+=$e[(n&63<<t)>>t]}o+="==".slice(0,4-i)}return o}const je=e=>e.map((e=>e.image?Ge(e):e.toolUse?Ke(e):e.toolResult?Fe(e):We(e))),Ge=({image:e})=>({image:{...e,source:{...e.source,bytes:qe(e.source.bytes)}}}),Ke=({toolUse:e})=>({toolUse:{...e,input:JSON.parse(e.input)}}),Fe=({toolResult:e})=>({toolResult:{toolUseId:e.toolUseId,content:e.content.map((e=>e.image?Ge(e):e.json?(({json:e})=>({json:JSON.parse(e)}))(e):We(e)))}}),We=e=>Object.fromEntries(Object.entries(e).filter((([e,t])=>null!==t))),He=({content:e,createdAt:t,id:n,conversationId:r,role:o})=>({content:je(e),conversationId:r,createdAt:t,id:n,role:o}),Be=(e,t,n,r,o)=>async i=>{const s=Me(e,t,r,o,!1,we(ve.ListMessages)),{data:a,nextToken:c,errors:u}=await s({...i,filter:{conversationId:{eq:n}}});return{data:a.map((e=>He(e))),nextToken:c,errors:u}},ze=(e,t,n,r,o)=>i=>{const{conversations:s}=t;if(!s)return{};const a=s[r].message.subscribe;return Ae(e,t,"subscription",a,!1,o,we(ve.OnMessage))({conversationId:n}).subscribe((e=>{i(He(e))}))},Qe=e=>JSON.stringify(e),Ve=e=>e.map((e=>e.image?Ye(e):e.toolResult?Xe(e):e)),Je=({tools:e})=>({tools:Object.entries(e).map((([e,t])=>({toolSpec:{name:e,description:t.description,inputSchema:{json:JSON.stringify(t.inputSchema.json)}}})))}),Ye=({image:e})=>({image:{...e,source:{...e.source,bytes:Ue(e.source.bytes)}}}),Xe=({toolResult:e})=>({toolResult:{...e,content:e.content.map((e=>e.image?Ye(e):e.json?(({json:e})=>({json:JSON.stringify(e)}))(e):e))}}),Ze=(e,t,n,r,o)=>async i=>{const{conversations:s}=t;if(!s)return{};const a="string"==typeof i?{content:[{text:i}]}:i,{content:c,aiContext:u,toolConfiguration:l}=a,d=s[r].message.send,p=Ae(e,t,"mutation",d,!1,o,we(ve.SendMessage)),{data:h,errors:f}=await p({conversationId:n,content:Ve(c),...u&&{aiContext:Qe(u)},...l&&{toolConfiguration:Je(l)}});return{data:h?He(h):h,errors:f}},et=(e,t,n,r,o,i,s,a,c,u)=>{if(!n)throw new Error(`An error occurred converting a ${i} conversation: Missing ID`);return{id:n,createdAt:r,updatedAt:o,metadata:c,name:u,onMessage:ze(e,t,n,i,a),sendMessage:Ze(e,t,n,i,a),listMessages:Be(e,t,n,s,a)}},tt=(e,t,n,r,o,i)=>async()=>{const s=xe(e,t,r,"CREATE",i,!1,we(ve.CreateConversation)),{data:a,errors:c}=await s();return{data:et(e,t,a?.id,a?.createdAt,a?.updatedAt,n,o,i,a?.metadata,a?.name),errors:c}},nt=(e,t,n,r,o,i)=>async({id:s})=>{const a=xe(e,t,r,"GET",i,!1,we(ve.GetConversation)),{data:c,errors:u}=await a({id:s});return{data:c?et(e,t,c.id,c.createdAt,c.updatedAt,n,o,i,c?.metadata,c?.name):c,errors:u}},rt=(e,t,n,r,o,i)=>async s=>{const a=Me(e,t,r,i,!1,we(ve.ListConversations)),{data:c,nextToken:u,errors:l}=await a(s);return{data:c.map((r=>et(e,t,r.id,r.createdAt,r.updatedAt,n,o,i,r?.metadata,r?.name))),nextToken:u,errors:l}},ot=(e,t,n,r,o,i)=>async({id:s})=>{const a=xe(e,t,r,"DELETE",i,!1,we(ve.DeleteConversation)),{data:c,errors:u}=await a({id:s});return{data:c?et(e,t,c?.id,c?.createdAt,c?.updatedAt,n,o,i,c?.metadata,c?.name):c,errors:u}},it=e=>{const t=e.modelIntrospection;if(!t)return{};const n={};for(const[e,r]of Object.entries(t.enums))n[r.name]={values:()=>r.values};return n};function st(e,t,n,r,o,i=!1){return i?(i,s,a)=>at(e,t,n,r,o,{...s,...a},i):(i,s)=>at(e,t,n,r,o,{...i,...s})}function at(e,t,n,r,o,i,s){return Q((async a=>{const{name:c}=n,u=pe(t,c,"INDEX_QUERY",i,r),l=he(n,"INDEX_QUERY",i,t,r),d=ye(e,o,i),p=n=>ne(e,c,n,t,d.authMode,d.authToken,!!s);try{const n=be(e,o,i?.headers),r=[{...d,query:u,variables:l},n];void 0!==s&&r.unshift(s);const h=J(e.graphql(...r),a),f=await h;if(void 0!==f.data)return function(e,t,n,r,o){const{data:i,extensions:s}=n,[a]=Object.keys(i);if(i[a].items){const n=i[a].items.map((n=>ee(e,t,n)));return{data:r?n:o(n),nextToken:i[a].nextToken,extensions:s}}return{data:i[a],nextToken:i[a].nextToken,extensions:s}}(t,c,f,i?.selectionSet,p)}catch(e){const{data:n,errors:r}=e;if(void 0!==n&&0!==Object.keys(n).length&&r){const[e]=Object.keys(n);if(n[e]?.items){const r=n[e]?.items.map((e=>ee(t,c,e)));if(r)return{data:i?.selectionSet?r:p(r),nextToken:n[e]?.nextToken}}return{data:n[e],nextToken:n[e]?.nextToken}}return me(e)}}))}function ct(e,t,n,r,o){const{name:i}=n;return s=>{const a=pe(t,i,r,s),c=he(n,r,s,t),u=ye(e,o,s),l=be(e,o,s?.headers);return e.graphql({...u,query:a,variables:c},l).pipe(H((n=>{const[r]=Object.keys(n.data),o=n.data[r],a=ee(t,i,o);if(null===a)return null;if(s?.selectionSet)return a;{const[n]=ne(e,i,[a],t,u.authMode,u.authToken);return n}})))}}var ut="function"==typeof Symbol&&Symbol.observable||"@@observable";function lt(e){return e}var dt=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r,o=this,i=(r=e)&&r instanceof D||function(e){return e&&c(e.next)&&c(e.error)&&c(e.complete)}(r)&&E(r)?e:new U(e,t,n);return function(e){if(O){var t=!M;if(t&&(M={errorThrown:!1,error:null}),e(),t){var n=M,r=n.errorThrown,o=n.error;if(M=null,r)throw o}}else e()}((function(){var e=o,t=e.operator,n=e.source;i.add(t?t.call(i,n):n?o._subscribe(i):o._trySubscribe(i))})),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=pt(t))((function(t,r){var o=new U({next:function(t){try{e(t)}catch(e){r(e),o.unsubscribe()}},error:r,complete:t});n.subscribe(o)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[ut]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0===(n=e).length?lt:1===n.length?n[0]:function(e){return n.reduce((function(e,t){return t(e)}),e)})(this);var n},e.prototype.toPromise=function(e){var t=this;return new(e=pt(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function pt(e){var t;return null!==(t=null!=e?e:N)&&void 0!==t?t:Promise}function ht(e,t,n){const r=Object.fromEntries(n.map((t=>[t,e[t]])));for(let e=0;e<t.length;e++)if(Object.keys(r).every((n=>r[n]===t[e][n])))return e;return-1}function ft(e,t){const{name:n}=t;return r=>new dt((o=>{const i=[],s=[];let a=(...e)=>s.push(...e);const c=e[n].onCreate(r).subscribe({next(e){a({item:e,type:"create"})},error(e){o.error({type:"onCreate",error:e})}}),u=e[n].onUpdate(r).subscribe({next(e){a({item:e,type:"update"})},error(e){o.error({type:"onUpdate",error:e})}}),l=e[n].onDelete(r).subscribe({next(e){a({item:e,type:"delete"})},error(e){o.error({type:"onDelete",error:e})}});function d(e){for(const t of e){const e=ht(t.item,i,p);switch(t.type){case"create":e<0&&i.push(t.item);break;case"update":e>=0&&(i[e]=t.item);break;case"delete":e>=0&&i.splice(e,1);break;default:console.error("Unrecognized message in observeQuery.",t)}}o.next({items:i,isSynced:!0})}const p=function(e){const{primaryKeyFieldName:t,sortKeyFieldNames:n}=e.primaryKeyInfo;return[t,...n]}(t);return(async()=>{let t=!0,c=null;for(;!o.closed&&(t||c);){t=!1;const{data:a,errors:u,nextToken:l}=await e[n].list({...r,nextToken:c});c=l,i.push(...a);const d=0===s.length&&null==c;if(o.next({items:i,isSynced:d}),Array.isArray(u))for(const e of u)o.error(e)}s.length>0&&d(s),a=(...e)=>(d(e),i.length)})(),()=>{c.unsubscribe(),u.unsubscribe(),l.unsubscribe()}}))}const yt=e=>"key"===e.type&&e.properties?.name&&e.properties?.queryField&&e.properties?.fields.length>0,bt=e=>{const t=e.attributes?.filter(yt).map((e=>{const t=e.properties.queryField,[n,...r]=e.properties.fields;return{queryField:t,pk:n,sk:r}}));return t||[]},mt=(e,t)=>{const n=e.models[t].attributes?.find((e=>"model"===e.type)),r={queries:["list","get","observeQuery"],mutations:["create","update","delete"],subscriptions:["onCreate","onUpdate","onDelete"]},o=[];if(!n)return re;if(n.properties)for(const[e,t]of Object.entries(n.properties))e in r&&(null===t?o.push(...r[e]):t instanceof Object&&o.push(...Object.keys(t)));o.includes("list")&&o.push("observeQuery");const i=o.map((e=>e.toUpperCase()));return Object.fromEntries(Object.entries(re).filter((([e])=>!i.includes(e))))};function gt(e,t,n){return function(e){const t=e.cancel.bind(e);e.cancel=function(e,n){const r=new Set;let o=e;for(;o&&V.has(o);){if(r.has(o))throw new Error("A cycle was detected in the modeled graphql cancellation chain. This is a bug. Please report it!");r.add(o),o=V.get(o)}return t(o,n)}}(e),e.models=function(e,t,n){const r={},o=t.modelIntrospection;if(!o)return{};const i=["ONCREATE","ONUPDATE","ONDELETE"];for(const t of Object.values(o.models)){const{name:s}=t;r[s]={};const a=mt(o,s);Object.entries(a).forEach((([a,{operationPrefix:c}])=>{const u=a;"LIST"===u?r[s][c]=Me(e,o,t,n):i.includes(u)?r[s][c]=ct(e,o,t,u,n):r[s][c]="OBSERVEQUERY"===u?ft(r,t):xe(e,o,t,u,n)}));const c=bt(t);for(const i of c)r[s][i.queryField]=st(e,o,t,i,n)}return r}(e,t,n),e.enums=it(t),e.queries=function(e,t,n){return Re(e,t,"queries",n)}(e,t,n),e.mutations=function(e,t,n){return Re(e,t,"mutations",n)}(e,t,n),e.subscriptions=function(e,t,n){return Re(e,t,"subscriptions",n)}(e,t,n),e.conversations=function(e,t,n){const r=t?.modelIntrospection;if(!r?.conversations)return{};const o={};for(const{name:t,conversation:i,message:s,models:a,nonModels:c,enums:u}of Object.values(r.conversations)){const l=a[i.modelName],d=a[s.modelName];if(!l||!d)return{};const p={...r,models:{...r.models,...a},nonModels:{...r.nonModels,...c},enums:{...r.enums,...u}};o[t]={create:tt(e,p,t,l,d,n),get:nt(e,p,t,l,d,n),delete:ot(e,p,t,l,d,n),list:rt(e,p,t,l,d,n)}}return o}(e,t,n),e.generations=function(e,t,n){const r=t?.modelIntrospection;if(!r?.generations)return{};const o={};for(const t of Object.values(r.generations))o[t.name]=Ae(e,r,"query",t,!1,n,we(ve.Generation));return o}(e,t,n),e}var St;!function(e){e.NO_API_KEY="No api-key configured",e.NO_CURRENT_USER="No current user",e.NO_CREDENTIALS="No credentials",e.NO_FEDERATED_JWT="No federated jwt",e.NO_AUTH_TOKEN="No auth token specified"}(St||(St={}));const vt=Symbol("amplify"),wt=Symbol("authMode"),Et=Symbol("authToken"),Tt=Symbol("headers");function At(e){const t=e;return{amplify:t[vt],authMode:t[wt],authToken:t[Et],headers:t[Tt]}}function Ct(e){return void 0!==e}var Nt,Ot,_t,kt,It,Rt,xt,Pt,Mt,Dt,Lt,$t,qt,Ut;!function(e){e.WebUnknown="0",e.React="1",e.NextJs="2",e.Angular="3",e.VueJs="4",e.Nuxt="5",e.Svelte="6",e.ServerSideUnknown="100",e.ReactSSR="101",e.NextJsSSR="102",e.AngularSSR="103",e.VueJsSSR="104",e.NuxtSSR="105",e.SvelteSSR="106",e.ReactNative="201",e.Expo="202"}(Nt||(Nt={})),function(e){e.AI="ai",e.API="api",e.Auth="auth",e.Analytics="analytics",e.DataStore="datastore",e.Geo="geo",e.InAppMessaging="inappmessaging",e.Interactions="interactions",e.Predictions="predictions",e.PubSub="pubsub",e.PushNotification="pushnotification",e.Storage="storage"}(Ot||(Ot={})),function(e){e.CreateConversation="1",e.GetConversation="2",e.ListConversations="3",e.DeleteConversation="4",e.SendMessage="5",e.ListMessages="6",e.OnMessage="7",e.Generation="8",e.UpdateConversation="9"}(_t||(_t={})),function(e){e.Record="1",e.IdentifyUser="2"}(kt||(kt={})),function(e){e.GraphQl="1",e.Get="2",e.Post="3",e.Put="4",e.Patch="5",e.Del="6",e.Head="7"}(It||(It={})),function(e){e.SignUp="1",e.ConfirmSignUp="2",e.ResendSignUpCode="3",e.SignIn="4",e.FetchMFAPreference="6",e.UpdateMFAPreference="7",e.SetUpTOTP="10",e.VerifyTOTPSetup="11",e.ConfirmSignIn="12",e.DeleteUserAttributes="15",e.DeleteUser="16",e.UpdateUserAttributes="17",e.FetchUserAttributes="18",e.ConfirmUserAttribute="22",e.SignOut="26",e.UpdatePassword="27",e.ResetPassword="28",e.ConfirmResetPassword="29",e.FederatedSignIn="30",e.RememberDevice="32",e.ForgetDevice="33",e.FetchDevices="34",e.SendUserAttributeVerificationCode="35",e.SignInWithRedirect="36",e.StartWebAuthnRegistration="37",e.CompleteWebAuthnRegistration="38",e.ListWebAuthnCredentials="39",e.DeleteWebAuthnCredential="40"}(Rt||(Rt={})),function(e){e.Subscribe="1",e.GraphQl="2"}(xt||(xt={})),function(e){e.SearchByText="0",e.SearchByCoordinates="1",e.SearchForSuggestions="2",e.SearchByPlaceId="3",e.SaveGeofences="4",e.GetGeofence="5",e.ListGeofences="6",e.DeleteGeofences="7"}(Pt||(Pt={})),function(e){e.SyncMessages="1",e.IdentifyUser="2",e.NotifyMessageInteraction="3"}(Mt||(Mt={})),function(e){e.None="0"}(Dt||(Dt={})),function(e){e.Convert="1",e.Identify="2",e.Interpret="3"}(Lt||(Lt={})),function(e){e.Subscribe="1"}($t||($t={})),function(e){e.InitializePushNotifications="1",e.IdentifyUser="2"}(qt||(qt={})),function(e){e.UploadData="1",e.DownloadData="2",e.List="3",e.Copy="4",e.Remove="5",e.GetProperties="6",e.GetUrl="7",e.GetDataAccess="8",e.ListCallerAccessGrants="9"}(Ut||(Ut={}));var jt=o(49),Gt=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function Kt(e){return c(null==e?void 0:e.then)}function Ft(e){return c(e[ut])}function Wt(e){return Symbol.asyncIterator&&c(null==e?void 0:e[Symbol.asyncIterator])}function Ht(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var Bt="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function zt(e){return c(null==e?void 0:e[Bt])}function Qt(e){return function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),i=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",(function(e){return function(t){return Promise.resolve(t).then(e,u)}})),r[Symbol.asyncIterator]=function(){return this},r;function s(e,t){o[e]&&(r[e]=function(t){return new Promise((function(n,r){i.push([e,t,n,r])>1||a(e,t)}))},t&&(r[e]=t(r[e])))}function a(e,t){try{(n=o[e](t)).value instanceof m?Promise.resolve(n.value.v).then(c,u):l(i[0][2],n)}catch(e){l(i[0][3],e)}var n}function c(e){a("next",e)}function u(e){a("throw",e)}function l(e,t){e(t),i.shift(),i.length&&a(i[0][0],i[0][1])}}(this,arguments,(function(){var t,n,r;return h(this,(function(o){switch(o.label){case 0:t=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,m(t.read())];case 3:return n=o.sent(),r=n.value,n.done?[4,m(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,m(r)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function Vt(e){return c(null==e?void 0:e.getReader)}function Jt(e){if(e instanceof dt)return e;if(null!=e){if(Ft(e))return o=e,new dt((function(e){var t=o[ut]();if(c(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(Gt(e))return r=e,new dt((function(e){for(var t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()}));if(Kt(e))return n=e,new dt((function(e){n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,I)}));if(Wt(e))return Yt(e);if(zt(e))return t=e,new dt((function(e){var n,r;try{for(var o=f(t),i=o.next();!i.done;i=o.next()){var s=i.value;if(e.next(s),e.closed)return}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}e.complete()}));if(Vt(e))return Yt(Qt(e))}var t,n,r,o;throw Ht(e)}function Yt(e){return new dt((function(t){(function(e,t){var n,r,o,i;return p(this,void 0,void 0,(function(){var s,a;return h(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=f(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,o,(t=e[n](t)).done,t.value)}))}}}(e),c.label=1;case 1:return[4,n.next()];case 2:if((r=c.sent()).done)return[3,4];if(s=r.value,t.next(s),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),o={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(i=n.return)?[4,i.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function Xt(e){return u((function(t,n){var r,o=null,i=!1;o=t.subscribe(F(n,void 0,void 0,(function(s){r=Jt(e(s,Xt(e)(t))),o?(o.unsubscribe(),o=null,r.subscribe(n)):i=!0}))),i&&(o.unsubscribe(),o=null,r.subscribe(n))}))}const Zt=URL,en=URLSearchParams,tn="6.10.2",nn=()=>"undefined"!=typeof global,rn=()=>"undefined"!=typeof window,on=()=>"undefined"!=typeof document,sn=()=>"undefined"!=typeof process,an=(e,t)=>!!Object.keys(e).find((e=>e.startsWith(t))),cn=[{platform:Nt.Expo,detectionMethod:function(){return nn()&&void 0!==global.expo}},{platform:Nt.ReactNative,detectionMethod:function(){return"undefined"!=typeof navigator&&void 0!==navigator.product&&"ReactNative"===navigator.product}},{platform:Nt.NextJs,detectionMethod:function(){return rn()&&window.next&&"object"==typeof window.next}},{platform:Nt.Nuxt,detectionMethod:function(){return rn()&&(void 0!==window.__NUXT__||void 0!==window.$nuxt)}},{platform:Nt.Angular,detectionMethod:function(){const e=Boolean(on()&&document.querySelector("[ng-version]")),t=Boolean(rn()&&void 0!==window.ng);return e||t}},{platform:Nt.React,detectionMethod:function(){const e=e=>e.startsWith("_react")||e.startsWith("__react");return on()&&Array.from(document.querySelectorAll("[id]")).some((t=>Object.keys(t).find(e)))}},{platform:Nt.VueJs,detectionMethod:function(){return rn()&&an(window,"__VUE")}},{platform:Nt.Svelte,detectionMethod:function(){return rn()&&an(window,"__SVELTE")}},{platform:Nt.WebUnknown,detectionMethod:function(){return rn()}},{platform:Nt.NextJsSSR,detectionMethod:function(){return nn()&&(an(global,"__next")||an(global,"__NEXT"))}},{platform:Nt.NuxtSSR,detectionMethod:function(){return nn()&&void 0!==global.__NUXT_PATHS__}},{platform:Nt.ReactSSR,detectionMethod:function(){return sn()&&void 0!==process.env&&!!Object.keys(process.env).find((e=>e.includes("react")))}},{platform:Nt.VueJsSSR,detectionMethod:function(){return nn()&&an(global,"__VUE")}},{platform:Nt.AngularSSR,detectionMethod:function(){return sn()&&"object"==typeof process.env&&process.env.npm_lifecycle_script?.startsWith("ng ")||!1}},{platform:Nt.SvelteSSR,detectionMethod:function(){return sn()&&void 0!==process.env&&!!Object.keys(process.env).find((e=>e.includes("svelte")))}}];let un;const ln=[];let dn=!1;const pn=()=>{if(!un){if(un=cn.find((e=>e.detectionMethod()))?.platform||Nt.ServerSideUnknown,dn)for(;ln.length;)ln.pop()?.();else ln.forEach((e=>{e()}));hn(Nt.ServerSideUnknown,10),hn(Nt.WebUnknown,10)}return un};function hn(e,t){un!==e||dn||setTimeout((()=>{un=void 0,dn=!0,setTimeout(pn,1e3)}),t)}const fn={},yn="aws-amplify",bn=e=>e.replace(/\+.*/,"");new class{constructor(){this.userAgent=`${yn}/${bn(tn)}`}get framework(){return pn()}get isReactNative(){return this.framework===Nt.ReactNative||this.framework===Nt.Expo}observeFrameworkChanges(e){(e=>{dn||ln.push(e)})(e)}};const mn=e=>(({category:e,action:t}={})=>{const n=[[yn,bn(tn)]];if(e&&n.push([e,t]),n.push(["framework",pn()]),e&&t){const r=((e,t)=>fn[e]?.[t]?.additionalDetails)(e,t);r&&r.forEach((e=>{n.push(e)}))}return n})(e).map((([e,t])=>e&&t?`${e}/${t}`:e)).join(" ");class gn extends Error{constructor({message:e,name:t,recoverySuggestion:n,underlyingError:r}){super(e),this.name=t,this.underlyingError=r,this.recoverySuggestion=n,this.constructor=gn,Object.setPrototypeOf(this,gn.prototype)}}class Sn extends gn{get response(){return this._response?vn(this._response):void 0}constructor(e){super(e),this.constructor=Sn,Object.setPrototypeOf(this,Sn.prototype),e.response&&(this._response=e.response)}}const vn=e=>({...e,headers:{...e.headers}});class wn extends Sn{constructor(e){super(e),this.constructor=wn,Object.setPrototypeOf(this,wn.prototype)}}class En extends wn{constructor(e={}){super({name:"CanceledError",message:"Request is canceled by user",...e}),this.constructor=En,Object.setPrototypeOf(this,En.prototype)}}const Tn=e=>!!e&&e instanceof En;var An;!function(e){e.InvalidApiName="InvalidApiName"}(An||(An={}));const Cn={[An.InvalidApiName]:{message:"API name is invalid.",recoverySuggestion:"Check if the API name matches the one in your configuration or `aws-exports.js`"}},Nn=e=>{const{headers:t,statusCode:n}=e;return{...On(e)?e.$metadata:{},httpStatusCode:n,requestId:t["x-amzn-requestid"]??t["x-amzn-request-id"]??t["x-amz-request-id"],extendedRequestId:t["x-amz-id-2"],cfId:t["x-amz-cf-id"]}},On=e=>"object"==typeof e?.$metadata,_n=async e=>{if(!e)return;const t=await(async e=>{if(!e||e.statusCode<300)return;const t=await(async e=>{if(!e.body)throw new Error("Missing response payload");const t=await e.body.json();return Object.assign(t,{$metadata:Nn(e)})})(e),n=(e=>{const[t]=e.toString().split(/[,:]+/);return t.includes("#")?t.split("#")[1]:t})(e.headers["x-amzn-errortype"]??t.code??t.__type??"UnknownError"),r=t.message??t.Message??"Unknown error",o=new Error(r);return Object.assign(o,{name:n,$metadata:Nn(e)})})(kn(e));if(t){const n=await(e.body?.text());return In(t,{statusCode:e.statusCode,headers:e.headers,body:n})}},kn=e=>{let t;const n=new Proxy(e.body,{get:(e,n,r)=>"json"===n?async()=>{t||(t=e.text());try{return JSON.parse(await t)}catch(e){return{}}}:"text"===n?async()=>(t||(t=e.text()),t):Reflect.get(e,n,r)});return new Proxy(e,{get:(e,t,r)=>"body"===t?n:Reflect.get(e,t,r)})},In=(e,t)=>{const n=new wn({name:e?.name,message:e.message,underlyingError:e,response:t});return Object.assign(n,{$metadata:e.$metadata})},Rn=new a.ConsoleLogger("RestApis");function xn(e,t){const n=e=>!!t,r=new AbortController,o=r.signal,i=t?.signal;let s;const a=async()=>{try{const t=await(n()?e():e(o));if(t.statusCode>=300)throw await _n(t);return t}catch(e){const t=i??o,n=s??t.reason;if("AbortError"===e.name||!0===t?.aborted){const t=new En({...n&&{message:n},underlyingError:e,recoverySuggestion:"The API request was explicitly canceled. If this is not intended, validate if you called the `cancel()` function on the API request erroneously."});throw Rn.debug(e),t}throw Rn.debug(e),e}};if(n())return a();{const e=e=>{!0!==o.aborted&&(r.abort(e),e&&o.reason!==e&&(s=e))};return{response:a(),cancel:e}}}const Pn="execute-api",Mn="us-east-1",Dn=/^.+\.([a-z0-9-]+)\.([a-z0-9-]+)\.amazonaws\.com/,Ln=(e,t)=>{const{service:n=Pn,region:r=Mn}=t?.amplify.getConfig()?.API?.REST?.[t?.apiName]??{},{hostname:o}=e,[,i,s]=Dn.exec(o)??[];return i===Pn?{service:i,region:s??r}:"appsync-api"===i?{service:"appsync",region:s??r}:{service:n,region:r}},$n=({headers:e},t)=>!e.authorization&&!e["x-api-key"]&&!!t,qn=({headers:e},t)=>!e.authorization&&!!t;var Un;!function(e){e.NoEndpointId="NoEndpointId",e.PlatformNotSupported="PlatformNotSupported",e.Unknown="Unknown",e.NetworkError="NetworkError"}(Un||(Un={}));const jn=["AuthFailure","InvalidSignatureException","RequestExpired","RequestInTheFuture","RequestTimeTooSkewed","SignatureDoesNotMatch","BadRequestException"],Gn=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException"],Kn=["TimeoutError","RequestTimeout","RequestTimeoutException"],Fn=(e,t)=>429===e||!!t&&Gn.includes(t),Wn=e=>[Un.NetworkError,"ERR_NETWORK"].includes(e?.name),Hn=(e,t)=>!!e&&[500,502,503,504].includes(e)||!!t&&Kn.includes(t);function Bn(e=3e5){return t=>{const n=2**t*100+100*Math.random();return!(n>e)&&n}}const zn=3e5,Qn=e=>{const t=Bn(zn)(e);return!1===t?zn:t},Vn=({maxAttempts:e=3,retryDecider:t,computeDelay:n,abortSignal:r})=>{if(e<1)throw new Error("maxAttempts must be greater than 0");return(o,i)=>async function(s){let a,c,u=i.attemptsCount??0;const l=()=>{if(c)return Yn(c,u),c;throw Yn(a,u),a};for(;!r?.aborted&&u<e;){try{c=await o(s),a=void 0}catch(e){a=e,c=void 0}u=(i.attemptsCount??0)>u?i.attemptsCount??0:u+1,i.attemptsCount=u;const{isCredentialsExpiredError:d,retryable:p}=await t(c,a,i);if(!p)return l();if(i.isCredentialsExpired=!!d,!r?.aborted&&u<e){const e=n(u);await Jn(e,r)}}if(r?.aborted)throw new Error("Request aborted.");return l()}},Jn=(e,t)=>{if(t?.aborted)return Promise.resolve();let n,r;const o=new Promise((t=>{r=t,n=setTimeout(t,e)}));return t?.addEventListener("abort",(function e(o){clearTimeout(n),t?.removeEventListener("abort",e),r()})),o},Yn=(e,t)=>{"[object Object]"===Object.prototype.toString.call(e)&&(e.$metadata={...e.$metadata??{},attempts:t})},Xn=e=>Object.keys(e).map((e=>e.toLowerCase())).sort().join(";"),Zn="X-Amz-Date".toLowerCase(),er="X-Amz-Security-Token".toLowerCase(),tr="aws4_request",nr="AWS4-HMAC-SHA256";var rr=64,or=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ir=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],sr=Math.pow(2,53)-1,ar=function(){function e(){this.state=Int32Array.from(ir),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return e.prototype.update=function(e){if(this.finished)throw new Error("Attempted to update an already finished hash.");var t=0,n=e.byteLength;if(this.bytesHashed+=n,8*this.bytesHashed>sr)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;n>0;)this.buffer[this.bufferLength++]=e[t++],n--,this.bufferLength===rr&&(this.hashBuffer(),this.bufferLength=0)},e.prototype.digest=function(){if(!this.finished){var e=8*this.bytesHashed,t=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),n=this.bufferLength;if(t.setUint8(this.bufferLength++,128),n%rr>=56){for(var r=this.bufferLength;r<rr;r++)t.setUint8(r,0);this.hashBuffer(),this.bufferLength=0}for(r=this.bufferLength;r<56;r++)t.setUint8(r,0);t.setUint32(56,Math.floor(e/4294967296),!0),t.setUint32(60,e),this.hashBuffer(),this.finished=!0}var o=new Uint8Array(32);for(r=0;r<8;r++)o[4*r]=this.state[r]>>>24&255,o[4*r+1]=this.state[r]>>>16&255,o[4*r+2]=this.state[r]>>>8&255,o[4*r+3]=this.state[r]>>>0&255;return o},e.prototype.hashBuffer=function(){for(var e=this.buffer,t=this.state,n=t[0],r=t[1],o=t[2],i=t[3],s=t[4],a=t[5],c=t[6],u=t[7],l=0;l<rr;l++){if(l<16)this.temp[l]=(255&e[4*l])<<24|(255&e[4*l+1])<<16|(255&e[4*l+2])<<8|255&e[4*l+3];else{var d=this.temp[l-2],p=(d>>>17|d<<15)^(d>>>19|d<<13)^d>>>10,h=((d=this.temp[l-15])>>>7|d<<25)^(d>>>18|d<<14)^d>>>3;this.temp[l]=(p+this.temp[l-7]|0)+(h+this.temp[l-16]|0)}var f=(((s>>>6|s<<26)^(s>>>11|s<<21)^(s>>>25|s<<7))+(s&a^~s&c)|0)+(u+(or[l]+this.temp[l]|0)|0)|0,y=((n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10))+(n&r^n&o^r&o)|0;u=c,c=a,a=s,s=i+f|0,i=o,o=r,r=n,n=f+y|0}t[0]+=n,t[1]+=r,t[2]+=o,t[3]+=i,t[4]+=s,t[5]+=a,t[6]+=c,t[7]+=u},e}(),cr="undefined"!=typeof Buffer&&Buffer.from?function(e){return Buffer.from(e,"utf8")}:e=>(new TextEncoder).encode(e);function ur(e){return e instanceof Uint8Array?e:"string"==typeof e?cr(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(e)}var lr=function(){function e(e){this.secret=e,this.hash=new ar,this.reset()}return e.prototype.update=function(e){var t;if(("string"==typeof(t=e)?0!==t.length:0!==t.byteLength)&&!this.error)try{this.hash.update(ur(e))}catch(e){this.error=e}},e.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},e.prototype.digest=function(){return p(this,void 0,void 0,(function(){return h(this,(function(e){return[2,this.digestSync()]}))}))},e.prototype.reset=function(){if(this.hash=new ar,this.secret){this.outer=new ar;var e=function(e){var t=ur(e);if(t.byteLength>rr){var n=new ar;n.update(t),t=n.digest()}var r=new Uint8Array(rr);return r.set(t),r}(this.secret),t=new Uint8Array(rr);t.set(e);for(var n=0;n<rr;n++)e[n]^=54,t[n]^=92;for(this.hash.update(e),this.outer.update(t),n=0;n<e.byteLength;n++)e[n]=0}},e}();const dr={},pr={};for(let e=0;e<256;e++){let t=e.toString(16).toLowerCase();1===t.length&&(t=`0${t}`),dr[e]=t,pr[t]=e}const hr=(e,t)=>{const n=new lr(e??void 0);return n.update(t),n.digestSync()},fr=(e,t)=>function(e){let t="";for(let n=0;n<e.byteLength;n++)t+=dr[e[n]];return t}(hr(e,t)),yr=e=>Object.entries(e).map((([e,t])=>({key:e.toLowerCase(),value:t?.trim().replace(/\s+/g," ")??""}))).sort(((e,t)=>e.key<t.key?-1:1)).map((e=>`${e.key}:${e.value}\n`)).join(""),br=e=>encodeURIComponent(e).replace(/[!'()*]/g,mr),mr=e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`,gr=(e,t=!0)=>e?t?encodeURIComponent(e).replace(/%2F/g,"/"):e:"/",Sr=e=>null==e?"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855":vr(e)?fr(null,e):"UNSIGNED-PAYLOAD",vr=e=>"string"==typeof e||ArrayBuffer.isView(e)||wr(e),wr=e=>"function"==typeof ArrayBuffer&&e instanceof ArrayBuffer||"[object ArrayBuffer]"===Object.prototype.toString.call(e),Er=(e,t)=>{const n=(({credentials:e,signingDate:t=new Date,signingRegion:n,signingService:r,uriEscapePath:o=!0})=>{const{accessKeyId:i,secretAccessKey:s,sessionToken:a}=e,{longDate:c,shortDate:u}=(e=>{const t=e.toISOString().replace(/[:-]|\.\d{3}/g,"");return{longDate:t,shortDate:t.slice(0,8)}})(t);return{accessKeyId:i,credentialScope:`${u}/${n}/${r}/${tr}`,longDate:c,secretAccessKey:s,sessionToken:a,shortDate:u,signingRegion:n,signingService:r,uriEscapePath:o}})(t),{accessKeyId:r,credentialScope:o,longDate:i,sessionToken:s}=n,a={...e.headers};a.host=e.url.host,a[Zn]=i,s&&(a[er]=s);const c={...e,headers:a},u=((e,{credentialScope:t,longDate:n,secretAccessKey:r,shortDate:o,signingRegion:i,signingService:s,uriEscapePath:a})=>{const c=(({body:e,headers:t,method:n,url:r},o=!0)=>{return[n,gr(r.pathname,o),(i=r.searchParams,Array.from(i).sort((([e,t],[n,r])=>e===n?t<r?-1:1:e<n?-1:1)).map((([e,t])=>`${br(e)}=${br(t)}`)).join("&")),yr(t),Xn(t),Sr(e)].join("\n");var i})(e,a),u=((e,t,n)=>[nr,e,t,n].join("\n"))(n,t,fr(null,c)),l=fr(((e,t,n,r)=>{const o=hr(`AWS4${e}`,t),i=hr(o,n),s=hr(i,r);return hr(s,tr)})(r,o,i,s),u);return l})(c,n),l=`Credential=${r}/${o}`,d=`SignedHeaders=${Xn(a)}`,p=`Signature=${u}`;return a.authorization=`${nr} ${l}, ${d}, ${p}`,c},Tr=e=>new Date(Date.now()+e),Ar=({userAgentHeader:e="x-amz-user-agent",userAgentValue:t=""})=>n=>async function(r){if(0===t.trim().length)return await n(r);{const o=e.toLowerCase();return r.headers[o]=r.headers[o]?`${r.headers[o]} ${t}`:t,await n(r)}},Cr=(e,t)=>(n,r)=>{const o={};let i=t=>e(t,r);for(let e=t.length-1;e>=0;e--)i=(0,t[e])(r)(i,o);return i(n)},Nr=e=>{let t;return()=>(t||(t=e()),t)},Or=e=>!["HEAD","GET","DELETE"].includes(e.toUpperCase()),_r=async({url:e,method:t,headers:n,body:r},{abortSignal:o,cache:i,withCrossDomainCredentials:s})=>{let a;try{a=await fetch(e,{method:t,headers:n,body:Or(t)?r:void 0,signal:o,cache:i,credentials:s?"include":"same-origin"})}catch(e){if(e instanceof TypeError)throw new gn({name:Un.NetworkError,message:"A network error has occurred.",underlyingError:e});throw e}const c={};return a.headers?.forEach(((e,t)=>{c[t.toLowerCase()]=e})),{statusCode:a.status,headers:c,body:null,body:Object.assign(a.body??{},{text:Nr((()=>a.text())),blob:Nr((()=>a.blob())),json:Nr((()=>a.json()))})}},kr=Cr(_r,[Ar,Vn,({credentials:e,region:t,service:n,uriEscapePath:r=!0})=>{let o;return(i,s)=>async function(a){o=o??0;const c={credentials:"function"==typeof e?await e({forceRefresh:!!s?.isCredentialsExpired}):e,signingDate:Tr(o),signingRegion:t,signingService:n,uriEscapePath:r},u=await Er(a,c),l=await i(u),d=(({headers:e}={})=>e?.date??e?.Date??e?.["x-amz-date"])(l);return d&&(o=((e,t)=>((e,t)=>Math.abs(Tr(t).getTime()-e)>=3e5)(e,t)?e-Date.now():t)(Date.parse(d),o)),l}}]),Ir=Cr(_r,[Ar,Vn]),Rr=async(e,t,n,r)=>{const{url:o,method:i,headers:s,body:a,withCredentials:c,abortSignal:u}=t,l=a?a instanceof FormData?a:JSON.stringify(a??""):void 0,d=((e,t)=>{const n={};for(const t in e)n[t.toLowerCase()]=e[t];return t&&(n["content-type"]="application/json; charset=UTF-8",t instanceof FormData&&delete n["content-type"]),n})(s,a),p={url:o,headers:d,method:i,body:l},h={retryDecider:(y=_n,async(e,t)=>{const n=t??await y(e)??void 0,r=n?.code||n?.name,o=e?.statusCode;return{retryable:Wn(t)||Fn(o,r)||(e=>!!e&&jn.includes(e))(r)||Hn(o,r)}}),computeDelay:Qn,withCrossDomainCredentials:c,abortSignal:u},f=n(p,r);var y;let b;const m=await xr(e);if(f&&m){const e=Ln(o),t=r?.service??e.service,n=r?.region??e.region;b=await kr(p,{...h,credentials:m,region:n,service:t})}else b=await Ir(p,{...h});return{statusCode:b.statusCode,headers:b.headers,body:b.body}},xr=async e=>{try{const{credentials:t}=await e.Auth.fetchAuthSession();if(t)return t}catch(e){Rn.debug("No credentials available, the request will be unsigned.")}return null},Pr=(e,t,n)=>xn((async r=>{const{apiName:o,options:i={},path:s}=t,a=((e,t,n,r)=>{const o=e.getConfig()?.API?.REST?.[t]?.endpoint;!function(e,t){const{message:n,recoverySuggestion:r}=Cn[t];if(!e)throw new wn({name:t,message:n,recoverySuggestion:r})}(!!o,An.InvalidApiName);try{const e=new Zt(o+n);if(r){const t=new en(e.searchParams);Object.entries(r).forEach((([e,n])=>{t.set(e,n)})),e.search=new en(t).toString()}return e}catch(e){throw new wn({name:An.InvalidApiName,...Cn[An.InvalidApiName],recoverySuggestion:`Please make sure the REST endpoint URL is a valid URL string. Got ${o}`})}})(e,o,s,i?.queryParams),c=await(e.libraryOptions?.API?.REST?.headers?.({apiName:o})),{headers:u={}}=i,l={...c,...u},d=Ln(a,{amplify:e,apiName:o});return Rn.debug(n,a,l,`IAM signing options: ${JSON.stringify(d)}`),Rr(e,{...i,url:a,method:n,headers:l,abortSignal:r},qn,d)})),Mr=e=>((e,t)=>Pr(e,t,"GET"))(a.Amplify,e),Dr=e=>((e,t)=>Pr(e,t,"POST"))(a.Amplify,e),Lr=e=>((e,t)=>Pr(e,t,"PUT"))(a.Amplify,e),$r=e=>((e,t)=>Pr(e,t,"DELETE"))(a.Amplify,e),qr=e=>((e,t)=>Pr(e,t,"HEAD"))(a.Amplify,e),Ur=e=>((e,t)=>Pr(e,t,"PATCH"))(a.Amplify,e),jr=new WeakMap,Gr=(e,{url:t,options:n,abortController:r})=>{const o=r??new AbortController,i=xn((async()=>Rr(e,{url:t,method:"POST",...n,abortSignal:o.signal},$n,n?.signingServiceInfo)),o).finally((()=>{jr.delete(i)}));return i},Kr=(e,t)=>{const n=jr.get(e);return!!n&&(n.abort(t),t&&n.signal.reason!==t&&(n.signal.reason=t),!0)},Fr=(e,t)=>{jr.set(e,t)},Wr="x-amz-user-agent",Hr=[400,401,403],Br=["BadRequestException","UnauthorizedException"],zr="ConnectionStateChange";var Qr,Vr,Jr;!function(e){e.GQL_CONNECTION_INIT="connection_init",e.GQL_CONNECTION_ERROR="connection_error",e.GQL_CONNECTION_ACK="connection_ack",e.GQL_START="start",e.GQL_START_ACK="start_ack",e.DATA="data",e.GQL_CONNECTION_KEEP_ALIVE="ka",e.GQL_STOP="stop",e.GQL_COMPLETE="complete",e.GQL_ERROR="error",e.EVENT_SUBSCRIBE="subscribe",e.EVENT_PUBLISH="publish",e.EVENT_SUBSCRIBE_ACK="subscribe_success",e.EVENT_PUBLISH_ACK="publish_success",e.EVENT_STOP="unsubscribe",e.EVENT_COMPLETE="unsubscribe_success"}(Qr||(Qr={})),function(e){e[e.PENDING=0]="PENDING",e[e.CONNECTED=1]="CONNECTED",e[e.FAILED=2]="FAILED"}(Vr||(Vr={})),function(e){e[e.CLOSED=0]="CLOSED",e[e.READY=1]="READY",e[e.CONNECTING=2]="CONNECTING"}(Jr||(Jr={}));const Yr={accept:"application/json, text/javascript","content-encoding":"amz-1.0","content-type":"application/json; charset=UTF-8"},Xr=3e5;var Zr;!function(e){e.DEBUG="DEBUG",e.ERROR="ERROR",e.INFO="INFO",e.WARN="WARN",e.VERBOSE="VERBOSE",e.NONE="NONE"}(Zr||(Zr={}));const eo={VERBOSE:1,DEBUG:2,INFO:3,WARN:4,ERROR:5,NONE:6};class to{constructor(e,t=Zr.WARN){this.name=e,this.level=t,this._pluggables=[]}_padding(e){return e<10?"0"+e:""+e}_ts(){const e=new Date;return[this._padding(e.getMinutes()),this._padding(e.getSeconds())].join(":")+"."+e.getMilliseconds()}configure(e){return e?(this._config=e,this._config):this._config}_log(e,...t){let n=this.level;if(to.LOG_LEVEL&&(n=to.LOG_LEVEL),"undefined"!=typeof window&&window.LOG_LEVEL&&(n=window.LOG_LEVEL),!(eo[e]>=eo[n]))return;let r=console.log.bind(console);e===Zr.ERROR&&console.error&&(r=console.error.bind(console)),e===Zr.WARN&&console.warn&&(r=console.warn.bind(console)),to.BIND_ALL_LOG_LEVELS&&(e===Zr.INFO&&console.info&&(r=console.info.bind(console)),e===Zr.DEBUG&&console.debug&&(r=console.debug.bind(console)));const o=`[${e}] ${this._ts()} ${this.name}`;let i="";if(1===t.length&&"string"==typeof t[0])i=`${o} - ${t[0]}`,r(i);else if(1===t.length)i=`${o} ${t[0]}`,r(o,t[0]);else if("string"==typeof t[0]){let e=t.slice(1);1===e.length&&(e=e[0]),i=`${o} - ${t[0]} ${e}`,r(`${o} - ${t[0]}`,e)}else i=`${o} ${t}`,r(o,t);for(const e of this._pluggables){const t={message:i,timestamp:Date.now()};e.pushLogs([t])}}log(...e){this._log(Zr.INFO,...e)}info(...e){this._log(Zr.INFO,...e)}warn(...e){this._log(Zr.WARN,...e)}error(...e){this._log(Zr.ERROR,...e)}debug(...e){this._log(Zr.DEBUG,...e)}verbose(...e){this._log(Zr.VERBOSE,...e)}addPluggable(e){e&&"Logging"===e.getCategoryName()&&(this._pluggables.push(e),e.configure(this._config))}listPluggables(){return this._pluggables}}to.LOG_LEVEL=null,to.BIND_ALL_LOG_LEVELS=!1;const no="undefined"!=typeof Symbol?Symbol("amplify_default"):"@@amplify_default",ro=new to("Hub");class oo{constructor(e){this.listeners=new Map,this.protectedChannels=["core","auth","api","analytics","interactions","pubsub","storage","ui","xr"],this.name=e}_remove(e,t){const n=this.listeners.get(e);n?this.listeners.set(e,[...n.filter((({callback:e})=>e!==t))]):ro.warn(`No listeners for ${e}`)}dispatch(e,t,n,r){"string"==typeof e&&this.protectedChannels.indexOf(e)>-1&&(r===no||ro.warn(`WARNING: ${e} is protected and dispatching on it can have unintended consequences`));const o={channel:e,payload:{...t},source:n,patternInfo:[]};try{this._toListeners(o)}catch(e){ro.error(e)}}listen(e,t,n="noname"){let r;if("function"!=typeof t)throw new gn({name:"NoHubcallbackProvidedException",message:"No callback supplied to Hub"});r=t;let o=this.listeners.get(e);return o||(o=[],this.listeners.set(e,o)),o.push({name:n,callback:r}),()=>{this._remove(e,r)}}_toListeners(e){const{channel:t,payload:n}=e,r=this.listeners.get(t);r&&r.forEach((r=>{ro.debug(`Dispatching to ${t} with `,n);try{r.callback(e)}catch(e){ro.error(e)}}))}}new oo("__default__"),new oo("internal-hub");class io extends Error{constructor(){super(...arguments),this.nonRetryable=!0}}const so={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let ao;const co=new Uint8Array(16);function uo(){if(!ao&&(ao="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ao))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ao(co)}const lo=[];for(let e=0;e<256;++e)lo.push((e+256).toString(16).slice(1));const po=function(e,t,n){if(so.randomUUID&&!t&&!e)return so.randomUUID();const r=(e=e||{}).random||(e.rng||uo)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return lo[e[t+0]]+lo[e[t+1]]+lo[e[t+2]]+lo[e[t+3]]+"-"+lo[e[t+4]]+lo[e[t+5]]+"-"+lo[e[t+6]]+lo[e[t+7]]+"-"+lo[e[t+8]]+lo[e[t+9]]+"-"+lo[e[t+10]]+lo[e[t+11]]+lo[e[t+12]]+lo[e[t+13]]+lo[e[t+14]]+lo[e[t+15]]}(r)},ho=e=>e&&e.nonRetryable,fo={convert(e,t={urlSafe:!1,skipPadding:!1}){const n="string"==typeof e?e:function(e){return Array.from(e,(e=>String.fromCodePoint(e))).join("")}(e);let r=(()=>{if("undefined"!=typeof window&&"function"==typeof window.btoa)return window.btoa;if("function"==typeof btoa)return btoa;throw new gn({name:"Base64EncoderError",message:"Cannot resolve the `btoa` function from the environment."})})()(n);return t.urlSafe&&(r=r.replace(/\+/g,"-").replace(/\//g,"_")),t.skipPadding&&(r=r.replace(/=/g,"")),r}},yo=new to("retryUtil");var bo,mo;!function(e){e.CONNECTION_CLOSED="Connection closed",e.CONNECTION_FAILED="Connection failed",e.REALTIME_SUBSCRIPTION_INIT_ERROR="AppSync Realtime subscription init error",e.SUBSCRIPTION_ACK="Subscription ack",e.TIMEOUT_DISCONNECT="Timeout disconnect"}(bo||(bo={})),function(e){e.Connected="Connected",e.ConnectedPendingNetwork="ConnectedPendingNetwork",e.ConnectionDisrupted="ConnectionDisrupted",e.ConnectionDisruptedPendingNetwork="ConnectionDisruptedPendingNetwork",e.Connecting="Connecting",e.ConnectedPendingDisconnect="ConnectedPendingDisconnect",e.Disconnected="Disconnected",e.ConnectedPendingKeepAlive="ConnectedPendingKeepAlive"}(mo||(mo={}));class go{networkMonitor(e){const t=(()=>{if("undefined"==typeof self)return!1;const e=self;return void 0!==e.WorkerGlobalScope&&self instanceof e.WorkerGlobalScope})()?self:"undefined"!=typeof window&&window;return t?new dt((e=>{e.next({online:t.navigator.onLine});const n=()=>{e.next({online:!0})},r=()=>{e.next({online:!1})};return t.addEventListener("online",n),t.addEventListener("offline",r),go._observers.push(e),()=>{t.removeEventListener("online",n),t.removeEventListener("offline",r),go._observers=go._observers.filter((t=>t!==e))}})):Jt([{online:!0}])}static _observerOverride(e){for(const t of this._observers)t.closed?this._observers=this._observers.filter((e=>e!==t)):t?.next&&t.next(e)}}go._observers=[];const So=()=>(new go).networkMonitor(),vo={KEEP_ALIVE_MISSED:{keepAliveState:"unhealthy"},KEEP_ALIVE:{keepAliveState:"healthy"},CONNECTION_ESTABLISHED:{connectionState:"connected"},CONNECTION_FAILED:{intendedConnectionState:"disconnected",connectionState:"disconnected"},CLOSING_CONNECTION:{intendedConnectionState:"disconnected"},OPENING_CONNECTION:{intendedConnectionState:"connected",connectionState:"connecting"},CLOSED:{connectionState:"disconnected"},ONLINE:{networkState:"connected"},OFFLINE:{networkState:"disconnected"}};class wo{constructor(){this._networkMonitoringSubscription=void 0,this._linkedConnectionState={networkState:"connected",connectionState:"disconnected",intendedConnectionState:"disconnected",keepAliveState:"healthy"},this._initialNetworkStateSubscription=So().subscribe((({online:e})=>{this.record(e?vo.ONLINE:vo.OFFLINE),this._initialNetworkStateSubscription?.unsubscribe()})),this._linkedConnectionStateObservable=new dt((e=>{e.next(this._linkedConnectionState),this._linkedConnectionStateObserver=e}))}enableNetworkMonitoring(){this._initialNetworkStateSubscription?.unsubscribe(),void 0===this._networkMonitoringSubscription&&(this._networkMonitoringSubscription=So().subscribe((({online:e})=>{this.record(e?vo.ONLINE:vo.OFFLINE)})))}disableNetworkMonitoring(){this._networkMonitoringSubscription?.unsubscribe(),this._networkMonitoringSubscription=void 0}get connectionStateObservable(){let e;return this._linkedConnectionStateObservable.pipe(H((e=>this.connectionStatesTranslator(e)))).pipe((t=t=>{const n=t!==e;return e=t,n},u((function(e,n){var r=0;e.subscribe(F(n,(function(e){return t.call(undefined,e,r++)&&n.next(e)})))}))));var t}record(e){"connected"===e.intendedConnectionState?this.enableNetworkMonitoring():"disconnected"===e.intendedConnectionState&&this.disableNetworkMonitoring();const t={...this._linkedConnectionState,...e};this._linkedConnectionState={...t},this._linkedConnectionStateObserver?.next(this._linkedConnectionState)}connectionStatesTranslator({connectionState:e,networkState:t,intendedConnectionState:n,keepAliveState:r}){return"connected"===e&&"disconnected"===t?mo.ConnectedPendingNetwork:"connected"===e&&"disconnected"===n?mo.ConnectedPendingDisconnect:"disconnected"===e&&"connected"===n&&"disconnected"===t?mo.ConnectionDisruptedPendingNetwork:"disconnected"===e&&"connected"===n?mo.ConnectionDisrupted:"connected"===e&&"unhealthy"===r?mo.ConnectedPendingKeepAlive:"connecting"===e?mo.Connecting:"disconnected"===e?mo.Disconnected:mo.Connected}}var Eo;!function(e){e.START_RECONNECT="START_RECONNECT",e.HALT_RECONNECT="HALT_RECONNECT"}(Eo||(Eo={}));class To{constructor(){this.reconnectObservers=[]}addObserver(e){this.reconnectObservers.push(e)}record(e){e===Eo.START_RECONNECT&&void 0===this.reconnectSetTimeoutId&&void 0===this.reconnectIntervalId&&(this.reconnectSetTimeoutId=setTimeout((()=>{this._triggerReconnect(),this.reconnectIntervalId=setInterval((()=>{this._triggerReconnect()}),6e4)}),5e3)),e===Eo.HALT_RECONNECT&&(this.reconnectIntervalId&&(clearInterval(this.reconnectIntervalId),this.reconnectIntervalId=void 0),this.reconnectSetTimeoutId&&(clearTimeout(this.reconnectSetTimeoutId),this.reconnectSetTimeoutId=void 0))}close(){this.reconnectObservers.forEach((e=>{e.complete?.()}))}_triggerReconnect(){this.reconnectObservers.forEach((e=>{e.next?.()}))}}const Ao=/^https:\/\/\w{26}\.appsync-api\.\w{2}(?:(?:-\w{2,})+)-\d\.amazonaws.com(?:\.cn)?\/graphql$/i,Co=/^https:\/\/\w{26}\.\w+-api\.\w{2}(?:(?:-\w{2,})+)-\d\.amazonaws.com(?:\.cn)?\/event$/i,No="/realtime",Oo=async e=>{const{appSyncGraphqlEndpoint:t,query:n,libraryConfigHeaders:r=()=>({}),additionalHeaders:o={},authToken:i}=e;let s={};const a=await r();if("function"==typeof o){const e={url:t||"",queryString:n||""};s=await o(e)}else s=o;return i&&(s={...s,Authorization:i}),{additionalCustomHeaders:s,libraryConfigHeaders:a}},_o=new a.ConsoleLogger("AWSAppSyncRealTimeProvider Auth"),ko=async({host:e})=>{const t=await(0,a.fetchAuthSession)();return{Authorization:t?.tokens?.accessToken?.toString(),host:e}},Io=async({apiKey:e,host:t})=>({host:t,"x-amz-date":(new Date).toISOString().replace(/[:-]|\.\d{3}/g,""),"x-api-key":e}),Ro=async({payload:e,canonicalUri:t,appSyncGraphqlEndpoint:n,region:r})=>{const o={region:r,service:"appsync"},i=(await(0,a.fetchAuthSession)()).credentials,s={url:`${n}${t}`,data:e,method:"POST",headers:{...Yr}};return Er({headers:s.headers,method:s.method,url:new Zt(s.url),body:s.data},{credentials:i,signingRegion:o.region,signingService:o.service}).headers},xo=async({host:e,additionalCustomHeaders:t})=>{if(!t?.Authorization)throw new Error("No auth token specified");return{Authorization:t.Authorization,host:e}},Po=async({apiKey:e,authenticationType:t,canonicalUri:n,appSyncGraphqlEndpoint:r,region:o,additionalCustomHeaders:i,payload:s})=>{const a={apiKey:Io,iam:Ro,oidc:ko,userPool:ko,lambda:xo,none:xo};if(t&&a[t]){const c=a[t],u=r?new Zt(r).host:void 0,l="apiKey"===t?e:void 0;return _o.debug(`Authenticating with ${JSON.stringify(t)}`),await c({payload:s,canonicalUri:n,appSyncGraphqlEndpoint:r,apiKey:l,region:o,host:u,additionalCustomHeaders:i})}_o.debug(`Authentication type ${t} not supported`)},Mo=e=>{a.Hub.dispatch("api",e,"PubSub",no)};class Do{constructor(e){this.subscriptionObserverMap=new Map,this.socketStatus=Jr.CLOSED,this.keepAliveTimeout=Xr,this.promiseArray=[],this.connectionStateMonitor=new wo,this.reconnectionMonitor=new To,this._establishConnection=async(e,t)=>{this.logger.debug(`Establishing WebSocket connection to ${e}`);try{await this._openConnection(e,t),await this._initiateHandshake()}catch(e){const{errorType:t,errorCode:n}=e;throw Hr.includes(n)||Br.includes(t)?new io(t):t?new Error(t):e}},this.logger=new a.ConsoleLogger(e.providerName),this.wsProtocolName=e.wsProtocolName,this.wsConnectUri=e.connectUri,this.connectionStateMonitorSubscription=this._startConnectionStateMonitoring()}close(){return this.socketStatus=Jr.CLOSED,this.connectionStateMonitor.record(vo.CONNECTION_FAILED),this.connectionStateMonitorSubscription.unsubscribe(),this.reconnectionMonitor.close(),new Promise(((e,t)=>{this.awsRealTimeSocket?(this.awsRealTimeSocket.onclose=t=>{this.subscriptionObserverMap=new Map,this.awsRealTimeSocket=void 0,e()},this.awsRealTimeSocket.onerror=e=>{t(e)},this.awsRealTimeSocket.close()):e()}))}subscribe(e,t){return new dt((n=>{if(!e?.appSyncGraphqlEndpoint)return;let r=!1;const o=po(),i=()=>{r||(r=!0,this._startSubscriptionWithAWSAppSyncRealTime({options:e,observer:n,subscriptionId:o,customUserAgentDetails:t}).catch((e=>{this.logger.debug(`${bo.REALTIME_SUBSCRIPTION_INIT_ERROR}: ${e}`),this.connectionStateMonitor.record(vo.CLOSED)})).finally((()=>{r=!1})))},s=new dt((e=>{this.reconnectionMonitor.addObserver(e)})).subscribe((()=>{i()}));return i(),async()=>{await this._cleanupSubscription(o,s)}}))}async connect(e){this.socketStatus!==Jr.READY&&await this._connectWebSocket(e)}async publish(e,t){if(this.socketStatus!==Jr.READY)throw new Error("Subscription has not been initialized");return this._publishMessage(e,t)}async _connectWebSocket(e){const{apiKey:t,appSyncGraphqlEndpoint:n,authenticationType:r,region:o}=e,{additionalCustomHeaders:i}=await Oo(e);this.connectionStateMonitor.record(vo.OPENING_CONNECTION),await this._initializeWebSocketConnection({apiKey:t,appSyncGraphqlEndpoint:n,authenticationType:r,region:o,additionalCustomHeaders:i})}async _publishMessage(e,t){const n=po(),{additionalCustomHeaders:r,libraryConfigHeaders:o}=await Oo(e),i=await this._prepareSubscriptionPayload({options:e,subscriptionId:n,customUserAgentDetails:t,additionalCustomHeaders:r,libraryConfigHeaders:o,publish:!0});return new Promise(((e,t)=>{if(this.awsRealTimeSocket){const r=t=>{const o=JSON.parse(t.data);o.id===n&&"publish_success"===o.type&&(this.awsRealTimeSocket&&this.awsRealTimeSocket.removeEventListener("message",r),e()),o.erroredEvents&&o.erroredEvents.length};this.awsRealTimeSocket.addEventListener("message",r),this.awsRealTimeSocket.addEventListener("close",(()=>{t(new Error("WebSocket is closed"))})),this.awsRealTimeSocket.send(i)}}))}async _cleanupSubscription(e,t){t?.unsubscribe();try{await this._waitForSubscriptionToBeConnected(e);const{subscriptionState:t}=this.subscriptionObserverMap.get(e)||{};if(!t)return;if(t!==Vr.CONNECTED)throw new Error("Subscription never connected");this._sendUnsubscriptionMessage(e)}catch(e){this.logger.debug(`Error while unsubscribing ${e}`)}finally{this._removeSubscriptionObserver(e)}}_startConnectionStateMonitoring(){return this.connectionStateMonitor.connectionStateObservable.subscribe((e=>{Mo({event:zr,data:{provider:this,connectionState:e},message:`Connection state is ${e}`}),this.connectionState=e,e===mo.ConnectionDisrupted&&this.reconnectionMonitor.record(Eo.START_RECONNECT),[mo.Connected,mo.ConnectedPendingDisconnect,mo.ConnectedPendingKeepAlive,mo.ConnectedPendingNetwork,mo.ConnectionDisruptedPendingNetwork,mo.Disconnected].includes(e)&&this.reconnectionMonitor.record(Eo.HALT_RECONNECT)}))}async _startSubscriptionWithAWSAppSyncRealTime({options:e,observer:t,subscriptionId:n,customUserAgentDetails:r}){const{query:o,variables:i}=e,{additionalCustomHeaders:s,libraryConfigHeaders:a}=await Oo(e);this.subscriptionObserverMap.set(n,{observer:t,query:o??"",variables:i??{},subscriptionState:Vr.PENDING,startAckTimeoutId:void 0});const c=await this._prepareSubscriptionPayload({options:e,subscriptionId:n,customUserAgentDetails:r,additionalCustomHeaders:s,libraryConfigHeaders:a});try{await this._connectWebSocket(e)}catch(e){return void this._logStartSubscriptionError(n,t,e)}const{subscriptionFailedCallback:u,subscriptionReadyCallback:l}=this.subscriptionObserverMap.get(n)??{};this.subscriptionObserverMap.set(n,{observer:t,subscriptionState:Vr.PENDING,query:o??"",variables:i??{},subscriptionReadyCallback:l,subscriptionFailedCallback:u,startAckTimeoutId:setTimeout((()=>{this._timeoutStartSubscriptionAck(n)}),15e3)}),this.awsRealTimeSocket&&this.awsRealTimeSocket.send(c)}_logStartSubscriptionError(e,t,n){this.logger.debug({err:n});const r=String(n.message??"");if(this.connectionStateMonitor.record(vo.CLOSED),this.connectionState!==mo.ConnectionDisruptedPendingNetwork){ho(n)?t.error({errors:[{...new jt.GraphQLError(`${bo.CONNECTION_FAILED}: ${r}`)}]}):this.logger.debug(`${bo.CONNECTION_FAILED}: ${r}`);const{subscriptionFailedCallback:o}=this.subscriptionObserverMap.get(e)||{};"function"==typeof o&&o()}}async _waitForSubscriptionToBeConnected(e){const t=this.subscriptionObserverMap.get(e);if(t){const{subscriptionState:n}=t;if(n===Vr.PENDING)return new Promise(((n,r)=>{const{observer:o,subscriptionState:i,variables:s,query:a}=t;this.subscriptionObserverMap.set(e,{observer:o,subscriptionState:i,variables:s,query:a,subscriptionReadyCallback:n,subscriptionFailedCallback:r})}))}}_sendUnsubscriptionMessage(e){try{if(this.awsRealTimeSocket&&this.awsRealTimeSocket.readyState===WebSocket.OPEN&&this.socketStatus===Jr.READY){const t=this._unsubscribeMessage(e),n=JSON.stringify(t);this.awsRealTimeSocket.send(n)}}catch(e){this.logger.debug({err:e})}}_removeSubscriptionObserver(e){this.subscriptionObserverMap.delete(e),setTimeout(this._closeSocketIfRequired.bind(this),1e3)}_closeSocketIfRequired(){if(!(this.subscriptionObserverMap.size>0))if(this.awsRealTimeSocket)if(this.connectionStateMonitor.record(vo.CLOSING_CONNECTION),this.awsRealTimeSocket.bufferedAmount>0)setTimeout(this._closeSocketIfRequired.bind(this),1e3);else{this.logger.debug("closing WebSocket..."),this.keepAliveTimeoutId&&clearTimeout(this.keepAliveTimeoutId),this.keepAliveAlertTimeoutId&&clearTimeout(this.keepAliveAlertTimeoutId);const e=this.awsRealTimeSocket;e.onclose=null,e.onerror=null,e.close(1e3),this.awsRealTimeSocket=void 0,this.socketStatus=Jr.CLOSED,this.connectionStateMonitor.record(vo.CLOSED)}else this.socketStatus=Jr.CLOSED}_handleIncomingSubscriptionMessage(e){if("string"!=typeof e.data)return;const[t,n]=this._handleSubscriptionData(e);if(t)return;const{type:r,id:o,payload:i}=n,{observer:s=null,query:a="",variables:c={},startAckTimeoutId:u,subscriptionReadyCallback:l,subscriptionFailedCallback:d}=this.subscriptionObserverMap.get(o)||{};if(r===Qr.GQL_START_ACK||r===Qr.EVENT_SUBSCRIBE_ACK){this.logger.debug(`subscription ready for ${JSON.stringify({query:a,variables:c})}`),"function"==typeof l&&l(),u&&clearTimeout(u),Mo({event:bo.SUBSCRIPTION_ACK,data:{query:a,variables:c},message:"Connection established for subscription"});const e=Vr.CONNECTED;return s&&this.subscriptionObserverMap.set(o,{observer:s,query:a,variables:c,startAckTimeoutId:void 0,subscriptionState:e,subscriptionReadyCallback:l,subscriptionFailedCallback:d}),void this.connectionStateMonitor.record(vo.CONNECTION_ESTABLISHED)}if(r===Qr.GQL_CONNECTION_KEEP_ALIVE)return this.keepAliveTimeoutId&&clearTimeout(this.keepAliveTimeoutId),this.keepAliveAlertTimeoutId&&clearTimeout(this.keepAliveAlertTimeoutId),this.keepAliveTimeoutId=setTimeout((()=>{this._errorDisconnect(bo.TIMEOUT_DISCONNECT)}),this.keepAliveTimeout),this.keepAliveAlertTimeoutId=setTimeout((()=>{this.connectionStateMonitor.record(vo.KEEP_ALIVE_MISSED)}),65e3),void this.connectionStateMonitor.record(vo.KEEP_ALIVE);if(r===Qr.GQL_ERROR){const e=Vr.FAILED;s&&(this.subscriptionObserverMap.set(o,{observer:s,query:a,variables:c,startAckTimeoutId:u,subscriptionReadyCallback:l,subscriptionFailedCallback:d,subscriptionState:e}),this.logger.debug(`${bo.CONNECTION_FAILED}: ${JSON.stringify(i??n)}`),s.error({errors:[{...new jt.GraphQLError(`${bo.CONNECTION_FAILED}: ${JSON.stringify(i??n)}`)}]}),u&&clearTimeout(u),"function"==typeof d&&d())}}_errorDisconnect(e){this.logger.debug(`Disconnect error: ${e}`),this.awsRealTimeSocket&&(this.connectionStateMonitor.record(vo.CLOSED),this.awsRealTimeSocket.close()),this.socketStatus=Jr.CLOSED}_timeoutStartSubscriptionAck(e){const t=this.subscriptionObserverMap.get(e);if(t){const{observer:n,query:r,variables:o}=t;if(!n)return;this.subscriptionObserverMap.set(e,{observer:n,query:r,variables:o,subscriptionState:Vr.FAILED}),this.connectionStateMonitor.record(vo.CLOSED),this.logger.debug("timeoutStartSubscription",JSON.stringify({query:r,variables:o}))}}_initializeWebSocketConnection({appSyncGraphqlEndpoint:e,authenticationType:t,apiKey:n,region:r,additionalCustomHeaders:o}){if(this.socketStatus!==Jr.READY)return new Promise((async(i,s)=>{if(this.promiseArray.push({res:i,rej:s}),this.socketStatus===Jr.CLOSED)try{this.socketStatus=Jr.CONNECTING;const i="{}",s=await Po({authenticationType:t,payload:i,canonicalUri:this.wsConnectUri,apiKey:n,appSyncGraphqlEndpoint:e,region:r,additionalCustomHeaders:o}),a=s?JSON.stringify(s):"",c=`header-${fo.convert(a,{urlSafe:!0,skipPadding:!0})}`,u=(e=>{const t=(e=>{if(!e)return{};if("Authorization"in e){const{Authorization:t,...n}=e;return n}return e})(e),n=new en;return Object.entries(t).forEach((([e,t])=>{n.append(e,t)})),n})(o),l=((e,t)=>{const n=(e=>{let t=e??"";return t=null!==t.match(Co)?t.concat(No).replace("ddpg-api","grt-gamma").replace("appsync-api","appsync-realtime-api"):null===t.match(Ao)?t.concat(No):t.replace("appsync-api","appsync-realtime-api").replace("gogi-beta","grt-beta").replace("ddpg-api","grt-gamma"),t=t.replace("https://","wss://").replace("http://","ws://"),new Zt(t)})(e),r=new en(n.search);for(const[e,n]of t.entries())r.append(e,n);return n.search=r.toString(),n.toString()})(e,u);await this._establishRetryableConnection(l,c),this.promiseArray.forEach((({res:e})=>{this.logger.debug("Notifying connection successful"),e()})),this.socketStatus=Jr.READY,this.promiseArray=[]}catch(e){this.logger.debug("Connection exited with",e),this.promiseArray.forEach((({rej:t})=>{t(e)})),this.promiseArray=[],this.awsRealTimeSocket&&this.awsRealTimeSocket.readyState===WebSocket.OPEN&&this.awsRealTimeSocket.close(3001),this.awsRealTimeSocket=void 0,this.socketStatus=Jr.CLOSED}}))}async _establishRetryableConnection(e,t){this.logger.debug("Establishing retryable connection"),await((e,t,n=3e5,r)=>async function(e,t,n,r){if("function"!=typeof e)throw Error("functionToRetry must be a function");return new Promise((async(o,i)=>{let s,a,c=0,u=!1,l=()=>{};for(r&&r.then((()=>{u=!0,clearTimeout(s),l()}));!u;){c++,yo.debug(`${e.name} attempt #${c} with this vars: ${JSON.stringify(t)}`);try{return void o(await e(...t))}catch(r){if(a=r,yo.debug(`error on ${e.name}`,r),ho(r))return yo.debug(`${e.name} non retryable error`,r),void i(r);const o=n(c,t,r);if(yo.debug(`${e.name} retrying in ${o} ms`),!1===o||u)return void i(r);await new Promise((e=>{l=e,s=setTimeout(l,o)}))}}i(a)}))}(e,t,Bn(n),r))(this._establishConnection.bind(this),[e,t],5e3)}async _openConnection(e,t){return new Promise(((n,r)=>{const o=this._getNewWebSocket(e,[this.wsProtocolName,t]);o.onerror=()=>{this.logger.debug("WebSocket connection error")},o.onclose=()=>{r(new Error("Connection handshake error"))},o.onopen=()=>{this.awsRealTimeSocket=o,n()}}))}_getNewWebSocket(e,t){return new WebSocket(e,t)}async _initiateHandshake(){return new Promise(((e,t)=>{if(!this.awsRealTimeSocket)return void t(new Error("awsRealTimeSocket undefined"));let n=!1;this.awsRealTimeSocket.onerror=e=>{this.logger.debug(`WebSocket error ${JSON.stringify(e)}`)},this.awsRealTimeSocket.onclose=e=>{this.logger.debug(`WebSocket closed ${e.reason}`),t(new Error(JSON.stringify(e)))},this.awsRealTimeSocket.onmessage=r=>{if("string"!=typeof r.data)return;this.logger.debug(`subscription message from AWS AppSyncRealTime: ${r.data} `);const o=JSON.parse(r.data),{type:i}=o,s=this._extractConnectionTimeout(o);if(i===Qr.GQL_CONNECTION_ACK)return n=!0,this._registerWebsocketHandlers(s),void e("Connected to AWS AppSyncRealTime");if(i===Qr.GQL_CONNECTION_ERROR){const{errorType:e,errorCode:n}=this._extractErrorCodeAndType(o);t({errorType:e,errorCode:n})}};const r={type:Qr.GQL_CONNECTION_INIT};this.awsRealTimeSocket.send(JSON.stringify(r));const o=e=>{e||(this.connectionStateMonitor.record(vo.CONNECTION_FAILED),t(new Error("Connection timeout: ack from AWSAppSyncRealTime was not received after 15000 ms")))};setTimeout((()=>{o(n)}),15e3)}))}_registerWebsocketHandlers(e){this.awsRealTimeSocket&&(this.keepAliveTimeout=e,this.awsRealTimeSocket.onmessage=this._handleIncomingSubscriptionMessage.bind(this),this.awsRealTimeSocket.onerror=e=>{this.logger.debug(e),this._errorDisconnect(bo.CONNECTION_CLOSED)},this.awsRealTimeSocket.onclose=e=>{this.logger.debug(`WebSocket closed ${e.reason}`),this._errorDisconnect(bo.CONNECTION_CLOSED)})}}const Lo="AWSAppSyncRealTimeProvider";class $o extends Do{constructor(){super({providerName:Lo,wsProtocolName:"graphql-ws",connectUri:"/connect"})}getProviderName(){return Lo}subscribe(e,t){return super.subscribe(e,t)}async _prepareSubscriptionPayload({options:e,subscriptionId:t,customUserAgentDetails:n,additionalCustomHeaders:r,libraryConfigHeaders:o}){const{appSyncGraphqlEndpoint:i,authenticationType:s,query:a,variables:c,apiKey:u,region:l}=e,d={query:a,variables:c},p=JSON.stringify(d),h={id:t,payload:{data:p,extensions:{authorization:{...{...await Po({apiKey:u,appSyncGraphqlEndpoint:i,authenticationType:s,payload:p,canonicalUri:"",region:l,additionalCustomHeaders:r}),...o,...r,[Wr]:mn(n)}}}},type:Qr.GQL_START};return JSON.stringify(h)}_handleSubscriptionData(e){this.logger.debug(`subscription message from AWS AppSync RealTime: ${e.data}`);const{id:t="",payload:n,type:r}=JSON.parse(String(e.data)),{observer:o=null,query:i="",variables:s={}}=this.subscriptionObserverMap.get(t)||{};return this.logger.debug({id:t,observer:o,query:i,variables:s}),r===Qr.DATA&&n&&n.data?(o?o.next(n):this.logger.debug(`observer not found for id: ${t}`),[!0,{id:t,type:r,payload:n}]):[!1,{id:t,type:r,payload:n}]}_unsubscribeMessage(e){return{id:e,type:Qr.GQL_STOP}}_extractConnectionTimeout(e){const{payload:{connectionTimeoutMs:t=Xr}={}}=e;return t}_extractErrorCodeAndType(e){const{payload:{errors:[{errorType:t="",errorCode:n=0}={}]=[]}={}}=e;return{errorCode:n,errorType:t}}}class qo extends gn{constructor(e){super(e),this.constructor=qo,Object.setPrototypeOf(this,qo.prototype)}}var Uo;!function(e){e.NoAuthSession="NoAuthSession",e.NoRegion="NoRegion",e.NoCustomEndpoint="NoCustomEndpoint"}(Uo||(Uo={}));const jo={[Uo.NoAuthSession]:{message:"Auth session should not be empty."},[Uo.NoRegion]:{message:"Missing region."},[Uo.NoCustomEndpoint]:{message:"Custom endpoint region is present without custom endpoint."}},Go=new a.ConsoleLogger("GraphQLAPI resolveConfig"),Ko=e=>{const t=e.getConfig();t.API?.GraphQL||Go.warn("The API configuration is missing. This is likely due to Amplify.configure() not being called prior to generateClient().");const{apiKey:n,customEndpoint:r,customEndpointRegion:o,defaultAuthMode:i,endpoint:s,region:a}=t.API?.GraphQL??{};return function(e,t){const{message:n,recoverySuggestion:r}=jo[t];if(!e)throw new qo({name:t,message:n,recoverySuggestion:r})}(!(!r&&o),Uo.NoCustomEndpoint),{apiKey:n,customEndpoint:r,customEndpointRegion:o,defaultAuthMode:i,endpoint:s,region:a}},Fo=e=>{const t=e.libraryOptions?.API?.GraphQL?.headers,n=e.libraryOptions?.API?.GraphQL?.withCredentials;return{headers:t,withCredentials:n}};function Wo(e){return e.errors&&Array.isArray(e.errors)&&e.errors.forEach((e=>{var t;t=e,(t?.originalError?.name?.startsWith("UnauthorizedException")||t.message?.startsWith("Connection failed:")&&t.message?.includes("Permission denied"))&&(e.message="Unauthorized",e.recoverySuggestion="If you're calling an Amplify-generated API, make sure to set the \"authMode\" in generateClient({ authMode: '...' }) to the backend authorization rule's auth provider ('apiKey', 'userPool', 'iam', 'oidc', 'lambda')")})),e}const Ho={name:"NoApiKey",message:St.NO_API_KEY,recoverySuggestion:'The API request was made with `authMode: "apiKey"` but no API Key was passed into `Amplify.configure()`. Review if your API key is passed into the `Amplify.configure()` function.'},Bo={name:"NoCredentials",message:St.NO_CREDENTIALS,recoverySuggestion:'The API request was made with `authMode: "iam"` but no authentication credentials are available.\n\nIf you intended to make a request using an authenticated role, review if your user is signed in before making the request.\n\nIf you intend to make a request using an unauthenticated role or also known as "guest access", verify if "Auth.Cognito.allowGuestAccess" is set to "true" in the `Amplify.configure()` function.'},zo={name:"NoValidAuthTokens",message:St.NO_FEDERATED_JWT,recoverySuggestion:"If you intended to make an authenticated API request, review if the current user is signed in."},Qo={name:"NoSignedUser",message:St.NO_CURRENT_USER,recoverySuggestion:"Review the underlying exception field for more details. If you intended to make an authenticated API request, review if the current user is signed in."},Vo={name:"NoAuthorizationHeader",message:St.NO_AUTH_TOKEN,recoverySuggestion:'The API request was made with `authMode: "lambda"` but no `authToken` is set. Review if a valid authToken is passed into the request options or in the `Amplify.configure()` function.'},Jo={name:"NoEndpoint",message:"No GraphQL endpoint configured in `Amplify.configure()`.",recoverySuggestion:"Review if the GraphQL API endpoint is set in the `Amplify.configure()` function."},Yo=e=>({data:{},errors:[new jt.GraphQLError(e.message,null,null,null,null,e)]});function Xo(e){if(!e)return!1;const t=e;return Array.isArray(t.errors)&&t.errors.length>0}async function Zo(e,t,n,r={}){let o={};switch(t){case"apiKey":if(!n)throw new qo(Ho);o={"X-Api-Key":n};break;case"iam":if(void 0===(await e.Auth.fetchAuthSession()).credentials)throw new qo(Bo);break;case"oidc":case"userPool":{let t;try{t=(await e.Auth.fetchAuthSession()).tokens?.accessToken.toString()}catch(e){throw new qo({...Qo,underlyingError:e})}if(!t)throw new qo(zo);o={Authorization:t};break}case"lambda":if("object"==typeof r&&!r.Authorization)throw new qo(Vo);o={Authorization:r.Authorization}}return o}const ei="x-amz-user-agent";class ti{constructor(){this.appSyncRealTime=new $o,this._api={post:Gr,cancelREST:Kr,isCancelErrorREST:Tn,updateRequestToBeCancellable:Fr}}getModuleName(){return"InternalGraphQLAPI"}getGraphqlOperationType(e){const t=(0,jt.parse)(e).definitions,[{operation:n}]=t;return n}graphql(e,{query:t,variables:n={},authMode:r,authToken:o},i,s){const a="string"==typeof t?(0,jt.parse)(t):(0,jt.parse)((0,jt.print)(t)),[c={}]=a.definitions.filter((e=>"OperationDefinition"===e.kind)),{operation:u}=c,l=i||{};switch(u){case"query":case"mutation":{const t=new AbortController;let i;return i=(e=>"function"!=typeof e)(e)?this._graphql(e,{query:a,variables:n,authMode:r},l,t,s,o):e((async e=>await this._graphql(e,{query:a,variables:n,authMode:r},l,t,s,o))),this._api.updateRequestToBeCancellable(i,t),i}case"subscription":return this._graphqlSubscribe(e,{query:a,variables:n,authMode:r},l,s,o);default:throw new Error(`invalid operation type: ${u}`)}}async _graphql(e,{query:t,variables:n,authMode:r},o={},i,s,a){const{apiKey:c,region:u,endpoint:l,customEndpoint:d,customEndpointRegion:p,defaultAuthMode:h}=Ko(e),f=r||h||"iam",y="identityPool"===f?"iam":f,{headers:b,withCredentials:m}=Fo(e);let g;if("function"==typeof o){const e={method:"POST",url:new Zt(d||l||"").toString(),queryString:(0,jt.print)(t)};g=await o(e)}else g=o;a&&(g={...g,Authorization:a});const S=await Zo(e,y,c,g),v={...!d&&S,...d&&(p?S:{})||{},...b&&await b({query:(0,jt.print)(t),variables:n}),...g,...!d&&{[ei]:mn(s)}},w={query:(0,jt.print)(t),variables:n||null};let E;E=d&&!p||"oidc"!==y&&"userPool"!==y&&"iam"!==y&&"lambda"!==y?void 0:{service:p?"execute-api":"appsync",region:p||u};const T=d||l;if(!T)throw Yo(new qo(Jo));let A;try{const{body:t}=await this._api.post(e,{url:new Zt(T),options:{headers:v,body:w,signingServiceInfo:E,withCredentials:m},abortController:i});A=await t.json()}catch(e){if(this.isCancelError(e))throw e;A=Yo(e)}if(Xo(A))throw Wo(A);return A}isCancelError(e){return this._api.isCancelErrorREST(e)}cancel(e,t){return this._api.cancelREST(e,t)}_graphqlSubscribe(e,{query:t,variables:n,authMode:r},o={},i,s){const a=Ko(e),c=r||a?.defaultAuthMode||"iam",u="identityPool"===c?"iam":c,{headers:l}=Fo(e);return this.appSyncRealTime.subscribe({query:(0,jt.print)(t),variables:n,appSyncGraphqlEndpoint:a?.endpoint,region:a?.region,authenticationType:u,apiKey:a?.apiKey,additionalHeaders:o,authToken:s,libraryConfigHeaders:l},i).pipe(Xt((e=>{if(e.errors)throw Wo(e);throw e})))}}new ti;const ni=new class extends ti{getModuleName(){return"GraphQLAPI"}graphql(e,t,n){const r={category:Ot.API,action:It.GraphQl};if(function(e){return Se in e}(t)){const{[Se]:o,...i}=t;return super.graphql(e,i,n,{...r,...o})}return super.graphql(e,t,n,{...r})}isCancelError(e){return super.isCancelError(e)}cancel(e,t){return super.cancel(e,t)}};function ri(e,t){const n=At(this);e.authMode=e.authMode||n.authMode,e.authToken=e.authToken||n.authToken;const r=t||n.headers;return ni.graphql(n.amplify,e,r)}function oi(e,t){return ni.cancel(e,t)}function ii(e){return ni.isCancelError(e)}const si=e=>{a.Hub.listen("core",(t=>{if("configure"!==t.payload.event)return;const n=t.payload.data.API?.GraphQL;Ct(n)&&gt(e,n,At)}))},ai=new Proxy({},{get(){throw new Error("Client could not be generated. This is likely due to `Amplify.configure()` not being called prior to `generateClient()` or because the configuration passed to `Amplify.configure()` is missing GraphQL provider configuration.")}});function ci(e={}){return function(e){const t={[vt]:e.amplify,[wt]:e.authMode,[Et]:e.authToken,[Tt]:e.headers,graphql:ri,cancel:oi,isCancelError:ii,models:ai,enums:ai,queries:ai,mutations:ai,subscriptions:ai},n=e.amplify.getConfig().API?.GraphQL;return Ct(n)?gt(t,n,At):si(t),t}({...e,amplify:a.Amplify})}const ui="AWSAppSyncEventsProvider",li=new class extends Do{constructor(){super({providerName:ui,wsProtocolName:"aws-appsync-event-ws",connectUri:""})}getProviderName(){return ui}async connect(e){super.connect(e)}subscribe(e,t){return super.subscribe(e,t).pipe()}async publish(e,t){super.publish(e,t)}async _prepareSubscriptionPayload({options:e,subscriptionId:t,customUserAgentDetails:n,additionalCustomHeaders:r,libraryConfigHeaders:o,publish:i}){const{appSyncGraphqlEndpoint:s,authenticationType:a,query:c,apiKey:u,region:l}=e,d=JSON.stringify({channel:c}),p={id:t,channel:c,authorization:{...{...await Po({apiKey:u,appSyncGraphqlEndpoint:s,authenticationType:a,payload:d,canonicalUri:"",region:l,additionalCustomHeaders:r}),...o,...r,[Wr]:mn(n)}},type:i?Qr.EVENT_PUBLISH:Qr.EVENT_SUBSCRIBE};return JSON.stringify(p)}_handleSubscriptionData(e){this.logger.debug(`subscription message from AWS AppSync Events: ${e.data}`);const{id:t="",event:n,type:r}=JSON.parse(String(e.data)),{observer:o=null,query:i="",variables:s={}}=this.subscriptionObserverMap.get(t)||{};if(this.logger.debug({id:t,observer:o,query:i,variables:s}),r===Qr.DATA&&n){const e=JSON.parse(n);return o?o.next({id:t,type:r,event:e}):this.logger.debug(`observer not found for id: ${t}`),[!0,{id:t,type:r,payload:e}]}return[!1,{id:t,type:r,payload:n}]}_unsubscribeMessage(e){return{id:e,type:Qr.EVENT_STOP}}_extractConnectionTimeout(e){const{connectionTimeoutMs:t=Xr}=e;return t}_extractErrorCodeAndType(e){const{errors:[{errorType:t="",errorCode:n=0}={}]=[]}=e;return{errorCode:n,errorType:t}}},di="x-amz-user-agent";const pi=(e,t)=>e?"identityPool"===e?"iam":e:t,hi=()=>{const e=a.Amplify.getConfig(),t=e.API?.Events;if(!t)throw new Error("Amplify configuration is missing. Have you called Amplify.configure()?");const n=pi(t.defaultAuthMode,"apiKey");return{appSyncGraphqlEndpoint:t.endpoint,region:t.region,authenticationType:n,apiKey:t.apiKey}},fi=e=>{if(Array.isArray(e))return e.map(((e,t)=>{const n=JSON.stringify(e);if(void 0===n)throw new Error(`Event must be a valid JSON value. Received ${e} at index ${t}`);return n}));const t=JSON.stringify(e);if(void 0===t)throw new Error(`Event must be a valid JSON value. Received ${e}`);return[t]};async function yi(e,t){const n=hi();let r;return n.authenticationType=pi(t?.authMode,n.authenticationType),await li.connect(n),{subscribe:(t,o)=>{const i={...n,query:e};return i.authenticationType=pi(o?.authMode,i.authenticationType),r=li.subscribe(i).subscribe(t),r},close:()=>{r&&r.unsubscribe()}}}async function bi(e,t,n){const r=hi();r.authenticationType=pi(n?.authMode,r.authenticationType);const o="/"===e[0]?e:`/${e}`,i={...r,query:o,variables:fi(t),authToken:n?.authToken},s=new AbortController,c=await async function(e,t,n={},r,o){const{region:i,appSyncGraphqlEndpoint:s,authenticationType:a,query:c,variables:u}=t;if(!s)throw new Error("No endpoint");const{withCredentials:l}=Fo(e),d=await async function(e,t,n,r){const{apiKey:o,appSyncGraphqlEndpoint:i,authenticationType:s,query:a,variables:c,authToken:u}=t,{headers:l}=Fo(e);let d;if("function"==typeof n){const e={method:"POST",url:new Zt(i).toString(),queryString:a};d=await n(e)}else d=n;return u&&(d={...d,Authorization:u}),{...await Zo(e,s,o,d),...l&&await l({query:a,variables:c}),...d,[di]:mn(r)}}(e,t,n,o),p={channel:c,events:u},h=["apiKey","none"].includes(a)?void 0:{service:"appsync",region:i},{body:f}=await Gr(e,{url:new Zt(s),options:{headers:d,body:p,signingServiceInfo:h,withCredentials:l},abortController:r}),y=await f.json();if(Xo(y))throw Wo(y);return y}(a.Amplify,i,{},s);if(c.failed?.length>0)return c.failed}async function mi(){await li.close()}return i})()));
//# sourceMappingURL=aws-amplify-api.min.js.map