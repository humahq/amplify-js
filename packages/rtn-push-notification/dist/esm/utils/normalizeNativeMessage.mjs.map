{"version":3,"file":"normalizeNativeMessage.mjs","sources":["../../../src/utils/normalizeNativeMessage.ts"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport isEmpty from 'lodash/isEmpty.js';\n/**\n * @internal\n */\nexport const normalizeNativeMessage = (nativeMessage) => {\n    let normalized;\n    if (isApnsMessage(nativeMessage)) {\n        normalized = normalizeApnsMessage(nativeMessage);\n    }\n    else if (isFcmMessage(nativeMessage)) {\n        normalized = normalizeFcmMessage(nativeMessage);\n    }\n    else {\n        return null;\n    }\n    const { body, imageUrl, title, action, options, data } = normalized;\n    return {\n        body,\n        data,\n        imageUrl,\n        title,\n        ...action,\n        ...options,\n    };\n};\nconst normalizeApnsMessage = (apnsMessage) => {\n    const { aps, data } = apnsMessage;\n    const { body, title } = aps.alert ?? {};\n    const action = getApnsAction(data?.pinpoint) ?? {};\n    const imageUrl = data?.['media-url'];\n    const options = getApnsOptions(apnsMessage);\n    return { body, imageUrl, title, action, options, data };\n};\nconst normalizeFcmMessage = (fcmMessage) => {\n    const { body, imageUrl, rawData: data, title } = fcmMessage;\n    const action = getFcmAction(fcmMessage.action) ?? {};\n    const options = getFcmOptions(fcmMessage);\n    return { body, imageUrl, title, action, options, data };\n};\nconst getApnsAction = (action) => {\n    if (action?.deeplink) {\n        return { deeplinkUrl: action.deeplink };\n    }\n};\nconst getFcmAction = (action) => {\n    if (action?.url) {\n        return { goToUrl: action.url };\n    }\n    if (action?.deeplink) {\n        return { deeplinkUrl: action.deeplink };\n    }\n};\nconst getApnsOptions = ({ aps, }) => {\n    const { subtitle } = aps.alert ?? {};\n    const apnsOptions = { ...(subtitle && { subtitle }) };\n    return { ...(!isEmpty(apnsOptions) && { apnsOptions }) };\n};\nconst getFcmOptions = ({ channelId = '', messageId = '', senderId = '', sendTime = new Date().getTime(), }) => {\n    const fcmOptions = {\n        channelId,\n        messageId,\n        senderId,\n        sendTime: new Date(sendTime),\n    };\n    return { ...(!isEmpty(fcmOptions) && { fcmOptions }) };\n};\nconst isApnsMessage = (nativeMessage) => !!nativeMessage?.aps;\nconst isFcmMessage = (nativeMessage) => !!nativeMessage?.rawData;\n"],"names":[],"mappings":"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"}