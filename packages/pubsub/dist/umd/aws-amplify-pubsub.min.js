!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("aws_amplify_core")):"function"==typeof define&&define.amd?define("aws_amplify_pubsub",["aws_amplify_core"],t):"object"==typeof exports?exports.aws_amplify_pubsub=t(require("aws_amplify_core")):e.aws_amplify_pubsub=t(e.aws_amplify_core)}(this,(e=>(()=>{var t={670:function(e,t,n){var r,o,i;function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}e=n.nmd(e),i=function(){var e=function(e){var t=function(){try{if(e.localStorage)return e.localStorage}catch(e){var t={};return{setItem:function(e,n){t[e]=n},getItem:function(e){return t[e]},removeItem:function(e){delete t[e]}}}}(),n=function(e,t){for(var n in e)if(e.hasOwnProperty(n)){if(!t.hasOwnProperty(n)){var r="Unknown property, "+n+". Valid properties are:";for(var i in t)t.hasOwnProperty(i)&&(r=r+" "+i);throw new Error(r)}if(s(e[n])!==t[n])throw new Error(c(o.INVALID_TYPE,[s(e[n]),n]))}},r=function(e,t){return function(){return e.apply(t,arguments)}},o={OK:{code:0,text:"AMQJSC0000I OK."},CONNECT_TIMEOUT:{code:1,text:"AMQJSC0001E Connect timed out."},SUBSCRIBE_TIMEOUT:{code:2,text:"AMQJS0002E Subscribe timed out."},UNSUBSCRIBE_TIMEOUT:{code:3,text:"AMQJS0003E Unsubscribe timed out."},PING_TIMEOUT:{code:4,text:"AMQJS0004E Ping timed out."},INTERNAL_ERROR:{code:5,text:"AMQJS0005E Internal error. Error Message: {0}, Stack trace: {1}"},CONNACK_RETURNCODE:{code:6,text:"AMQJS0006E Bad Connack return code:{0} {1}."},SOCKET_ERROR:{code:7,text:"AMQJS0007E Socket error:{0}."},SOCKET_CLOSE:{code:8,text:"AMQJS0008I Socket closed."},MALFORMED_UTF:{code:9,text:"AMQJS0009E Malformed UTF data:{0} {1} {2}."},UNSUPPORTED:{code:10,text:"AMQJS0010E {0} is not supported by this browser."},INVALID_STATE:{code:11,text:"AMQJS0011E Invalid state {0}."},INVALID_TYPE:{code:12,text:"AMQJS0012E Invalid type {0} for {1}."},INVALID_ARGUMENT:{code:13,text:"AMQJS0013E Invalid argument {0} for {1}."},UNSUPPORTED_OPERATION:{code:14,text:"AMQJS0014E Unsupported operation."},INVALID_STORED_DATA:{code:15,text:"AMQJS0015E Invalid data in local storage key={0} value={1}."},INVALID_MQTT_MESSAGE_TYPE:{code:16,text:"AMQJS0016E Invalid MQTT message type {0}."},MALFORMED_UNICODE:{code:17,text:"AMQJS0017E Malformed Unicode string:{0} {1}."},BUFFER_FULL:{code:18,text:"AMQJS0018E Message buffer is full, maximum buffer size: {0}."}},i={0:"Connection Accepted",1:"Connection Refused: unacceptable protocol version",2:"Connection Refused: identifier rejected",3:"Connection Refused: server unavailable",4:"Connection Refused: bad user name or password",5:"Connection Refused: not authorized"},c=function(e,t){var n=e.text;if(t)for(var r,o,i=0;i<t.length;i++)if(r="{"+i+"}",(o=n.indexOf(r))>0){var s=n.substring(0,o),c=n.substring(o+r.length);n=s+t[i]+c}return n},a=[0,6,77,81,73,115,100,112,3],u=[0,4,77,81,84,84,4],h=function(e,t){for(var n in this.type=e,t)t.hasOwnProperty(n)&&(this[n]=t[n])};function l(e,t){var n,r=t,o=e[t],i=o>>4,s=o&=15;t+=1;var c=0,a=1;do{if(t==e.length)return[null,r];c+=(127&(n=e[t++]))*a,a*=128}while(128&n);var u=t+c;if(u>e.length)return[null,r];var l=new h(i);switch(i){case 2:1&e[t++]&&(l.sessionPresent=!0),l.returnCode=e[t++];break;case 3:var d=s>>1&3,f=p(e,t),g=y(e,t+=2,f);t+=f,d>0&&(l.messageIdentifier=p(e,t),t+=2);var _=new w(e.subarray(t,u));1&~s||(_.retained=!0),8&~s||(_.duplicate=!0),_.qos=d,_.destinationName=g,l.payloadMessage=_;break;case 4:case 5:case 6:case 7:case 11:l.messageIdentifier=p(e,t);break;case 9:l.messageIdentifier=p(e,t),t+=2,l.returnCode=e.subarray(t,u)}return[l,u]}function d(e,t,n){return t[n++]=e>>8,t[n++]=e%256,n}function f(e,t,n,r){return _(e,n,r=d(t,n,r)),r+t}function p(e,t){return 256*e[t]+e[t+1]}function g(e){for(var t=0,n=0;n<e.length;n++){var r=e.charCodeAt(n);r>2047?(55296<=r&&r<=56319&&(n++,t++),t+=3):r>127?t+=2:t++}return t}function _(e,t,n){for(var r=n,i=0;i<e.length;i++){var s=e.charCodeAt(i);if(55296<=s&&s<=56319){var a=e.charCodeAt(++i);if(isNaN(a))throw new Error(c(o.MALFORMED_UNICODE,[s,a]));s=a-56320+(s-55296<<10)+65536}s<=127?t[r++]=s:s<=2047?(t[r++]=s>>6&31|192,t[r++]=63&s|128):s<=65535?(t[r++]=s>>12&15|224,t[r++]=s>>6&63|128,t[r++]=63&s|128):(t[r++]=s>>18&7|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=63&s|128)}return t}function y(e,t,n){for(var r,i="",s=t;s<t+n;){var a=e[s++];if(a<128)r=a;else{var u=e[s++]-128;if(u<0)throw new Error(c(o.MALFORMED_UTF,[a.toString(16),u.toString(16),""]));if(a<224)r=64*(a-192)+u;else{var h=e[s++]-128;if(h<0)throw new Error(c(o.MALFORMED_UTF,[a.toString(16),u.toString(16),h.toString(16)]));if(a<240)r=4096*(a-224)+64*u+h;else{var l=e[s++]-128;if(l<0)throw new Error(c(o.MALFORMED_UTF,[a.toString(16),u.toString(16),h.toString(16),l.toString(16)]));if(!(a<248))throw new Error(c(o.MALFORMED_UTF,[a.toString(16),u.toString(16),h.toString(16),l.toString(16)]));r=262144*(a-240)+4096*u+64*h+l}}}r>65535&&(r-=65536,i+=String.fromCharCode(55296+(r>>10)),r=56320+(1023&r)),i+=String.fromCharCode(r)}return i}h.prototype.encode=function(){var e,t=(15&this.type)<<4,n=0,r=[],o=0;switch(void 0!==this.messageIdentifier&&(n+=2),this.type){case 1:switch(this.mqttVersion){case 3:n+=a.length+3;break;case 4:n+=u.length+3}n+=g(this.clientId)+2,void 0!==this.willMessage&&(n+=g(this.willMessage.destinationName)+2,(e=this.willMessage.payloadBytes)instanceof Uint8Array||(e=new Uint8Array(s)),n+=e.byteLength+2),void 0!==this.userName&&(n+=g(this.userName)+2),void 0!==this.password&&(n+=g(this.password)+2);break;case 8:t|=2;for(var i=0;i<this.topics.length;i++)r[i]=g(this.topics[i]),n+=r[i]+2;n+=this.requestedQos.length;break;case 10:for(t|=2,i=0;i<this.topics.length;i++)r[i]=g(this.topics[i]),n+=r[i]+2;break;case 6:t|=2;break;case 3:this.payloadMessage.duplicate&&(t|=8),t=t|=this.payloadMessage.qos<<1,this.payloadMessage.retained&&(t|=1),n+=(o=g(this.payloadMessage.destinationName))+2;var s=this.payloadMessage.payloadBytes;n+=s.byteLength,s instanceof ArrayBuffer?s=new Uint8Array(s):s instanceof Uint8Array||(s=new Uint8Array(s.buffer))}var c=function(e){var t=new Array(1),n=0;do{var r=e%128;(e>>=7)>0&&(r|=128),t[n++]=r}while(e>0&&n<4);return t}(n),h=c.length+1,l=new ArrayBuffer(n+h),p=new Uint8Array(l);if(p[0]=t,p.set(c,1),3==this.type)h=f(this.payloadMessage.destinationName,o,p,h);else if(1==this.type){switch(this.mqttVersion){case 3:p.set(a,h),h+=a.length;break;case 4:p.set(u,h),h+=u.length}var _=0;this.cleanSession&&(_=2),void 0!==this.willMessage&&(_|=4,_|=this.willMessage.qos<<3,this.willMessage.retained&&(_|=32)),void 0!==this.userName&&(_|=128),void 0!==this.password&&(_|=64),p[h++]=_,h=d(this.keepAliveInterval,p,h)}switch(void 0!==this.messageIdentifier&&(h=d(this.messageIdentifier,p,h)),this.type){case 1:h=f(this.clientId,g(this.clientId),p,h),void 0!==this.willMessage&&(h=f(this.willMessage.destinationName,g(this.willMessage.destinationName),p,h),h=d(e.byteLength,p,h),p.set(e,h),h+=e.byteLength),void 0!==this.userName&&(h=f(this.userName,g(this.userName),p,h)),void 0!==this.password&&(h=f(this.password,g(this.password),p,h));break;case 3:p.set(s,h);break;case 8:for(i=0;i<this.topics.length;i++)h=f(this.topics[i],r[i],p,h),p[h++]=this.requestedQos[i];break;case 10:for(i=0;i<this.topics.length;i++)h=f(this.topics[i],r[i],p,h)}return l};var v=function(e,t){this._client=e,this._keepAliveInterval=1e3*t,this.isReset=!1;var n=new h(12).encode(),r=function(e){return function(){return i.apply(e)}},i=function(){this.isReset?(this.isReset=!1,this._client._trace("Pinger.doPing","send PINGREQ"),this._client.socket.send(n),this.timeout=setTimeout(r(this),this._keepAliveInterval)):(this._client._trace("Pinger.doPing","Timed out"),this._client._disconnected(o.PING_TIMEOUT.code,c(o.PING_TIMEOUT)))};this.reset=function(){this.isReset=!0,clearTimeout(this.timeout),this._keepAliveInterval>0&&(this.timeout=setTimeout(r(this),this._keepAliveInterval))},this.cancel=function(){clearTimeout(this.timeout)}},b=function(e,t,n,r){t||(t=30),this.timeout=setTimeout(function(e,t,n){return function(){return e.apply(t,n)}}(n,e,r),1e3*t),this.cancel=function(){clearTimeout(this.timeout)}},m=function(n,r,i,s,a){if(!("WebSocket"in e)||null===e.WebSocket)throw new Error(c(o.UNSUPPORTED,["WebSocket"]));if(!("ArrayBuffer"in e)||null===e.ArrayBuffer)throw new Error(c(o.UNSUPPORTED,["ArrayBuffer"]));for(var u in this._trace("Paho.Client",n,r,i,s,a),this.host=r,this.port=i,this.path=s,this.uri=n,this.clientId=a,this._wsuri=null,this._localKey=r+":"+i+("/mqtt"!=s?":"+s:"")+":"+a+":",this._msg_queue=[],this._buffered_msg_queue=[],this._sentMessages={},this._receivedMessages={},this._notify_msg_sent={},this._message_identifier=1,this._sequence=0,t)0!==u.indexOf("Sent:"+this._localKey)&&0!==u.indexOf("Received:"+this._localKey)||this.restore(u)};m.prototype.host=null,m.prototype.port=null,m.prototype.path=null,m.prototype.uri=null,m.prototype.clientId=null,m.prototype.socket=null,m.prototype.connected=!1,m.prototype.maxMessageIdentifier=65536,m.prototype.connectOptions=null,m.prototype.hostIndex=null,m.prototype.onConnected=null,m.prototype.onConnectionLost=null,m.prototype.onMessageDelivered=null,m.prototype.onMessageArrived=null,m.prototype.traceFunction=null,m.prototype._msg_queue=null,m.prototype._buffered_msg_queue=null,m.prototype._connectTimeout=null,m.prototype.sendPinger=null,m.prototype.receivePinger=null,m.prototype._reconnectInterval=1,m.prototype._reconnecting=!1,m.prototype._reconnectTimeout=null,m.prototype.disconnectedPublishing=!1,m.prototype.disconnectedBufferSize=5e3,m.prototype.receiveBuffer=null,m.prototype._traceBuffer=null,m.prototype._MAX_TRACE_ENTRIES=100,m.prototype.connect=function(e){var t=this._traceMask(e,"password");if(this._trace("Client.connect",t,this.socket,this.connected),this.connected)throw new Error(c(o.INVALID_STATE,["already connected"]));if(this.socket)throw new Error(c(o.INVALID_STATE,["already connected"]));this._reconnecting&&(this._reconnectTimeout.cancel(),this._reconnectTimeout=null,this._reconnecting=!1),this.connectOptions=e,this._reconnectInterval=1,this._reconnecting=!1,e.uris?(this.hostIndex=0,this._doConnect(e.uris[0])):this._doConnect(this.uri)},m.prototype.subscribe=function(e,t){if(this._trace("Client.subscribe",e,t),!this.connected)throw new Error(c(o.INVALID_STATE,["not connected"]));var n=new h(8);n.topics=e.constructor===Array?e:[e],void 0===t.qos&&(t.qos=0),n.requestedQos=[];for(var r=0;r<n.topics.length;r++)n.requestedQos[r]=t.qos;t.onSuccess&&(n.onSuccess=function(e){t.onSuccess({invocationContext:t.invocationContext,grantedQos:e})}),t.onFailure&&(n.onFailure=function(e){t.onFailure({invocationContext:t.invocationContext,errorCode:e,errorMessage:c(e)})}),t.timeout&&(n.timeOut=new b(this,t.timeout,t.onFailure,[{invocationContext:t.invocationContext,errorCode:o.SUBSCRIBE_TIMEOUT.code,errorMessage:c(o.SUBSCRIBE_TIMEOUT)}])),this._requires_ack(n),this._schedule_message(n)},m.prototype.unsubscribe=function(e,t){if(this._trace("Client.unsubscribe",e,t),!this.connected)throw new Error(c(o.INVALID_STATE,["not connected"]));var n=new h(10);n.topics=e.constructor===Array?e:[e],t.onSuccess&&(n.callback=function(){t.onSuccess({invocationContext:t.invocationContext})}),t.timeout&&(n.timeOut=new b(this,t.timeout,t.onFailure,[{invocationContext:t.invocationContext,errorCode:o.UNSUBSCRIBE_TIMEOUT.code,errorMessage:c(o.UNSUBSCRIBE_TIMEOUT)}])),this._requires_ack(n),this._schedule_message(n)},m.prototype.send=function(e){this._trace("Client.send",e);var t=new h(3);if(t.payloadMessage=e,this.connected)e.qos>0?this._requires_ack(t):this.onMessageDelivered&&(this._notify_msg_sent[t]=this.onMessageDelivered(t.payloadMessage)),this._schedule_message(t);else{if(!this._reconnecting||!this.disconnectedPublishing)throw new Error(c(o.INVALID_STATE,["not connected"]));if(Object.keys(this._sentMessages).length+this._buffered_msg_queue.length>this.disconnectedBufferSize)throw new Error(c(o.BUFFER_FULL,[this.disconnectedBufferSize]));e.qos>0?this._requires_ack(t):(t.sequence=++this._sequence,this._buffered_msg_queue.unshift(t))}},m.prototype.disconnect=function(){if(this._trace("Client.disconnect"),this._reconnecting&&(this._reconnectTimeout.cancel(),this._reconnectTimeout=null,this._reconnecting=!1),!this.socket)throw new Error(c(o.INVALID_STATE,["not connecting or connected"]));var e=new h(14);this._notify_msg_sent[e]=r(this._disconnected,this),this._schedule_message(e)},m.prototype.getTraceLog=function(){if(null!==this._traceBuffer){for(var e in this._trace("Client.getTraceLog",new Date),this._trace("Client.getTraceLog in flight messages",this._sentMessages.length),this._sentMessages)this._trace("_sentMessages ",e,this._sentMessages[e]);for(var e in this._receivedMessages)this._trace("_receivedMessages ",e,this._receivedMessages[e]);return this._traceBuffer}},m.prototype.startTrace=function(){null===this._traceBuffer&&(this._traceBuffer=[]),this._trace("Client.startTrace",new Date,"@VERSION@-@BUILDLEVEL@")},m.prototype.stopTrace=function(){delete this._traceBuffer},m.prototype._doConnect=function(e){if(this.connectOptions.useSSL){var t=e.split(":");t[0]="wss",e=t.join(":")}this._wsuri=e,this.connected=!1,this.connectOptions.mqttVersion<4?this.socket=new WebSocket(e,["mqttv3.1"]):this.socket=new WebSocket(e,["mqtt"]),this.socket.binaryType="arraybuffer",this.socket.onopen=r(this._on_socket_open,this),this.socket.onmessage=r(this._on_socket_message,this),this.socket.onerror=r(this._on_socket_error,this),this.socket.onclose=r(this._on_socket_close,this),this.sendPinger=new v(this,this.connectOptions.keepAliveInterval),this.receivePinger=new v(this,this.connectOptions.keepAliveInterval),this._connectTimeout&&(this._connectTimeout.cancel(),this._connectTimeout=null),this._connectTimeout=new b(this,this.connectOptions.timeout,this._disconnected,[o.CONNECT_TIMEOUT.code,c(o.CONNECT_TIMEOUT)])},m.prototype._schedule_message=function(e){this._msg_queue.unshift(e),this.connected&&this._process_queue()},m.prototype.store=function(e,n){var r={type:n.type,messageIdentifier:n.messageIdentifier,version:1};if(3!==n.type)throw Error(c(o.INVALID_STORED_DATA,[e+this._localKey+n.messageIdentifier,r]));n.pubRecReceived&&(r.pubRecReceived=!0),r.payloadMessage={};for(var i="",s=n.payloadMessage.payloadBytes,a=0;a<s.length;a++)s[a]<=15?i=i+"0"+s[a].toString(16):i+=s[a].toString(16);r.payloadMessage.payloadHex=i,r.payloadMessage.qos=n.payloadMessage.qos,r.payloadMessage.destinationName=n.payloadMessage.destinationName,n.payloadMessage.duplicate&&(r.payloadMessage.duplicate=!0),n.payloadMessage.retained&&(r.payloadMessage.retained=!0),0===e.indexOf("Sent:")&&(void 0===n.sequence&&(n.sequence=++this._sequence),r.sequence=n.sequence),t.setItem(e+this._localKey+n.messageIdentifier,JSON.stringify(r))},m.prototype.restore=function(e){var n=t.getItem(e),r=JSON.parse(n),i=new h(r.type,r);if(3!==r.type)throw Error(c(o.INVALID_STORED_DATA,[e,n]));for(var s=r.payloadMessage.payloadHex,a=new ArrayBuffer(s.length/2),u=new Uint8Array(a),l=0;s.length>=2;){var d=parseInt(s.substring(0,2),16);s=s.substring(2,s.length),u[l++]=d}var f=new w(u);f.qos=r.payloadMessage.qos,f.destinationName=r.payloadMessage.destinationName,r.payloadMessage.duplicate&&(f.duplicate=!0),r.payloadMessage.retained&&(f.retained=!0),i.payloadMessage=f,0===e.indexOf("Sent:"+this._localKey)?(i.payloadMessage.duplicate=!0,this._sentMessages[i.messageIdentifier]=i):0===e.indexOf("Received:"+this._localKey)&&(this._receivedMessages[i.messageIdentifier]=i)},m.prototype._process_queue=function(){for(var e=null;e=this._msg_queue.pop();)this._socket_send(e),this._notify_msg_sent[e]&&(this._notify_msg_sent[e](),delete this._notify_msg_sent[e])},m.prototype._requires_ack=function(e){var t=Object.keys(this._sentMessages).length;if(t>this.maxMessageIdentifier)throw Error("Too many messages:"+t);for(;void 0!==this._sentMessages[this._message_identifier];)this._message_identifier++;e.messageIdentifier=this._message_identifier,this._sentMessages[e.messageIdentifier]=e,3===e.type&&this.store("Sent:",e),this._message_identifier===this.maxMessageIdentifier&&(this._message_identifier=1)},m.prototype._on_socket_open=function(){var e=new h(1,this.connectOptions);e.clientId=this.clientId,this._socket_send(e)},m.prototype._on_socket_message=function(e){this._trace("Client._on_socket_message",e.data);for(var t=this._deframeMessages(e.data),n=0;n<t.length;n+=1)this._handleMessage(t[n])},m.prototype._deframeMessages=function(e){var t=new Uint8Array(e),n=[];if(this.receiveBuffer){var r=new Uint8Array(this.receiveBuffer.length+t.length);r.set(this.receiveBuffer),r.set(t,this.receiveBuffer.length),t=r,delete this.receiveBuffer}try{for(var i=0;i<t.length;){var s=l(t,i),a=s[0];if(i=s[1],null===a)break;n.push(a)}i<t.length&&(this.receiveBuffer=t.subarray(i))}catch(e){var u="undefined"==e.hasOwnProperty("stack")?e.stack.toString():"No Error Stack Available";return void this._disconnected(o.INTERNAL_ERROR.code,c(o.INTERNAL_ERROR,[e.message,u]))}return n},m.prototype._handleMessage=function(e){this._trace("Client._handleMessage",e);try{switch(e.type){case 2:if(this._connectTimeout.cancel(),this._reconnectTimeout&&this._reconnectTimeout.cancel(),this.connectOptions.cleanSession){for(var n in this._sentMessages){var r=this._sentMessages[n];t.removeItem("Sent:"+this._localKey+r.messageIdentifier)}for(var n in this._sentMessages={},this._receivedMessages){var s=this._receivedMessages[n];t.removeItem("Received:"+this._localKey+s.messageIdentifier)}this._receivedMessages={}}if(0!==e.returnCode){this._disconnected(o.CONNACK_RETURNCODE.code,c(o.CONNACK_RETURNCODE,[e.returnCode,i[e.returnCode]]));break}this.connected=!0,this.connectOptions.uris&&(this.hostIndex=this.connectOptions.uris.length);var a=[];for(var u in this._sentMessages)this._sentMessages.hasOwnProperty(u)&&a.push(this._sentMessages[u]);if(this._buffered_msg_queue.length>0)for(var l=null;l=this._buffered_msg_queue.pop();)a.push(l),this.onMessageDelivered&&(this._notify_msg_sent[l]=this.onMessageDelivered(l.payloadMessage));a=a.sort((function(e,t){return e.sequence-t.sequence}));for(var d=0,f=a.length;d<f;d++)if(3==(r=a[d]).type&&r.pubRecReceived){var p=new h(6,{messageIdentifier:r.messageIdentifier});this._schedule_message(p)}else this._schedule_message(r);this.connectOptions.onSuccess&&this.connectOptions.onSuccess({invocationContext:this.connectOptions.invocationContext});var g=!1;this._reconnecting&&(g=!0,this._reconnectInterval=1,this._reconnecting=!1),this._connected(g,this._wsuri),this._process_queue();break;case 3:this._receivePublish(e);break;case 4:(r=this._sentMessages[e.messageIdentifier])&&(delete this._sentMessages[e.messageIdentifier],t.removeItem("Sent:"+this._localKey+e.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(r.payloadMessage));break;case 5:(r=this._sentMessages[e.messageIdentifier])&&(r.pubRecReceived=!0,p=new h(6,{messageIdentifier:e.messageIdentifier}),this.store("Sent:",r),this._schedule_message(p));break;case 6:s=this._receivedMessages[e.messageIdentifier],t.removeItem("Received:"+this._localKey+e.messageIdentifier),s&&(this._receiveMessage(s),delete this._receivedMessages[e.messageIdentifier]);var _=new h(7,{messageIdentifier:e.messageIdentifier});this._schedule_message(_);break;case 7:r=this._sentMessages[e.messageIdentifier],delete this._sentMessages[e.messageIdentifier],t.removeItem("Sent:"+this._localKey+e.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(r.payloadMessage);break;case 9:(r=this._sentMessages[e.messageIdentifier])&&(r.timeOut&&r.timeOut.cancel(),128===e.returnCode[0]?r.onFailure&&r.onFailure(e.returnCode):r.onSuccess&&r.onSuccess(e.returnCode),delete this._sentMessages[e.messageIdentifier]);break;case 11:(r=this._sentMessages[e.messageIdentifier])&&(r.timeOut&&r.timeOut.cancel(),r.callback&&r.callback(),delete this._sentMessages[e.messageIdentifier]);break;case 13:this.sendPinger.reset();break;default:this._disconnected(o.INVALID_MQTT_MESSAGE_TYPE.code,c(o.INVALID_MQTT_MESSAGE_TYPE,[e.type]))}}catch(e){var y="undefined"==e.hasOwnProperty("stack")?e.stack.toString():"No Error Stack Available";return void this._disconnected(o.INTERNAL_ERROR.code,c(o.INTERNAL_ERROR,[e.message,y]))}},m.prototype._on_socket_error=function(e){this._reconnecting||this._disconnected(o.SOCKET_ERROR.code,c(o.SOCKET_ERROR,[e.data]))},m.prototype._on_socket_close=function(){this._reconnecting||this._disconnected(o.SOCKET_CLOSE.code,c(o.SOCKET_CLOSE))},m.prototype._socket_send=function(e){if(1==e.type){var t=this._traceMask(e,"password");this._trace("Client._socket_send",t)}else this._trace("Client._socket_send",e);this.socket.send(e.encode()),this.sendPinger.reset()},m.prototype._receivePublish=function(e){switch(e.payloadMessage.qos){case"undefined":case 0:this._receiveMessage(e);break;case 1:var t=new h(4,{messageIdentifier:e.messageIdentifier});this._schedule_message(t),this._receiveMessage(e);break;case 2:this._receivedMessages[e.messageIdentifier]=e,this.store("Received:",e);var n=new h(5,{messageIdentifier:e.messageIdentifier});this._schedule_message(n);break;default:throw Error("Invaild qos="+e.payloadMessage.qos)}},m.prototype._receiveMessage=function(e){this.onMessageArrived&&this.onMessageArrived(e.payloadMessage)},m.prototype._connected=function(e,t){this.onConnected&&this.onConnected(e,t)},m.prototype._reconnect=function(){this._trace("Client._reconnect"),this.connected||(this._reconnecting=!0,this.sendPinger.cancel(),this.receivePinger.cancel(),this._reconnectInterval<128&&(this._reconnectInterval=2*this._reconnectInterval),this.connectOptions.uris?(this.hostIndex=0,this._doConnect(this.connectOptions.uris[0])):this._doConnect(this.uri))},m.prototype._disconnected=function(e,t){if(this._trace("Client._disconnected",e,t),void 0!==e&&this._reconnecting)this._reconnectTimeout=new b(this,this._reconnectInterval,this._reconnect);else if(this.sendPinger.cancel(),this.receivePinger.cancel(),this._connectTimeout&&(this._connectTimeout.cancel(),this._connectTimeout=null),this._msg_queue=[],this._buffered_msg_queue=[],this._notify_msg_sent={},this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,1===this.socket.readyState&&this.socket.close(),delete this.socket),this.connectOptions.uris&&this.hostIndex<this.connectOptions.uris.length-1)this.hostIndex++,this._doConnect(this.connectOptions.uris[this.hostIndex]);else if(void 0===e&&(e=o.OK.code,t=c(o.OK)),this.connected){if(this.connected=!1,this.onConnectionLost&&this.onConnectionLost({errorCode:e,errorMessage:t,reconnect:this.connectOptions.reconnect,uri:this._wsuri}),e!==o.OK.code&&this.connectOptions.reconnect)return this._reconnectInterval=1,void this._reconnect()}else 4===this.connectOptions.mqttVersion&&!1===this.connectOptions.mqttVersionExplicit?(this._trace("Failed to connect V4, dropping back to V3"),this.connectOptions.mqttVersion=3,this.connectOptions.uris?(this.hostIndex=0,this._doConnect(this.connectOptions.uris[0])):this._doConnect(this.uri)):this.connectOptions.onFailure&&this.connectOptions.onFailure({invocationContext:this.connectOptions.invocationContext,errorCode:e,errorMessage:t})},m.prototype._trace=function(){if(this.traceFunction){var e=Array.prototype.slice.call(arguments);for(var t in e)void 0!==e[t]&&e.splice(t,1,JSON.stringify(e[t]));var n=e.join("");this.traceFunction({severity:"Debug",message:n})}if(null!==this._traceBuffer){t=0;for(var r=arguments.length;t<r;t++)this._traceBuffer.length==this._MAX_TRACE_ENTRIES&&this._traceBuffer.shift(),0===t||void 0===arguments[t]?this._traceBuffer.push(arguments[t]):this._traceBuffer.push("  "+JSON.stringify(arguments[t]))}},m.prototype._traceMask=function(e,t){var n={};for(var r in e)e.hasOwnProperty(r)&&(n[r]=r==t?"******":e[r]);return n};var w=function(e){var t,n;if(!("string"==typeof e||e instanceof ArrayBuffer||ArrayBuffer.isView(e)&&!(e instanceof DataView)))throw c(o.INVALID_ARGUMENT,[e,"newPayload"]);t=e;var r=0,i=!1,s=!1;Object.defineProperties(this,{payloadString:{enumerable:!0,get:function(){return"string"==typeof t?t:y(t,0,t.length)}},payloadBytes:{enumerable:!0,get:function(){if("string"==typeof t){var e=new ArrayBuffer(g(t)),n=new Uint8Array(e);return _(t,n,0),n}return t}},destinationName:{enumerable:!0,get:function(){return n},set:function(e){if("string"!=typeof e)throw new Error(c(o.INVALID_ARGUMENT,[e,"newDestinationName"]));n=e}},qos:{enumerable:!0,get:function(){return r},set:function(e){if(0!==e&&1!==e&&2!==e)throw new Error("Invalid argument:"+e);r=e}},retained:{enumerable:!0,get:function(){return i},set:function(e){if("boolean"!=typeof e)throw new Error(c(o.INVALID_ARGUMENT,[e,"newRetained"]));i=e}},topic:{enumerable:!0,get:function(){return n},set:function(e){n=e}},duplicate:{enumerable:!0,get:function(){return s},set:function(e){s=e}}})};return{Client:function(e,t,r,i){var a;if("string"!=typeof e)throw new Error(c(o.INVALID_TYPE,[s(e),"host"]));if(2==arguments.length){i=t;var u=(a=e).match(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/);if(!u)throw new Error(c(o.INVALID_ARGUMENT,[e,"host"]));e=u[4]||u[2],t=parseInt(u[7]),r=u[8]}else{if(3==arguments.length&&(i=r,r="/mqtt"),"number"!=typeof t||t<0)throw new Error(c(o.INVALID_TYPE,[s(t),"port"]));if("string"!=typeof r)throw new Error(c(o.INVALID_TYPE,[s(r),"path"]));var h=-1!==e.indexOf(":")&&"["!==e.slice(0,1)&&"]"!==e.slice(-1);a="ws://"+(h?"["+e+"]":e)+":"+t+r}for(var l=0,d=0;d<i.length;d++){var f=i.charCodeAt(d);55296<=f&&f<=56319&&d++,l++}if("string"!=typeof i||l>65535)throw new Error(c(o.INVALID_ARGUMENT,[i,"clientId"]));var p=new m(a,e,t,r,i);Object.defineProperties(this,{host:{get:function(){return e},set:function(){throw new Error(c(o.UNSUPPORTED_OPERATION))}},port:{get:function(){return t},set:function(){throw new Error(c(o.UNSUPPORTED_OPERATION))}},path:{get:function(){return r},set:function(){throw new Error(c(o.UNSUPPORTED_OPERATION))}},uri:{get:function(){return a},set:function(){throw new Error(c(o.UNSUPPORTED_OPERATION))}},clientId:{get:function(){return p.clientId},set:function(){throw new Error(c(o.UNSUPPORTED_OPERATION))}},onConnected:{get:function(){return p.onConnected},set:function(e){if("function"!=typeof e)throw new Error(c(o.INVALID_TYPE,[s(e),"onConnected"]));p.onConnected=e}},disconnectedPublishing:{get:function(){return p.disconnectedPublishing},set:function(e){p.disconnectedPublishing=e}},disconnectedBufferSize:{get:function(){return p.disconnectedBufferSize},set:function(e){p.disconnectedBufferSize=e}},onConnectionLost:{get:function(){return p.onConnectionLost},set:function(e){if("function"!=typeof e)throw new Error(c(o.INVALID_TYPE,[s(e),"onConnectionLost"]));p.onConnectionLost=e}},onMessageDelivered:{get:function(){return p.onMessageDelivered},set:function(e){if("function"!=typeof e)throw new Error(c(o.INVALID_TYPE,[s(e),"onMessageDelivered"]));p.onMessageDelivered=e}},onMessageArrived:{get:function(){return p.onMessageArrived},set:function(e){if("function"!=typeof e)throw new Error(c(o.INVALID_TYPE,[s(e),"onMessageArrived"]));p.onMessageArrived=e}},trace:{get:function(){return p.traceFunction},set:function(e){if("function"!=typeof e)throw new Error(c(o.INVALID_TYPE,[s(e),"onTrace"]));p.traceFunction=e}}}),this.connect=function(e){if(n(e=e||{},{timeout:"number",userName:"string",password:"string",willMessage:"object",keepAliveInterval:"number",cleanSession:"boolean",useSSL:"boolean",invocationContext:"object",onSuccess:"function",onFailure:"function",hosts:"object",ports:"object",reconnect:"boolean",mqttVersion:"number",mqttVersionExplicit:"boolean",uris:"object"}),void 0===e.keepAliveInterval&&(e.keepAliveInterval=60),e.mqttVersion>4||e.mqttVersion<3)throw new Error(c(o.INVALID_ARGUMENT,[e.mqttVersion,"connectOptions.mqttVersion"]));if(void 0===e.mqttVersion?(e.mqttVersionExplicit=!1,e.mqttVersion=4):e.mqttVersionExplicit=!0,void 0!==e.password&&void 0===e.userName)throw new Error(c(o.INVALID_ARGUMENT,[e.password,"connectOptions.password"]));if(e.willMessage){if(!(e.willMessage instanceof w))throw new Error(c(o.INVALID_TYPE,[e.willMessage,"connectOptions.willMessage"]));if(e.willMessage.stringPayload=null,void 0===e.willMessage.destinationName)throw new Error(c(o.INVALID_TYPE,[s(e.willMessage.destinationName),"connectOptions.willMessage.destinationName"]))}if(void 0===e.cleanSession&&(e.cleanSession=!0),e.hosts){if(!(e.hosts instanceof Array))throw new Error(c(o.INVALID_ARGUMENT,[e.hosts,"connectOptions.hosts"]));if(e.hosts.length<1)throw new Error(c(o.INVALID_ARGUMENT,[e.hosts,"connectOptions.hosts"]));for(var t=!1,i=0;i<e.hosts.length;i++){if("string"!=typeof e.hosts[i])throw new Error(c(o.INVALID_TYPE,[s(e.hosts[i]),"connectOptions.hosts["+i+"]"]));if(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/.test(e.hosts[i])){if(0===i)t=!0;else if(!t)throw new Error(c(o.INVALID_ARGUMENT,[e.hosts[i],"connectOptions.hosts["+i+"]"]))}else if(t)throw new Error(c(o.INVALID_ARGUMENT,[e.hosts[i],"connectOptions.hosts["+i+"]"]))}if(t)e.uris=e.hosts;else{if(!e.ports)throw new Error(c(o.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));if(!(e.ports instanceof Array))throw new Error(c(o.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));if(e.hosts.length!==e.ports.length)throw new Error(c(o.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));for(e.uris=[],i=0;i<e.hosts.length;i++){if("number"!=typeof e.ports[i]||e.ports[i]<0)throw new Error(c(o.INVALID_TYPE,[s(e.ports[i]),"connectOptions.ports["+i+"]"]));var u=e.hosts[i],h=e.ports[i],l=-1!==u.indexOf(":");a="ws://"+(l?"["+u+"]":u)+":"+h+r,e.uris.push(a)}}}p.connect(e)},this.subscribe=function(e,t){if("string"!=typeof e&&e.constructor!==Array)throw new Error("Invalid argument:"+e);if(n(t=t||{},{qos:"number",invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"}),t.timeout&&!t.onFailure)throw new Error("subscribeOptions.timeout specified with no onFailure callback.");if(void 0!==t.qos&&0!==t.qos&&1!==t.qos&&2!==t.qos)throw new Error(c(o.INVALID_ARGUMENT,[t.qos,"subscribeOptions.qos"]));p.subscribe(e,t)},this.unsubscribe=function(e,t){if("string"!=typeof e&&e.constructor!==Array)throw new Error("Invalid argument:"+e);if(n(t=t||{},{invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"}),t.timeout&&!t.onFailure)throw new Error("unsubscribeOptions.timeout specified with no onFailure callback.");p.unsubscribe(e,t)},this.send=function(e,t,n,r){var i;if(0===arguments.length)throw new Error("Invalid argument.length");if(1==arguments.length){if(!(e instanceof w)&&"string"!=typeof e)throw new Error("Invalid argument:"+s(e));if(void 0===(i=e).destinationName)throw new Error(c(o.INVALID_ARGUMENT,[i.destinationName,"Message.destinationName"]));p.send(i)}else(i=new w(t)).destinationName=e,arguments.length>=3&&(i.qos=n),arguments.length>=4&&(i.retained=r),p.send(i)},this.publish=function(e,t,n,r){var i;if(0===arguments.length)throw new Error("Invalid argument.length");if(1==arguments.length){if(!(e instanceof w)&&"string"!=typeof e)throw new Error("Invalid argument:"+s(e));if(void 0===(i=e).destinationName)throw new Error(c(o.INVALID_ARGUMENT,[i.destinationName,"Message.destinationName"]));p.send(i)}else(i=new w(t)).destinationName=e,arguments.length>=3&&(i.qos=n),arguments.length>=4&&(i.retained=r),p.send(i)},this.disconnect=function(){p.disconnect()},this.getTraceLog=function(){return p.getTraceLog()},this.startTrace=function(){p.startTrace()},this.stopTrace=function(){p.stopTrace()},this.isConnected=function(){return p.connected}},Message:w}}(void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});return e},"object"===s(t)&&"object"===s(e)?e.exports=i():void 0===(o="function"==typeof(r=i)?r.call(t,n,t,e):r)||(e.exports=o)},556:t=>{"use strict";t.exports=e}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var i=n[e]={id:e,loaded:!1,exports:{}};return t[e].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var o={};return(()=>{"use strict";r.r(o),r.d(o,{CONNECTION_STATE_CHANGE:()=>e,CONTROL_MSG:()=>s,ConnectionState:()=>c,PubSub:()=>mt,mqttTopicMatch:()=>_t});const e="ConnectionStateChange";var t,n,i,s,c;!function(e){e.GQL_CONNECTION_INIT="connection_init",e.GQL_CONNECTION_ERROR="connection_error",e.GQL_CONNECTION_ACK="connection_ack",e.GQL_START="start",e.GQL_START_ACK="start_ack",e.GQL_DATA="data",e.GQL_CONNECTION_KEEP_ALIVE="ka",e.GQL_STOP="stop",e.GQL_COMPLETE="complete",e.GQL_ERROR="error"}(t||(t={})),function(e){e[e.PENDING=0]="PENDING",e[e.CONNECTED=1]="CONNECTED",e[e.FAILED=2]="FAILED"}(n||(n={})),function(e){e[e.CLOSED=0]="CLOSED",e[e.READY=1]="READY",e[e.CONNECTING=2]="CONNECTING"}(i||(i={})),function(e){e.CONNECTION_CLOSED="Connection closed",e.CONNECTION_FAILED="Connection failed",e.REALTIME_SUBSCRIPTION_INIT_ERROR="AppSync Realtime subscription init error",e.SUBSCRIPTION_ACK="Subscription ack",e.TIMEOUT_DISCONNECT="Timeout disconnect"}(s||(s={})),function(e){e.Connected="Connected",e.ConnectedPendingNetwork="ConnectedPendingNetwork",e.ConnectionDisrupted="ConnectionDisrupted",e.ConnectionDisruptedPendingNetwork="ConnectionDisruptedPendingNetwork",e.Connecting="Connecting",e.ConnectedPendingDisconnect="ConnectedPendingDisconnect",e.Disconnected="Disconnected",e.ConnectedPendingKeepAlive="ConnectedPendingKeepAlive"}(c||(c={}));const a=e=>Object.keys(e).map((e=>e.toLowerCase())).sort().join(";"),u="X-Amz-Algorithm",h="X-Amz-Date",l="X-Amz-Credential",d="X-Amz-Expires",f="X-Amz-SignedHeaders",p="X-Amz-Security-Token",g="host",_=h.toLowerCase(),y=p.toLowerCase(),v="aws4_request",b="AWS4-HMAC-SHA256",m=({credentials:e,signingDate:t=new Date,signingRegion:n,signingService:r,uriEscapePath:o=!0})=>{const{accessKeyId:i,secretAccessKey:s,sessionToken:c}=e,{longDate:a,shortDate:u}=(e=>{const t=e.toISOString().replace(/[:-]|\.\d{3}/g,"");return{longDate:t,shortDate:t.slice(0,8)}})(t);return{accessKeyId:i,credentialScope:`${u}/${n}/${r}/${v}`,longDate:a,secretAccessKey:s,sessionToken:c,shortDate:u,signingRegion:n,signingService:r,uriEscapePath:o}};var w=function(e,t){return w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},w(e,t)};function E(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}w(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function I(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))}function S(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=c(0),s.throw=c(1),s.return=c(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function c(c){return function(a){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,a])}}}function O(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function N(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function T(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}function A(e){return this instanceof A?(this.v=e,this):new A(e)}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var C=64,M=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),k=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],L=Math.pow(2,53)-1,R=function(){function e(){this.state=Int32Array.from(k),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return e.prototype.update=function(e){if(this.finished)throw new Error("Attempted to update an already finished hash.");var t=0,n=e.byteLength;if(this.bytesHashed+=n,8*this.bytesHashed>L)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;n>0;)this.buffer[this.bufferLength++]=e[t++],n--,this.bufferLength===C&&(this.hashBuffer(),this.bufferLength=0)},e.prototype.digest=function(){if(!this.finished){var e=8*this.bytesHashed,t=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),n=this.bufferLength;if(t.setUint8(this.bufferLength++,128),n%C>=56){for(var r=this.bufferLength;r<C;r++)t.setUint8(r,0);this.hashBuffer(),this.bufferLength=0}for(r=this.bufferLength;r<56;r++)t.setUint8(r,0);t.setUint32(56,Math.floor(e/4294967296),!0),t.setUint32(60,e),this.hashBuffer(),this.finished=!0}var o=new Uint8Array(32);for(r=0;r<8;r++)o[4*r]=this.state[r]>>>24&255,o[4*r+1]=this.state[r]>>>16&255,o[4*r+2]=this.state[r]>>>8&255,o[4*r+3]=this.state[r]>>>0&255;return o},e.prototype.hashBuffer=function(){for(var e=this.buffer,t=this.state,n=t[0],r=t[1],o=t[2],i=t[3],s=t[4],c=t[5],a=t[6],u=t[7],h=0;h<C;h++){if(h<16)this.temp[h]=(255&e[4*h])<<24|(255&e[4*h+1])<<16|(255&e[4*h+2])<<8|255&e[4*h+3];else{var l=this.temp[h-2],d=(l>>>17|l<<15)^(l>>>19|l<<13)^l>>>10,f=((l=this.temp[h-15])>>>7|l<<25)^(l>>>18|l<<14)^l>>>3;this.temp[h]=(d+this.temp[h-7]|0)+(f+this.temp[h-16]|0)}var p=(((s>>>6|s<<26)^(s>>>11|s<<21)^(s>>>25|s<<7))+(s&c^~s&a)|0)+(u+(M[h]+this.temp[h]|0)|0)|0,g=((n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10))+(n&r^n&o^r&o)|0;u=a,a=c,c=s,s=i+p|0,i=o,o=r,r=n,n=p+g|0}t[0]+=n,t[1]+=r,t[2]+=o,t[3]+=i,t[4]+=s,t[5]+=c,t[6]+=a,t[7]+=u},e}(),D="undefined"!=typeof Buffer&&Buffer.from?function(e){return Buffer.from(e,"utf8")}:e=>(new TextEncoder).encode(e);function P(e){return e instanceof Uint8Array?e:"string"==typeof e?D(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(e)}var x=function(){function e(e){this.secret=e,this.hash=new R,this.reset()}return e.prototype.update=function(e){var t;if(("string"==typeof(t=e)?0!==t.length:0!==t.byteLength)&&!this.error)try{this.hash.update(P(e))}catch(e){this.error=e}},e.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},e.prototype.digest=function(){return I(this,void 0,void 0,(function(){return S(this,(function(e){return[2,this.digestSync()]}))}))},e.prototype.reset=function(){if(this.hash=new R,this.secret){this.outer=new R;var e=function(e){var t=P(e);if(t.byteLength>C){var n=new R;n.update(t),t=n.digest()}var r=new Uint8Array(C);return r.set(t),r}(this.secret),t=new Uint8Array(C);t.set(e);for(var n=0;n<C;n++)e[n]^=54,t[n]^=92;for(this.hash.update(e),this.outer.update(t),n=0;n<e.byteLength;n++)e[n]=0}},e}();const U={},V={};for(let e=0;e<256;e++){let t=e.toString(16).toLowerCase();1===t.length&&(t=`0${t}`),U[e]=t,V[t]=e}const q=(e,t)=>{const n=new x(e??void 0);return n.update(t),n.digestSync()},B=(e,t)=>function(e){let t="";for(let n=0;n<e.byteLength;n++)t+=U[e[n]];return t}(q(e,t)),F=e=>Object.entries(e).map((([e,t])=>({key:e.toLowerCase(),value:t?.trim().replace(/\s+/g," ")??""}))).sort(((e,t)=>e.key<t.key?-1:1)).map((e=>`${e.key}:${e.value}\n`)).join(""),G=e=>encodeURIComponent(e).replace(/[!'()*]/g,j),j=e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`,Q=(e,t=!0)=>e?t?encodeURIComponent(e).replace(/%2F/g,"/"):e:"/",K=e=>null==e?"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855":$(e)?B(null,e):"UNSIGNED-PAYLOAD",$=e=>"string"==typeof e||ArrayBuffer.isView(e)||z(e),z=e=>"function"==typeof ArrayBuffer&&e instanceof ArrayBuffer||"[object ArrayBuffer]"===Object.prototype.toString.call(e),J=(e,{credentialScope:t,longDate:n,secretAccessKey:r,shortDate:o,signingRegion:i,signingService:s,uriEscapePath:c})=>{const u=(({body:e,headers:t,method:n,url:r},o=!0)=>{return[n,Q(r.pathname,o),(i=r.searchParams,Array.from(i).sort((([e,t],[n,r])=>e===n?t<r?-1:1:e<n?-1:1)).map((([e,t])=>`${G(e)}=${G(t)}`)).join("&")),F(t),a(t),K(e)].join("\n");var i})(e,c),h=((e,t,n)=>[b,e,t,n].join("\n"))(n,t,B(null,u)),l=B(((e,t,n,r)=>{const o=q(`AWS4${e}`,t),i=q(o,n),s=q(i,r);return q(s,v)})(r,o,i,s),h);return l},Y=URL,H={clockOffset:0,getDateWithClockOffset:()=>H.clockOffset?new Date((new Date).getTime()+H.clockOffset):new Date,getClockOffset:()=>H.clockOffset,getHeaderStringFromDate:(e=H.getDateWithClockOffset())=>e.toISOString().replace(/[:-]|\.\d{3}/g,""),getDateFromHeaderString(e){const[,t,n,r,o,i,s]=e.match(/^(\d{4})(\d{2})(\d{2})T(\d{2})(\d{2})(\d{2}).+/);return new Date(Date.UTC(Number(t),Number(n)-1,Number(r),Number(o),Number(i),Number(s)))},isClockSkewed:e=>Math.abs(e.getTime()-H.getDateWithClockOffset().getTime())>=3e5,isClockSkewError(e){if(!e.response||!e.response.headers)return!1;const{headers:t}=e.response;return Boolean(["BadRequestException","InvalidSignatureException"].includes(t["x-amzn-errortype"])&&(t.date||t.Date))},setClockOffset(e){H.clockOffset=e}},W=/([^.]+)\.(?:([^.]*)\.)?amazonaws\.com(.cn)?$/;class X{static sign(e,t,n){if(e.headers=e.headers||{},e.body&&!e.data)throw new Error('The attribute "body" was found on the request object. Please use the attribute "data" instead.');const r={...e,body:e.data,url:new Y(e.url)},o=((e,t)=>{const n=m(t),{accessKeyId:r,credentialScope:o,longDate:i,sessionToken:s}=n,c={...e.headers};c[g]=e.url.host,c[_]=i,s&&(c[y]=s);const u={...e,headers:c},h=J(u,n),l=`Credential=${r}/${o}`,d=`SignedHeaders=${a(c)}`,f=`Signature=${h}`;return c.authorization=`${b} ${l}, ${d}, ${f}`,u})(r,Z(r,t,n));return o.url=o.url.toString(),o.headers.Authorization=o.headers.authorization,o.headers["X-Amz-Security-Token"]=o.headers["x-amz-security-token"],delete o.headers.authorization,delete o.headers["x-amz-security-token"],o}static signUrl(e,t,n,r){const o="object"==typeof e?e.url:e,i="object"==typeof e?e.method:"GET",s={body:"object"==typeof e?e.body:void 0,method:i,url:new Y(o)},c=Z(s,t,n,r),a=(({body:e,method:t="GET",url:n},{expiration:r,...o})=>{const i=m(o),{accessKeyId:s,credentialScope:c,longDate:a,sessionToken:_}=i,y=new Y(n);Object.entries({[u]:b,[l]:`${s}/${c}`,[h]:a,[f]:g,...r&&{[d]:r.toString()},..._&&{[p]:_}}).forEach((([e,t])=>{y.searchParams.append(e,t)}));const v={body:e,headers:{[g]:n.host},method:t,url:y},w=J(v,i);return y.searchParams.append("X-Amz-Signature",w),y})(s,c);return t.session_token&&!te(c.signingService)&&a.searchParams.append(p,t.session_token),a.toString()}}const Z=(e,t,n,r)=>{const{access_key:o,secret_key:i,session_token:s}=t??{},{region:c,service:a}=ee(e.url),{region:u=c,service:h=a}=n??{};return{credentials:{accessKeyId:o,secretAccessKey:i,...te(h)?{sessionToken:s}:{}},signingDate:H.getDateWithClockOffset(),signingRegion:u,signingService:h,...r&&{expiration:r}}},ee=e=>{const{host:t}=e;let n=(t.match(W)??[]).slice(1,3);return"es"===n[1]&&(n=n.reverse()),{service:n[0],region:n[1]}},te=e=>"iotdevicegateway"!==e;var ne=r(556);function re(e){return"function"==typeof e}var oe,ie=((oe=function(e){var t;t=this,Error.call(t),t.stack=(new Error).stack,this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}).prototype=Object.create(Error.prototype),oe.prototype.constructor=oe,oe);function se(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var ce=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,n,r,o;if(!this.closed){this.closed=!0;var i=this._parentage;if(i)if(this._parentage=null,Array.isArray(i))try{for(var s=O(i),c=s.next();!c.done;c=s.next())c.value.remove(this)}catch(t){e={error:t}}finally{try{c&&!c.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else i.remove(this);var a=this.initialTeardown;if(re(a))try{a()}catch(e){o=e instanceof ie?e.errors:[e]}var u=this._finalizers;if(u){this._finalizers=null;try{for(var h=O(u),l=h.next();!l.done;l=h.next()){var d=l.value;try{ue(d)}catch(e){o=null!=o?o:[],e instanceof ie?o=T(T([],N(o)),N(e.errors)):o.push(e)}}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=h.return)&&r.call(h)}finally{if(n)throw n.error}}}if(o)throw new ie(o)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)ue(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&se(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&se(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}();function ae(e){return e instanceof ce||e&&"closed"in e&&re(e.remove)&&re(e.add)&&re(e.unsubscribe)}function ue(e){re(e)?e():e.unsubscribe()}ce.EMPTY;var he=null,le=null,de=void 0,fe=!1,pe=!1,ge={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=ge.delegate;return(null==o?void 0:o.setTimeout)?o.setTimeout.apply(o,T([e,t],N(n))):setTimeout.apply(void 0,T([e,t],N(n)))},clearTimeout:function(e){var t=ge.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function _e(e){ge.setTimeout((function(){if(!he)throw e;he(e)}))}function ye(){}var ve=be("C",void 0,void 0);function be(e,t,n){return{kind:e,value:t,error:n}}var me=null,we=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,ae(t)&&t.add(n)):n.destination=Ae,n}return E(t,e),t.create=function(e,t,n){return new Oe(e,t,n)},t.prototype.next=function(e){this.isStopped?Te(function(e){return be("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?Te(be("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?Te(ve,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(ce),Ee=Function.prototype.bind;function Ie(e,t){return Ee.call(e,t)}var Se=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){Ne(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){Ne(e)}else Ne(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){Ne(e)}},e}(),Oe=function(e){function t(t,n,r){var o,i,s=e.call(this)||this;return re(t)||!t?o={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:s&&pe?((i=Object.create(t)).unsubscribe=function(){return s.unsubscribe()},o={next:t.next&&Ie(t.next,i),error:t.error&&Ie(t.error,i),complete:t.complete&&Ie(t.complete,i)}):o=t,s.destination=new Se(o),s}return E(t,e),t}(we);function Ne(e){var t;fe?(t=e,fe&&me&&(me.errorThrown=!0,me.error=t)):_e(e)}function Te(e,t){var n=le;n&&ge.setTimeout((function(){return n(e,t)}))}var Ae={closed:!0,next:ye,error:function(e){throw e},complete:ye},Ce="function"==typeof Symbol&&Symbol.observable||"@@observable";function Me(e){return e}var ke,Le=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r,o=this,i=(r=e)&&r instanceof we||function(e){return e&&re(e.next)&&re(e.error)&&re(e.complete)}(r)&&ae(r)?e:new Oe(e,t,n);return function(e){if(fe){var t=!me;if(t&&(me={errorThrown:!1,error:null}),e(),t){var n=me,r=n.errorThrown,o=n.error;if(me=null,r)throw o}}else e()}((function(){var e=o,t=e.operator,n=e.source;i.add(t?t.call(i,n):n?o._subscribe(i):o._trySubscribe(i))})),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=Re(t))((function(t,r){var o=new Oe({next:function(t){try{e(t)}catch(e){r(e),o.unsubscribe()}},error:r,complete:t});n.subscribe(o)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[Ce]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0===(n=e).length?Me:1===n.length?n[0]:function(e){return n.reduce((function(e,t){return t(e)}),e)})(this);var n},e.prototype.toPromise=function(e){var t=this;return new(e=Re(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function Re(e){var t;return null!==(t=null!=e?e:de)&&void 0!==t?t:Promise}!function(e){e.DEBUG="DEBUG",e.ERROR="ERROR",e.INFO="INFO",e.WARN="WARN",e.VERBOSE="VERBOSE",e.NONE="NONE"}(ke||(ke={}));const De={VERBOSE:1,DEBUG:2,INFO:3,WARN:4,ERROR:5,NONE:6};class Pe{constructor(e,t=ke.WARN){this.name=e,this.level=t,this._pluggables=[]}_padding(e){return e<10?"0"+e:""+e}_ts(){const e=new Date;return[this._padding(e.getMinutes()),this._padding(e.getSeconds())].join(":")+"."+e.getMilliseconds()}configure(e){return e?(this._config=e,this._config):this._config}_log(e,...t){let n=this.level;if(Pe.LOG_LEVEL&&(n=Pe.LOG_LEVEL),"undefined"!=typeof window&&window.LOG_LEVEL&&(n=window.LOG_LEVEL),!(De[e]>=De[n]))return;let r=console.log.bind(console);e===ke.ERROR&&console.error&&(r=console.error.bind(console)),e===ke.WARN&&console.warn&&(r=console.warn.bind(console)),Pe.BIND_ALL_LOG_LEVELS&&(e===ke.INFO&&console.info&&(r=console.info.bind(console)),e===ke.DEBUG&&console.debug&&(r=console.debug.bind(console)));const o=`[${e}] ${this._ts()} ${this.name}`;let i="";if(1===t.length&&"string"==typeof t[0])i=`${o} - ${t[0]}`,r(i);else if(1===t.length)i=`${o} ${t[0]}`,r(o,t[0]);else if("string"==typeof t[0]){let e=t.slice(1);1===e.length&&(e=e[0]),i=`${o} - ${t[0]} ${e}`,r(`${o} - ${t[0]}`,e)}else i=`${o} ${t}`,r(o,t);for(const e of this._pluggables){const t={message:i,timestamp:Date.now()};e.pushLogs([t])}}log(...e){this._log(ke.INFO,...e)}info(...e){this._log(ke.INFO,...e)}warn(...e){this._log(ke.WARN,...e)}error(...e){this._log(ke.ERROR,...e)}debug(...e){this._log(ke.DEBUG,...e)}verbose(...e){this._log(ke.VERBOSE,...e)}addPluggable(e){e&&"Logging"===e.getCategoryName()&&(this._pluggables.push(e),e.configure(this._config))}listPluggables(){return this._pluggables}}Pe.LOG_LEVEL=null,Pe.BIND_ALL_LOG_LEVELS=!1;class xe extends Error{constructor({message:e,name:t,recoverySuggestion:n,underlyingError:r}){super(e),this.name=t,this.underlyingError=r,this.recoverySuggestion=n,this.constructor=xe,Object.setPrototypeOf(this,xe.prototype)}}const Ue="undefined"!=typeof Symbol?Symbol("amplify_default"):"@@amplify_default",Ve=new Pe("Hub");class qe{constructor(e){this.listeners=new Map,this.protectedChannels=["core","auth","api","analytics","interactions","pubsub","storage","ui","xr"],this.name=e}_remove(e,t){const n=this.listeners.get(e);n?this.listeners.set(e,[...n.filter((({callback:e})=>e!==t))]):Ve.warn(`No listeners for ${e}`)}dispatch(e,t,n,r){"string"==typeof e&&this.protectedChannels.indexOf(e)>-1&&(r===Ue||Ve.warn(`WARNING: ${e} is protected and dispatching on it can have unintended consequences`));const o={channel:e,payload:{...t},source:n,patternInfo:[]};try{this._toListeners(o)}catch(e){Ve.error(e)}}listen(e,t,n="noname"){let r;if("function"!=typeof t)throw new xe({name:"NoHubcallbackProvidedException",message:"No callback supplied to Hub"});r=t;let o=this.listeners.get(e);return o||(o=[],this.listeners.set(e,o)),o.push({name:n,callback:r}),()=>{this._remove(e,r)}}_toListeners(e){const{channel:t,payload:n}=e,r=this.listeners.get(t);r&&r.forEach((r=>{Ve.debug(`Dispatching to ${t} with `,n);try{r.callback(e)}catch(e){Ve.error(e)}}))}}new qe("__default__"),new qe("internal-hub");const Be={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let Fe;const Ge=new Uint8Array(16);function je(){if(!Fe&&(Fe="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Fe))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Fe(Ge)}const Qe=[];for(let e=0;e<256;++e)Qe.push((e+256).toString(16).slice(1));const Ke=function(e,t,n){if(Be.randomUUID&&!t&&!e)return Be.randomUUID();const r=(e=e||{}).random||(e.rng||je)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return Qe[e[t+0]]+Qe[e[t+1]]+Qe[e[t+2]]+Qe[e[t+3]]+"-"+Qe[e[t+4]]+Qe[e[t+5]]+"-"+Qe[e[t+6]]+Qe[e[t+7]]+"-"+Qe[e[t+8]]+Qe[e[t+9]]+"-"+Qe[e[t+10]]+Qe[e[t+11]]+Qe[e[t+12]]+Qe[e[t+13]]+Qe[e[t+14]]+Qe[e[t+15]]}(r)};var $e=r(670);function ze(e){return function(t){if(function(e){return re(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function Je(e,t,n,r,o){return new Ye(e,t,n,r,o)}var Ye=function(e){function t(t,n,r,o,i,s){var c=e.call(this,t)||this;return c.onFinalize=i,c.shouldUnsubscribe=s,c._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,c._error=o?function(e){try{o(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,c._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,c}return E(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(we),He=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function We(e){return re(null==e?void 0:e.then)}function Xe(e){return re(e[Ce])}function Ze(e){return Symbol.asyncIterator&&re(null==e?void 0:e[Symbol.asyncIterator])}function et(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var tt="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function nt(e){return re(null==e?void 0:e[tt])}function rt(e){return function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),i=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",(function(e){return function(t){return Promise.resolve(t).then(e,u)}})),r[Symbol.asyncIterator]=function(){return this},r;function s(e,t){o[e]&&(r[e]=function(t){return new Promise((function(n,r){i.push([e,t,n,r])>1||c(e,t)}))},t&&(r[e]=t(r[e])))}function c(e,t){try{(n=o[e](t)).value instanceof A?Promise.resolve(n.value.v).then(a,u):h(i[0][2],n)}catch(e){h(i[0][3],e)}var n}function a(e){c("next",e)}function u(e){c("throw",e)}function h(e,t){e(t),i.shift(),i.length&&c(i[0][0],i[0][1])}}(this,arguments,(function(){var t,n,r;return S(this,(function(o){switch(o.label){case 0:t=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,A(t.read())];case 3:return n=o.sent(),r=n.value,n.done?[4,A(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,A(r)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function ot(e){return re(null==e?void 0:e.getReader)}function it(e){if(e instanceof Le)return e;if(null!=e){if(Xe(e))return o=e,new Le((function(e){var t=o[Ce]();if(re(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(He(e))return r=e,new Le((function(e){for(var t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()}));if(We(e))return n=e,new Le((function(e){n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,_e)}));if(Ze(e))return st(e);if(nt(e))return t=e,new Le((function(e){var n,r;try{for(var o=O(t),i=o.next();!i.done;i=o.next()){var s=i.value;if(e.next(s),e.closed)return}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}e.complete()}));if(ot(e))return st(rt(e))}var t,n,r,o;throw et(e)}function st(e){return new Le((function(t){(function(e,t){var n,r,o,i;return I(this,void 0,void 0,(function(){var s,c;return S(this,(function(a){switch(a.label){case 0:a.trys.push([0,5,6,11]),n=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=O(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,o,(t=e[n](t)).done,t.value)}))}}}(e),a.label=1;case 1:return[4,n.next()];case 2:if((r=a.sent()).done)return[3,4];if(s=r.value,t.next(s),t.closed)return[2];a.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return c=a.sent(),o={error:c},[3,11];case 6:return a.trys.push([6,,9,10]),r&&!r.done&&(i=n.return)?[4,i.call(n)]:[3,8];case 7:a.sent(),a.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}class ct{networkMonitor(e){const t=(()=>{if("undefined"==typeof self)return!1;const e=self;return void 0!==e.WorkerGlobalScope&&self instanceof e.WorkerGlobalScope})()?self:"undefined"!=typeof window&&window;return t?new Le((e=>{e.next({online:t.navigator.onLine});const n=()=>{e.next({online:!0})},r=()=>{e.next({online:!1})};return t.addEventListener("online",n),t.addEventListener("offline",r),ct._observers.push(e),()=>{t.removeEventListener("online",n),t.removeEventListener("offline",r),ct._observers=ct._observers.filter((t=>t!==e))}})):it([{online:!0}])}static _observerOverride(e){for(const t of this._observers)t.closed?this._observers=this._observers.filter((e=>e!==t)):t?.next&&t.next(e)}}ct._observers=[];const at=()=>(new ct).networkMonitor(),ut={KEEP_ALIVE_MISSED:{keepAliveState:"unhealthy"},KEEP_ALIVE:{keepAliveState:"healthy"},CONNECTION_ESTABLISHED:{connectionState:"connected"},CONNECTION_FAILED:{intendedConnectionState:"disconnected",connectionState:"disconnected"},CLOSING_CONNECTION:{intendedConnectionState:"disconnected"},OPENING_CONNECTION:{intendedConnectionState:"connected",connectionState:"connecting"},CLOSED:{connectionState:"disconnected"},ONLINE:{networkState:"connected"},OFFLINE:{networkState:"disconnected"}};class ht{constructor(){this._networkMonitoringSubscription=void 0,this._linkedConnectionState={networkState:"connected",connectionState:"disconnected",intendedConnectionState:"disconnected",keepAliveState:"healthy"},this._initialNetworkStateSubscription=at().subscribe((({online:e})=>{this.record(e?ut.ONLINE:ut.OFFLINE),this._initialNetworkStateSubscription?.unsubscribe()})),this._linkedConnectionStateObservable=new Le((e=>{e.next(this._linkedConnectionState),this._linkedConnectionStateObserver=e}))}enableNetworkMonitoring(){this._initialNetworkStateSubscription?.unsubscribe(),void 0===this._networkMonitoringSubscription&&(this._networkMonitoringSubscription=at().subscribe((({online:e})=>{this.record(e?ut.ONLINE:ut.OFFLINE)})))}disableNetworkMonitoring(){this._networkMonitoringSubscription?.unsubscribe(),this._networkMonitoringSubscription=void 0}get connectionStateObservable(){let e;return this._linkedConnectionStateObservable.pipe((n=e=>this.connectionStatesTranslator(e),ze((function(e,t){var r=0;e.subscribe(Je(t,(function(e){t.next(n.call(undefined,e,r++))})))})))).pipe((t=t=>{const n=t!==e;return e=t,n},ze((function(e,n){var r=0;e.subscribe(Je(n,(function(e){return t.call(void 0,e,r++)&&n.next(e)})))}))));var t,n}record(e){"connected"===e.intendedConnectionState?this.enableNetworkMonitoring():"disconnected"===e.intendedConnectionState&&this.disableNetworkMonitoring();const t={...this._linkedConnectionState,...e};this._linkedConnectionState={...t},this._linkedConnectionStateObserver?.next(this._linkedConnectionState)}connectionStatesTranslator({connectionState:e,networkState:t,intendedConnectionState:n,keepAliveState:r}){return"connected"===e&&"disconnected"===t?c.ConnectedPendingNetwork:"connected"===e&&"disconnected"===n?c.ConnectedPendingDisconnect:"disconnected"===e&&"connected"===n&&"disconnected"===t?c.ConnectionDisruptedPendingNetwork:"disconnected"===e&&"connected"===n?c.ConnectionDisrupted:"connected"===e&&"unhealthy"===r?c.ConnectedPendingKeepAlive:"connecting"===e?c.Connecting:"disconnected"===e?c.Disconnected:c.Connected}}var lt;!function(e){e.START_RECONNECT="START_RECONNECT",e.HALT_RECONNECT="HALT_RECONNECT"}(lt||(lt={}));class dt{constructor(){this.reconnectObservers=[]}addObserver(e){this.reconnectObservers.push(e)}record(e){e===lt.START_RECONNECT&&void 0===this.reconnectSetTimeoutId&&void 0===this.reconnectIntervalId&&(this.reconnectSetTimeoutId=setTimeout((()=>{this._triggerReconnect(),this.reconnectIntervalId=setInterval((()=>{this._triggerReconnect()}),6e4)}),5e3)),e===lt.HALT_RECONNECT&&(this.reconnectIntervalId&&(clearInterval(this.reconnectIntervalId),this.reconnectIntervalId=void 0),this.reconnectSetTimeoutId&&(clearTimeout(this.reconnectSetTimeoutId),this.reconnectSetTimeoutId=void 0))}close(){this.reconnectObservers.forEach((e=>{e.complete?.()}))}_triggerReconnect(){this.reconnectObservers.forEach((e=>{e.next?.()}))}}const ft=new ne.ConsoleLogger("AbstractPubSubProvider");class pt{constructor(e){this._config=e}configure(e){return this._config={...e,...this._config},ft.debug("configure",this._config),this.options}get options(){return{...this._config}}}const gt=new ne.ConsoleLogger("MqttOverWS");function _t(e,t){const n=e.split("/"),{length:r}=n,o=t.split("/");for(let e=0;e<r;++e){const t=n[e],i=o[e];if("#"===t)return o.length>=r;if("+"!==t&&t!==i)return!1}return r===o.length}class yt{constructor(){this.promises=new Map}async get(e,t){const n=this.promises.get(e);if(n)return n;if(t){const n=t(e);return this.promises.set(e,n),n.catch((()=>this.promises.delete(e))),n}}get allClients(){return Array.from(this.promises.keys())}remove(e){this.promises.delete(e)}}const vt="undefined"!=typeof Symbol?Symbol("topic"):"@@topic";class bt extends pt{constructor(t={}){super({...t,clientId:t.clientId||Ke()}),this._clientsQueue=new yt,this.connectionStateMonitor=new ht,this.reconnectionMonitor=new dt,this._topicObservers=new Map,this._clientIdObservers=new Map,this.connectionStateMonitor.connectionStateObservable.subscribe((t=>{var n;n={event:e,data:{provider:this,connectionState:t},message:`Connection state is ${t}`},ne.Hub.dispatch("pubsub",n,"PubSub",Ue),this.connectionState=t,t===c.ConnectionDisrupted?this.reconnectionMonitor.record(lt.START_RECONNECT):t!==c.Connecting&&this.reconnectionMonitor.record(lt.HALT_RECONNECT)}))}get clientId(){return this.options.clientId}get endpoint(){return Promise.resolve(this.options.endpoint)}get clientsQueue(){return this._clientsQueue}get isSSLEnabled(){return!this.options.aws_appsync_dangerously_connect_to_http_endpoint_for_testing}onDisconnect({clientId:e,errorCode:t,...n}){if(0!==t){if(gt.warn(e,JSON.stringify({errorCode:t,...n},null,2)),!e)return;if(!this._clientIdObservers.get(e))return;this.disconnect(e)}}async newClient({url:e,clientId:t}){gt.debug("Creating new MQTT client",t),this.connectionStateMonitor.record(ut.OPENING_CONNECTION);const n=new $e.Client(e,t);return n.onMessageArrived=({destinationName:e,payloadString:t})=>{this._onMessage(e,t)},n.onConnectionLost=({errorCode:e,...n})=>{this.onDisconnect({clientId:t,errorCode:e,...n}),this.connectionStateMonitor.record(ut.CLOSED)},await new Promise(((e,r)=>{n.connect({useSSL:this.isSSLEnabled,mqttVersion:3,onSuccess:()=>{e(!0)},onFailure:()=>{t&&this._clientsQueue.remove(t),this.connectionStateMonitor.record(ut.CLOSED),e(!1)}})}))&&this.connectionStateMonitor.record(ut.CONNECTION_ESTABLISHED),n}async connect(e,t={}){return this.clientsQueue.get(e,(async e=>{const n=await this.newClient({...t,clientId:e});return n&&this._topicObservers.forEach(((e,t)=>{n.subscribe(t)})),n}))}async disconnect(e){const t=await this.clientsQueue.get(e);t&&t.isConnected()&&t.disconnect(),this.clientsQueue.remove(e),this.connectionStateMonitor.record(ut.CLOSED)}async publish({topics:e,message:t}){const n=[].concat(e),r=JSON.stringify(t),o=await this.clientsQueue.get(this.clientId);o?(gt.debug("Publishing to topic(s)",n.join(","),t),n.forEach((e=>{o.send(e,r)}))):gt.debug("Publishing to topic(s) failed",n.join(","),t)}_onMessage(e,t){try{const n=[];this._topicObservers.forEach(((t,r)=>{_t(r,e)&&n.push(t)}));const r=JSON.parse(t);"object"==typeof r&&(r[vt]=e),n.forEach((e=>{e.forEach((e=>{e.next(r)}))}))}catch(e){gt.warn("Error handling message",e,t)}}subscribe({topics:e,options:t={}}){const n=[].concat(e);let r;return gt.debug("Subscribing to topic(s)",n.join(",")),new Le((e=>{n.forEach((t=>{let n=this._topicObservers.get(t);n||(n=new Set,this._topicObservers.set(t,n)),n.add(e)}));const{clientId:o=this.clientId}=t;let i=this._clientIdObservers.get(o);return i||(i=new Set),i&&(i.add(e),this._clientIdObservers.set(o,i)),(async()=>{const e=async()=>{try{const{url:e=await this.endpoint}=t,r=await this.connect(o,{url:e});void 0!==r&&n.forEach((e=>{r.subscribe(e)}))}catch(e){gt.debug("Error forming connection",e)}};await e(),r=new Le((e=>{this.reconnectionMonitor.addObserver(e)})).subscribe((()=>{e()}))})(),async()=>{const t=await this.clientsQueue.get(o);return r?.unsubscribe(),t&&(this._clientIdObservers.get(o)?.delete(e),0===this._clientIdObservers.get(o)?.size&&(this.disconnect(o),this.connectionStateMonitor.record(ut.CLOSING_CONNECTION),this._clientIdObservers.delete(o)),n.forEach((n=>{const r=this._topicObservers.get(n)||new Set;r.delete(e),0===r.size&&(this._topicObservers.delete(n),t.isConnected()&&t.unsubscribe(n))}))),null}}))}}class mt extends bt{constructor(e={}){super(e)}get region(){return this.options?.region}get endpoint(){return(async()=>{const{endpoint:e}=this.options,t={service:"iotdevicegateway",region:this.region},n=await(0,ne.fetchAuthSession)();if(!n.credentials)throw new Error("No auth session credentials");const{accessKeyId:r,secretAccessKey:o,sessionToken:i}=n.credentials;return X.signUrl(e,{access_key:r,secret_key:o,session_token:i},t)})()}}})(),o})()));
//# sourceMappingURL=aws-amplify-pubsub.min.js.map