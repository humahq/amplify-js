/*! For license information please see aws-amplify-datastore.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("aws_amplify_datastore",[],t):"object"==typeof exports?exports.aws_amplify_datastore=t():e.aws_amplify_datastore=t()}(self,(()=>(()=>{var e={363:()=>{}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";function e(e){var t=new Error(e);return t.source="ulid",t}n.r(r),n.d(r,{AsyncCollection:()=>ml,AsyncItem:()=>yl,AuthModeStrategyType:()=>Ee,DISCARD:()=>Ve,DataStore:()=>Ol,DataStoreClass:()=>Nl,GraphQLScalarType:()=>ve,LimitTimerRaceResolvedValues:()=>He,ModelAttributeAuthAllow:()=>me,ModelAttributeAuthProvider:()=>ge,ModelOperation:()=>Ae,ModelPredicateCreator:()=>Xa,ModelSortPredicateCreator:()=>Qe,NAMESPACES:()=>et,OpType:()=>be,PredicateInternalsKey:()=>Je,Predicates:()=>Ya,ProcessName:()=>Te,QueryOne:()=>we,SortDirection:()=>Se,initSchema:()=>rl,isAssociatedWith:()=>xe,isEnumFieldType:()=>Be,isFieldAssociation:()=>Me,isGraphQLScalarType:()=>$e,isIdentifierObject:()=>Ge,isModelAttributeAuth:()=>Re,isModelAttributeCompositeKey:()=>je,isModelAttributeKey:()=>Fe,isModelAttributePrimaryKey:()=>Le,isModelFieldType:()=>Ue,isNonModelFieldType:()=>qe,isPredicateGroup:()=>We,isPredicateObj:()=>Ke,isSchemaModel:()=>Pe,isSchemaModelWithAttributes:()=>ke,isTargetNameAssociation:()=>De,syncExpression:()=>ze,utils:()=>_l});var t,i="0123456789ABCDEFGHJKMNPQRSTVWXYZ",o=Math.pow(2,48)-1;function s(e,t,n){return t>e.length-1?e:e.substr(0,t)+n+e.substr(t+1)}function a(e){var t=Math.floor(32*e());return 32===t&&(t=31),i.charAt(t)}function c(t,n){if(isNaN(t))throw new Error(t+" must be a number");if(t>o)throw e("cannot encode time greater than "+o);if(t<0)throw e("time must be positive");if(!1===Number.isInteger(t))throw e("time must be an integer");for(var r=void 0,s="";n>0;n--)s=i.charAt(r=t%32)+s,t=(t-r)/32;return s}function u(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments[1];r||(r="undefined"!=typeof window?window:null);var i=r&&(r.crypto||r.msCrypto);if(i)return function(){var e=new Uint8Array(1);return i.getRandomValues(e),e[0]/255};try{var o=n(363);return function(){return o.randomBytes(1).readUInt8()/255}}catch(e){}if(t){try{console.error("secure crypto unusable, falling back to insecure Math.random()!")}catch(e){}return function(){return Math.random()}}throw e("secure crypto unusable, insecure Math.random not allowed")}function l(t){t||(t=u());var n=0,r=void 0;return function(o){if(isNaN(o)&&(o=Date.now()),o<=n){var u=r=function(t){for(var n=void 0,r=t.length,o=void 0,a=void 0;!n&&r-- >=0;){if(o=t[r],-1===(a=i.indexOf(o)))throw e("incorrectly encoded string");31!==a?n=s(t,r,i[a+1]):t=s(t,r,i[0])}if("string"==typeof n)return n;throw e("cannot increment this string")}(r);return c(n,10)+u}n=o;var l=r=function(e,t){for(var n="";e>0;e--)n=a(t)+n;return n}(16,t);return c(o,10)+l}}t||(t=u());const d={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let h;const p=new Uint8Array(16);function f(){if(!h&&(h="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!h))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return h(p)}const y=[];for(let e=0;e<256;++e)y.push((e+256).toString(16).slice(1));const m=function(e,t,n){if(d.randomUUID&&!t&&!e)return d.randomUUID();const r=(e=e||{}).random||(e.rng||f)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return y[e[t+0]]+y[e[t+1]]+y[e[t+2]]+y[e[t+3]]+"-"+y[e[t+4]]+y[e[t+5]]+"-"+y[e[t+6]]+y[e[t+7]]+"-"+y[e[t+8]]+y[e[t+9]]+"-"+y[e[t+10]]+y[e[t+11]]+y[e[t+12]]+y[e[t+13]]+y[e[t+14]]+y[e[t+15]]}(r)};class g extends Error{constructor({message:e,name:t,recoverySuggestion:n,underlyingError:r}){super(e),this.name=t,this.underlyingError=r,this.recoverySuggestion=n,this.constructor=g,Object.setPrototypeOf(this,g.prototype)}}const v=()=>{if("object"==typeof window&&"object"==typeof window.crypto)return window.crypto;if("object"==typeof crypto)return crypto;throw new g({name:"MissingPolyfill",message:"Cannot resolve the `crypto` function from the environment."})};class b{constructor(e,t){this.words=[];let n=e;n=this.words=n||[],this.sigBytes=void 0!==t?t:4*n.length}random(e){const t=[];for(let n=0;n<e;n+=4)t.push(v().getRandomValues(new Uint32Array(1))[0]);return new b(t,e)}toString(){return function(e){const{words:t}=e,{sigBytes:n}=e,r=[];for(let e=0;e<n;e++){const n=t[e>>>2]>>>24-e%4*8&255;r.push((n>>>4).toString(16)),r.push((15&n).toString(16))}return r.join("")}(this)}}const w=URL,S=URLSearchParams;function E(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw Error("[Immer] minified error nr: "+e+(n.length?" "+n.map((function(e){return"'"+e+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function A(e){return!!e&&!!e[ue]}function T(e){return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return n===Object||"function"==typeof n&&Function.toString.call(n)===le}(e)||Array.isArray(e)||!!e[ce]||!!e.constructor[ce]||P(e)||k(e))}function I(e,t,n){void 0===n&&(n=!1),0===N(e)?(n?Object.keys:de)(e).forEach((function(r){n&&"symbol"==typeof r||t(r,e[r],e)})):e.forEach((function(n,r){return t(r,n,e)}))}function N(e){var t=e[ue];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:P(e)?2:k(e)?3:0}function O(e,t){return 2===N(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function _(e,t){return 2===N(e)?e.get(t):e[t]}function C(e,t,n){var r=N(e);2===r?e.set(t,n):3===r?(e.delete(t),e.add(n)):e[t]=n}function P(e){return ie&&e instanceof Map}function k(e){return oe&&e instanceof Set}function x(e){return e.o||e.t}function D(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=he(e);delete t[ue];for(var n=de(t),r=0;r<n.length;r++){var i=n[r],o=t[i];!1===o.writable&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(t[i]={configurable:!0,writable:!0,enumerable:o.enumerable,value:e[i]})}return Object.create(Object.getPrototypeOf(e),t)}function M(e,t){return void 0===t&&(t=!1),F(e)||A(e)||!T(e)||(N(e)>1&&(e.set=e.add=e.clear=e.delete=R),Object.freeze(e),t&&I(e,(function(e,t){return M(t,!0)}),!0)),e}function R(){E(2)}function F(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function L(e){var t=pe[e];return t||E(18,e),t}function j(){return ne}function $(e,t){t&&(L("Patches"),e.u=[],e.s=[],e.v=t)}function U(e){q(e),e.p.forEach(G),e.p=null}function q(e){e===ne&&(ne=e.l)}function B(e){return ne={p:[],l:ne,h:e,m:!0,_:0}}function G(e){var t=e[ue];0===t.i||1===t.i?t.j():t.O=!0}function K(e,t){t._=t.p.length;var n=t.p[0],r=void 0!==e&&e!==n;return t.h.g||L("ES5").S(t,e,r),r?(n[ue].P&&(U(t),E(4)),T(e)&&(e=W(t,e),t.l||V(t,e)),t.u&&L("Patches").M(n[ue],e,t.u,t.s)):e=W(t,n,[]),U(t),t.u&&t.v(t.u,t.s),e!==ae?e:void 0}function W(e,t,n){if(F(t))return t;var r=t[ue];if(!r)return I(t,(function(i,o){return z(e,r,t,i,o,n)}),!0),t;if(r.A!==e)return t;if(!r.P)return V(e,r.t,!0),r.t;if(!r.I){r.I=!0,r.A._--;var i=4===r.i||5===r.i?r.o=D(r.k):r.o;I(3===r.i?new Set(i):i,(function(t,o){return z(e,r,i,t,o,n)})),V(e,i,!1),n&&e.u&&L("Patches").R(r,n,e.u,e.s)}return r.o}function z(e,t,n,r,i,o){if(A(i)){var s=W(e,i,o&&t&&3!==t.i&&!O(t.D,r)?o.concat(r):void 0);if(C(n,r,s),!A(s))return;e.m=!1}if(T(i)&&!F(i)){if(!e.h.F&&e._<1)return;W(e,i),t&&t.A.l||V(e,i)}}function V(e,t,n){void 0===n&&(n=!1),e.h.F&&e.m&&M(t,n)}function H(e,t){var n=e[ue];return(n?x(n):e)[t]}function J(e,t){if(t in e)for(var n=Object.getPrototypeOf(e);n;){var r=Object.getOwnPropertyDescriptor(n,t);if(r)return r;n=Object.getPrototypeOf(n)}}function Q(e){e.P||(e.P=!0,e.l&&Q(e.l))}function Y(e){e.o||(e.o=D(e.t))}function X(e,t,n){var r=P(t)?L("MapSet").N(t,n):k(t)?L("MapSet").T(t,n):e.g?function(e,t){var n=Array.isArray(e),r={i:n?1:0,A:t?t.A:j(),P:!1,I:!1,D:{},l:t,t:e,k:null,o:null,j:null,C:!1},i=r,o=fe;n&&(i=[r],o=ye);var s=Proxy.revocable(i,o),a=s.revoke,c=s.proxy;return r.k=c,r.j=a,c}(t,n):L("ES5").J(t,n);return(n?n.A:j()).p.push(r),r}function Z(e){return A(e)||E(22,e),function e(t){if(!T(t))return t;var n,r=t[ue],i=N(t);if(r){if(!r.P&&(r.i<4||!L("ES5").K(r)))return r.t;r.I=!0,n=ee(t,i),r.I=!1}else n=ee(t,i);return I(n,(function(t,i){r&&_(r.t,t)===i||C(n,t,e(i))})),3===i?new Set(n):n}(e)}function ee(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return D(e)}var te,ne,re="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),ie="undefined"!=typeof Map,oe="undefined"!=typeof Set,se="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,ae=re?Symbol.for("immer-nothing"):((te={})["immer-nothing"]=!0,te),ce=re?Symbol.for("immer-draftable"):"__$immer_draftable",ue=re?Symbol.for("immer-state"):"__$immer_state",le=("undefined"!=typeof Symbol&&Symbol.iterator,""+Object.prototype.constructor),de="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,he=Object.getOwnPropertyDescriptors||function(e){var t={};return de(e).forEach((function(n){t[n]=Object.getOwnPropertyDescriptor(e,n)})),t},pe={},fe={get:function(e,t){if(t===ue)return e;var n=x(e);if(!O(n,t))return function(e,t,n){var r,i=J(t,n);return i?"value"in i?i.value:null===(r=i.get)||void 0===r?void 0:r.call(e.k):void 0}(e,n,t);var r=n[t];return e.I||!T(r)?r:r===H(e.t,t)?(Y(e),e.o[t]=X(e.A.h,r,e)):r},has:function(e,t){return t in x(e)},ownKeys:function(e){return Reflect.ownKeys(x(e))},set:function(e,t,n){var r=J(x(e),t);if(null==r?void 0:r.set)return r.set.call(e.k,n),!0;if(!e.P){var i=H(x(e),t),o=null==i?void 0:i[ue];if(o&&o.t===n)return e.o[t]=n,e.D[t]=!1,!0;if(function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}(n,i)&&(void 0!==n||O(e.t,t)))return!0;Y(e),Q(e)}return e.o[t]===n&&"number"!=typeof n&&(void 0!==n||t in e.o)||(e.o[t]=n,e.D[t]=!0,!0)},deleteProperty:function(e,t){return void 0!==H(e.t,t)||t in e.t?(e.D[t]=!1,Y(e),Q(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var n=x(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r?{writable:!0,configurable:1!==e.i||"length"!==t,enumerable:r.enumerable,value:n[t]}:r},defineProperty:function(){E(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){E(12)}},ye={};I(fe,(function(e,t){ye[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),ye.deleteProperty=function(e,t){return fe.deleteProperty.call(this,e[0],t)},ye.set=function(e,t,n){return fe.set.call(this,e[0],t,n,e[0])};var me,ge,ve,be,we,Se,Ee,Ae,Te,Ie=function(){function e(e){var t=this;this.g=se,this.F=!0,this.produce=function(e,n,r){if("function"==typeof e&&"function"!=typeof n){var i=n;n=e;var o=t;return function(e){var t=this;void 0===e&&(e=i);for(var r=arguments.length,s=Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];return o.produce(e,(function(e){var r;return(r=n).call.apply(r,[t,e].concat(s))}))}}var s;if("function"!=typeof n&&E(6),void 0!==r&&"function"!=typeof r&&E(7),T(e)){var a=B(t),c=X(t,e,void 0),u=!0;try{s=n(c),u=!1}finally{u?U(a):q(a)}return"undefined"!=typeof Promise&&s instanceof Promise?s.then((function(e){return $(a,r),K(e,a)}),(function(e){throw U(a),e})):($(a,r),K(s,a))}if(!e||"object"!=typeof e){if((s=n(e))===ae)return;return void 0===s&&(s=e),t.F&&M(s,!0),s}E(21,e)},this.produceWithPatches=function(e,n){return"function"==typeof e?function(n){for(var r=arguments.length,i=Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return t.produceWithPatches(n,(function(t){return e.apply(void 0,[t].concat(i))}))}:[t.produce(e,n,(function(e,t){r=e,i=t})),r,i];var r,i},"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze)}var t=e.prototype;return t.createDraft=function(e){T(e)||E(8),A(e)&&(e=Z(e));var t=B(this),n=X(this,e,void 0);return n[ue].C=!0,q(t),n},t.finishDraft=function(e,t){var n=(e&&e[ue]).A;return $(n,t),K(void 0,n)},t.setAutoFreeze=function(e){this.F=e},t.setUseProxies=function(e){e&&!se&&E(20),this.g=e},t.applyPatches=function(e,t){var n;for(n=t.length-1;n>=0;n--){var r=t[n];if(0===r.path.length&&"replace"===r.op){e=r.value;break}}var i=L("Patches").$;return A(e)?i(e,t):this.produce(e,(function(e){return i(e,t.slice(n+1))}))},e}(),Ne=new Ie,Oe=Ne.produce,_e=(Ne.produceWithPatches.bind(Ne),Ne.setAutoFreeze.bind(Ne)),Ce=(Ne.setUseProxies.bind(Ne),Ne.applyPatches.bind(Ne));function Pe(e){return e&&void 0!==e.pluralName}function ke(e){return Pe(e)&&void 0!==e.attributes}function xe(e){return e&&e.associatedWith}function De(e){return e?.targetName||e?.targetNames}function Me(e,t){return e?.fields[t]?.association?.connectionType}function Re(e){return"auth"===e.type&&e.properties&&e.properties.rules&&e.properties.rules.length>0}function Fe(e){return"key"===e.type&&e.properties&&e.properties.fields&&e.properties.fields.length>0}function Le(e){return Fe(e)&&void 0===e.properties.name}function je(e){return Fe(e)&&void 0!==e.properties.name&&e.properties.fields.length>2}function $e(e){return e&&void 0!==ve[e]}function Ue(e){return!(!e||!e.model)}function qe(e){return!(!e||!e.nonModel)}function Be(e){return!(!e||!e.enum)}function Ge(e,t){const n=Mt(t);return"object"==typeof e&&e&&n.every((t=>void 0!==e[t]))}function Ke(e){return e&&void 0!==e.field}function We(e){return e&&void 0!==e.type}async function ze(e,t){return{modelConstructor:e,conditionProducer:t}}Ne.createDraft.bind(Ne),Ne.finishDraft.bind(Ne),function(e){e.CUSTOM="custom",e.OWNER="owner",e.GROUPS="groups",e.PRIVATE="private",e.PUBLIC="public"}(me||(me={})),function(e){e.FUNCTION="function",e.USER_POOLS="userPools",e.OIDC="oidc",e.IAM="iam",e.API_KEY="apiKey"}(ge||(ge={})),function(e){e[e.ID=0]="ID",e[e.String=1]="String",e[e.Int=2]="Int",e[e.Float=3]="Float",e[e.Boolean=4]="Boolean",e[e.AWSDate=5]="AWSDate",e[e.AWSTime=6]="AWSTime",e[e.AWSDateTime=7]="AWSDateTime",e[e.AWSTimestamp=8]="AWSTimestamp",e[e.AWSEmail=9]="AWSEmail",e[e.AWSJSON=10]="AWSJSON",e[e.AWSURL=11]="AWSURL",e[e.AWSPhone=12]="AWSPhone",e[e.AWSIPAddress=13]="AWSIPAddress"}(ve||(ve={})),function(e){e.getJSType=function(e){switch(e){case"Boolean":return"boolean";case"ID":case"String":case"AWSDate":case"AWSTime":case"AWSDateTime":case"AWSEmail":case"AWSURL":case"AWSPhone":case"AWSIPAddress":return"string";case"Int":case"Float":case"AWSTimestamp":return"number";case"AWSJSON":return"object";default:throw new Error("Invalid scalar type")}},e.getValidationFunction=function(e){switch(e){case"AWSDate":return St;case"AWSTime":return Et;case"AWSDateTime":return At;case"AWSTimestamp":return Tt;case"AWSEmail":return It;case"AWSJSON":return Nt;case"AWSURL":return Ot;case"AWSPhone":return _t;case"AWSIPAddress":return Ct;default:return}}}(ve||(ve={})),function(e){e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"}(be||(be={})),function(e){e[e.FIRST=0]="FIRST",e[e.LAST=1]="LAST"}(we||(we={})),function(e){e.ASCENDING="ASCENDING",e.DESCENDING="DESCENDING"}(Se||(Se={})),function(e){e.DEFAULT="DEFAULT",e.MULTI_AUTH="MULTI_AUTH"}(Ee||(Ee={})),function(e){e.CREATE="CREATE",e.READ="READ",e.UPDATE="UPDATE",e.DELETE="DELETE"}(Ae||(Ae={})),function(e){e.sync="sync",e.mutate="mutate",e.subscribe="subscribe"}(Te||(Te={}));const Ve=Symbol("DISCARD");var He;!function(e){e.LIMIT="LIMIT",e.TIMER="TIMER"}(He||(He={}));class Je{constructor(){this.__isPredicateInternalsKeySentinel=!0}}class Qe{static createPredicateBuilder(e){const{name:t}=e,n=new Set(Object.keys(e.fields)),r=new Proxy({},{get(e,r,i){const o=r;if(!n.has(o))throw new Error(`Invalid field for model. field: ${String(o)}, model: ${t}`);return e=>(Qe.sortPredicateGroupsMap.get(i)?.push({field:o,sortDirection:e}),i)}});return Qe.sortPredicateGroupsMap.set(r,[]),r}static isValidPredicate(e){return Qe.sortPredicateGroupsMap.has(e)}static getPredicates(e,t=!0){if(t&&!Qe.isValidPredicate(e))throw new Error("The predicate is not valid");const n=Qe.sortPredicateGroupsMap.get(e);if(n)return n;throw new Error("Predicate group not found")}static createFromExisting(e,t){if(t&&e)return t(Qe.createPredicateBuilder(e))}}Qe.sortPredicateGroupsMap=new WeakMap;const Ye="id",Xe="#",Ze="An index field cannot contain an empty string value";var et;!function(e){e.DATASTORE="datastore",e.USER="user",e.SYNC="sync",e.STORAGE="storage"}(et||(et={}));const{DATASTORE:tt}=et,{USER:nt}=et,{SYNC:rt}=et,{STORAGE:it}=et,ot=e=>void 0===e||null==e,st=(e,t,n)=>{let r,i=!1;if(0===n.length)return!0;switch(t){case"not":r="every",i=!0;break;case"and":r="every";break;case"or":r="some";break;default:throw new Error(`Invalid ${t}`)}const o=n[r]((t=>{if(Ke(t)){const{field:n,operator:r,operand:i}=t,o=e[n];return at(o,r,i)}if(We(t)){const{type:n,predicates:r}=t;return st(e,n,r)}throw new Error("Not a predicate or group")}));return i?!o:o},at=(e,t,n)=>{switch(t){case"ne":return e!==n;case"eq":return e===n;case"le":return e<=n;case"lt":return e<n;case"ge":return e>=n;case"gt":return e>n;case"between":{const[t,r]=n;return e>=t&&e<=r}case"beginsWith":return!ot(e)&&e.startsWith(n);case"contains":return!ot(e)&&e.indexOf(n)>-1;case"notContains":return ot(e)||-1===e.indexOf(n);default:return!1}},ct=e=>e&&"function"==typeof e.copyOf,ut=new WeakSet,lt=new WeakMap,dt=(e,t,n,r,i)=>{const o=[],s=i(n.name,e).copyOf(t,(()=>{}));o.unshift({modelName:e,item:s,instance:s}),lt.has(n)||lt.set(n,Array.from(n.modelTopologicalOrdering.keys()));const a=lt.get(n);return o.sort(((e,t)=>a.indexOf(e.modelName)-a.indexOf(t.modelName))),o};let ht,pt;const ft={};for(let e=0;e<256;e++){let t=e.toString(16).toLowerCase();1===t.length&&(t=`0${t}`),ft[t]=e}const yt=()=>{return(e=1,(e=>{if(e.length%2!=0)throw new Error("Hex encoded strings must have an even number length");const t=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2){const r=e.slice(n,n+2).toLowerCase();if(!(r in ft))throw new Error(`Cannot decode unrecognized sequence ${r} as hexadecimal`);t[n/2]=ft[r]}return t})((new b).random(e).toString()))[0]/255;var e};function mt(e){const t=l(yt);return()=>t(e)}function gt(){return"undefined"!=typeof performance&&performance&&"function"==typeof performance.now?0|performance.now():Date.now()}function vt(e){return function(t,n){for(const r of e){const{field:e,sortDirection:i}=r,o=i===Se.ASCENDING?1:-1;if(t[e]<n[e])return-1*o;if(t[e]>n[e])return 1*o}return 0}}function bt(e,t,n=!1){let r=e,i=t;if(r instanceof Object&&!(i instanceof Object)||!(r instanceof Object)&&i instanceof Object)return!1;if(!(r instanceof Object))return!(!n||(o=r,s=i,null!=o||null!=s))||r===i;var o,s;if(Array.isArray(r)&&!Array.isArray(i)||Array.isArray(i)&&!Array.isArray(r))return!1;r instanceof Set&&i instanceof Set&&(r=[...r],i=[...i]),r instanceof Map&&i instanceof Map&&(r=Object.fromEntries(r),i=Object.fromEntries(i));const a=Object.keys(r),c=Object.keys(i);if(a.length!==c.length&&(!n||Array.isArray(r)))return!1;const u=a.length>=c.length?a:c;for(const e of u)if(!bt(r[e],i[e],n))return!1;return!0}function wt(e,t){if(t&&e.length>1){if(t.sort){const n=Qe.getPredicates(t.sort);if(n.length){const t=vt(n);e.sort(t)}}const{page:n=0,limit:r=0}=t,i=Math.max(0,n*r)||0,o=r>0?i+r:e.length;return e.slice(i,o)}return e}const St=e=>!!/^\d{4}-\d{2}-\d{2}(Z|[+-]\d{2}:\d{2}($|:\d{2}))?$/.exec(e),Et=e=>!!/^\d{2}:\d{2}(:\d{2}(.\d+)?)?(Z|[+-]\d{2}:\d{2}($|:\d{2}))?$/.exec(e),At=e=>!!/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}(:\d{2}(.\d+)?)?(Z|[+-]\d{2}:\d{2}($|:\d{2}))?$/.exec(e),Tt=e=>!!/^\d+$/.exec(String(e)),It=e=>!!/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.exec(e),Nt=e=>{try{return JSON.parse(e),!0}catch{return!1}},Ot=e=>{try{return!!new w(e)}catch{return!1}},_t=e=>!!/^\+?\d[\d\s-]+$/.exec(e),Ct=e=>!!/((^((([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]))$)|(^((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?$))$/.exec(e);class Pt{constructor(){const e=this;this.promise=new Promise(((t,n)=>{e.resolve=t,e.reject=n}))}}class kt{constructor(e){this.limitPromise=new Pt,this.raceInFlight=!1,this.callback=()=>{},this.defaultErrorHandler=(e="DeferredCallbackResolver error")=>{throw new Error(e)},this.callback=e.callback,this.errorHandler=e.errorHandler||this.defaultErrorHandler,this.maxInterval=e.maxInterval||2e3}startTimer(){this.timerPromise=new Promise(((e,t)=>{this.timer=setTimeout((()=>{e(He.TIMER)}),this.maxInterval)}))}async racePromises(){let e;try{this.raceInFlight=!0,this.startTimer(),e=await Promise.race([this.timerPromise,this.limitPromise.promise]),this.callback()}catch(e){this.errorHandler(e)}finally{return this.clear(),this.raceInFlight=!1,this.limitPromise=new Pt,e}}start(){this.raceInFlight||this.racePromises()}clear(){clearTimeout(this.timer)}resolve(){this.limitPromise.resolve(He.LIMIT)}}const xt=(e,t)=>`${e}_${t}`,Dt=e=>{const t=e?.attributes?.find(Fe);return t},Mt=e=>{const t=Dt(e);return t&&Le(t)?t.properties.fields:[Ye]},Rt=(e,t)=>t.map((t=>e[t])),Ft=e=>{const t=Dt(e);return!t||!Le(t)},Lt=e=>{const t={},n={};return Object.keys(e.models).forEach((r=>{t[r]={indexes:[],relationTypes:[]},n[r]={};const i=e.models[r];if(Object.keys(i.fields).forEach((e=>{const n=i.fields[e];if("object"==typeof n.type&&"model"in n.type){const{connectionType:e}=n.association;if(t[r].relationTypes.push({fieldName:n.name,modelName:n.type.model,relationType:e,targetName:n.association.targetName,targetNames:n.association.targetNames,associatedWith:n.association.associatedWith}),"BELONGS_TO"===e){const e=jt(n.association);if(e){const n=$t(e);t[r].indexes.find((([e])=>e===n))||t[r].indexes.push([n,e])}}}})),i.attributes){n[r].compositeKeys=(e=>{const t=e=>e.reduce(((e,t)=>{const n=new Set(t);if(0===e.length)return e.push(n),e;const r=e.findIndex((e=>[...e].some((e=>n.has(e)))));if(r>-1){const t=new Set([...e[r],...n]);e[r]=t}else e.push(n);return e}),[]),n=t(e.filter(je).map((({properties:{fields:[,...e]}})=>e)));return t(n)})(i.attributes);for(const e of i.attributes){if(!Fe(e))continue;const{fields:i}=e.properties;if(Le(e)){n[r].primaryKey=i;continue}const o=$t(i);t[r].indexes.find((([e])=>e===o))||t[r].indexes.push([o,i])}}n[r].primaryKey||(n[r].primaryKey=[Ye]),t[r].indexes.push(["byPk",n[r].primaryKey,{unique:!0}])})),[t,n]},jt=e=>{const t=e?.targetName,n=e?.targetNames;return Array.isArray(n)?n:"string"==typeof t?[t]:void 0},$t=e=>e.reduce(((e,t,n)=>0===n?t:`${e}-${t}`),""),Ut=(e,t)=>e.length===t.length&&e.every(((e,n)=>e===t[n])),qt=(e,t)=>{const n=e?.keys?.[t]?.primaryKey;return n||[Ye]};function Bt(e){return Bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bt(e)}"function"==typeof Symbol&&null!=Symbol.iterator&&Symbol.iterator,"function"==typeof Symbol&&null!=Symbol.asyncIterator&&Symbol.asyncIterator;var Gt="function"==typeof Symbol&&null!=Symbol.toStringTag?Symbol.toStringTag:"@@toStringTag";function Kt(e,t){for(var n,r=/\r\n|[\n\r]/g,i=1,o=t+1;(n=r.exec(e.body))&&n.index<t;)i+=1,o=t+1-(n.index+n[0].length);return{line:i,column:o}}function Wt(e){return zt(e.source,Kt(e.source,e.start))}function zt(e,t){var n=e.locationOffset.column-1,r=Ht(n)+e.body,i=t.line-1,o=e.locationOffset.line-1,s=t.line+o,a=1===t.line?n:0,c=t.column+a,u="".concat(e.name,":").concat(s,":").concat(c,"\n"),l=r.split(/\r\n|[\n\r]/g),d=l[i];if(d.length>120){for(var h=Math.floor(c/80),p=c%80,f=[],y=0;y<d.length;y+=80)f.push(d.slice(y,y+80));return u+Vt([["".concat(s),f[0]]].concat(f.slice(1,h+1).map((function(e){return["",e]})),[[" ",Ht(p-1)+"^"],["",f[h+1]]]))}return u+Vt([["".concat(s-1),l[i-1]],["".concat(s),d],["",Ht(c-1)+"^"],["".concat(s+1),l[i+1]]])}function Vt(e){var t=e.filter((function(e){return e[0],void 0!==e[1]})),n=Math.max.apply(Math,t.map((function(e){return e[0].length})));return t.map((function(e){var t,r=e[0],i=e[1];return Ht(n-(t=r).length)+t+(i?" | "+i:" |")})).join("\n")}function Ht(e){return Array(e+1).join(" ")}function Jt(e){return Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jt(e)}function Qt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Yt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Xt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Zt(e,t){return!t||"object"!==Jt(t)&&"function"!=typeof t?en(e):t}function en(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tn(e){var t="function"==typeof Map?new Map:void 0;return tn=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return nn(e,arguments,sn(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),on(r,e)},tn(e)}function nn(e,t,n){return nn=rn()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&on(i,n.prototype),i},nn.apply(null,arguments)}function rn(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function on(e,t){return on=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},on(e,t)}function sn(e){return sn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},sn(e)}var an=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&on(e,t)}(s,e);var t,n,r,i,o=(t=s,n=rn(),function(){var e,r=sn(t);if(n){var i=sn(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return Zt(this,e)});function s(e,t,n,r,i,a,c){var u,l,d,h;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(h=o.call(this,e)).name="GraphQLError",h.originalError=null!=a?a:void 0,h.nodes=cn(Array.isArray(t)?t:t?[t]:void 0);for(var p=[],f=0,y=null!==(m=h.nodes)&&void 0!==m?m:[];f<y.length;f++){var m,g=y[f].loc;null!=g&&p.push(g)}p=cn(p),h.source=null!=n?n:null===(u=p)||void 0===u?void 0:u[0].source,h.positions=null!=r?r:null===(l=p)||void 0===l?void 0:l.map((function(e){return e.start})),h.locations=r&&n?r.map((function(e){return Kt(n,e)})):null===(d=p)||void 0===d?void 0:d.map((function(e){return Kt(e.source,e.start)})),h.path=null!=i?i:void 0;var v,b=null==a?void 0:a.extensions;return null==c&&"object"==Bt(v=b)&&null!==v?h.extensions=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qt(Object(n),!0).forEach((function(t){Yt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},b):h.extensions=null!=c?c:{},Object.defineProperties(en(h),{message:{enumerable:!0},locations:{enumerable:null!=h.locations},path:{enumerable:null!=h.path},extensions:{enumerable:null!=h.extensions&&Object.keys(h.extensions).length>0},name:{enumerable:!1},nodes:{enumerable:!1},source:{enumerable:!1},positions:{enumerable:!1},originalError:{enumerable:!1}}),null!=a&&a.stack?(Object.defineProperty(en(h),"stack",{value:a.stack,writable:!0,configurable:!0}),Zt(h)):(Error.captureStackTrace?Error.captureStackTrace(en(h),s):Object.defineProperty(en(h),"stack",{value:Error().stack,writable:!0,configurable:!0}),h)}return r=s,(i=[{key:"toString",value:function(){return function(e){var t=e.message;if(e.nodes)for(var n=0,r=e.nodes;n<r.length;n++){var i=r[n];i.loc&&(t+="\n\n"+Wt(i.loc))}else if(e.source&&e.locations)for(var o=0,s=e.locations;o<s.length;o++){var a=s[o];t+="\n\n"+zt(e.source,a)}return t}(this)}},{key:Gt,get:function(){return"Object"}}])&&Xt(r.prototype,i),s}(tn(Error));function cn(e){return void 0===e||0===e.length?void 0:e}function un(e,t,n){return new an("Syntax Error: ".concat(n),void 0,e,[t])}var ln=Object.freeze({NAME:"Name",DOCUMENT:"Document",OPERATION_DEFINITION:"OperationDefinition",VARIABLE_DEFINITION:"VariableDefinition",SELECTION_SET:"SelectionSet",FIELD:"Field",ARGUMENT:"Argument",FRAGMENT_SPREAD:"FragmentSpread",INLINE_FRAGMENT:"InlineFragment",FRAGMENT_DEFINITION:"FragmentDefinition",VARIABLE:"Variable",INT:"IntValue",FLOAT:"FloatValue",STRING:"StringValue",BOOLEAN:"BooleanValue",NULL:"NullValue",ENUM:"EnumValue",LIST:"ListValue",OBJECT:"ObjectValue",OBJECT_FIELD:"ObjectField",DIRECTIVE:"Directive",NAMED_TYPE:"NamedType",LIST_TYPE:"ListType",NON_NULL_TYPE:"NonNullType",SCHEMA_DEFINITION:"SchemaDefinition",OPERATION_TYPE_DEFINITION:"OperationTypeDefinition",SCALAR_TYPE_DEFINITION:"ScalarTypeDefinition",OBJECT_TYPE_DEFINITION:"ObjectTypeDefinition",FIELD_DEFINITION:"FieldDefinition",INPUT_VALUE_DEFINITION:"InputValueDefinition",INTERFACE_TYPE_DEFINITION:"InterfaceTypeDefinition",UNION_TYPE_DEFINITION:"UnionTypeDefinition",ENUM_TYPE_DEFINITION:"EnumTypeDefinition",ENUM_VALUE_DEFINITION:"EnumValueDefinition",INPUT_OBJECT_TYPE_DEFINITION:"InputObjectTypeDefinition",DIRECTIVE_DEFINITION:"DirectiveDefinition",SCHEMA_EXTENSION:"SchemaExtension",SCALAR_TYPE_EXTENSION:"ScalarTypeExtension",OBJECT_TYPE_EXTENSION:"ObjectTypeExtension",INTERFACE_TYPE_EXTENSION:"InterfaceTypeExtension",UNION_TYPE_EXTENSION:"UnionTypeExtension",ENUM_TYPE_EXTENSION:"EnumTypeExtension",INPUT_OBJECT_TYPE_EXTENSION:"InputObjectTypeExtension"});const dn="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):void 0;function hn(e){var t=e.prototype.toJSON;"function"==typeof t||function(){if(!Boolean(0))throw new Error("Unexpected invariant triggered.")}(),e.prototype.inspect=t,dn&&(e.prototype[dn]=t)}var pn=function(){function e(e,t,n){this.start=e.start,this.end=t.end,this.startToken=e,this.endToken=t,this.source=n}return e.prototype.toJSON=function(){return{start:this.start,end:this.end}},e}();hn(pn);var fn=function(){function e(e,t,n,r,i,o,s){this.kind=e,this.start=t,this.end=n,this.line=r,this.column=i,this.value=s,this.prev=o,this.next=null}return e.prototype.toJSON=function(){return{kind:this.kind,value:this.value,line:this.line,column:this.column}},e}();function yn(e){return null!=e&&"string"==typeof e.kind}hn(fn);var mn=Object.freeze({SOF:"<SOF>",EOF:"<EOF>",BANG:"!",DOLLAR:"$",AMP:"&",PAREN_L:"(",PAREN_R:")",SPREAD:"...",COLON:":",EQUALS:"=",AT:"@",BRACKET_L:"[",BRACKET_R:"]",BRACE_L:"{",PIPE:"|",BRACE_R:"}",NAME:"Name",INT:"Int",FLOAT:"Float",STRING:"String",BLOCK_STRING:"BlockString",COMMENT:"Comment"});function gn(e){return gn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gn(e)}function vn(e){return bn(e,[])}function bn(e,t){switch(gn(e)){case"string":return JSON.stringify(e);case"function":return e.name?"[function ".concat(e.name,"]"):"[function]";case"object":return null===e?"null":function(e,t){if(-1!==t.indexOf(e))return"[Circular]";var n=[].concat(t,[e]),r=function(e){var t=e[String(dn)];return"function"==typeof t?t:"function"==typeof e.inspect?e.inspect:void 0}(e);if(void 0!==r){var i=r.call(e);if(i!==e)return"string"==typeof i?i:bn(i,n)}else if(Array.isArray(e))return function(e,t){if(0===e.length)return"[]";if(t.length>2)return"[Array]";for(var n=Math.min(10,e.length),r=e.length-n,i=[],o=0;o<n;++o)i.push(bn(e[o],t));return 1===r?i.push("... 1 more item"):r>1&&i.push("... ".concat(r," more items")),"["+i.join(", ")+"]"}(e,n);return function(e,t){var n=Object.keys(e);return 0===n.length?"{}":t.length>2?"["+function(e){var t=Object.prototype.toString.call(e).replace(/^\[object /,"").replace(/]$/,"");if("Object"===t&&"function"==typeof e.constructor){var n=e.constructor.name;if("string"==typeof n&&""!==n)return n}return t}(e)+"]":"{ "+n.map((function(n){return n+": "+bn(e[n],t)})).join(", ")+" }"}(e,n)}(e,t);default:return String(e)}}function wn(e,t){if(!Boolean(e))throw new Error(t)}function Sn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var En=function(){function e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GraphQL request",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{line:1,column:1};"string"==typeof e||wn(0,"Body must be a string. Received: ".concat(vn(e),".")),this.body=e,this.name=t,this.locationOffset=n,this.locationOffset.line>0||wn(0,"line in locationOffset is 1-indexed and must be positive."),this.locationOffset.column>0||wn(0,"column in locationOffset is 1-indexed and must be positive.")}var t,n;return t=e,(n=[{key:Gt,get:function(){return"Source"}}])&&Sn(t.prototype,n),e}(),An=Object.freeze({QUERY:"QUERY",MUTATION:"MUTATION",SUBSCRIPTION:"SUBSCRIPTION",FIELD:"FIELD",FRAGMENT_DEFINITION:"FRAGMENT_DEFINITION",FRAGMENT_SPREAD:"FRAGMENT_SPREAD",INLINE_FRAGMENT:"INLINE_FRAGMENT",VARIABLE_DEFINITION:"VARIABLE_DEFINITION",SCHEMA:"SCHEMA",SCALAR:"SCALAR",OBJECT:"OBJECT",FIELD_DEFINITION:"FIELD_DEFINITION",ARGUMENT_DEFINITION:"ARGUMENT_DEFINITION",INTERFACE:"INTERFACE",UNION:"UNION",ENUM:"ENUM",ENUM_VALUE:"ENUM_VALUE",INPUT_OBJECT:"INPUT_OBJECT",INPUT_FIELD_DEFINITION:"INPUT_FIELD_DEFINITION"});function Tn(e){var t=e.split(/\r\n|[\n\r]/g),n=function(e){for(var t,n=!0,r=!0,i=0,o=null,s=0;s<e.length;++s)switch(e.charCodeAt(s)){case 13:10===e.charCodeAt(s+1)&&++s;case 10:n=!1,r=!0,i=0;break;case 9:case 32:++i;break;default:r&&!n&&(null===o||i<o)&&(o=i),r=!1}return null!==(t=o)&&void 0!==t?t:0}(e);if(0!==n)for(var r=1;r<t.length;r++)t[r]=t[r].slice(n);for(var i=0;i<t.length&&In(t[i]);)++i;for(var o=t.length;o>i&&In(t[o-1]);)--o;return t.slice(i,o).join("\n")}function In(e){for(var t=0;t<e.length;++t)if(" "!==e[t]&&"\t"!==e[t])return!1;return!0}var Nn=function(){function e(e){var t=new fn(mn.SOF,0,0,0,0,null);this.source=e,this.lastToken=t,this.token=t,this.line=1,this.lineStart=0}var t=e.prototype;return t.advance=function(){return this.lastToken=this.token,this.token=this.lookahead()},t.lookahead=function(){var e=this.token;if(e.kind!==mn.EOF)do{var t;e=null!==(t=e.next)&&void 0!==t?t:e.next=_n(this,e)}while(e.kind===mn.COMMENT);return e},e}();function On(e){return isNaN(e)?mn.EOF:e<127?JSON.stringify(String.fromCharCode(e)):'"\\u'.concat(("00"+e.toString(16).toUpperCase()).slice(-4),'"')}function _n(e,t){for(var n=e.source,r=n.body,i=r.length,o=t.end;o<i;){var s=r.charCodeAt(o),a=e.line,c=1+o-e.lineStart;switch(s){case 65279:case 9:case 32:case 44:++o;continue;case 10:++o,++e.line,e.lineStart=o;continue;case 13:10===r.charCodeAt(o+1)?o+=2:++o,++e.line,e.lineStart=o;continue;case 33:return new fn(mn.BANG,o,o+1,a,c,t);case 35:return Pn(n,o,a,c,t);case 36:return new fn(mn.DOLLAR,o,o+1,a,c,t);case 38:return new fn(mn.AMP,o,o+1,a,c,t);case 40:return new fn(mn.PAREN_L,o,o+1,a,c,t);case 41:return new fn(mn.PAREN_R,o,o+1,a,c,t);case 46:if(46===r.charCodeAt(o+1)&&46===r.charCodeAt(o+2))return new fn(mn.SPREAD,o,o+3,a,c,t);break;case 58:return new fn(mn.COLON,o,o+1,a,c,t);case 61:return new fn(mn.EQUALS,o,o+1,a,c,t);case 64:return new fn(mn.AT,o,o+1,a,c,t);case 91:return new fn(mn.BRACKET_L,o,o+1,a,c,t);case 93:return new fn(mn.BRACKET_R,o,o+1,a,c,t);case 123:return new fn(mn.BRACE_L,o,o+1,a,c,t);case 124:return new fn(mn.PIPE,o,o+1,a,c,t);case 125:return new fn(mn.BRACE_R,o,o+1,a,c,t);case 34:return 34===r.charCodeAt(o+1)&&34===r.charCodeAt(o+2)?Mn(n,o,a,c,t,e):Dn(n,o,a,c,t);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return kn(n,o,s,a,c,t);case 65:case 66:case 67:case 68:case 69:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 81:case 82:case 83:case 84:case 85:case 86:case 87:case 88:case 89:case 90:case 95:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:return Ln(n,o,a,c,t)}throw un(n,o,Cn(s))}var u=e.line,l=1+o-e.lineStart;return new fn(mn.EOF,i,i,u,l,t)}function Cn(e){return e<32&&9!==e&&10!==e&&13!==e?"Cannot contain the invalid character ".concat(On(e),"."):39===e?"Unexpected single quote character ('), did you mean to use a double quote (\")?":"Cannot parse the unexpected character ".concat(On(e),".")}function Pn(e,t,n,r,i){var o,s=e.body,a=t;do{o=s.charCodeAt(++a)}while(!isNaN(o)&&(o>31||9===o));return new fn(mn.COMMENT,t,a,n,r,i,s.slice(t+1,a))}function kn(e,t,n,r,i,o){var s=e.body,a=n,c=t,u=!1;if(45===a&&(a=s.charCodeAt(++c)),48===a){if((a=s.charCodeAt(++c))>=48&&a<=57)throw un(e,c,"Invalid number, unexpected digit after 0: ".concat(On(a),"."))}else c=xn(e,c,a),a=s.charCodeAt(c);if(46===a&&(u=!0,a=s.charCodeAt(++c),c=xn(e,c,a),a=s.charCodeAt(c)),69!==a&&101!==a||(u=!0,43!==(a=s.charCodeAt(++c))&&45!==a||(a=s.charCodeAt(++c)),c=xn(e,c,a),a=s.charCodeAt(c)),46===a||function(e){return 95===e||e>=65&&e<=90||e>=97&&e<=122}(a))throw un(e,c,"Invalid number, expected digit but got: ".concat(On(a),"."));return new fn(u?mn.FLOAT:mn.INT,t,c,r,i,o,s.slice(t,c))}function xn(e,t,n){var r=e.body,i=t,o=n;if(o>=48&&o<=57){do{o=r.charCodeAt(++i)}while(o>=48&&o<=57);return i}throw un(e,i,"Invalid number, expected digit but got: ".concat(On(o),"."))}function Dn(e,t,n,r,i){for(var o=e.body,s=t+1,a=s,c=0,u="";s<o.length&&!isNaN(c=o.charCodeAt(s))&&10!==c&&13!==c;){if(34===c)return u+=o.slice(a,s),new fn(mn.STRING,t,s+1,n,r,i,u);if(c<32&&9!==c)throw un(e,s,"Invalid character within String: ".concat(On(c),"."));if(++s,92===c){switch(u+=o.slice(a,s-1),c=o.charCodeAt(s)){case 34:u+='"';break;case 47:u+="/";break;case 92:u+="\\";break;case 98:u+="\b";break;case 102:u+="\f";break;case 110:u+="\n";break;case 114:u+="\r";break;case 116:u+="\t";break;case 117:var l=Rn(o.charCodeAt(s+1),o.charCodeAt(s+2),o.charCodeAt(s+3),o.charCodeAt(s+4));if(l<0){var d=o.slice(s+1,s+5);throw un(e,s,"Invalid character escape sequence: \\u".concat(d,"."))}u+=String.fromCharCode(l),s+=4;break;default:throw un(e,s,"Invalid character escape sequence: \\".concat(String.fromCharCode(c),"."))}a=++s}}throw un(e,s,"Unterminated string.")}function Mn(e,t,n,r,i,o){for(var s=e.body,a=t+3,c=a,u=0,l="";a<s.length&&!isNaN(u=s.charCodeAt(a));){if(34===u&&34===s.charCodeAt(a+1)&&34===s.charCodeAt(a+2))return l+=s.slice(c,a),new fn(mn.BLOCK_STRING,t,a+3,n,r,i,Tn(l));if(u<32&&9!==u&&10!==u&&13!==u)throw un(e,a,"Invalid character within String: ".concat(On(u),"."));10===u?(++a,++o.line,o.lineStart=a):13===u?(10===s.charCodeAt(a+1)?a+=2:++a,++o.line,o.lineStart=a):92===u&&34===s.charCodeAt(a+1)&&34===s.charCodeAt(a+2)&&34===s.charCodeAt(a+3)?(l+=s.slice(c,a)+'"""',c=a+=4):++a}throw un(e,a,"Unterminated string.")}function Rn(e,t,n,r){return Fn(e)<<12|Fn(t)<<8|Fn(n)<<4|Fn(r)}function Fn(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:-1}function Ln(e,t,n,r,i){for(var o=e.body,s=o.length,a=t+1,c=0;a!==s&&!isNaN(c=o.charCodeAt(a))&&(95===c||c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122);)++a;return new fn(mn.NAME,t,a,n,r,i,o.slice(t,a))}function jn(e,t){return new $n(e,t).parseDocument()}var $n=function(){function e(e,t){var n=function(e){return e instanceof En}(e)?e:new En(e);this._lexer=new Nn(n),this._options=t}var t=e.prototype;return t.parseName=function(){var e=this.expectToken(mn.NAME);return{kind:ln.NAME,value:e.value,loc:this.loc(e)}},t.parseDocument=function(){var e=this._lexer.token;return{kind:ln.DOCUMENT,definitions:this.many(mn.SOF,this.parseDefinition,mn.EOF),loc:this.loc(e)}},t.parseDefinition=function(){if(this.peek(mn.NAME))switch(this._lexer.token.value){case"query":case"mutation":case"subscription":return this.parseOperationDefinition();case"fragment":return this.parseFragmentDefinition();case"schema":case"scalar":case"type":case"interface":case"union":case"enum":case"input":case"directive":return this.parseTypeSystemDefinition();case"extend":return this.parseTypeSystemExtension()}else{if(this.peek(mn.BRACE_L))return this.parseOperationDefinition();if(this.peekDescription())return this.parseTypeSystemDefinition()}throw this.unexpected()},t.parseOperationDefinition=function(){var e=this._lexer.token;if(this.peek(mn.BRACE_L))return{kind:ln.OPERATION_DEFINITION,operation:"query",name:void 0,variableDefinitions:[],directives:[],selectionSet:this.parseSelectionSet(),loc:this.loc(e)};var t,n=this.parseOperationType();return this.peek(mn.NAME)&&(t=this.parseName()),{kind:ln.OPERATION_DEFINITION,operation:n,name:t,variableDefinitions:this.parseVariableDefinitions(),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(e)}},t.parseOperationType=function(){var e=this.expectToken(mn.NAME);switch(e.value){case"query":return"query";case"mutation":return"mutation";case"subscription":return"subscription"}throw this.unexpected(e)},t.parseVariableDefinitions=function(){return this.optionalMany(mn.PAREN_L,this.parseVariableDefinition,mn.PAREN_R)},t.parseVariableDefinition=function(){var e=this._lexer.token;return{kind:ln.VARIABLE_DEFINITION,variable:this.parseVariable(),type:(this.expectToken(mn.COLON),this.parseTypeReference()),defaultValue:this.expectOptionalToken(mn.EQUALS)?this.parseValueLiteral(!0):void 0,directives:this.parseDirectives(!0),loc:this.loc(e)}},t.parseVariable=function(){var e=this._lexer.token;return this.expectToken(mn.DOLLAR),{kind:ln.VARIABLE,name:this.parseName(),loc:this.loc(e)}},t.parseSelectionSet=function(){var e=this._lexer.token;return{kind:ln.SELECTION_SET,selections:this.many(mn.BRACE_L,this.parseSelection,mn.BRACE_R),loc:this.loc(e)}},t.parseSelection=function(){return this.peek(mn.SPREAD)?this.parseFragment():this.parseField()},t.parseField=function(){var e,t,n=this._lexer.token,r=this.parseName();return this.expectOptionalToken(mn.COLON)?(e=r,t=this.parseName()):t=r,{kind:ln.FIELD,alias:e,name:t,arguments:this.parseArguments(!1),directives:this.parseDirectives(!1),selectionSet:this.peek(mn.BRACE_L)?this.parseSelectionSet():void 0,loc:this.loc(n)}},t.parseArguments=function(e){var t=e?this.parseConstArgument:this.parseArgument;return this.optionalMany(mn.PAREN_L,t,mn.PAREN_R)},t.parseArgument=function(){var e=this._lexer.token,t=this.parseName();return this.expectToken(mn.COLON),{kind:ln.ARGUMENT,name:t,value:this.parseValueLiteral(!1),loc:this.loc(e)}},t.parseConstArgument=function(){var e=this._lexer.token;return{kind:ln.ARGUMENT,name:this.parseName(),value:(this.expectToken(mn.COLON),this.parseValueLiteral(!0)),loc:this.loc(e)}},t.parseFragment=function(){var e=this._lexer.token;this.expectToken(mn.SPREAD);var t=this.expectOptionalKeyword("on");return!t&&this.peek(mn.NAME)?{kind:ln.FRAGMENT_SPREAD,name:this.parseFragmentName(),directives:this.parseDirectives(!1),loc:this.loc(e)}:{kind:ln.INLINE_FRAGMENT,typeCondition:t?this.parseNamedType():void 0,directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(e)}},t.parseFragmentDefinition=function(){var e,t=this._lexer.token;return this.expectKeyword("fragment"),!0===(null===(e=this._options)||void 0===e?void 0:e.experimentalFragmentVariables)?{kind:ln.FRAGMENT_DEFINITION,name:this.parseFragmentName(),variableDefinitions:this.parseVariableDefinitions(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(t)}:{kind:ln.FRAGMENT_DEFINITION,name:this.parseFragmentName(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(t)}},t.parseFragmentName=function(){if("on"===this._lexer.token.value)throw this.unexpected();return this.parseName()},t.parseValueLiteral=function(e){var t=this._lexer.token;switch(t.kind){case mn.BRACKET_L:return this.parseList(e);case mn.BRACE_L:return this.parseObject(e);case mn.INT:return this._lexer.advance(),{kind:ln.INT,value:t.value,loc:this.loc(t)};case mn.FLOAT:return this._lexer.advance(),{kind:ln.FLOAT,value:t.value,loc:this.loc(t)};case mn.STRING:case mn.BLOCK_STRING:return this.parseStringLiteral();case mn.NAME:switch(this._lexer.advance(),t.value){case"true":return{kind:ln.BOOLEAN,value:!0,loc:this.loc(t)};case"false":return{kind:ln.BOOLEAN,value:!1,loc:this.loc(t)};case"null":return{kind:ln.NULL,loc:this.loc(t)};default:return{kind:ln.ENUM,value:t.value,loc:this.loc(t)}}case mn.DOLLAR:if(!e)return this.parseVariable()}throw this.unexpected()},t.parseStringLiteral=function(){var e=this._lexer.token;return this._lexer.advance(),{kind:ln.STRING,value:e.value,block:e.kind===mn.BLOCK_STRING,loc:this.loc(e)}},t.parseList=function(e){var t=this,n=this._lexer.token;return{kind:ln.LIST,values:this.any(mn.BRACKET_L,(function(){return t.parseValueLiteral(e)}),mn.BRACKET_R),loc:this.loc(n)}},t.parseObject=function(e){var t=this,n=this._lexer.token;return{kind:ln.OBJECT,fields:this.any(mn.BRACE_L,(function(){return t.parseObjectField(e)}),mn.BRACE_R),loc:this.loc(n)}},t.parseObjectField=function(e){var t=this._lexer.token,n=this.parseName();return this.expectToken(mn.COLON),{kind:ln.OBJECT_FIELD,name:n,value:this.parseValueLiteral(e),loc:this.loc(t)}},t.parseDirectives=function(e){for(var t=[];this.peek(mn.AT);)t.push(this.parseDirective(e));return t},t.parseDirective=function(e){var t=this._lexer.token;return this.expectToken(mn.AT),{kind:ln.DIRECTIVE,name:this.parseName(),arguments:this.parseArguments(e),loc:this.loc(t)}},t.parseTypeReference=function(){var e,t=this._lexer.token;return this.expectOptionalToken(mn.BRACKET_L)?(e=this.parseTypeReference(),this.expectToken(mn.BRACKET_R),e={kind:ln.LIST_TYPE,type:e,loc:this.loc(t)}):e=this.parseNamedType(),this.expectOptionalToken(mn.BANG)?{kind:ln.NON_NULL_TYPE,type:e,loc:this.loc(t)}:e},t.parseNamedType=function(){var e=this._lexer.token;return{kind:ln.NAMED_TYPE,name:this.parseName(),loc:this.loc(e)}},t.parseTypeSystemDefinition=function(){var e=this.peekDescription()?this._lexer.lookahead():this._lexer.token;if(e.kind===mn.NAME)switch(e.value){case"schema":return this.parseSchemaDefinition();case"scalar":return this.parseScalarTypeDefinition();case"type":return this.parseObjectTypeDefinition();case"interface":return this.parseInterfaceTypeDefinition();case"union":return this.parseUnionTypeDefinition();case"enum":return this.parseEnumTypeDefinition();case"input":return this.parseInputObjectTypeDefinition();case"directive":return this.parseDirectiveDefinition()}throw this.unexpected(e)},t.peekDescription=function(){return this.peek(mn.STRING)||this.peek(mn.BLOCK_STRING)},t.parseDescription=function(){if(this.peekDescription())return this.parseStringLiteral()},t.parseSchemaDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("schema");var n=this.parseDirectives(!0),r=this.many(mn.BRACE_L,this.parseOperationTypeDefinition,mn.BRACE_R);return{kind:ln.SCHEMA_DEFINITION,description:t,directives:n,operationTypes:r,loc:this.loc(e)}},t.parseOperationTypeDefinition=function(){var e=this._lexer.token,t=this.parseOperationType();this.expectToken(mn.COLON);var n=this.parseNamedType();return{kind:ln.OPERATION_TYPE_DEFINITION,operation:t,type:n,loc:this.loc(e)}},t.parseScalarTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("scalar");var n=this.parseName(),r=this.parseDirectives(!0);return{kind:ln.SCALAR_TYPE_DEFINITION,description:t,name:n,directives:r,loc:this.loc(e)}},t.parseObjectTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("type");var n=this.parseName(),r=this.parseImplementsInterfaces(),i=this.parseDirectives(!0),o=this.parseFieldsDefinition();return{kind:ln.OBJECT_TYPE_DEFINITION,description:t,name:n,interfaces:r,directives:i,fields:o,loc:this.loc(e)}},t.parseImplementsInterfaces=function(){var e;if(!this.expectOptionalKeyword("implements"))return[];if(!0===(null===(e=this._options)||void 0===e?void 0:e.allowLegacySDLImplementsInterfaces)){var t=[];this.expectOptionalToken(mn.AMP);do{t.push(this.parseNamedType())}while(this.expectOptionalToken(mn.AMP)||this.peek(mn.NAME));return t}return this.delimitedMany(mn.AMP,this.parseNamedType)},t.parseFieldsDefinition=function(){var e;return!0===(null===(e=this._options)||void 0===e?void 0:e.allowLegacySDLEmptyFields)&&this.peek(mn.BRACE_L)&&this._lexer.lookahead().kind===mn.BRACE_R?(this._lexer.advance(),this._lexer.advance(),[]):this.optionalMany(mn.BRACE_L,this.parseFieldDefinition,mn.BRACE_R)},t.parseFieldDefinition=function(){var e=this._lexer.token,t=this.parseDescription(),n=this.parseName(),r=this.parseArgumentDefs();this.expectToken(mn.COLON);var i=this.parseTypeReference(),o=this.parseDirectives(!0);return{kind:ln.FIELD_DEFINITION,description:t,name:n,arguments:r,type:i,directives:o,loc:this.loc(e)}},t.parseArgumentDefs=function(){return this.optionalMany(mn.PAREN_L,this.parseInputValueDef,mn.PAREN_R)},t.parseInputValueDef=function(){var e=this._lexer.token,t=this.parseDescription(),n=this.parseName();this.expectToken(mn.COLON);var r,i=this.parseTypeReference();this.expectOptionalToken(mn.EQUALS)&&(r=this.parseValueLiteral(!0));var o=this.parseDirectives(!0);return{kind:ln.INPUT_VALUE_DEFINITION,description:t,name:n,type:i,defaultValue:r,directives:o,loc:this.loc(e)}},t.parseInterfaceTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("interface");var n=this.parseName(),r=this.parseImplementsInterfaces(),i=this.parseDirectives(!0),o=this.parseFieldsDefinition();return{kind:ln.INTERFACE_TYPE_DEFINITION,description:t,name:n,interfaces:r,directives:i,fields:o,loc:this.loc(e)}},t.parseUnionTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("union");var n=this.parseName(),r=this.parseDirectives(!0),i=this.parseUnionMemberTypes();return{kind:ln.UNION_TYPE_DEFINITION,description:t,name:n,directives:r,types:i,loc:this.loc(e)}},t.parseUnionMemberTypes=function(){return this.expectOptionalToken(mn.EQUALS)?this.delimitedMany(mn.PIPE,this.parseNamedType):[]},t.parseEnumTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("enum");var n=this.parseName(),r=this.parseDirectives(!0),i=this.parseEnumValuesDefinition();return{kind:ln.ENUM_TYPE_DEFINITION,description:t,name:n,directives:r,values:i,loc:this.loc(e)}},t.parseEnumValuesDefinition=function(){return this.optionalMany(mn.BRACE_L,this.parseEnumValueDefinition,mn.BRACE_R)},t.parseEnumValueDefinition=function(){var e=this._lexer.token,t=this.parseDescription(),n=this.parseName(),r=this.parseDirectives(!0);return{kind:ln.ENUM_VALUE_DEFINITION,description:t,name:n,directives:r,loc:this.loc(e)}},t.parseInputObjectTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("input");var n=this.parseName(),r=this.parseDirectives(!0),i=this.parseInputFieldsDefinition();return{kind:ln.INPUT_OBJECT_TYPE_DEFINITION,description:t,name:n,directives:r,fields:i,loc:this.loc(e)}},t.parseInputFieldsDefinition=function(){return this.optionalMany(mn.BRACE_L,this.parseInputValueDef,mn.BRACE_R)},t.parseTypeSystemExtension=function(){var e=this._lexer.lookahead();if(e.kind===mn.NAME)switch(e.value){case"schema":return this.parseSchemaExtension();case"scalar":return this.parseScalarTypeExtension();case"type":return this.parseObjectTypeExtension();case"interface":return this.parseInterfaceTypeExtension();case"union":return this.parseUnionTypeExtension();case"enum":return this.parseEnumTypeExtension();case"input":return this.parseInputObjectTypeExtension()}throw this.unexpected(e)},t.parseSchemaExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("schema");var t=this.parseDirectives(!0),n=this.optionalMany(mn.BRACE_L,this.parseOperationTypeDefinition,mn.BRACE_R);if(0===t.length&&0===n.length)throw this.unexpected();return{kind:ln.SCHEMA_EXTENSION,directives:t,operationTypes:n,loc:this.loc(e)}},t.parseScalarTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("scalar");var t=this.parseName(),n=this.parseDirectives(!0);if(0===n.length)throw this.unexpected();return{kind:ln.SCALAR_TYPE_EXTENSION,name:t,directives:n,loc:this.loc(e)}},t.parseObjectTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("type");var t=this.parseName(),n=this.parseImplementsInterfaces(),r=this.parseDirectives(!0),i=this.parseFieldsDefinition();if(0===n.length&&0===r.length&&0===i.length)throw this.unexpected();return{kind:ln.OBJECT_TYPE_EXTENSION,name:t,interfaces:n,directives:r,fields:i,loc:this.loc(e)}},t.parseInterfaceTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("interface");var t=this.parseName(),n=this.parseImplementsInterfaces(),r=this.parseDirectives(!0),i=this.parseFieldsDefinition();if(0===n.length&&0===r.length&&0===i.length)throw this.unexpected();return{kind:ln.INTERFACE_TYPE_EXTENSION,name:t,interfaces:n,directives:r,fields:i,loc:this.loc(e)}},t.parseUnionTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("union");var t=this.parseName(),n=this.parseDirectives(!0),r=this.parseUnionMemberTypes();if(0===n.length&&0===r.length)throw this.unexpected();return{kind:ln.UNION_TYPE_EXTENSION,name:t,directives:n,types:r,loc:this.loc(e)}},t.parseEnumTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("enum");var t=this.parseName(),n=this.parseDirectives(!0),r=this.parseEnumValuesDefinition();if(0===n.length&&0===r.length)throw this.unexpected();return{kind:ln.ENUM_TYPE_EXTENSION,name:t,directives:n,values:r,loc:this.loc(e)}},t.parseInputObjectTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("input");var t=this.parseName(),n=this.parseDirectives(!0),r=this.parseInputFieldsDefinition();if(0===n.length&&0===r.length)throw this.unexpected();return{kind:ln.INPUT_OBJECT_TYPE_EXTENSION,name:t,directives:n,fields:r,loc:this.loc(e)}},t.parseDirectiveDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("directive"),this.expectToken(mn.AT);var n=this.parseName(),r=this.parseArgumentDefs(),i=this.expectOptionalKeyword("repeatable");this.expectKeyword("on");var o=this.parseDirectiveLocations();return{kind:ln.DIRECTIVE_DEFINITION,description:t,name:n,arguments:r,repeatable:i,locations:o,loc:this.loc(e)}},t.parseDirectiveLocations=function(){return this.delimitedMany(mn.PIPE,this.parseDirectiveLocation)},t.parseDirectiveLocation=function(){var e=this._lexer.token,t=this.parseName();if(void 0!==An[t.value])return t;throw this.unexpected(e)},t.loc=function(e){var t;if(!0!==(null===(t=this._options)||void 0===t?void 0:t.noLocation))return new pn(e,this._lexer.lastToken,this._lexer.source)},t.peek=function(e){return this._lexer.token.kind===e},t.expectToken=function(e){var t=this._lexer.token;if(t.kind===e)return this._lexer.advance(),t;throw un(this._lexer.source,t.start,"Expected ".concat(qn(e),", found ").concat(Un(t),"."))},t.expectOptionalToken=function(e){var t=this._lexer.token;if(t.kind===e)return this._lexer.advance(),t},t.expectKeyword=function(e){var t=this._lexer.token;if(t.kind!==mn.NAME||t.value!==e)throw un(this._lexer.source,t.start,'Expected "'.concat(e,'", found ').concat(Un(t),"."));this._lexer.advance()},t.expectOptionalKeyword=function(e){var t=this._lexer.token;return t.kind===mn.NAME&&t.value===e&&(this._lexer.advance(),!0)},t.unexpected=function(e){var t=null!=e?e:this._lexer.token;return un(this._lexer.source,t.start,"Unexpected ".concat(Un(t),"."))},t.any=function(e,t,n){this.expectToken(e);for(var r=[];!this.expectOptionalToken(n);)r.push(t.call(this));return r},t.optionalMany=function(e,t,n){if(this.expectOptionalToken(e)){var r=[];do{r.push(t.call(this))}while(!this.expectOptionalToken(n));return r}return[]},t.many=function(e,t,n){this.expectToken(e);var r=[];do{r.push(t.call(this))}while(!this.expectOptionalToken(n));return r},t.delimitedMany=function(e,t){this.expectOptionalToken(e);var n=[];do{n.push(t.call(this))}while(this.expectOptionalToken(e));return n},e}();function Un(e){var t=e.value;return qn(e.kind)+(null!=t?' "'.concat(t,'"'):"")}function qn(e){return function(e){return e===mn.BANG||e===mn.DOLLAR||e===mn.AMP||e===mn.PAREN_L||e===mn.PAREN_R||e===mn.SPREAD||e===mn.COLON||e===mn.EQUALS||e===mn.AT||e===mn.BRACKET_L||e===mn.BRACKET_R||e===mn.BRACE_L||e===mn.PIPE||e===mn.BRACE_R}(e)?'"'.concat(e,'"'):e}var Bn={Name:[],Document:["definitions"],OperationDefinition:["name","variableDefinitions","directives","selectionSet"],VariableDefinition:["variable","type","defaultValue","directives"],Variable:["name"],SelectionSet:["selections"],Field:["alias","name","arguments","directives","selectionSet"],Argument:["name","value"],FragmentSpread:["name","directives"],InlineFragment:["typeCondition","directives","selectionSet"],FragmentDefinition:["name","variableDefinitions","typeCondition","directives","selectionSet"],IntValue:[],FloatValue:[],StringValue:[],BooleanValue:[],NullValue:[],EnumValue:[],ListValue:["values"],ObjectValue:["fields"],ObjectField:["name","value"],Directive:["name","arguments"],NamedType:["name"],ListType:["type"],NonNullType:["type"],SchemaDefinition:["description","directives","operationTypes"],OperationTypeDefinition:["type"],ScalarTypeDefinition:["description","name","directives"],ObjectTypeDefinition:["description","name","interfaces","directives","fields"],FieldDefinition:["description","name","arguments","type","directives"],InputValueDefinition:["description","name","type","defaultValue","directives"],InterfaceTypeDefinition:["description","name","interfaces","directives","fields"],UnionTypeDefinition:["description","name","directives","types"],EnumTypeDefinition:["description","name","directives","values"],EnumValueDefinition:["description","name","directives"],InputObjectTypeDefinition:["description","name","directives","fields"],DirectiveDefinition:["description","name","arguments","locations"],SchemaExtension:["directives","operationTypes"],ScalarTypeExtension:["name","directives"],ObjectTypeExtension:["name","interfaces","directives","fields"],InterfaceTypeExtension:["name","interfaces","directives","fields"],UnionTypeExtension:["name","directives","types"],EnumTypeExtension:["name","directives","values"],InputObjectTypeExtension:["name","directives","fields"]},Gn=Object.freeze({});function Kn(e,t,n){var r=e[t];if(r){if(!n&&"function"==typeof r)return r;var i=n?r.leave:r.enter;if("function"==typeof i)return i}else{var o=n?e.leave:e.enter;if(o){if("function"==typeof o)return o;var s=o[t];if("function"==typeof s)return s}}}function Wn(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Bn,r=void 0,i=Array.isArray(e),o=[e],s=-1,a=[],c=void 0,u=void 0,l=void 0,d=[],h=[],p=e;do{var f=++s===o.length,y=f&&0!==a.length;if(f){if(u=0===h.length?void 0:d[d.length-1],c=l,l=h.pop(),y){if(i)c=c.slice();else{for(var m={},g=0,v=Object.keys(c);g<v.length;g++){var b=v[g];m[b]=c[b]}c=m}for(var w=0,S=0;S<a.length;S++){var E=a[S][0],A=a[S][1];i&&(E-=w),i&&null===A?(c.splice(E,1),w++):c[E]=A}}s=r.index,o=r.keys,a=r.edits,i=r.inArray,r=r.prev}else{if(u=l?i?s:o[s]:void 0,null==(c=l?l[u]:p))continue;l&&d.push(u)}var T,I=void 0;if(!Array.isArray(c)){if(!yn(c))throw new Error("Invalid AST Node: ".concat(vn(c),"."));var N=Kn(t,c.kind,f);if(N){if((I=N.call(t,c,u,l,d,h))===Gn)break;if(!1===I){if(!f){d.pop();continue}}else if(void 0!==I&&(a.push([u,I]),!f)){if(!yn(I)){d.pop();continue}c=I}}}void 0===I&&y&&a.push([u,c]),f?d.pop():(r={inArray:i,index:s,keys:o,edits:a,prev:r},o=(i=Array.isArray(c))?c:null!==(T=n[c.kind])&&void 0!==T?T:[],s=-1,a=[],l&&h.push(l),l=c)}while(void 0!==r);return 0!==a.length&&(p=a[a.length-1][1]),p}(e,{leave:zn})}var zn={Name:function(e){return e.value},Variable:function(e){return"$"+e.name},Document:function(e){return Hn(e.definitions,"\n\n")+"\n"},OperationDefinition:function(e){var t=e.operation,n=e.name,r=Qn("(",Hn(e.variableDefinitions,", "),")"),i=Hn(e.directives," "),o=e.selectionSet;return n||i||r||"query"!==t?Hn([t,Hn([n,r]),i,o]," "):o},VariableDefinition:function(e){var t=e.variable,n=e.type,r=e.defaultValue,i=e.directives;return t+": "+n+Qn(" = ",r)+Qn(" ",Hn(i," "))},SelectionSet:function(e){return Jn(e.selections)},Field:function(e){var t=e.alias,n=e.name,r=e.arguments,i=e.directives,o=e.selectionSet,s=Qn("",t,": ")+n,a=s+Qn("(",Hn(r,", "),")");return a.length>80&&(a=s+Qn("(\n",Yn(Hn(r,"\n")),"\n)")),Hn([a,Hn(i," "),o]," ")},Argument:function(e){return e.name+": "+e.value},FragmentSpread:function(e){return"..."+e.name+Qn(" ",Hn(e.directives," "))},InlineFragment:function(e){var t=e.typeCondition,n=e.directives,r=e.selectionSet;return Hn(["...",Qn("on ",t),Hn(n," "),r]," ")},FragmentDefinition:function(e){var t=e.name,n=e.typeCondition,r=e.variableDefinitions,i=e.directives,o=e.selectionSet;return"fragment ".concat(t).concat(Qn("(",Hn(r,", "),")")," ")+"on ".concat(n," ").concat(Qn("",Hn(i," ")," "))+o},IntValue:function(e){return e.value},FloatValue:function(e){return e.value},StringValue:function(e,t){var n=e.value;return e.block?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=-1===e.indexOf("\n"),i=" "===e[0]||"\t"===e[0],o='"'===e[e.length-1],s="\\"===e[e.length-1],a=!r||o||s||n,c="";return!a||r&&i||(c+="\n"+t),c+=t?e.replace(/\n/g,"\n"+t):e,a&&(c+="\n"),'"""'+c.replace(/"""/g,'\\"""')+'"""'}(n,"description"===t?"":"  "):JSON.stringify(n)},BooleanValue:function(e){return e.value?"true":"false"},NullValue:function(){return"null"},EnumValue:function(e){return e.value},ListValue:function(e){return"["+Hn(e.values,", ")+"]"},ObjectValue:function(e){return"{"+Hn(e.fields,", ")+"}"},ObjectField:function(e){return e.name+": "+e.value},Directive:function(e){return"@"+e.name+Qn("(",Hn(e.arguments,", "),")")},NamedType:function(e){return e.name},ListType:function(e){return"["+e.type+"]"},NonNullType:function(e){return e.type+"!"},SchemaDefinition:Vn((function(e){var t=e.directives,n=e.operationTypes;return Hn(["schema",Hn(t," "),Jn(n)]," ")})),OperationTypeDefinition:function(e){return e.operation+": "+e.type},ScalarTypeDefinition:Vn((function(e){return Hn(["scalar",e.name,Hn(e.directives," ")]," ")})),ObjectTypeDefinition:Vn((function(e){var t=e.name,n=e.interfaces,r=e.directives,i=e.fields;return Hn(["type",t,Qn("implements ",Hn(n," & ")),Hn(r," "),Jn(i)]," ")})),FieldDefinition:Vn((function(e){var t=e.name,n=e.arguments,r=e.type,i=e.directives;return t+(Zn(n)?Qn("(\n",Yn(Hn(n,"\n")),"\n)"):Qn("(",Hn(n,", "),")"))+": "+r+Qn(" ",Hn(i," "))})),InputValueDefinition:Vn((function(e){var t=e.name,n=e.type,r=e.defaultValue,i=e.directives;return Hn([t+": "+n,Qn("= ",r),Hn(i," ")]," ")})),InterfaceTypeDefinition:Vn((function(e){var t=e.name,n=e.interfaces,r=e.directives,i=e.fields;return Hn(["interface",t,Qn("implements ",Hn(n," & ")),Hn(r," "),Jn(i)]," ")})),UnionTypeDefinition:Vn((function(e){var t=e.name,n=e.directives,r=e.types;return Hn(["union",t,Hn(n," "),r&&0!==r.length?"= "+Hn(r," | "):""]," ")})),EnumTypeDefinition:Vn((function(e){var t=e.name,n=e.directives,r=e.values;return Hn(["enum",t,Hn(n," "),Jn(r)]," ")})),EnumValueDefinition:Vn((function(e){return Hn([e.name,Hn(e.directives," ")]," ")})),InputObjectTypeDefinition:Vn((function(e){var t=e.name,n=e.directives,r=e.fields;return Hn(["input",t,Hn(n," "),Jn(r)]," ")})),DirectiveDefinition:Vn((function(e){var t=e.name,n=e.arguments,r=e.repeatable,i=e.locations;return"directive @"+t+(Zn(n)?Qn("(\n",Yn(Hn(n,"\n")),"\n)"):Qn("(",Hn(n,", "),")"))+(r?" repeatable":"")+" on "+Hn(i," | ")})),SchemaExtension:function(e){var t=e.directives,n=e.operationTypes;return Hn(["extend schema",Hn(t," "),Jn(n)]," ")},ScalarTypeExtension:function(e){return Hn(["extend scalar",e.name,Hn(e.directives," ")]," ")},ObjectTypeExtension:function(e){var t=e.name,n=e.interfaces,r=e.directives,i=e.fields;return Hn(["extend type",t,Qn("implements ",Hn(n," & ")),Hn(r," "),Jn(i)]," ")},InterfaceTypeExtension:function(e){var t=e.name,n=e.interfaces,r=e.directives,i=e.fields;return Hn(["extend interface",t,Qn("implements ",Hn(n," & ")),Hn(r," "),Jn(i)]," ")},UnionTypeExtension:function(e){var t=e.name,n=e.directives,r=e.types;return Hn(["extend union",t,Hn(n," "),r&&0!==r.length?"= "+Hn(r," | "):""]," ")},EnumTypeExtension:function(e){var t=e.name,n=e.directives,r=e.values;return Hn(["extend enum",t,Hn(n," "),Jn(r)]," ")},InputObjectTypeExtension:function(e){var t=e.name,n=e.directives,r=e.fields;return Hn(["extend input",t,Hn(n," "),Jn(r)]," ")}};function Vn(e){return function(t){return Hn([t.description,e(t)],"\n")}}function Hn(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return null!==(t=null==e?void 0:e.filter((function(e){return e})).join(n))&&void 0!==t?t:""}function Jn(e){return Qn("{\n",Yn(Hn(e,"\n")),"\n}")}function Qn(e,t){return null!=t&&""!==t?e+t+(arguments.length>2&&void 0!==arguments[2]?arguments[2]:""):""}function Yn(e){return Qn("  ",e.replace(/\n/g,"\n  "))}function Xn(e){return-1!==e.indexOf("\n")}function Zn(e){return null!=e&&e.some(Xn)}var er=function(e,t){return er=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},er(e,t)};function tr(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}er(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function nr(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function rr(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function ir(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function or(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function sr(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function ar(e){return this instanceof ar?(this.v=e,this):new ar(e)}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var cr=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function ur(e){return"function"==typeof e}function lr(e){return ur(null==e?void 0:e.then)}function dr(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var hr=dr((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function pr(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var fr=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,n,r,i;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var s=ir(o),a=s.next();!a.done;a=s.next())a.value.remove(this)}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else o.remove(this);var c=this.initialTeardown;if(ur(c))try{c()}catch(e){i=e instanceof hr?e.errors:[e]}var u=this._finalizers;if(u){this._finalizers=null;try{for(var l=ir(u),d=l.next();!d.done;d=l.next()){var h=d.value;try{gr(h)}catch(e){i=null!=i?i:[],e instanceof hr?i=sr(sr([],or(i)),or(e.errors)):i.push(e)}}}catch(e){n={error:e}}finally{try{d&&!d.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}}if(i)throw new hr(i)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)gr(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&pr(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&pr(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}(),yr=fr.EMPTY;function mr(e){return e instanceof fr||e&&"closed"in e&&ur(e.remove)&&ur(e.add)&&ur(e.unsubscribe)}function gr(e){ur(e)?e():e.unsubscribe()}var vr=null,br=null,wr=void 0,Sr=!1,Er=!1,Ar={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=Ar.delegate;return(null==i?void 0:i.setTimeout)?i.setTimeout.apply(i,sr([e,t],or(n))):setTimeout.apply(void 0,sr([e,t],or(n)))},clearTimeout:function(e){var t=Ar.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function Tr(e){Ar.setTimeout((function(){if(!vr)throw e;vr(e)}))}function Ir(){}var Nr=Or("C",void 0,void 0);function Or(e,t,n){return{kind:e,value:t,error:n}}var _r=null;function Cr(e){if(Sr){var t=!_r;if(t&&(_r={errorThrown:!1,error:null}),e(),t){var n=_r,r=n.errorThrown,i=n.error;if(_r=null,r)throw i}}else e()}var Pr=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,mr(t)&&t.add(n)):n.destination=Lr,n}return tr(t,e),t.create=function(e,t,n){return new Mr(e,t,n)},t.prototype.next=function(e){this.isStopped?Fr(function(e){return Or("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?Fr(Or("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?Fr(Nr,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(fr),kr=Function.prototype.bind;function xr(e,t){return kr.call(e,t)}var Dr=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){Rr(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){Rr(e)}else Rr(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){Rr(e)}},e}(),Mr=function(e){function t(t,n,r){var i,o,s=e.call(this)||this;return ur(t)||!t?i={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:s&&Er?((o=Object.create(t)).unsubscribe=function(){return s.unsubscribe()},i={next:t.next&&xr(t.next,o),error:t.error&&xr(t.error,o),complete:t.complete&&xr(t.complete,o)}):i=t,s.destination=new Dr(i),s}return tr(t,e),t}(Pr);function Rr(e){var t;Sr?(t=e,Sr&&_r&&(_r.errorThrown=!0,_r.error=t)):Tr(e)}function Fr(e,t){var n=br;n&&Ar.setTimeout((function(){return n(e,t)}))}var Lr={closed:!0,next:Ir,error:function(e){throw e},complete:Ir},jr="function"==typeof Symbol&&Symbol.observable||"@@observable";function $r(e){return e}var Ur=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r,i=this,o=(r=e)&&r instanceof Pr||function(e){return e&&ur(e.next)&&ur(e.error)&&ur(e.complete)}(r)&&mr(r)?e:new Mr(e,t,n);return Cr((function(){var e=i,t=e.operator,n=e.source;o.add(t?t.call(o,n):n?i._subscribe(o):i._trySubscribe(o))})),o},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=qr(t))((function(t,r){var i=new Mr({next:function(t){try{e(t)}catch(e){r(e),i.unsubscribe()}},error:r,complete:t});n.subscribe(i)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[jr]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0===(n=e).length?$r:1===n.length?n[0]:function(e){return n.reduce((function(e,t){return t(e)}),e)})(this);var n},e.prototype.toPromise=function(e){var t=this;return new(e=qr(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function qr(e){var t;return null!==(t=null!=e?e:wr)&&void 0!==t?t:Promise}function Br(e){return ur(e[jr])}function Gr(e){return Symbol.asyncIterator&&ur(null==e?void 0:e[Symbol.asyncIterator])}function Kr(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var Wr="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function zr(e){return ur(null==e?void 0:e[Wr])}function Vr(e){return function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),o=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",(function(e){return function(t){return Promise.resolve(t).then(e,u)}})),r[Symbol.asyncIterator]=function(){return this},r;function s(e,t){i[e]&&(r[e]=function(t){return new Promise((function(n,r){o.push([e,t,n,r])>1||a(e,t)}))},t&&(r[e]=t(r[e])))}function a(e,t){try{!function(e){e.value instanceof ar?Promise.resolve(e.value.v).then(c,u):l(o[0][2],e)}(i[e](t))}catch(e){l(o[0][3],e)}}function c(e){a("next",e)}function u(e){a("throw",e)}function l(e,t){e(t),o.shift(),o.length&&a(o[0][0],o[0][1])}}(this,arguments,(function(){var t,n,r;return rr(this,(function(i){switch(i.label){case 0:t=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,ar(t.read())];case 3:return n=i.sent(),r=n.value,n.done?[4,ar(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,ar(r)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function Hr(e){return ur(null==e?void 0:e.getReader)}function Jr(e){if(e instanceof Ur)return e;if(null!=e){if(Br(e))return i=e,new Ur((function(e){var t=i[jr]();if(ur(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(cr(e))return r=e,new Ur((function(e){for(var t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()}));if(lr(e))return n=e,new Ur((function(e){n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,Tr)}));if(Gr(e))return Qr(e);if(zr(e))return t=e,new Ur((function(e){var n,r;try{for(var i=ir(t),o=i.next();!o.done;o=i.next()){var s=o.value;if(e.next(s),e.closed)return}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()}));if(Hr(e))return Qr(Vr(e))}var t,n,r,i;throw Kr(e)}function Qr(e){return new Ur((function(t){(function(e,t){var n,r,i,o;return nr(this,void 0,void 0,(function(){var s,a;return rr(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=ir(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,i,(t=e[n](t)).done,t.value)}))}}}(e),c.label=1;case 1:return[4,n.next()];case 2:if((r=c.sent()).done)return[3,4];if(s=r.value,t.next(s),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(o=n.return)?[4,o.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function Yr(e,t,n,r,i){return new hi(e,t,n,r,i)}var Xr,Zr,ei,ti,ni,ri,ii,oi,si,ai,ci,ui,li,di,hi=function(e){function t(t,n,r,i,o,s){var a=e.call(this,t)||this;return a.onFinalize=o,a.shouldUnsubscribe=s,a._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,a._error=i?function(e){try{i(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return tr(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(Pr);function pi(e){return function(t){if(function(e){return ur(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function fi(e){return pi((function(t,n){var r,i=null,o=!1;i=t.subscribe(Yr(n,void 0,void 0,(function(s){r=Jr(e(s,fi(e)(t))),i?(i.unsubscribe(),i=null,r.subscribe(n)):o=!0}))),o&&(i.unsubscribe(),i=null,r.subscribe(n))}))}!function(e){e.WebUnknown="0",e.React="1",e.NextJs="2",e.Angular="3",e.VueJs="4",e.Nuxt="5",e.Svelte="6",e.ServerSideUnknown="100",e.ReactSSR="101",e.NextJsSSR="102",e.AngularSSR="103",e.VueJsSSR="104",e.NuxtSSR="105",e.SvelteSSR="106",e.ReactNative="201",e.Expo="202"}(Xr||(Xr={})),function(e){e.AI="ai",e.API="api",e.Auth="auth",e.Analytics="analytics",e.DataStore="datastore",e.Geo="geo",e.InAppMessaging="inappmessaging",e.Interactions="interactions",e.Predictions="predictions",e.PubSub="pubsub",e.PushNotification="pushnotification",e.Storage="storage"}(Zr||(Zr={})),function(e){e.CreateConversation="1",e.GetConversation="2",e.ListConversations="3",e.DeleteConversation="4",e.SendMessage="5",e.ListMessages="6",e.OnMessage="7",e.Generation="8",e.UpdateConversation="9"}(ei||(ei={})),function(e){e.Record="1",e.IdentifyUser="2"}(ti||(ti={})),function(e){e.GraphQl="1",e.Get="2",e.Post="3",e.Put="4",e.Patch="5",e.Del="6",e.Head="7"}(ni||(ni={})),function(e){e.SignUp="1",e.ConfirmSignUp="2",e.ResendSignUpCode="3",e.SignIn="4",e.FetchMFAPreference="6",e.UpdateMFAPreference="7",e.SetUpTOTP="10",e.VerifyTOTPSetup="11",e.ConfirmSignIn="12",e.DeleteUserAttributes="15",e.DeleteUser="16",e.UpdateUserAttributes="17",e.FetchUserAttributes="18",e.ConfirmUserAttribute="22",e.SignOut="26",e.UpdatePassword="27",e.ResetPassword="28",e.ConfirmResetPassword="29",e.FederatedSignIn="30",e.RememberDevice="32",e.ForgetDevice="33",e.FetchDevices="34",e.SendUserAttributeVerificationCode="35",e.SignInWithRedirect="36",e.StartWebAuthnRegistration="37",e.CompleteWebAuthnRegistration="38",e.ListWebAuthnCredentials="39",e.DeleteWebAuthnCredential="40"}(ri||(ri={})),function(e){e.Subscribe="1",e.GraphQl="2"}(ii||(ii={})),function(e){e.SearchByText="0",e.SearchByCoordinates="1",e.SearchForSuggestions="2",e.SearchByPlaceId="3",e.SaveGeofences="4",e.GetGeofence="5",e.ListGeofences="6",e.DeleteGeofences="7"}(oi||(oi={})),function(e){e.SyncMessages="1",e.IdentifyUser="2",e.NotifyMessageInteraction="3"}(si||(si={})),function(e){e.None="0"}(ai||(ai={})),function(e){e.Convert="1",e.Identify="2",e.Interpret="3"}(ci||(ci={})),function(e){e.Subscribe="1"}(ui||(ui={})),function(e){e.InitializePushNotifications="1",e.IdentifyUser="2"}(li||(li={})),function(e){e.UploadData="1",e.DownloadData="2",e.List="3",e.Copy="4",e.Remove="5",e.GetProperties="6",e.GetUrl="7",e.GetDataAccess="8",e.ListCallerAccessGrants="9"}(di||(di={}));const yi="6.10.2",mi=()=>"undefined"!=typeof global,gi=()=>"undefined"!=typeof window,vi=()=>"undefined"!=typeof document,bi=()=>"undefined"!=typeof process,wi=(e,t)=>!!Object.keys(e).find((e=>e.startsWith(t))),Si=[{platform:Xr.Expo,detectionMethod:function(){return mi()&&void 0!==global.expo}},{platform:Xr.ReactNative,detectionMethod:function(){return"undefined"!=typeof navigator&&void 0!==navigator.product&&"ReactNative"===navigator.product}},{platform:Xr.NextJs,detectionMethod:function(){return gi()&&window.next&&"object"==typeof window.next}},{platform:Xr.Nuxt,detectionMethod:function(){return gi()&&(void 0!==window.__NUXT__||void 0!==window.$nuxt)}},{platform:Xr.Angular,detectionMethod:function(){const e=Boolean(vi()&&document.querySelector("[ng-version]")),t=Boolean(gi()&&void 0!==window.ng);return e||t}},{platform:Xr.React,detectionMethod:function(){const e=e=>e.startsWith("_react")||e.startsWith("__react");return vi()&&Array.from(document.querySelectorAll("[id]")).some((t=>Object.keys(t).find(e)))}},{platform:Xr.VueJs,detectionMethod:function(){return gi()&&wi(window,"__VUE")}},{platform:Xr.Svelte,detectionMethod:function(){return gi()&&wi(window,"__SVELTE")}},{platform:Xr.WebUnknown,detectionMethod:function(){return gi()}},{platform:Xr.NextJsSSR,detectionMethod:function(){return mi()&&(wi(global,"__next")||wi(global,"__NEXT"))}},{platform:Xr.NuxtSSR,detectionMethod:function(){return mi()&&void 0!==global.__NUXT_PATHS__}},{platform:Xr.ReactSSR,detectionMethod:function(){return bi()&&void 0!==process.env&&!!Object.keys(process.env).find((e=>e.includes("react")))}},{platform:Xr.VueJsSSR,detectionMethod:function(){return mi()&&wi(global,"__VUE")}},{platform:Xr.AngularSSR,detectionMethod:function(){return bi()&&"object"==typeof process.env&&process.env.npm_lifecycle_script?.startsWith("ng ")||!1}},{platform:Xr.SvelteSSR,detectionMethod:function(){return bi()&&void 0!==process.env&&!!Object.keys(process.env).find((e=>e.includes("svelte")))}}];let Ei;const Ai=[];let Ti=!1;const Ii=()=>{if(!Ei){if(Ei=Si.find((e=>e.detectionMethod()))?.platform||Xr.ServerSideUnknown,Ti)for(;Ai.length;)Ai.pop()?.();else Ai.forEach((e=>{e()}));Ni(Xr.ServerSideUnknown,10),Ni(Xr.WebUnknown,10)}return Ei};function Ni(e,t){Ei!==e||Ti||setTimeout((()=>{Ei=void 0,Ti=!0,setTimeout(Ii,1e3)}),t)}const Oi={},_i="aws-amplify",Ci=e=>e.replace(/\+.*/,"");new class{constructor(){this.userAgent=`${_i}/${Ci(yi)}`}get framework(){return Ii()}get isReactNative(){return this.framework===Xr.ReactNative||this.framework===Xr.Expo}observeFrameworkChanges(e){(e=>{Ti||Ai.push(e)})(e)}};const Pi=e=>(({category:e,action:t}={})=>{const n=[[_i,Ci(yi)]];if(e&&n.push([e,t]),n.push(["framework",Ii()]),e&&t){const r=((e,t)=>Oi[e]?.[t]?.additionalDetails)(e,t);r&&r.forEach((e=>{n.push(e)}))}return n})(e).map((([e,t])=>e&&t?`${e}/${t}`:e)).join(" ");class ki extends g{get response(){return this._response?xi(this._response):void 0}constructor(e){super(e),this.constructor=ki,Object.setPrototypeOf(this,ki.prototype),e.response&&(this._response=e.response)}}const xi=e=>({...e,headers:{...e.headers}});class Di extends ki{constructor(e){super(e),this.constructor=Di,Object.setPrototypeOf(this,Di.prototype)}}class Mi extends Di{constructor(e={}){super({name:"CanceledError",message:"Request is canceled by user",...e}),this.constructor=Mi,Object.setPrototypeOf(this,Mi.prototype)}}const Ri=e=>!!e&&e instanceof Mi;var Fi;(Fi||(Fi={})).InvalidApiName="InvalidApiName",Fi.InvalidApiName;const Li=e=>{const{headers:t,statusCode:n}=e;return{...ji(e)?e.$metadata:{},httpStatusCode:n,requestId:t["x-amzn-requestid"]??t["x-amzn-request-id"]??t["x-amz-request-id"],extendedRequestId:t["x-amz-id-2"],cfId:t["x-amz-cf-id"]}},ji=e=>"object"==typeof e?.$metadata,$i=async e=>{if(!e)return;const t=await(async e=>{if(!e||e.statusCode<300)return;const t=await(async e=>{if(!e.body)throw new Error("Missing response payload");const t=await e.body.json();return Object.assign(t,{$metadata:Li(e)})})(e),n=(e=>{const[t]=e.toString().split(/[,:]+/);return t.includes("#")?t.split("#")[1]:t})(e.headers["x-amzn-errortype"]??t.code??t.__type??"UnknownError"),r=t.message??t.Message??"Unknown error",i=new Error(r);return Object.assign(i,{name:n,$metadata:Li(e)})})(Ui(e));if(t){const n=await(e.body?.text());return qi(t,{statusCode:e.statusCode,headers:e.headers,body:n})}},Ui=e=>{let t;const n=new Proxy(e.body,{get:(e,n,r)=>"json"===n?async()=>{t||(t=e.text());try{return JSON.parse(await t)}catch(e){return{}}}:"text"===n?async()=>(t||(t=e.text()),t):Reflect.get(e,n,r)});return new Proxy(e,{get:(e,t,r)=>"body"===t?n:Reflect.get(e,t,r)})},qi=(e,t)=>{const n=new Di({name:e?.name,message:e.message,underlyingError:e,response:t});return Object.assign(n,{$metadata:e.$metadata})},Bi="x-amz-user-agent";var Gi;!function(e){e.DEBUG="DEBUG",e.ERROR="ERROR",e.INFO="INFO",e.WARN="WARN",e.VERBOSE="VERBOSE",e.NONE="NONE"}(Gi||(Gi={}));const Ki={VERBOSE:1,DEBUG:2,INFO:3,WARN:4,ERROR:5,NONE:6};class Wi{constructor(e,t=Gi.WARN){this.name=e,this.level=t,this._pluggables=[]}_padding(e){return e<10?"0"+e:""+e}_ts(){const e=new Date;return[this._padding(e.getMinutes()),this._padding(e.getSeconds())].join(":")+"."+e.getMilliseconds()}configure(e){return e?(this._config=e,this._config):this._config}_log(e,...t){let n=this.level;if(Wi.LOG_LEVEL&&(n=Wi.LOG_LEVEL),"undefined"!=typeof window&&window.LOG_LEVEL&&(n=window.LOG_LEVEL),!(Ki[e]>=Ki[n]))return;let r=console.log.bind(console);e===Gi.ERROR&&console.error&&(r=console.error.bind(console)),e===Gi.WARN&&console.warn&&(r=console.warn.bind(console)),Wi.BIND_ALL_LOG_LEVELS&&(e===Gi.INFO&&console.info&&(r=console.info.bind(console)),e===Gi.DEBUG&&console.debug&&(r=console.debug.bind(console)));const i=`[${e}] ${this._ts()} ${this.name}`;let o="";if(1===t.length&&"string"==typeof t[0])o=`${i} - ${t[0]}`,r(o);else if(1===t.length)o=`${i} ${t[0]}`,r(i,t[0]);else if("string"==typeof t[0]){let e=t.slice(1);1===e.length&&(e=e[0]),o=`${i} - ${t[0]} ${e}`,r(`${i} - ${t[0]}`,e)}else o=`${i} ${t}`,r(i,t);for(const e of this._pluggables){const t={message:o,timestamp:Date.now()};e.pushLogs([t])}}log(...e){this._log(Gi.INFO,...e)}info(...e){this._log(Gi.INFO,...e)}warn(...e){this._log(Gi.WARN,...e)}error(...e){this._log(Gi.ERROR,...e)}debug(...e){this._log(Gi.DEBUG,...e)}verbose(...e){this._log(Gi.VERBOSE,...e)}addPluggable(e){e&&"Logging"===e.getCategoryName()&&(this._pluggables.push(e),e.configure(this._config))}listPluggables(){return this._pluggables}}Wi.LOG_LEVEL=null,Wi.BIND_ALL_LOG_LEVELS=!1;const zi=new Wi("RestApis");var Vi;!function(e){e.NoEndpointId="NoEndpointId",e.PlatformNotSupported="PlatformNotSupported",e.Unknown="Unknown",e.NetworkError="NetworkError"}(Vi||(Vi={}));const Hi=["AuthFailure","InvalidSignatureException","RequestExpired","RequestInTheFuture","RequestTimeTooSkewed","SignatureDoesNotMatch","BadRequestException"],Ji=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException"],Qi=["TimeoutError","RequestTimeout","RequestTimeoutException"],Yi=(e,t)=>429===e||!!t&&Ji.includes(t),Xi=e=>[Vi.NetworkError,"ERR_NETWORK"].includes(e?.name),Zi=(e,t)=>!!e&&[500,502,503,504].includes(e)||!!t&&Qi.includes(t);function eo(e=3e5){return t=>{const n=2**t*100+100*Math.random();return!(n>e)&&n}}const to=3e5,no=e=>{const t=eo(to)(e);return!1===t?to:t},ro=({maxAttempts:e=3,retryDecider:t,computeDelay:n,abortSignal:r})=>{if(e<1)throw new Error("maxAttempts must be greater than 0");return(i,o)=>async function(s){let a,c,u=o.attemptsCount??0;const l=()=>{if(c)return oo(c,u),c;throw oo(a,u),a};for(;!r?.aborted&&u<e;){try{c=await i(s),a=void 0}catch(e){a=e,c=void 0}u=(o.attemptsCount??0)>u?o.attemptsCount??0:u+1,o.attemptsCount=u;const{isCredentialsExpiredError:d,retryable:h}=await t(c,a,o);if(!h)return l();if(o.isCredentialsExpired=!!d,!r?.aborted&&u<e){const e=n(u);await io(e,r)}}if(r?.aborted)throw new Error("Request aborted.");return l()}},io=(e,t)=>{if(t?.aborted)return Promise.resolve();let n,r;const i=new Promise((t=>{r=t,n=setTimeout(t,e)}));return t?.addEventListener("abort",(function e(i){clearTimeout(n),t?.removeEventListener("abort",e),r()})),i},oo=(e,t)=>{"[object Object]"===Object.prototype.toString.call(e)&&(e.$metadata={...e.$metadata??{},attempts:t})},so=e=>Object.keys(e).map((e=>e.toLowerCase())).sort().join(";"),ao="X-Amz-Date".toLowerCase(),co="X-Amz-Security-Token".toLowerCase(),uo="aws4_request",lo="AWS4-HMAC-SHA256";var ho=64,po=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),fo=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],yo=Math.pow(2,53)-1,mo=function(){function e(){this.state=Int32Array.from(fo),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return e.prototype.update=function(e){if(this.finished)throw new Error("Attempted to update an already finished hash.");var t=0,n=e.byteLength;if(this.bytesHashed+=n,8*this.bytesHashed>yo)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;n>0;)this.buffer[this.bufferLength++]=e[t++],n--,this.bufferLength===ho&&(this.hashBuffer(),this.bufferLength=0)},e.prototype.digest=function(){if(!this.finished){var e=8*this.bytesHashed,t=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),n=this.bufferLength;if(t.setUint8(this.bufferLength++,128),n%ho>=56){for(var r=this.bufferLength;r<ho;r++)t.setUint8(r,0);this.hashBuffer(),this.bufferLength=0}for(r=this.bufferLength;r<56;r++)t.setUint8(r,0);t.setUint32(56,Math.floor(e/4294967296),!0),t.setUint32(60,e),this.hashBuffer(),this.finished=!0}var i=new Uint8Array(32);for(r=0;r<8;r++)i[4*r]=this.state[r]>>>24&255,i[4*r+1]=this.state[r]>>>16&255,i[4*r+2]=this.state[r]>>>8&255,i[4*r+3]=this.state[r]>>>0&255;return i},e.prototype.hashBuffer=function(){for(var e=this.buffer,t=this.state,n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],c=t[6],u=t[7],l=0;l<ho;l++){if(l<16)this.temp[l]=(255&e[4*l])<<24|(255&e[4*l+1])<<16|(255&e[4*l+2])<<8|255&e[4*l+3];else{var d=this.temp[l-2],h=(d>>>17|d<<15)^(d>>>19|d<<13)^d>>>10,p=((d=this.temp[l-15])>>>7|d<<25)^(d>>>18|d<<14)^d>>>3;this.temp[l]=(h+this.temp[l-7]|0)+(p+this.temp[l-16]|0)}var f=(((s>>>6|s<<26)^(s>>>11|s<<21)^(s>>>25|s<<7))+(s&a^~s&c)|0)+(u+(po[l]+this.temp[l]|0)|0)|0,y=((n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10))+(n&r^n&i^r&i)|0;u=c,c=a,a=s,s=o+f|0,o=i,i=r,r=n,n=f+y|0}t[0]+=n,t[1]+=r,t[2]+=i,t[3]+=o,t[4]+=s,t[5]+=a,t[6]+=c,t[7]+=u},e}(),go="undefined"!=typeof Buffer&&Buffer.from?function(e){return Buffer.from(e,"utf8")}:e=>(new TextEncoder).encode(e);function vo(e){return e instanceof Uint8Array?e:"string"==typeof e?go(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(e)}var bo=function(){function e(e){this.secret=e,this.hash=new mo,this.reset()}return e.prototype.update=function(e){var t;if(("string"==typeof(t=e)?0!==t.length:0!==t.byteLength)&&!this.error)try{this.hash.update(vo(e))}catch(e){this.error=e}},e.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},e.prototype.digest=function(){return nr(this,void 0,void 0,(function(){return rr(this,(function(e){return[2,this.digestSync()]}))}))},e.prototype.reset=function(){if(this.hash=new mo,this.secret){this.outer=new mo;var e=function(e){var t=vo(e);if(t.byteLength>ho){var n=new mo;n.update(t),t=n.digest()}var r=new Uint8Array(ho);return r.set(t),r}(this.secret),t=new Uint8Array(ho);t.set(e);for(var n=0;n<ho;n++)e[n]^=54,t[n]^=92;for(this.hash.update(e),this.outer.update(t),n=0;n<e.byteLength;n++)e[n]=0}},e}();const wo={},So={};for(let e=0;e<256;e++){let t=e.toString(16).toLowerCase();1===t.length&&(t=`0${t}`),wo[e]=t,So[t]=e}const Eo=(e,t)=>{const n=new bo(e??void 0);return n.update(t),n.digestSync()},Ao=(e,t)=>function(e){let t="";for(let n=0;n<e.byteLength;n++)t+=wo[e[n]];return t}(Eo(e,t)),To=e=>Object.entries(e).map((([e,t])=>({key:e.toLowerCase(),value:t?.trim().replace(/\s+/g," ")??""}))).sort(((e,t)=>e.key<t.key?-1:1)).map((e=>`${e.key}:${e.value}\n`)).join(""),Io=e=>encodeURIComponent(e).replace(/[!'()*]/g,No),No=e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`,Oo=(e,t=!0)=>e?t?encodeURIComponent(e).replace(/%2F/g,"/"):e:"/",_o=e=>null==e?"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855":Co(e)?Ao(null,e):"UNSIGNED-PAYLOAD",Co=e=>"string"==typeof e||ArrayBuffer.isView(e)||Po(e),Po=e=>"function"==typeof ArrayBuffer&&e instanceof ArrayBuffer||"[object ArrayBuffer]"===Object.prototype.toString.call(e),ko=(e,t)=>{const n=(({credentials:e,signingDate:t=new Date,signingRegion:n,signingService:r,uriEscapePath:i=!0})=>{const{accessKeyId:o,secretAccessKey:s,sessionToken:a}=e,{longDate:c,shortDate:u}=(e=>{const t=e.toISOString().replace(/[:-]|\.\d{3}/g,"");return{longDate:t,shortDate:t.slice(0,8)}})(t);return{accessKeyId:o,credentialScope:`${u}/${n}/${r}/${uo}`,longDate:c,secretAccessKey:s,sessionToken:a,shortDate:u,signingRegion:n,signingService:r,uriEscapePath:i}})(t),{accessKeyId:r,credentialScope:i,longDate:o,sessionToken:s}=n,a={...e.headers};a.host=e.url.host,a[ao]=o,s&&(a[co]=s);const c={...e,headers:a},u=((e,{credentialScope:t,longDate:n,secretAccessKey:r,shortDate:i,signingRegion:o,signingService:s,uriEscapePath:a})=>{const c=(({body:e,headers:t,method:n,url:r},i=!0)=>{return[n,Oo(r.pathname,i),(o=r.searchParams,Array.from(o).sort((([e,t],[n,r])=>e===n?t<r?-1:1:e<n?-1:1)).map((([e,t])=>`${Io(e)}=${Io(t)}`)).join("&")),To(t),so(t),_o(e)].join("\n");var o})(e,a),u=((e,t,n)=>[lo,e,t,n].join("\n"))(n,t,Ao(null,c)),l=Ao(((e,t,n,r)=>{const i=Eo(`AWS4${e}`,t),o=Eo(i,n),s=Eo(o,r);return Eo(s,uo)})(r,i,o,s),u);return l})(c,n),l=`Credential=${r}/${i}`,d=`SignedHeaders=${so(a)}`,h=`Signature=${u}`;return a.authorization=`${lo} ${l}, ${d}, ${h}`,c},xo=e=>new Date(Date.now()+e),Do=({userAgentHeader:e="x-amz-user-agent",userAgentValue:t=""})=>n=>async function(r){if(0===t.trim().length)return await n(r);{const i=e.toLowerCase();return r.headers[i]=r.headers[i]?`${r.headers[i]} ${t}`:t,await n(r)}},Mo=(e,t)=>(n,r)=>{const i={};let o=t=>e(t,r);for(let e=t.length-1;e>=0;e--)o=(0,t[e])(r)(o,i);return o(n)},Ro=e=>{let t;return()=>(t||(t=e()),t)},Fo=e=>!["HEAD","GET","DELETE"].includes(e.toUpperCase()),Lo=async({url:e,method:t,headers:n,body:r},{abortSignal:i,cache:o,withCrossDomainCredentials:s})=>{let a;try{a=await fetch(e,{method:t,headers:n,body:Fo(t)?r:void 0,signal:i,cache:o,credentials:s?"include":"same-origin"})}catch(e){if(e instanceof TypeError)throw new g({name:Vi.NetworkError,message:"A network error has occurred.",underlyingError:e});throw e}const c={};return a.headers?.forEach(((e,t)=>{c[t.toLowerCase()]=e})),{statusCode:a.status,headers:c,body:null,body:Object.assign(a.body??{},{text:Ro((()=>a.text())),blob:Ro((()=>a.blob())),json:Ro((()=>a.json()))})}},jo=Mo(Lo,[Do,ro,({credentials:e,region:t,service:n,uriEscapePath:r=!0})=>{let i;return(o,s)=>async function(a){i=i??0;const c={credentials:"function"==typeof e?await e({forceRefresh:!!s?.isCredentialsExpired}):e,signingDate:xo(i),signingRegion:t,signingService:n,uriEscapePath:r},u=await ko(a,c),l=await o(u),d=(({headers:e}={})=>e?.date??e?.Date??e?.["x-amz-date"])(l);return d&&(i=((e,t)=>((e,t)=>Math.abs(xo(t).getTime()-e)>=3e5)(e,t)?e-Date.now():t)(Date.parse(d),i)),l}}]),$o=Mo(Lo,[Do,ro]),Uo="execute-api",qo="us-east-1",Bo=/^.+\.([a-z0-9-]+)\.([a-z0-9-]+)\.amazonaws\.com/,Go=async e=>{try{const{credentials:t}=await e.Auth.fetchAuthSession();if(t)return t}catch(e){zi.debug("No credentials available, the request will be unsigned.")}return null},Ko=({headers:e},t)=>!e.authorization&&!e["x-api-key"]&&!!t,Wo=new WeakMap,zo=(e,{url:t,options:n,abortController:r})=>{const i=r??new AbortController,o=function(e,t){const n=e=>!!t,r=new AbortController,i=r.signal,o=t?.signal;let s;const a=async()=>{try{const t=await(n(),e());if(t.statusCode>=300)throw await $i(t);return t}catch(e){const t=o??i,n=s??t.reason;if("AbortError"===e.name||!0===t?.aborted){const t=new Mi({...n&&{message:n},underlyingError:e,recoverySuggestion:"The API request was explicitly canceled. If this is not intended, validate if you called the `cancel()` function on the API request erroneously."});throw zi.debug(e),t}throw zi.debug(e),e}};if(n())return a();{const e=e=>{!0!==i.aborted&&(r.abort(e),e&&i.reason!==e&&(s=e))};return{response:a(),cancel:e}}}((async()=>(async(e,t,n,r)=>{const{url:i,method:o,headers:s,body:a,withCredentials:c,abortSignal:u}=t,l=a?a instanceof FormData?a:JSON.stringify(a??""):void 0,d=((e,t)=>{const n={};for(const t in e)n[t.toLowerCase()]=e[t];return t&&(n["content-type"]="application/json; charset=UTF-8",t instanceof FormData&&delete n["content-type"]),n})(s,a),h={url:i,headers:d,method:o,body:l},p={retryDecider:(y=$i,async(e,t)=>{const n=t??await y(e)??void 0,r=n?.code||n?.name,i=e?.statusCode;return{retryable:Xi(t)||Yi(i,r)||(e=>!!e&&Hi.includes(e))(r)||Zi(i,r)}}),computeDelay:no,withCrossDomainCredentials:c,abortSignal:u},f=n(h,r);var y;let m;const g=await Go(e);if(f&&g){const e=(e=>{const{service:t=Uo,region:n=qo}={},{hostname:r}=e,[,i,o]=Bo.exec(r)??[];return i===Uo?{service:i,region:o??n}:"appsync-api"===i?{service:"appsync",region:o??n}:{service:t,region:n}})(i),t=r?.service??e.service,n=r?.region??e.region;m=await jo(h,{...p,credentials:g,region:n,service:t})}else m=await $o(h,{...p});return{statusCode:m.statusCode,headers:m.headers,body:m.body}})(e,{url:t,method:"POST",...n,abortSignal:i.signal},Ko,n?.signingServiceInfo)),i),s=o.finally((()=>{Wo.delete(s)}));return s},Vo=(e,t)=>{const n=Wo.get(e);return!!n&&(n.abort(t),t&&n.signal.reason!==t&&(n.signal.reason=t),!0)},Ho=(e,t)=>{Wo.set(e,t)},Jo=[400,401,403],Qo=["BadRequestException","UnauthorizedException"],Yo="ConnectionStateChange";var Xo,Zo,es;!function(e){e.GQL_CONNECTION_INIT="connection_init",e.GQL_CONNECTION_ERROR="connection_error",e.GQL_CONNECTION_ACK="connection_ack",e.GQL_START="start",e.GQL_START_ACK="start_ack",e.DATA="data",e.GQL_CONNECTION_KEEP_ALIVE="ka",e.GQL_STOP="stop",e.GQL_COMPLETE="complete",e.GQL_ERROR="error",e.EVENT_SUBSCRIBE="subscribe",e.EVENT_PUBLISH="publish",e.EVENT_SUBSCRIBE_ACK="subscribe_success",e.EVENT_PUBLISH_ACK="publish_success",e.EVENT_STOP="unsubscribe",e.EVENT_COMPLETE="unsubscribe_success"}(Xo||(Xo={})),function(e){e[e.PENDING=0]="PENDING",e[e.CONNECTED=1]="CONNECTED",e[e.FAILED=2]="FAILED"}(Zo||(Zo={})),function(e){e[e.CLOSED=0]="CLOSED",e[e.READY=1]="READY",e[e.CONNECTING=2]="CONNECTING"}(es||(es={}));const ts={accept:"application/json, text/javascript","content-encoding":"amz-1.0","content-type":"application/json; charset=UTF-8"},ns=3e5,rs="undefined"!=typeof Symbol?Symbol("amplify_default"):"@@amplify_default",is=new Wi("Hub");class os{constructor(e){this.listeners=new Map,this.protectedChannels=["core","auth","api","analytics","interactions","pubsub","storage","ui","xr"],this.name=e}_remove(e,t){const n=this.listeners.get(e);n?this.listeners.set(e,[...n.filter((({callback:e})=>e!==t))]):is.warn(`No listeners for ${e}`)}dispatch(e,t,n,r){"string"==typeof e&&this.protectedChannels.indexOf(e)>-1&&(r===rs||is.warn(`WARNING: ${e} is protected and dispatching on it can have unintended consequences`));const i={channel:e,payload:{...t},source:n,patternInfo:[]};try{this._toListeners(i)}catch(e){is.error(e)}}listen(e,t,n="noname"){let r;if("function"!=typeof t)throw new g({name:"NoHubcallbackProvidedException",message:"No callback supplied to Hub"});r=t;let i=this.listeners.get(e);return i||(i=[],this.listeners.set(e,i)),i.push({name:n,callback:r}),()=>{this._remove(e,r)}}_toListeners(e){const{channel:t,payload:n}=e,r=this.listeners.get(t);r&&r.forEach((r=>{is.debug(`Dispatching to ${t} with `,n);try{r.callback(e)}catch(e){is.error(e)}}))}}const ss=new os("__default__");new os("internal-hub");class as extends Error{constructor(){super(...arguments),this.nonRetryable=!0}}const cs=e=>e&&e.nonRetryable,us={convert(e,t={urlSafe:!1,skipPadding:!1}){const n="string"==typeof e?e:function(e){return Array.from(e,(e=>String.fromCodePoint(e))).join("")}(e);let r=(()=>{if("undefined"!=typeof window&&"function"==typeof window.btoa)return window.btoa;if("function"==typeof btoa)return btoa;throw new g({name:"Base64EncoderError",message:"Cannot resolve the `btoa` function from the environment."})})()(n);return t.urlSafe&&(r=r.replace(/\+/g,"-").replace(/\//g,"_")),t.skipPadding&&(r=r.replace(/=/g,"")),r}},ls=new Wi("retryUtil");async function ds(e,t,n,r){if("function"!=typeof e)throw Error("functionToRetry must be a function");return new Promise((async(i,o)=>{let s,a,c=0,u=!1,l=()=>{};for(r&&r.then((()=>{u=!0,clearTimeout(s),l()}));!u;){c++,ls.debug(`${e.name} attempt #${c} with this vars: ${JSON.stringify(t)}`);try{return void i(await e(...t))}catch(r){if(a=r,ls.debug(`error on ${e.name}`,r),cs(r))return ls.debug(`${e.name} non retryable error`,r),void o(r);const i=n(c,t,r);if(ls.debug(`${e.name} retrying in ${i} ms`),!1===i||u)return void o(r);await new Promise((e=>{l=e,s=setTimeout(l,i)}))}}o(a)}))}const hs=(e,t,n=3e5,r)=>ds(e,t,eo(n),r);var ps,fs;function ys(e,t){return pi((function(n,r){var i=0;n.subscribe(Yr(r,(function(n){r.next(e.call(t,n,i++))})))}))}function ms(e,t){return pi((function(n,r){var i=0;n.subscribe(Yr(r,(function(n){return e.call(t,n,i++)&&r.next(n)})))}))}function gs(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=!1);var o=t.schedule((function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()}),r);if(e.add(o),!i)return o}function vs(e,t){return void 0===t&&(t=0),pi((function(n,r){n.subscribe(Yr(r,(function(n){return gs(r,e,(function(){return r.next(n)}),t)}),(function(){return gs(r,e,(function(){return r.complete()}),t)}),(function(n){return gs(r,e,(function(){return r.error(n)}),t)})))}))}function bs(e,t){return void 0===t&&(t=0),pi((function(n,r){r.add(e.schedule((function(){return n.subscribe(r)}),t))}))}function ws(e,t){if(!e)throw new Error("Iterable cannot be null");return new Ur((function(n){gs(n,t,(function(){var r=e[Symbol.asyncIterator]();gs(n,t,(function(){r.next().then((function(e){e.done?n.complete():n.next(e.value)}))}),0,!0)}))}))}function Ss(e,t){return t?function(e,t){if(null!=e){if(Br(e))return function(e,t){return Jr(e).pipe(bs(t),vs(t))}(e,t);if(cr(e))return function(e,t){return new Ur((function(n){var r=0;return t.schedule((function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())}))}))}(e,t);if(lr(e))return function(e,t){return Jr(e).pipe(bs(t),vs(t))}(e,t);if(Gr(e))return ws(e,t);if(zr(e))return function(e,t){return new Ur((function(n){var r;return gs(n,t,(function(){r=e[Wr](),gs(n,t,(function(){var e,t,i;try{t=(e=r.next()).value,i=e.done}catch(e){return void n.error(e)}i?n.complete():n.next(t)}),0,!0)})),function(){return ur(null==r?void 0:r.return)&&r.return()}}))}(e,t);if(Hr(e))return function(e,t){return ws(Vr(e),t)}(e,t)}throw Kr(e)}(e,t):Jr(e)}!function(e){e.CONNECTION_CLOSED="Connection closed",e.CONNECTION_FAILED="Connection failed",e.REALTIME_SUBSCRIPTION_INIT_ERROR="AppSync Realtime subscription init error",e.SUBSCRIPTION_ACK="Subscription ack",e.TIMEOUT_DISCONNECT="Timeout disconnect"}(ps||(ps={})),function(e){e.Connected="Connected",e.ConnectedPendingNetwork="ConnectedPendingNetwork",e.ConnectionDisrupted="ConnectionDisrupted",e.ConnectionDisruptedPendingNetwork="ConnectionDisruptedPendingNetwork",e.Connecting="Connecting",e.ConnectedPendingDisconnect="ConnectedPendingDisconnect",e.Disconnected="Disconnected",e.ConnectedPendingKeepAlive="ConnectedPendingKeepAlive"}(fs||(fs={}));const Es=()=>{if("undefined"==typeof self)return!1;const e=self;return void 0!==e.WorkerGlobalScope&&self instanceof e.WorkerGlobalScope};class As{networkMonitor(e){const t=Es()?self:"undefined"!=typeof window&&window;return t?new Ur((e=>{e.next({online:t.navigator.onLine});const n=()=>{e.next({online:!0})},r=()=>{e.next({online:!1})};return t.addEventListener("online",n),t.addEventListener("offline",r),As._observers.push(e),()=>{t.removeEventListener("online",n),t.removeEventListener("offline",r),As._observers=As._observers.filter((t=>t!==e))}})):Ss([{online:!0}])}static _observerOverride(e){for(const t of this._observers)t.closed?this._observers=this._observers.filter((e=>e!==t)):t?.next&&t.next(e)}}As._observers=[];const Ts=()=>(new As).networkMonitor(),Is={KEEP_ALIVE_MISSED:{keepAliveState:"unhealthy"},KEEP_ALIVE:{keepAliveState:"healthy"},CONNECTION_ESTABLISHED:{connectionState:"connected"},CONNECTION_FAILED:{intendedConnectionState:"disconnected",connectionState:"disconnected"},CLOSING_CONNECTION:{intendedConnectionState:"disconnected"},OPENING_CONNECTION:{intendedConnectionState:"connected",connectionState:"connecting"},CLOSED:{connectionState:"disconnected"},ONLINE:{networkState:"connected"},OFFLINE:{networkState:"disconnected"}};class Ns{constructor(){this._networkMonitoringSubscription=void 0,this._linkedConnectionState={networkState:"connected",connectionState:"disconnected",intendedConnectionState:"disconnected",keepAliveState:"healthy"},this._initialNetworkStateSubscription=Ts().subscribe((({online:e})=>{this.record(e?Is.ONLINE:Is.OFFLINE),this._initialNetworkStateSubscription?.unsubscribe()})),this._linkedConnectionStateObservable=new Ur((e=>{e.next(this._linkedConnectionState),this._linkedConnectionStateObserver=e}))}enableNetworkMonitoring(){this._initialNetworkStateSubscription?.unsubscribe(),void 0===this._networkMonitoringSubscription&&(this._networkMonitoringSubscription=Ts().subscribe((({online:e})=>{this.record(e?Is.ONLINE:Is.OFFLINE)})))}disableNetworkMonitoring(){this._networkMonitoringSubscription?.unsubscribe(),this._networkMonitoringSubscription=void 0}get connectionStateObservable(){let e;return this._linkedConnectionStateObservable.pipe(ys((e=>this.connectionStatesTranslator(e)))).pipe(ms((t=>{const n=t!==e;return e=t,n})))}record(e){"connected"===e.intendedConnectionState?this.enableNetworkMonitoring():"disconnected"===e.intendedConnectionState&&this.disableNetworkMonitoring();const t={...this._linkedConnectionState,...e};this._linkedConnectionState={...t},this._linkedConnectionStateObserver?.next(this._linkedConnectionState)}connectionStatesTranslator({connectionState:e,networkState:t,intendedConnectionState:n,keepAliveState:r}){return"connected"===e&&"disconnected"===t?fs.ConnectedPendingNetwork:"connected"===e&&"disconnected"===n?fs.ConnectedPendingDisconnect:"disconnected"===e&&"connected"===n&&"disconnected"===t?fs.ConnectionDisruptedPendingNetwork:"disconnected"===e&&"connected"===n?fs.ConnectionDisrupted:"connected"===e&&"unhealthy"===r?fs.ConnectedPendingKeepAlive:"connecting"===e?fs.Connecting:"disconnected"===e?fs.Disconnected:fs.Connected}}var Os;!function(e){e.START_RECONNECT="START_RECONNECT",e.HALT_RECONNECT="HALT_RECONNECT"}(Os||(Os={}));class _s{constructor(){this.reconnectObservers=[]}addObserver(e){this.reconnectObservers.push(e)}record(e){e===Os.START_RECONNECT&&void 0===this.reconnectSetTimeoutId&&void 0===this.reconnectIntervalId&&(this.reconnectSetTimeoutId=setTimeout((()=>{this._triggerReconnect(),this.reconnectIntervalId=setInterval((()=>{this._triggerReconnect()}),6e4)}),5e3)),e===Os.HALT_RECONNECT&&(this.reconnectIntervalId&&(clearInterval(this.reconnectIntervalId),this.reconnectIntervalId=void 0),this.reconnectSetTimeoutId&&(clearTimeout(this.reconnectSetTimeoutId),this.reconnectSetTimeoutId=void 0))}close(){this.reconnectObservers.forEach((e=>{e.complete?.()}))}_triggerReconnect(){this.reconnectObservers.forEach((e=>{e.next?.()}))}}const Cs=/^https:\/\/\w{26}\.appsync-api\.\w{2}(?:(?:-\w{2,})+)-\d\.amazonaws.com(?:\.cn)?\/graphql$/i,Ps=/^https:\/\/\w{26}\.\w+-api\.\w{2}(?:(?:-\w{2,})+)-\d\.amazonaws.com(?:\.cn)?\/event$/i,ks="/realtime",xs=async e=>{const{appSyncGraphqlEndpoint:t,query:n,libraryConfigHeaders:r=()=>({}),additionalHeaders:i={},authToken:o}=e;let s={};const a=await r();if("function"==typeof i){const e={url:t||"",queryString:n||""};s=await i(e)}else s=i;return o&&(s={...s,Authorization:o}),{additionalCustomHeaders:s,libraryConfigHeaders:a}},Ds=e=>{const t=Reflect.ownKeys(e);for(const n of t){const t=e[n];(t&&"object"==typeof t||"function"==typeof t)&&Ds(t)}return Object.freeze(e)},Ms=Symbol("oauth-listener"),Rs=new Wi("parseAWSExports"),Fs={API_KEY:"apiKey",AWS_IAM:"iam",AMAZON_COGNITO_USER_POOLS:"userPool",OPENID_CONNECT:"oidc",NONE:"none",AWS_LAMBDA:"lambda",LAMBDA:"lambda"},Ls=e=>e?.split(",")??[],js=({domain:e,scope:t,redirectSignIn:n,redirectSignOut:r,responseType:i})=>({domain:e,scopes:t,redirectSignIn:Ls(n),redirectSignOut:Ls(r),responseType:i}),$s=e=>e.map((e=>{const t=e.toLowerCase();return t.charAt(0).toUpperCase()+t.slice(1)}));const Us={AMAZON_COGNITO_USER_POOLS:"userPool",API_KEY:"apiKey",AWS_IAM:"iam",AWS_LAMBDA:"lambda",OPENID_CONNECT:"oidc"};function qs(e){return Us[e]}const Bs={GOOGLE:"Google",LOGIN_WITH_AMAZON:"Amazon",FACEBOOK:"Facebook",SIGN_IN_WITH_APPLE:"Apple"};function Gs(e=[]){return e.reduce(((e,t)=>(void 0!==Bs[t]&&e.push(Bs[t]),e)),[])}function Ks(e){const t={};return e.forEach((({name:e,bucket_name:n,aws_region:r,paths:i})=>{if(e in t)throw new Error(`Duplicate friendly name found: ${e}. Name must be unique.`);t[e]={bucketName:n,region:r,paths:i}})),t}const Ws=e=>Object.keys(e).some((e=>e.startsWith("aws_")))?((e={})=>{if(!Object.prototype.hasOwnProperty.call(e,"aws_project_region"))throw new g({name:"InvalidParameterException",message:"Invalid config parameter.",recoverySuggestion:"Ensure passing the config object imported from  `amplifyconfiguration.json`."});const{aws_appsync_apiKey:t,aws_appsync_authenticationType:n,aws_appsync_graphqlEndpoint:r,aws_appsync_region:i,aws_bots_config:o,aws_cognito_identity_pool_id:s,aws_cognito_sign_up_verification_method:a,aws_cognito_mfa_configuration:c,aws_cognito_mfa_types:u,aws_cognito_password_protection_settings:l,aws_cognito_verification_mechanisms:d,aws_cognito_signup_attributes:h,aws_cognito_social_providers:p,aws_cognito_username_attributes:f,aws_mandatory_sign_in:y,aws_mobile_analytics_app_id:m,aws_mobile_analytics_app_region:v,aws_user_files_s3_bucket:b,aws_user_files_s3_bucket_region:w,aws_user_files_s3_dangerously_connect_to_http_endpoint_for_testing:S,aws_user_pools_id:E,aws_user_pools_web_client_id:A,geo:T,oauth:I,predictions:N,aws_cloud_logic_custom:O,Notifications:_,modelIntrospection:C}=e,P={};m&&(P.Analytics={Pinpoint:{appId:m,region:v}});const{InAppMessaging:k,Push:x}=_??{};if(k?.AWSPinpoint||x?.AWSPinpoint){if(k?.AWSPinpoint){const{appId:e,region:t}=k.AWSPinpoint;P.Notifications={InAppMessaging:{Pinpoint:{appId:e,region:t}}}}if(x?.AWSPinpoint){const{appId:e,region:t}=x.AWSPinpoint;P.Notifications={...P.Notifications,PushNotification:{Pinpoint:{appId:e,region:t}}}}}if(Array.isArray(o)&&(P.Interactions={LexV1:Object.fromEntries(o.map((e=>[e.name,e])))}),r){const e=Fs[n];e||Rs.debug(`Invalid authentication type ${n}. Falling back to IAM.`),P.API={GraphQL:{endpoint:r,apiKey:t,region:i,defaultAuthMode:e??"iam"}},C&&(P.API.GraphQL.modelIntrospection=C)}const D=c?{status:c&&c.toLowerCase(),totpEnabled:u?.includes("TOTP")??!1,smsEnabled:u?.includes("SMS")??!1}:void 0,M=l?{minLength:l.passwordPolicyMinLength,requireLowercase:l.passwordPolicyCharacters?.includes("REQUIRES_LOWERCASE")??!1,requireUppercase:l.passwordPolicyCharacters?.includes("REQUIRES_UPPERCASE")??!1,requireNumbers:l.passwordPolicyCharacters?.includes("REQUIRES_NUMBERS")??!1,requireSpecialCharacters:l.passwordPolicyCharacters?.includes("REQUIRES_SYMBOLS")??!1}:void 0,R=Array.from(new Set([...d??[],...h??[]])).reduce(((e,t)=>({...e,[t.toLowerCase()]:{required:!0}})),{}),F=f?.includes("EMAIL")??!1,L=f?.includes("PHONE_NUMBER")??!1;(s||E)&&(P.Auth={Cognito:{identityPoolId:s,allowGuestAccess:"enable"!==y,signUpVerificationMethod:a,userAttributes:R,userPoolClientId:A,userPoolId:E,mfa:D,passwordFormat:M,loginWith:{username:!(F||L),email:F,phone:L}}});const j=!!I&&Object.keys(I).length>0,$=!!p&&p.length>0;if(P.Auth&&j&&(P.Auth.Cognito.loginWith={...P.Auth.Cognito.loginWith,oauth:{...js(I),...$&&{providers:$s(p)}}}),b&&(P.Storage={S3:{bucket:b,region:w,dangerouslyConnectToHttpEndpointForTesting:S}}),T){const{amazon_location_service:e}=T;P.Geo={LocationService:{maps:e.maps,geofenceCollections:e.geofenceCollections,searchIndices:e.search_indices,region:e.region}}}if(O&&(P.API={...P.API,REST:O.reduce(((e,t)=>{const{name:n,endpoint:r,region:i,service:o}=t;return{...e,[n]:{endpoint:r,...o?{service:o}:void 0,...i?{region:i}:void 0}}}),{})}),N){const{VoiceId:e}=N?.convert?.speechGenerator?.defaults??{};P.Predictions=e?{...N,convert:{...N.convert,speechGenerator:{...N.convert.speechGenerator,defaults:{voiceId:e}}}}:N}return P})(e):function(e){const{version:t}=e;return!!t&&t.startsWith("1")}(e)?function(e){const t={};if(e.storage&&(t.Storage=function(e){if(!e)return;const{bucket_name:t,aws_region:n,buckets:r}=e;return{S3:{bucket:t,region:n,buckets:r&&Ks(r)}}}(e.storage)),e.auth&&(t.Auth=function(e){if(!e)return;const{user_pool_id:t,user_pool_client_id:n,identity_pool_id:r,password_policy:i,mfa_configuration:o,mfa_methods:s,unauthenticated_identities_enabled:a,oauth:c,username_attributes:u,standard_required_attributes:l,groups:d}=e,h={Cognito:{userPoolId:t,userPoolClientId:n,groups:d}};return r&&(h.Cognito={...h.Cognito,identityPoolId:r}),i&&(h.Cognito.passwordFormat={requireLowercase:i.require_lowercase,requireNumbers:i.require_numbers,requireUppercase:i.require_uppercase,requireSpecialCharacters:i.require_symbols,minLength:i.min_length??6}),o&&(h.Cognito.mfa={status:(p=o,"OPTIONAL"===p?"optional":"REQUIRED"===p?"on":"off"),smsEnabled:s?.includes("SMS"),totpEnabled:s?.includes("TOTP")}),a&&(h.Cognito.allowGuestAccess=a),c&&(h.Cognito.loginWith={oauth:{domain:c.domain,redirectSignIn:c.redirect_sign_in_uri,redirectSignOut:c.redirect_sign_out_uri,responseType:"token"===c.response_type?"token":"code",scopes:c.scopes,providers:Gs(c.identity_providers)}}),u&&(h.Cognito.loginWith={...h.Cognito.loginWith,email:u.includes("email"),phone:u.includes("phone_number"),username:u.includes("username")}),l&&(h.Cognito.userAttributes=l.reduce(((e,t)=>({...e,[t]:{required:!0}})),{})),h;var p}(e.auth)),e.analytics&&(t.Analytics=function(e){if(!e?.amazon_pinpoint)return;const{amazon_pinpoint:t}=e;return{Pinpoint:{appId:t.app_id,region:t.aws_region}}}(e.analytics)),e.geo&&(t.Geo=function(e){if(!e)return;const{aws_region:t,geofence_collections:n,maps:r,search_indices:i}=e;return{LocationService:{region:t,searchIndices:i,geofenceCollections:n,maps:r}}}(e.geo)),e.data&&(t.API=function(e){if(!e)return;const{aws_region:t,default_authorization_type:n,url:r,api_key:i,model_introspection:o}=e;return{GraphQL:{endpoint:r,defaultAuthMode:qs(n),region:t,apiKey:i,modelIntrospection:o}}}(e.data)),e.custom){const n=function(e){if(!e?.events)return;const{url:t,aws_region:n,api_key:r,default_authorization_type:i}=e.events;return{Events:{endpoint:t,defaultAuthMode:qs(i),region:n,apiKey:r}}}(e.custom);n&&"Events"in n&&(t.API={...t.API,...n})}return e.notifications&&(t.Notifications=function(e){if(!e)return;const{aws_region:t,channels:n,amazon_pinpoint_app_id:r}=e,i=n.includes("IN_APP_MESSAGING"),o=n.includes("APNS")||n.includes("FCM");if(!i&&!o)return;const s={};return i&&(s.InAppMessaging={Pinpoint:{appId:r,region:t}}),o&&(s.PushNotification={Pinpoint:{appId:r,region:t}}),s}(e.notifications)),t}(e):e,zs=new Wi("Auth");class Vs{configure(e,t){this.authConfig=e,this.authOptions=t,e.Cognito.userPoolEndpoint&&zs.warn(Hs("Amazon Cognito User Pool")),e.Cognito.identityPoolEndpoint&&zs.warn(Hs("Amazon Cognito Identity Pool"))}async fetchAuthSession(e={}){let t,n;const r=await this.getTokens(e);return r?(n=r.accessToken?.payload?.sub,t=await(this.authOptions?.credentialsProvider?.getCredentialsAndIdentityId({authConfig:this.authConfig,tokens:r,authenticated:!0,forceRefresh:e.forceRefresh}))):t=await(this.authOptions?.credentialsProvider?.getCredentialsAndIdentityId({authConfig:this.authConfig,authenticated:!1,forceRefresh:e.forceRefresh})),{tokens:r,credentials:t?.credentials,identityId:t?.identityId,userSub:n}}async clearCredentials(){await(this.authOptions?.credentialsProvider?.clearCredentialsAndIdentityId())}async getTokens(e){return await(this.authOptions?.tokenProvider?.getTokens(e))??void 0}}const Hs=e=>`You are using a custom Amazon ${e} endpoint, ensure the endpoint is correct.`,Js=new class{constructor(){this.oAuthListener=void 0,this.resourcesConfig={},this.libraryOptions={},this.Auth=new Vs}configure(e,t){const n=Ws(e);this.resourcesConfig=n,t&&(this.libraryOptions=t),this.resourcesConfig=Ds(this.resourcesConfig),this.Auth.configure(this.resourcesConfig.Auth,this.libraryOptions.Auth),ss.dispatch("core",{event:"configure",data:this.resourcesConfig},"Configure",rs),this.notifyOAuthListener()}getConfig(){return this.resourcesConfig}[Ms](e){this.resourcesConfig.Auth?.Cognito.loginWith?.oauth?e(this.resourcesConfig.Auth?.Cognito):this.oAuthListener=e}notifyOAuthListener(){this.resourcesConfig.Auth?.Cognito.loginWith?.oauth&&this.oAuthListener&&(this.oAuthListener(this.resourcesConfig.Auth?.Cognito),this.oAuthListener=void 0)}},Qs=e=>((e,t)=>e.Auth.fetchAuthSession(t))(Js,e),Ys=new Wi("AWSAppSyncRealTimeProvider Auth"),Xs=async({host:e})=>{const t=await Qs();return{Authorization:t?.tokens?.accessToken?.toString(),host:e}},Zs=async({apiKey:e,host:t})=>({host:t,"x-amz-date":(new Date).toISOString().replace(/[:-]|\.\d{3}/g,""),"x-api-key":e}),ea=async({payload:e,canonicalUri:t,appSyncGraphqlEndpoint:n,region:r})=>{const i={region:r,service:"appsync"},o=(await Qs()).credentials,s={url:`${n}${t}`,data:e,method:"POST",headers:{...ts}};return ko({headers:s.headers,method:s.method,url:new w(s.url),body:s.data},{credentials:o,signingRegion:i.region,signingService:i.service}).headers},ta=async({host:e,additionalCustomHeaders:t})=>{if(!t?.Authorization)throw new Error("No auth token specified");return{Authorization:t.Authorization,host:e}},na=async({apiKey:e,authenticationType:t,canonicalUri:n,appSyncGraphqlEndpoint:r,region:i,additionalCustomHeaders:o,payload:s})=>{const a={apiKey:Zs,iam:ea,oidc:Xs,userPool:Xs,lambda:ta,none:ta};if(t&&a[t]){const c=a[t],u=r?new w(r).host:void 0,l="apiKey"===t?e:void 0;return Ys.debug(`Authenticating with ${JSON.stringify(t)}`),await c({payload:s,canonicalUri:n,appSyncGraphqlEndpoint:r,apiKey:l,region:i,host:u,additionalCustomHeaders:o})}Ys.debug(`Authentication type ${t} not supported`)},ra=e=>{ss.dispatch("api",e,"PubSub",rs)};class ia{constructor(e){this.subscriptionObserverMap=new Map,this.socketStatus=es.CLOSED,this.keepAliveTimeout=ns,this.promiseArray=[],this.connectionStateMonitor=new Ns,this.reconnectionMonitor=new _s,this._establishConnection=async(e,t)=>{this.logger.debug(`Establishing WebSocket connection to ${e}`);try{await this._openConnection(e,t),await this._initiateHandshake()}catch(e){const{errorType:t,errorCode:n}=e;throw Jo.includes(n)||Qo.includes(t)?new as(t):t?new Error(t):e}},this.logger=new Wi(e.providerName),this.wsProtocolName=e.wsProtocolName,this.wsConnectUri=e.connectUri,this.connectionStateMonitorSubscription=this._startConnectionStateMonitoring()}close(){return this.socketStatus=es.CLOSED,this.connectionStateMonitor.record(Is.CONNECTION_FAILED),this.connectionStateMonitorSubscription.unsubscribe(),this.reconnectionMonitor.close(),new Promise(((e,t)=>{this.awsRealTimeSocket?(this.awsRealTimeSocket.onclose=t=>{this.subscriptionObserverMap=new Map,this.awsRealTimeSocket=void 0,e()},this.awsRealTimeSocket.onerror=e=>{t(e)},this.awsRealTimeSocket.close()):e()}))}subscribe(e,t){return new Ur((n=>{if(!e?.appSyncGraphqlEndpoint)return;let r=!1;const i=m(),o=()=>{r||(r=!0,this._startSubscriptionWithAWSAppSyncRealTime({options:e,observer:n,subscriptionId:i,customUserAgentDetails:t}).catch((e=>{this.logger.debug(`${ps.REALTIME_SUBSCRIPTION_INIT_ERROR}: ${e}`),this.connectionStateMonitor.record(Is.CLOSED)})).finally((()=>{r=!1})))},s=new Ur((e=>{this.reconnectionMonitor.addObserver(e)})).subscribe((()=>{o()}));return o(),async()=>{await this._cleanupSubscription(i,s)}}))}async connect(e){this.socketStatus!==es.READY&&await this._connectWebSocket(e)}async publish(e,t){if(this.socketStatus!==es.READY)throw new Error("Subscription has not been initialized");return this._publishMessage(e,t)}async _connectWebSocket(e){const{apiKey:t,appSyncGraphqlEndpoint:n,authenticationType:r,region:i}=e,{additionalCustomHeaders:o}=await xs(e);this.connectionStateMonitor.record(Is.OPENING_CONNECTION),await this._initializeWebSocketConnection({apiKey:t,appSyncGraphqlEndpoint:n,authenticationType:r,region:i,additionalCustomHeaders:o})}async _publishMessage(e,t){const n=m(),{additionalCustomHeaders:r,libraryConfigHeaders:i}=await xs(e),o=await this._prepareSubscriptionPayload({options:e,subscriptionId:n,customUserAgentDetails:t,additionalCustomHeaders:r,libraryConfigHeaders:i,publish:!0});return new Promise(((e,t)=>{if(this.awsRealTimeSocket){const r=t=>{const i=JSON.parse(t.data);i.id===n&&"publish_success"===i.type&&(this.awsRealTimeSocket&&this.awsRealTimeSocket.removeEventListener("message",r),e()),i.erroredEvents&&i.erroredEvents.length};this.awsRealTimeSocket.addEventListener("message",r),this.awsRealTimeSocket.addEventListener("close",(()=>{t(new Error("WebSocket is closed"))})),this.awsRealTimeSocket.send(o)}}))}async _cleanupSubscription(e,t){t?.unsubscribe();try{await this._waitForSubscriptionToBeConnected(e);const{subscriptionState:t}=this.subscriptionObserverMap.get(e)||{};if(!t)return;if(t!==Zo.CONNECTED)throw new Error("Subscription never connected");this._sendUnsubscriptionMessage(e)}catch(e){this.logger.debug(`Error while unsubscribing ${e}`)}finally{this._removeSubscriptionObserver(e)}}_startConnectionStateMonitoring(){return this.connectionStateMonitor.connectionStateObservable.subscribe((e=>{ra({event:Yo,data:{provider:this,connectionState:e},message:`Connection state is ${e}`}),this.connectionState=e,e===fs.ConnectionDisrupted&&this.reconnectionMonitor.record(Os.START_RECONNECT),[fs.Connected,fs.ConnectedPendingDisconnect,fs.ConnectedPendingKeepAlive,fs.ConnectedPendingNetwork,fs.ConnectionDisruptedPendingNetwork,fs.Disconnected].includes(e)&&this.reconnectionMonitor.record(Os.HALT_RECONNECT)}))}async _startSubscriptionWithAWSAppSyncRealTime({options:e,observer:t,subscriptionId:n,customUserAgentDetails:r}){const{query:i,variables:o}=e,{additionalCustomHeaders:s,libraryConfigHeaders:a}=await xs(e);this.subscriptionObserverMap.set(n,{observer:t,query:i??"",variables:o??{},subscriptionState:Zo.PENDING,startAckTimeoutId:void 0});const c=await this._prepareSubscriptionPayload({options:e,subscriptionId:n,customUserAgentDetails:r,additionalCustomHeaders:s,libraryConfigHeaders:a});try{await this._connectWebSocket(e)}catch(e){return void this._logStartSubscriptionError(n,t,e)}const{subscriptionFailedCallback:u,subscriptionReadyCallback:l}=this.subscriptionObserverMap.get(n)??{};this.subscriptionObserverMap.set(n,{observer:t,subscriptionState:Zo.PENDING,query:i??"",variables:o??{},subscriptionReadyCallback:l,subscriptionFailedCallback:u,startAckTimeoutId:setTimeout((()=>{this._timeoutStartSubscriptionAck(n)}),15e3)}),this.awsRealTimeSocket&&this.awsRealTimeSocket.send(c)}_logStartSubscriptionError(e,t,n){this.logger.debug({err:n});const r=String(n.message??"");if(this.connectionStateMonitor.record(Is.CLOSED),this.connectionState!==fs.ConnectionDisruptedPendingNetwork){cs(n)?t.error({errors:[{...new an(`${ps.CONNECTION_FAILED}: ${r}`)}]}):this.logger.debug(`${ps.CONNECTION_FAILED}: ${r}`);const{subscriptionFailedCallback:i}=this.subscriptionObserverMap.get(e)||{};"function"==typeof i&&i()}}async _waitForSubscriptionToBeConnected(e){const t=this.subscriptionObserverMap.get(e);if(t){const{subscriptionState:n}=t;if(n===Zo.PENDING)return new Promise(((n,r)=>{const{observer:i,subscriptionState:o,variables:s,query:a}=t;this.subscriptionObserverMap.set(e,{observer:i,subscriptionState:o,variables:s,query:a,subscriptionReadyCallback:n,subscriptionFailedCallback:r})}))}}_sendUnsubscriptionMessage(e){try{if(this.awsRealTimeSocket&&this.awsRealTimeSocket.readyState===WebSocket.OPEN&&this.socketStatus===es.READY){const t=this._unsubscribeMessage(e),n=JSON.stringify(t);this.awsRealTimeSocket.send(n)}}catch(e){this.logger.debug({err:e})}}_removeSubscriptionObserver(e){this.subscriptionObserverMap.delete(e),setTimeout(this._closeSocketIfRequired.bind(this),1e3)}_closeSocketIfRequired(){if(!(this.subscriptionObserverMap.size>0))if(this.awsRealTimeSocket)if(this.connectionStateMonitor.record(Is.CLOSING_CONNECTION),this.awsRealTimeSocket.bufferedAmount>0)setTimeout(this._closeSocketIfRequired.bind(this),1e3);else{this.logger.debug("closing WebSocket..."),this.keepAliveTimeoutId&&clearTimeout(this.keepAliveTimeoutId),this.keepAliveAlertTimeoutId&&clearTimeout(this.keepAliveAlertTimeoutId);const e=this.awsRealTimeSocket;e.onclose=null,e.onerror=null,e.close(1e3),this.awsRealTimeSocket=void 0,this.socketStatus=es.CLOSED,this.connectionStateMonitor.record(Is.CLOSED)}else this.socketStatus=es.CLOSED}_handleIncomingSubscriptionMessage(e){if("string"!=typeof e.data)return;const[t,n]=this._handleSubscriptionData(e);if(t)return;const{type:r,id:i,payload:o}=n,{observer:s=null,query:a="",variables:c={},startAckTimeoutId:u,subscriptionReadyCallback:l,subscriptionFailedCallback:d}=this.subscriptionObserverMap.get(i)||{};if(r===Xo.GQL_START_ACK||r===Xo.EVENT_SUBSCRIBE_ACK){this.logger.debug(`subscription ready for ${JSON.stringify({query:a,variables:c})}`),"function"==typeof l&&l(),u&&clearTimeout(u),ra({event:ps.SUBSCRIPTION_ACK,data:{query:a,variables:c},message:"Connection established for subscription"});const e=Zo.CONNECTED;return s&&this.subscriptionObserverMap.set(i,{observer:s,query:a,variables:c,startAckTimeoutId:void 0,subscriptionState:e,subscriptionReadyCallback:l,subscriptionFailedCallback:d}),void this.connectionStateMonitor.record(Is.CONNECTION_ESTABLISHED)}if(r===Xo.GQL_CONNECTION_KEEP_ALIVE)return this.keepAliveTimeoutId&&clearTimeout(this.keepAliveTimeoutId),this.keepAliveAlertTimeoutId&&clearTimeout(this.keepAliveAlertTimeoutId),this.keepAliveTimeoutId=setTimeout((()=>{this._errorDisconnect(ps.TIMEOUT_DISCONNECT)}),this.keepAliveTimeout),this.keepAliveAlertTimeoutId=setTimeout((()=>{this.connectionStateMonitor.record(Is.KEEP_ALIVE_MISSED)}),65e3),void this.connectionStateMonitor.record(Is.KEEP_ALIVE);if(r===Xo.GQL_ERROR){const e=Zo.FAILED;s&&(this.subscriptionObserverMap.set(i,{observer:s,query:a,variables:c,startAckTimeoutId:u,subscriptionReadyCallback:l,subscriptionFailedCallback:d,subscriptionState:e}),this.logger.debug(`${ps.CONNECTION_FAILED}: ${JSON.stringify(o??n)}`),s.error({errors:[{...new an(`${ps.CONNECTION_FAILED}: ${JSON.stringify(o??n)}`)}]}),u&&clearTimeout(u),"function"==typeof d&&d())}}_errorDisconnect(e){this.logger.debug(`Disconnect error: ${e}`),this.awsRealTimeSocket&&(this.connectionStateMonitor.record(Is.CLOSED),this.awsRealTimeSocket.close()),this.socketStatus=es.CLOSED}_timeoutStartSubscriptionAck(e){const t=this.subscriptionObserverMap.get(e);if(t){const{observer:n,query:r,variables:i}=t;if(!n)return;this.subscriptionObserverMap.set(e,{observer:n,query:r,variables:i,subscriptionState:Zo.FAILED}),this.connectionStateMonitor.record(Is.CLOSED),this.logger.debug("timeoutStartSubscription",JSON.stringify({query:r,variables:i}))}}_initializeWebSocketConnection({appSyncGraphqlEndpoint:e,authenticationType:t,apiKey:n,region:r,additionalCustomHeaders:i}){if(this.socketStatus!==es.READY)return new Promise((async(o,s)=>{if(this.promiseArray.push({res:o,rej:s}),this.socketStatus===es.CLOSED)try{this.socketStatus=es.CONNECTING;const o="{}",s=await na({authenticationType:t,payload:o,canonicalUri:this.wsConnectUri,apiKey:n,appSyncGraphqlEndpoint:e,region:r,additionalCustomHeaders:i}),a=s?JSON.stringify(s):"",c=`header-${us.convert(a,{urlSafe:!0,skipPadding:!0})}`,u=(e=>{const t=(e=>{if(!e)return{};if("Authorization"in e){const{Authorization:t,...n}=e;return n}return e})(e),n=new S;return Object.entries(t).forEach((([e,t])=>{n.append(e,t)})),n})(i),l=((e,t)=>{const n=(e=>{let t=e??"";return t=null!==t.match(Ps)?t.concat(ks).replace("ddpg-api","grt-gamma").replace("appsync-api","appsync-realtime-api"):null===t.match(Cs)?t.concat(ks):t.replace("appsync-api","appsync-realtime-api").replace("gogi-beta","grt-beta").replace("ddpg-api","grt-gamma"),t=t.replace("https://","wss://").replace("http://","ws://"),new w(t)})(e),r=new S(n.search);for(const[e,n]of t.entries())r.append(e,n);return n.search=r.toString(),n.toString()})(e,u);await this._establishRetryableConnection(l,c),this.promiseArray.forEach((({res:e})=>{this.logger.debug("Notifying connection successful"),e()})),this.socketStatus=es.READY,this.promiseArray=[]}catch(e){this.logger.debug("Connection exited with",e),this.promiseArray.forEach((({rej:t})=>{t(e)})),this.promiseArray=[],this.awsRealTimeSocket&&this.awsRealTimeSocket.readyState===WebSocket.OPEN&&this.awsRealTimeSocket.close(3001),this.awsRealTimeSocket=void 0,this.socketStatus=es.CLOSED}}))}async _establishRetryableConnection(e,t){this.logger.debug("Establishing retryable connection"),await hs(this._establishConnection.bind(this),[e,t],5e3)}async _openConnection(e,t){return new Promise(((n,r)=>{const i=this._getNewWebSocket(e,[this.wsProtocolName,t]);i.onerror=()=>{this.logger.debug("WebSocket connection error")},i.onclose=()=>{r(new Error("Connection handshake error"))},i.onopen=()=>{this.awsRealTimeSocket=i,n()}}))}_getNewWebSocket(e,t){return new WebSocket(e,t)}async _initiateHandshake(){return new Promise(((e,t)=>{if(!this.awsRealTimeSocket)return void t(new Error("awsRealTimeSocket undefined"));let n=!1;this.awsRealTimeSocket.onerror=e=>{this.logger.debug(`WebSocket error ${JSON.stringify(e)}`)},this.awsRealTimeSocket.onclose=e=>{this.logger.debug(`WebSocket closed ${e.reason}`),t(new Error(JSON.stringify(e)))},this.awsRealTimeSocket.onmessage=r=>{if("string"!=typeof r.data)return;this.logger.debug(`subscription message from AWS AppSyncRealTime: ${r.data} `);const i=JSON.parse(r.data),{type:o}=i,s=this._extractConnectionTimeout(i);if(o===Xo.GQL_CONNECTION_ACK)return n=!0,this._registerWebsocketHandlers(s),void e("Connected to AWS AppSyncRealTime");if(o===Xo.GQL_CONNECTION_ERROR){const{errorType:e,errorCode:n}=this._extractErrorCodeAndType(i);t({errorType:e,errorCode:n})}};const r={type:Xo.GQL_CONNECTION_INIT};this.awsRealTimeSocket.send(JSON.stringify(r));const i=e=>{e||(this.connectionStateMonitor.record(Is.CONNECTION_FAILED),t(new Error("Connection timeout: ack from AWSAppSyncRealTime was not received after 15000 ms")))};setTimeout((()=>{i(n)}),15e3)}))}_registerWebsocketHandlers(e){this.awsRealTimeSocket&&(this.keepAliveTimeout=e,this.awsRealTimeSocket.onmessage=this._handleIncomingSubscriptionMessage.bind(this),this.awsRealTimeSocket.onerror=e=>{this.logger.debug(e),this._errorDisconnect(ps.CONNECTION_CLOSED)},this.awsRealTimeSocket.onclose=e=>{this.logger.debug(`WebSocket closed ${e.reason}`),this._errorDisconnect(ps.CONNECTION_CLOSED)})}}const oa="AWSAppSyncRealTimeProvider";class sa extends ia{constructor(){super({providerName:oa,wsProtocolName:"graphql-ws",connectUri:"/connect"})}getProviderName(){return oa}subscribe(e,t){return super.subscribe(e,t)}async _prepareSubscriptionPayload({options:e,subscriptionId:t,customUserAgentDetails:n,additionalCustomHeaders:r,libraryConfigHeaders:i}){const{appSyncGraphqlEndpoint:o,authenticationType:s,query:a,variables:c,apiKey:u,region:l}=e,d={query:a,variables:c},h=JSON.stringify(d),p={id:t,payload:{data:h,extensions:{authorization:{...{...await na({apiKey:u,appSyncGraphqlEndpoint:o,authenticationType:s,payload:h,canonicalUri:"",region:l,additionalCustomHeaders:r}),...i,...r,[Bi]:Pi(n)}}}},type:Xo.GQL_START};return JSON.stringify(p)}_handleSubscriptionData(e){this.logger.debug(`subscription message from AWS AppSync RealTime: ${e.data}`);const{id:t="",payload:n,type:r}=JSON.parse(String(e.data)),{observer:i=null,query:o="",variables:s={}}=this.subscriptionObserverMap.get(t)||{};return this.logger.debug({id:t,observer:i,query:o,variables:s}),r===Xo.DATA&&n&&n.data?(i?i.next(n):this.logger.debug(`observer not found for id: ${t}`),[!0,{id:t,type:r,payload:n}]):[!1,{id:t,type:r,payload:n}]}_unsubscribeMessage(e){return{id:e,type:Xo.GQL_STOP}}_extractConnectionTimeout(e){const{payload:{connectionTimeoutMs:t=ns}={}}=e;return t}_extractErrorCodeAndType(e){const{payload:{errors:[{errorType:t="",errorCode:n=0}={}]=[]}={}}=e;return{errorCode:n,errorType:t}}}class aa extends g{constructor(e){super(e),this.constructor=aa,Object.setPrototypeOf(this,aa.prototype)}}var ca;!function(e){e.NoAuthSession="NoAuthSession",e.NoRegion="NoRegion",e.NoCustomEndpoint="NoCustomEndpoint"}(ca||(ca={}));const ua={[ca.NoAuthSession]:{message:"Auth session should not be empty."},[ca.NoRegion]:{message:"Missing region."},[ca.NoCustomEndpoint]:{message:"Custom endpoint region is present without custom endpoint."}},la=new Wi("GraphQLAPI resolveConfig"),da=e=>{const t=e.getConfig();t.API?.GraphQL||la.warn("The API configuration is missing. This is likely due to Amplify.configure() not being called prior to generateClient().");const{apiKey:n,customEndpoint:r,customEndpointRegion:i,defaultAuthMode:o,endpoint:s,region:a}=t.API?.GraphQL??{};return function(e,t){const{message:n,recoverySuggestion:r}=ua[t];if(!e)throw new aa({name:t,message:n,recoverySuggestion:r})}(!(!r&&i),ca.NoCustomEndpoint),{apiKey:n,customEndpoint:r,customEndpointRegion:i,defaultAuthMode:o,endpoint:s,region:a}},ha=e=>{const t=e.libraryOptions?.API?.GraphQL?.headers,n=e.libraryOptions?.API?.GraphQL?.withCredentials;return{headers:t,withCredentials:n}};function pa(e){return e.errors&&Array.isArray(e.errors)&&e.errors.forEach((e=>{var t;t=e,(t?.originalError?.name?.startsWith("UnauthorizedException")||t.message?.startsWith("Connection failed:")&&t.message?.includes("Permission denied"))&&(e.message="Unauthorized",e.recoverySuggestion="If you're calling an Amplify-generated API, make sure to set the \"authMode\" in generateClient({ authMode: '...' }) to the backend authorization rule's auth provider ('apiKey', 'userPool', 'iam', 'oidc', 'lambda')")})),e}var fa;!function(e){e.NO_API_KEY="No api-key configured",e.NO_CURRENT_USER="No current user",e.NO_CREDENTIALS="No credentials",e.NO_FEDERATED_JWT="No federated jwt",e.NO_AUTH_TOKEN="No auth token specified"}(fa||(fa={})),Symbol("amplify"),Symbol("authMode"),Symbol("authToken"),Symbol("headers");const ya={name:"NoApiKey",message:fa.NO_API_KEY,recoverySuggestion:'The API request was made with `authMode: "apiKey"` but no API Key was passed into `Amplify.configure()`. Review if your API key is passed into the `Amplify.configure()` function.'},ma={name:"NoCredentials",message:fa.NO_CREDENTIALS,recoverySuggestion:'The API request was made with `authMode: "iam"` but no authentication credentials are available.\n\nIf you intended to make a request using an authenticated role, review if your user is signed in before making the request.\n\nIf you intend to make a request using an unauthenticated role or also known as "guest access", verify if "Auth.Cognito.allowGuestAccess" is set to "true" in the `Amplify.configure()` function.'},ga={name:"NoValidAuthTokens",message:fa.NO_FEDERATED_JWT,recoverySuggestion:"If you intended to make an authenticated API request, review if the current user is signed in."},va={name:"NoSignedUser",message:fa.NO_CURRENT_USER,recoverySuggestion:"Review the underlying exception field for more details. If you intended to make an authenticated API request, review if the current user is signed in."},ba={name:"NoAuthorizationHeader",message:fa.NO_AUTH_TOKEN,recoverySuggestion:'The API request was made with `authMode: "lambda"` but no `authToken` is set. Review if a valid authToken is passed into the request options or in the `Amplify.configure()` function.'},wa={name:"NoEndpoint",message:"No GraphQL endpoint configured in `Amplify.configure()`.",recoverySuggestion:"Review if the GraphQL API endpoint is set in the `Amplify.configure()` function."},Sa=e=>({data:{},errors:[new an(e.message,null,null,null,null,e)]}),Ea="x-amz-user-agent";class Aa{constructor(){this.appSyncRealTime=new sa,this._api={post:zo,cancelREST:Vo,isCancelErrorREST:Ri,updateRequestToBeCancellable:Ho}}getModuleName(){return"InternalGraphQLAPI"}getGraphqlOperationType(e){const t=jn(e).definitions,[{operation:n}]=t;return n}graphql(e,{query:t,variables:n={},authMode:r,authToken:i},o,s){const a=jn("string"==typeof t?t:Wn(t)),[c={}]=a.definitions.filter((e=>"OperationDefinition"===e.kind)),{operation:u}=c,l=o||{};switch(u){case"query":case"mutation":{const t=new AbortController;let o;return o=(e=>"function"!=typeof e)(e)?this._graphql(e,{query:a,variables:n,authMode:r},l,t,s,i):e((async e=>await this._graphql(e,{query:a,variables:n,authMode:r},l,t,s,i))),this._api.updateRequestToBeCancellable(o,t),o}case"subscription":return this._graphqlSubscribe(e,{query:a,variables:n,authMode:r},l,s,i);default:throw new Error(`invalid operation type: ${u}`)}}async _graphql(e,{query:t,variables:n,authMode:r},i={},o,s,a){const{apiKey:c,region:u,endpoint:l,customEndpoint:d,customEndpointRegion:h,defaultAuthMode:p}=da(e),f=r||p||"iam",y="identityPool"===f?"iam":f,{headers:m,withCredentials:g}=ha(e);let v;if("function"==typeof i){const e={method:"POST",url:new w(d||l||"").toString(),queryString:Wn(t)};v=await i(e)}else v=i;a&&(v={...v,Authorization:a});const b=await async function(e,t,n,r={}){let i={};switch(t){case"apiKey":if(!n)throw new aa(ya);i={"X-Api-Key":n};break;case"iam":if(void 0===(await e.Auth.fetchAuthSession()).credentials)throw new aa(ma);break;case"oidc":case"userPool":{let t;try{t=(await e.Auth.fetchAuthSession()).tokens?.accessToken.toString()}catch(e){throw new aa({...va,underlyingError:e})}if(!t)throw new aa(ga);i={Authorization:t};break}case"lambda":if("object"==typeof r&&!r.Authorization)throw new aa(ba);i={Authorization:r.Authorization}}return i}(e,y,c,v),S={...!d&&b,...d&&(h?b:{})||{},...m&&await m({query:Wn(t),variables:n}),...v,...!d&&{[Ea]:Pi(s)}},E={query:Wn(t),variables:n||null};let A;A=d&&!h||"oidc"!==y&&"userPool"!==y&&"iam"!==y&&"lambda"!==y?void 0:{service:h?"execute-api":"appsync",region:h||u};const T=d||l;if(!T)throw Sa(new aa(wa));let I;try{const{body:t}=await this._api.post(e,{url:new w(T),options:{headers:S,body:E,signingServiceInfo:A,withCredentials:g},abortController:o});I=await t.json()}catch(e){if(this.isCancelError(e))throw e;I=Sa(e)}if(function(e){if(!e)return!1;const t=e;return Array.isArray(t.errors)&&t.errors.length>0}(I))throw pa(I);return I}isCancelError(e){return this._api.isCancelErrorREST(e)}cancel(e,t){return this._api.cancelREST(e,t)}_graphqlSubscribe(e,{query:t,variables:n,authMode:r},i={},o,s){const a=da(e),c=r||a?.defaultAuthMode||"iam",u="identityPool"===c?"iam":c,{headers:l}=ha(e);return this.appSyncRealTime.subscribe({query:Wn(t),variables:n,appSyncGraphqlEndpoint:a?.endpoint,region:a?.region,authenticationType:u,apiKey:a?.apiKey,additionalHeaders:i,authToken:s,libraryConfigHeaders:l},o).pipe(fi((e=>{if(e.errors)throw pa(e);throw e})))}}new Aa;class Ta extends g{constructor(){super({name:Vi.PlatformNotSupported,message:"Function not supported on current platform"})}}class Ia{constructor(e){this.storage=e}async setItem(e,t){if(!this.storage)throw new Ta;this.storage.setItem(e,t)}async getItem(e){if(!this.storage)throw new Ta;return this.storage.getItem(e)}async removeItem(e){if(!this.storage)throw new Ta;this.storage.removeItem(e)}async clear(){if(!this.storage)throw new Ta;this.storage.clear()}}class Na{constructor(){this.storage=new Map}get length(){return this.storage.size}key(e){return e>this.length-1?null:Array.from(this.storage.keys())[e]}setItem(e,t){this.storage.set(e,t)}getItem(e){return this.storage.get(e)??null}removeItem(e){this.storage.delete(e)}clear(){this.storage.clear()}}const Oa=new Wi("CoreStorageUtils"),_a={keyPrefix:"aws-amplify-cache",capacityInBytes:1048576,itemMaxSize:21e4,defaultTTL:2592e5,defaultPriority:5,warningThreshold:.8},Ca="CurSize";function Pa(e){let t=0;t=e.length;for(let n=e.length;n>=0;n-=1){const r=e.charCodeAt(n);r>127&&r<=2047?t+=1:r>2047&&r<=65535&&(t+=2),r>=56320&&r<=57343&&(n-=1)}return t}function ka(){return(new Date).getTime()}const xa=e=>`${e}${Ca}`;var Da;!function(e){e.NoCacheItem="NoCacheItem",e.NullNextNode="NullNextNode",e.NullPreviousNode="NullPreviousNode"}(Da||(Da={}));const Ma=((e,t=g)=>(n,r,i)=>{const{message:o,recoverySuggestion:s}=e[r];if(!n)throw new t({name:r,message:i?`${o} ${i}`:o,recoverySuggestion:s})})({[Da.NoCacheItem]:{message:"Item not found in the cache storage."},[Da.NullNextNode]:{message:"Next node is null."},[Da.NullPreviousNode]:{message:"Previous node is null."}}),Ra=new Wi("StorageCache");class Fa{constructor({config:e,keyValueStorage:t}){this.config={..._a,...e},this.keyValueStorage=t,this.sanitizeConfig()}getModuleName(){return"Cache"}configure(e){return e&&(e.keyPrefix&&Ra.warn("keyPrefix can not be re-configured on an existing Cache instance."),this.config={...this.config,...e}),this.sanitizeConfig(),this.config}async getCurrentCacheSize(){let e=await this.getStorage().getItem(xa(this.config.keyPrefix));return e||(await this.getStorage().setItem(xa(this.config.keyPrefix),"0"),e="0"),Number(e)}async setItem(e,t,n){if(Ra.debug(`Set item: key is ${e}, value is ${t} with options: ${n}`),!e||e===Ca)return void Ra.warn(`Invalid key: should not be empty or reserved key: '${Ca}'`);if(void 0===t)return void Ra.warn("The value of item should not be undefined!");const r={priority:void 0!==n?.priority?n.priority:this.config.defaultPriority,expires:void 0!==n?.expires?n.expires:this.config.defaultTTL+ka()};if(r.priority<1||r.priority>5)return void Ra.warn("Invalid parameter: priority due to out or range. It should be within 1 and 5.");const i=`${this.config.keyPrefix}${e}`,o=this.fillCacheItem(i,t,r);if(o.byteSize>this.config.itemMaxSize)Ra.warn(`Item with key: ${e} you are trying to put into is too big!`);else try{const e=await this.getStorage().getItem(i);if(e&&await this.removeCacheItem(i,JSON.parse(e).byteSize),await this.isCacheFull(o.byteSize)){const e=await this.clearInvalidAndGetRemainingKeys();if(await this.isCacheFull(o.byteSize)){const t=await this.sizeToPop(o.byteSize);await this.popOutItems(e,t)}}return this.setCacheItem(i,o)}catch(e){Ra.warn(`setItem failed! ${e}`)}}async getItem(e,t){let n;if(Ra.debug(`Get item: key is ${e} with options ${t}`),!e||e===Ca)return Ra.warn(`Invalid key: should not be empty or reserved key: '${Ca}'`),null;const r=`${this.config.keyPrefix}${e}`;try{if(n=await this.getStorage().getItem(r),null!=n){if(!await this.isExpired(r))return(await this.updateVisitedTime(JSON.parse(n),r)).data;await this.removeCacheItem(r,JSON.parse(n).byteSize)}if(t?.callback){const n=t.callback();return null!==n&&await this.setItem(e,n,t),n}return null}catch(e){return Ra.warn(`getItem failed! ${e}`),null}}async removeItem(e){if(Ra.debug(`Remove item: key is ${e}`),!e||e===Ca)return void Ra.warn(`Invalid key: should not be empty or reserved key: '${Ca}'`);const t=`${this.config.keyPrefix}${e}`;try{const e=await this.getStorage().getItem(t);e&&await this.removeCacheItem(t,JSON.parse(e).byteSize)}catch(e){Ra.warn(`removeItem failed! ${e}`)}}async getAllKeys(){try{return await this.getAllCacheKeys()}catch(e){return Ra.warn(`getAllkeys failed! ${e}`),[]}}getStorage(){return this.keyValueStorage}async isExpired(e){const t=await this.getStorage().getItem(e);Ma(null!==t,Da.NoCacheItem,`Key: ${e}`);const n=JSON.parse(t);return ka()>=n.expires}async removeCacheItem(e,t){const n=await this.getStorage().getItem(e);Ma(null!==n,Da.NoCacheItem,`Key: ${e}`);const r=t??JSON.parse(n).byteSize;await this.decreaseCurrentSizeInBytes(r);try{await this.getStorage().removeItem(e)}catch(e){await this.increaseCurrentSizeInBytes(r),Ra.error(`Failed to remove item: ${e}`)}}fillCacheItem(e,t,n){const r={key:e,data:t,timestamp:ka(),visitedTime:ka(),priority:n.priority??0,expires:n.expires??0,type:typeof t,byteSize:0};return r.byteSize=Pa(JSON.stringify(r)),r.byteSize=Pa(JSON.stringify(r)),r}sanitizeConfig(){this.config.itemMaxSize>this.config.capacityInBytes&&(Ra.error("Invalid parameter: itemMaxSize. It should be smaller than capacityInBytes. Setting back to default."),this.config.itemMaxSize=_a.itemMaxSize),(this.config.defaultPriority>5||this.config.defaultPriority<1)&&(Ra.error("Invalid parameter: defaultPriority. It should be between 1 and 5. Setting back to default."),this.config.defaultPriority=_a.defaultPriority),(Number(this.config.warningThreshold)>1||Number(this.config.warningThreshold)<0)&&(Ra.error("Invalid parameter: warningThreshold. It should be between 0 and 1. Setting back to default."),this.config.warningThreshold=_a.warningThreshold),this.config.capacityInBytes>5242880&&(Ra.error("Cache Capacity should be less than 5MB. Setting back to default. Setting back to default."),this.config.capacityInBytes=_a.capacityInBytes)}async increaseCurrentSizeInBytes(e){const t=await this.getCurrentCacheSize();await this.getStorage().setItem(xa(this.config.keyPrefix),(t+e).toString())}async decreaseCurrentSizeInBytes(e){const t=await this.getCurrentCacheSize();await this.getStorage().setItem(xa(this.config.keyPrefix),(t-e).toString())}async updateVisitedTime(e,t){return e.visitedTime=ka(),await this.getStorage().setItem(t,JSON.stringify(e)),e}async setCacheItem(e,t){await this.increaseCurrentSizeInBytes(t.byteSize);try{await this.getStorage().setItem(e,JSON.stringify(t))}catch(e){await this.decreaseCurrentSizeInBytes(t.byteSize),Ra.error(`Failed to set item ${e}`)}}async sizeToPop(e){const t=await this.getCurrentCacheSize()+e-this.config.capacityInBytes,n=(1-this.config.warningThreshold)*this.config.capacityInBytes;return t>n?t:n}async isCacheFull(e){return e+await this.getCurrentCacheSize()>this.config.capacityInBytes}async popOutItems(e,t){const n=[];let r=t;for(const t of e){const e=await this.getStorage().getItem(t);if(null!=e){const t=JSON.parse(e);n.push(t)}}n.sort(((e,t)=>e.priority>t.priority?-1:e.priority<t.priority?1:e.visitedTime<t.visitedTime?-1:1));for(const e of n)if(await this.removeCacheItem(e.key,e.byteSize),r-=e.byteSize,r<=0)return}async clearInvalidAndGetRemainingKeys(){const e=[],t=await this.getAllCacheKeys({omitSizeKey:!0});for(const n of t)await this.isExpired(n)?await this.removeCacheItem(n):e.push(n);return e}async clear(){Ra.debug("Clear Cache");try{const e=await this.getAllKeys();for(const t of e){const e=`${this.config.keyPrefix}${t}`;await this.getStorage().removeItem(e)}}catch(e){Ra.warn(`clear failed! ${e}`)}}}const La=new Wi("StorageCache");class ja extends Fa{constructor(e){const t=(()=>{try{if("undefined"!=typeof window&&window.localStorage)return window.localStorage}catch(e){Oa.info("localStorage not found. InMemoryStorage is used as a fallback.")}return new Na})();super({config:e,keyValueStorage:new Ia(t)}),this.storage=t,this.getItem=this.getItem.bind(this),this.setItem=this.setItem.bind(this),this.removeItem=this.removeItem.bind(this)}async getAllCacheKeys(e){const{omitSizeKey:t}=e??{},n=[];for(let e=0;e<this.storage.length;e++){const r=this.storage.key(e);t&&r===xa(this.config.keyPrefix)||r?.startsWith(this.config.keyPrefix)&&n.push(r.substring(this.config.keyPrefix.length))}return n}createInstance(e){return e.keyPrefix&&e.keyPrefix!==_a.keyPrefix||(La.error("invalid keyPrefix, setting keyPrefix with timeStamp"),e.keyPrefix=ka.toString()),new ja(e)}}const $a=new ja,Ua=new class{constructor(){this.Cache=$a,this._graphqlApi=new Aa}getModuleName(){return"InternalAPI"}getGraphqlOperationType(e){return this._graphqlApi.getGraphqlOperationType(e)}graphql(e,t,n){const r={category:Zr.API,action:ni.GraphQl,...n};return this._graphqlApi.graphql(Js,e,t,r)}};class qa extends Error{constructor(e){super(`BackgroundManagerNotOpenError: ${e}`)}}var Ba;!function(e){e.Open="Open",e.Closing="Closing",e.Closed="Closed"}(Ba||(Ba={}));class Ga{constructor(){this._state=Ba.Open,this.jobs=new Set}add(e,t){let n,r;"string"==typeof e?(n=void 0,r=e):(n=e,r=t);const i=this.closedFailure(r);if(i)return i;if(void 0===n)return this.addHook(r);if("function"==typeof n)return this.addFunction(n,r);if(!(n instanceof Ga))throw new Error("If `job` is provided, it must be an Observable, Function, or BackgroundProcessManager.");this.addManager(n,r)}addCleaner(e,t){const{resolve:n,onTerminate:r}=this.addHook(t),i=async()=>{await e(),n()};return r.then(i),i}addFunction(e,t){let n;const r=e(new Promise((e=>{n=e})));return"function"==typeof r?.then&&this.registerPromise(r,n,t),r}addManager(e,t){this.addCleaner((async()=>e.close()),t)}addHook(e){let t,n;const r=new Promise(((e,r)=>{t=e,n=r}));let i;const o=new Promise((e=>{i=e}));return this.registerPromise(r,i,e),{resolve:t,reject:n,onTerminate:o}}registerPromise(e,t,n){const r={promise:e,terminate:t,description:n};this.jobs.add(r),e.then((()=>{this.jobs.delete(r)})).catch((()=>{this.jobs.delete(r)}))}get length(){return this.jobs.size}get state(){return this._state}get pending(){return Array.from(this.jobs).map((e=>e.description))}get isOpen(){return this._state===Ba.Open}get isClosing(){return this._state===Ba.Closing}get isClosed(){return this._state===Ba.Closed}closedFailure(e){if(!this.isOpen)return Promise.reject(new qa([`The manager is ${this.state}.`,`You tried to add "${e}".`,`Pending jobs: [\n${this.pending.map((e=>"    "+e)).join(",\n")}\n]`].join("\n")))}async close(){if(this.isOpen){this._state=Ba.Closing;for(const e of Array.from(this.jobs))try{e.terminate()}catch(t){console.warn(`Failed to send termination signal to job. Error: ${t.message}`,e)}this._closingPromise=Promise.allSettled(Array.from(this.jobs).map((e=>e.promise))),await this._closingPromise,this._state=Ba.Closed}return this._closingPromise}async open(){this.isClosing&&await this.close(),this._state=Ba.Open}}const Ka=()=>[];function Wa(e){return"private"!==e.allow||e.provider?"public"!==e.allow||e.provider?e.provider:ge.API_KEY:ge.USER_POOLS}const za=new WeakSet;function Va(e){return za.has(e)}const Ha=new Set(["and","or","not"]),Ja=new Set(["eq","ne","gt","lt","ge","le","contains","notContains","beginsWith","between"]),Qa=e=>Array.isArray(e)?e.every((e=>Qa(e))):Object.keys(e).length<=1;Symbol("A predicate that matches all records");class Ya{static get ALL(){const e=e=>e;return za.add(e),e}}class Xa{static isValidPredicate(e){return Xa.predicateGroupsMap.has(e)}static getPredicates(e,t=!0){if(t&&!Xa.isValidPredicate(e))throw new Error("The predicate is not valid");return Xa.predicateGroupsMap.get(e)}static createForPk(e,t){const n=Mt(e),r=Rt(t,n);return this.createFromAST(e,{and:n.map(((e,t)=>{const n=r[t];return{[e]:{eq:n}}}))})}static createFromFlatEqualities(e,t){const n={and:Object.entries(t).map((([e,t])=>({[e]:{eq:t}})))};return this.createFromAST(e,n)}static transformGraphQLFilterNodeToPredicateAST(e){if(!Qa(e))throw new Error("Invalid GraphQL Condition or subtree: "+JSON.stringify(e));if((e=>!Array.isArray(e)&&0===Object.keys(e).length)(e))return{type:"and",predicates:[]};if((e=>{const t=[...Object.keys(e)];return 1===t.length&&Ha.has(t[0])})(e)){const t=Object.keys(e)[0],n=this.transformGraphQLFilterNodeToPredicateAST(e[t]);return{type:t,predicates:Array.isArray(n)?n:[n]}}if((e=>{const t=[...Object.keys(e)];return!Array.isArray(e)&&1===t.length&&Ja.has(t[0])})(e)){const t=Object.keys(e)[0];return{operator:t,operand:e[t]}}if(Array.isArray(e))return e.map((e=>this.transformGraphQLFilterNodeToPredicateAST(e)));{const t=Object.keys(e)[0];return{field:t,...this.transformGraphQLFilterNodeToPredicateAST(e[t])}}}static createFromAST(e,t){const n={};return Xa.predicateGroupsMap.set(n,this.transformGraphQLFilterNodeToPredicateAST(t)),n}}Xa.predicateGroupsMap=new WeakMap;var Za=dr((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),ec=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return tr(t,e),t.prototype.lift=function(e){var t=new tc(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new Za},t.prototype.next=function(e){var t=this;Cr((function(){var n,r;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var i=ir(t.currentObservers),o=i.next();!o.done;o=i.next())o.value.next(e)}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;Cr((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;Cr((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,r=n.hasError,i=n.isStopped,o=n.observers;return r||i?yr:(this.currentObservers=null,o.push(e),new fr((function(){t.currentObservers=null,pr(o,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,r=t.thrownError,i=t.isStopped;n?e.error(r):i&&e.complete()},t.prototype.asObservable=function(){var e=new Ur;return e.source=this,e},t.create=function(e,t){return new tc(e,t)},t}(Ur),tc=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return tr(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:yr},t}(ec);class nc{constructor(){this._queue=[],this._pending=!1}isLocked(){return this._pending}acquire(){const e=new Promise((e=>this._queue.push(e)));return this._pending||this._dispatchNext(),e}runExclusive(e){return this.acquire().then((t=>{let n;try{n=e()}catch(e){throw t(),e}return Promise.resolve(n).then((e=>(t(),e)),(e=>{throw t(),e}))}))}_dispatchNext(){this._queue.length>0?(this._pending=!0,this._queue.shift()(this._dispatchNext.bind(this))):this._pending=!1}}const rc=new Wi("DataStore"),ic={LIST:"query",CREATE:"mutation",UPDATE:"mutation",DELETE:"mutation",GET:"query"};var oc;!function(e){e.CREATE="Create",e.UPDATE="Update",e.DELETE="Delete",e.GET="Get"}(oc||(oc={}));const sc=Object.keys({_version:void 0,_lastChangedAt:void 0,_deleted:void 0});function ac(e,t){const n=cc(t),r=function(e,t){const n=[];return Object.values(t.fields).forEach((({name:t,type:r})=>{if(qe(r)){const i=e.nonModels[r.nonModel],o=Object.values(cc(i)).map((({name:e})=>e)),s=[];Object.values(i.fields).forEach((t=>{const{type:n,name:r}=t;if(qe(n)){const t=e.nonModels[n.nonModel];s.push(`${r} { ${ac(e,t)} }`)}})),n.push(`${t} { ${o.join(" ")} ${s.join(" ")} }`)}})),n}(e,t),i=function(e,t){const n=function(e){const t=[];return ke(e)&&e.attributes.forEach((e=>{if(e.properties&&e.properties.rules){const n=e.properties.rules.find((e=>"owner"===e.allow));n&&n.ownerField&&t.push(n.ownerField)}})),t}(e);return!t.owner&&n.includes("owner")?["owner"]:[]}(t,n);let o=Object.values(n).map((({name:e})=>e)).concat(i).concat(r);return Pe(t)&&(o=o.concat(sc).concat(function(e,t){const n=[];return Object.values(e.fields).filter((({association:e})=>e&&Object.keys(e).length)).forEach((({name:r,association:i})=>{const{connectionType:o}=i||{};switch(o){case"HAS_ONE":case"HAS_MANY":break;case"BELONGS_TO":if(De(i))if(i.targetNames&&i.targetNames.length>0){const[i]=Lt(t),o=i[e.fields[r].type.model].indexes.find((([e])=>"byPk"===e)),s=o&&o[1],a=s?.join(" ");n.push(`${r} { ${a} _deleted }`)}else n.push(`${r} { id _deleted }`);break;default:throw new Error(`Invalid connection type ${o}`)}})),n}(t,e))),o.join("\n")}function cc(e){const{fields:t}=e;return Object.values(t).filter((e=>!(!$e(e.type)&&!Be(e.type)))).reduce(((e,t)=>(e[t.name]=t,e)),{})}function uc(e){const t=[].concat(e.attributes||[]).find((e=>e&&"auth"===e.type)),{properties:{rules:n=[]}={}}=t||{},r=[];return n.forEach((t=>{const{identityClaim:n="cognito:username",ownerField:i="owner",operations:o=["create","update","delete","read"],provider:s="userPools",groupClaim:a="cognito:groups",allow:c="iam",groups:u=[],groupsField:l=""}=t,d="owner"===c;if(!o.includes("read")&&!d)return;const h={identityClaim:n,ownerField:i,provider:s,groupClaim:a,authStrategy:c,groups:u,groupsField:l,areSubscriptionsPublic:!1};if(d){const t=[].concat(e.attributes||[]).find((e=>e&&"model"===e.type)),{properties:{subscriptions:{level:n="on"}={}}={}}=t||{};h.areSubscriptionsPublic=!o.includes("read")||"public"===n}d?r.push(h):r.unshift(h)})),r}function lc(e,t,n){let r=ac(e,t);const{name:i,pluralName:o}=t;let s,a,c,u;switch(n){case"LIST":s=`sync${o}`,a=`($limit: Int, $nextToken: String, $lastSync: AWSTimestamp, $filter: Model${i}FilterInput)`,c="(limit: $limit, nextToken: $nextToken, lastSync: $lastSync, filter: $filter)",r=`items {\n\t\t\t\t\t\t\t${r}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnextToken\n\t\t\t\t\t\tstartedAt`;break;case"CREATE":s=`create${i}`,a=`($input: Create${i}Input!)`,c="(input: $input)",u=oc.CREATE;break;case"UPDATE":s=`update${i}`,a=`($input: Update${i}Input!, $condition: Model${i}ConditionInput)`,c="(input: $input, condition: $condition)",u=oc.UPDATE;break;case"DELETE":s=`delete${i}`,a=`($input: Delete${i}Input!, $condition: Model${i}ConditionInput)`,c="(input: $input, condition: $condition)",u=oc.DELETE;break;case"GET":s=`get${i}`,a="($id: ID!)",c="(id: $id)",u=oc.GET;break;default:throw new Error(`Invalid graphQlOpType ${n}`)}return[[u,s,`${ic[n]} operation${a}{\n\t\t${s}${c}{\n\t\t\t${r}\n\t\t}\n\t}`]]}function dc(e,t,n,r,i,o,s,a,c){let u;switch(n){case be.INSERT:u=oc.CREATE;break;case be.UPDATE:u=oc.UPDATE;break;case be.DELETE:u=oc.DELETE;break;default:throw new Error(`Invalid opType ${n}`)}const l=bc(t,i),d=a(s,{...be.INSERT&&c?{id:c}:{},data:JSON.stringify(i,((e,n)=>e&&null!==n&&"object"==typeof n&&t.fields[e]&&"AWSJSON"===t.fields[e].type?JSON.stringify(n):n)),modelId:l,model:r.name,operation:u,condition:JSON.stringify(o)});return d}function hc(e,t=[],n=!0){const r={};if(!e||!Array.isArray(e.predicates))return r;const{type:i,predicates:o}=e,s="and"===i||"or"===i;r[i]=s?[]:{};const a=[];if(o.forEach((e=>{if(Ke(e)){const{field:n,operator:r,operand:i}=e;if(t.includes(n))return;const o={[n]:{[r]:i}};return void a.push(o)}const n=hc(e,t,!1);Object.keys(n).length>0&&a.push(n)})),1===a.length){const[e]=a;if(s&&!n||s&&n&&("and"in e||"or"in e))return delete r[i],Object.assign(r,e),r}if(a.forEach((e=>{s?r[i].push(e):r[i]=e})),s){if(0===r[i].length)return{}}else if(0===Object.keys(r[i]).length)return{};return r}var pc;async function fc({authModeStrategy:e,defaultAuthMode:t,modelName:n,schema:r}){const i=Object.values(Ae),o={CREATE:[],READ:[],UPDATE:[],DELETE:[]};try{await Promise.all(i.map((async i=>{const s=await e({schema:r,modelName:n,operation:i});"string"==typeof s?o[i]=[s]:Array.isArray(s)&&s.length?o[i]=s:o[i]=[t]})))}catch(e){rc.debug(`Error getting auth modes for model: ${n}`,e)}return o}function yc(e){const t=[401,403];let n;return e&&e.errors?n=e.errors.find((e=>t.includes(mc(e)))):e&&e.message&&(n=e),n?n.message??`Request failed with status code ${mc(n)}`:null}function mc(e){return e?.$metadata?.httpStatusCode?Number(e?.$metadata?.httpStatusCode):e?.originalError?mc(e?.originalError):null}function gc(e){const t=Object.values(fa);return e&&e.message&&t.find((t=>e.message.includes(t)))||null}async function vc(e,t={}){if("lambda"===e){const{authProviders:{functionAuthProvider:e}={functionAuthProvider:null}}=t;if(!e||"function"!=typeof e)throw new Error("You must provide a `functionAuthProvider` function to `DataStore.configure` when using lambda");try{const{token:t}=await e();return t}catch(e){throw new Error(`Error retrieving token from \`functionAuthProvider\`: ${e}`)}}}function bc(e,t){const n=Mt(e).map((e=>t[e])).join("-");return n}!function(e){e[e.UnknownField=0]="UnknownField",e[e.MaxAttributes=1]="MaxAttributes",e[e.MaxCombinations=2]="MaxCombinations",e[e.RepeatedFieldname=3]="RepeatedFieldname",e[e.NotGroup=4]="NotGroup",e[e.FieldNotInType=5]="FieldNotInType"}(pc||(pc={}));const wc=()=>"undefined"!=typeof window&&void 0!==window.document;let Sc,Ec;const Ac=new WeakMap,Tc=new WeakMap,Ic=new WeakMap,Nc=new WeakMap,Oc=new WeakMap;let _c={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return Tc.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Ic.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Pc(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Cc(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Ec||(Ec=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(kc(this),e),Pc(Ac.get(this))}:function(...e){return Pc(t.apply(kc(this),e))}:function(e,...n){const r=t.call(kc(this),e,...n);return Ic.set(r,e.sort?e.sort():[e]),Pc(r)}:(e instanceof IDBTransaction&&function(e){if(Tc.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",o),e.removeEventListener("abort",o)},i=()=>{t(),r()},o=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",o),e.addEventListener("abort",o)}));Tc.set(e,t)}(e),n=e,(Sc||(Sc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>n instanceof e))?new Proxy(e,_c):e);var t,n}function Pc(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",o)},i=()=>{t(Pc(e.result)),r()},o=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",o)}));return t.then((t=>{t instanceof IDBCursor&&Ac.set(t,e)})).catch((()=>{})),Oc.set(t,e),t}(e);if(Nc.has(e))return Nc.get(e);const t=Cc(e);return t!==e&&(Nc.set(e,t),Oc.set(t,e)),t}const kc=e=>Oc.get(e),xc=["get","getKey","getAll","getAllKeys","count"],Dc=["put","add","delete","clear"],Mc=new Map;function Rc(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Mc.get(t))return Mc.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=Dc.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!xc.includes(n))return;const o=async function(e,...t){const o=this.transaction(e,i?"readwrite":"readonly");let s=o.store;r&&(s=s.index(t.shift()));const a=await s[n](...t);return i&&await o.done,a};return Mc.set(t,o),o}var Fc;Fc=_c,_c={...Fc,get:(e,t,n)=>Rc(e,t)||Fc.get(e,t,n),has:(e,t)=>!!Rc(e,t)||Fc.has(e,t)};class Lc{constructor(e,t){if(!Me(e.schema,t))throw new Error(`${e.schema.name}.${t} is not a relationship.`);this.localModel=e,this._field=t}static from(e,t){return Me(e.schema,t)?new this(e,t):null}static allFrom(e){const t=[];for(const n of Object.keys(e.schema.fields)){const r=Lc.from(e,n);r&&t.push(r)}return t}get localDefinition(){return this.localModel.schema}get field(){return this._field}get localConstructor(){return this.localModel.builder}get type(){return this.localAssocation.connectionType}get localAssocation(){return this.localDefinition.fields[this.field].association}get localJoinFields(){return this.localAssocation.targetName?[this.localAssocation.targetName]:this.localAssocation.targetNames?this.localAssocation.targetNames:this.localPKFields}get localPKFields(){return this.localModel.pkField}get remoteDefinition(){return this.remoteModelType.modelConstructor?.schema}get remoteModelType(){return this.localDefinition.fields[this.field].type}get remoteModelConstructor(){return this.remoteModelType.modelConstructor.builder}get remotePKFields(){return this.remoteModelType.modelConstructor?.pkField||["id"]}get localAssociatedWith(){return"HAS_MANY"===this.localAssocation.connectionType||"HAS_ONE"===this.localAssocation.connectionType?Array.isArray(this.localAssocation.associatedWith)?this.localAssocation.associatedWith:[this.localAssocation.associatedWith]:void 0}get explicitRemoteAssociation(){if(this.localAssociatedWith)return 1===this.localAssociatedWith.length?this.remoteDefinition.fields[this.localAssociatedWith[0]]?.association:void 0}get remoteJoinFields(){return this.explicitRemoteAssociation?.targetName?[this.explicitRemoteAssociation.targetName]:this.explicitRemoteAssociation?.targetNames?this.explicitRemoteAssociation?.targetNames:this.localAssociatedWith?this.localAssociatedWith:this.remotePKFields}get isComplete(){return this.localJoinFields.length>0&&this.remoteJoinFields.length>0}createLocalFKObject(e){const t={};for(let n=0;n<this.localJoinFields.length;n++)t[this.localJoinFields[n]]=e[this.remoteJoinFields[n]];return t}createRemoteQueryObject(e){const t={};for(let n=0;n<this.remoteJoinFields.length;n++){if(null==e[this.localJoinFields[n]])return null;t[this.remoteJoinFields[n]]=e[this.localJoinFields[n]]}return t}}const jc=new Wi("DataStore"),$c="amplify-datastore";class Uc{constructor(){this.dbName=$c}async setUp(e,t,n,r,i){if(await this.preSetUpChecks(),this.initPromise)await this.initPromise;else{this.initPromise=new Promise(((e,t)=>{this.resolve=e,this.reject=t})),i&&(this.dbName=`${$c}-${i}`),this.schema=e,this.namespaceResolver=t,this.modelInstanceCreator=n,this.getModelConstructorByModelName=r;try{this.db||(this.db=await this.initDb(),this.resolve())}catch(e){this.reject(e)}}}getStorenameForModel(e){const t=this.namespaceResolver(e),{name:n}=e;return xt(t,n)}getIndexKeyValuesFromModel(e){const t=Object.getPrototypeOf(e).constructor,n=this.namespaceResolver(t),r=qt(this.schema.namespaces[n],t.name);return Rt(e,r)}saveMetadata(e){const t=Object.getPrototypeOf(e).constructor,n=this.getStorenameForModel(t),r=this.namespaceResolver(t),i=dt(t.name,e,this.schema.namespaces[r],this.modelInstanceCreator,this.getModelConstructorByModelName),o=new Set,s=Object.values(i).map((({modelName:e,item:t,instance:n})=>{const i=xt(r,e);return o.add(i),{storeName:i,item:t,instance:n,keys:qt(this.schema.namespaces[r],e)}})),a=this.getIndexKeyValuesFromModel(e);return{storeName:n,set:o,connectionStoreNames:s,modelKeyValues:a}}validateSaveCondition(e,t){if(!e||!t)return;const n=Xa.getPredicates(e),{predicates:r,type:i}=n;if(!st(t,i,r)){const e="Conditional update failed";throw jc.error(e,{model:t,condition:r}),new Error(e)}}async load(e,t,n){const r=this.schema.namespaces[e].relationships[t].relationTypes.map((({modelName:t})=>xt(e,t))),i=this.getModelConstructorByModelName(e,t);return r.length,n.map((e=>this.modelInstanceCreator(i,e)))}keyValueFromPredicate(e,t){const{predicates:n}=e;if(n.length!==t.length)return;const r=[];for(const e of t){const t=n.find((t=>Ke(t)&&t.field===e&&"eq"===t.operator&&null!==t.operand&&void 0!==t.operand));t&&r.push(t.operand)}return r.length===t.length?r:void 0}queryMetadata(e,t,n){const r=this.getStorenameForModel(e),i=this.namespaceResolver(e),o=t&&Xa.getPredicates(t),s=qt(this.schema.namespaces[i],e.name);return{storeName:r,namespaceName:i,queryByKey:o&&this.keyValueFromPredicate(o,s),predicates:o,hasSort:n&&n.sort,hasPagination:n&&n.limit}}async delete(e,t){await this.preOpCheck();const n=[];if(ct(e)){const r=e,i=this.namespaceResolver(r),o=await this.query(r,t);return await this.deleteTraverse(o,r,i,n),await this.deleteItem(n),[o,n.reduce(((e,{items:t})=>e.concat(t)),[])]}{const r=e,i=Object.getPrototypeOf(r).constructor,o=this.namespaceResolver(i),s=this.getStorenameForModel(i);if(t){const e=this.getIndexKeyValuesFromModel(r),a=await this._get(s,e);if(void 0===a){const e="Model instance not found in storage";return jc.warn(e,{model:r}),[[r],[]]}const c=Xa.getPredicates(t),{predicates:u,type:l}=c;if(!st(a,l,u)){const e="Conditional update failed";throw jc.error(e,{model:a,condition:u}),new Error(e)}await this.deleteTraverse([r],i,o,n)}else await this.deleteTraverse([r],i,o,n);return await this.deleteItem(n),[[r],n.reduce(((e,{items:t})=>e.concat(t)),[])]}}async deleteTraverse(e,t,n,r){const i=["HAS_ONE","HAS_MANY"];for await(const o of e){const e=this.schema.namespaces[n].models[t.name],s={builder:t,schema:e,pkField:Mt(e)},a=Lc.allFrom(s).filter((e=>i.includes(e.type)));for await(const e of a){const t=e.createRemoteQueryObject(o);if(null!==t){const i=await this.query(e.remoteModelConstructor,Xa.createFromFlatEqualities(e.remoteDefinition,t));await this.deleteTraverse(i,e.remoteModelConstructor,n,r)}}}r.push({storeName:xt(n,t.name),items:e})}}const qc=new Wi("DataStore");var Bc=new class extends Uc{constructor(){super(...arguments),this.safariCompatabilityMode=!1,this.canonicalKeyPath=e=>this.safariCompatabilityMode?e.length>1?e:e[0]:e}async preSetUpChecks(){await this.checkPrivate(),await this.setSafariCompatabilityMode()}async preOpCheck(){await this.checkPrivate()}async initDb(){return function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:o}={}){const s=indexedDB.open(e,t),a=Pc(s);return r&&s.addEventListener("upgradeneeded",(e=>{r(Pc(s.result),e.oldVersion,e.newVersion,Pc(s.transaction))})),n&&s.addEventListener("blocked",(()=>n())),a.then((e=>{o&&e.addEventListener("close",(()=>o())),i&&e.addEventListener("versionchange",(()=>i()))})).catch((()=>{})),a}(this.dbName,3,{upgrade:async(e,t,n,r)=>{if(0!==t){if((1===t||2===t)&&3===n)try{for(const t of r.objectStoreNames){const n=r.objectStore(t),i=`tmp_${t}`;n.name=i;const{namespaceName:o,modelName:s}=this.getNamespaceAndModelFromStorename(t);if(!(s in this.schema.namespaces[o].models)){e.deleteObjectStore(i);continue}const a=this.createObjectStoreForModel(e,o,t,s);let c=await n.openCursor(),u=0;for(;c&&c.value;)await a.put(c.value),c=await c.continue(),u++;e.deleteObjectStore(i),qc.debug(`${u} ${t} records migrated`)}Object.keys(this.schema.namespaces).forEach((t=>{const n=this.schema.namespaces[t],i=new Set(r.objectStoreNames);Object.keys(n.models).map((e=>[e,xt(t,e)])).filter((([,e])=>!i.has(e))).forEach((([n,r])=>{this.createObjectStoreForModel(e,t,r,n)}))}))}catch(e){throw qc.error("Error migrating IndexedDB data",e),r.abort(),e}}else Object.keys(this.schema.namespaces).forEach((t=>{const n=this.schema.namespaces[t];Object.keys(n.models).forEach((n=>{const r=xt(t,n);this.createObjectStoreForModel(e,t,r,n)}))}))}})}async _get(e,t){let n;if("string"==typeof e){const t=e;n=this.db.transaction(t,"readonly").store.index("byPk")}else n=e.index("byPk");return await n.get(this.canonicalKeyPath(t))}async clear(){await this.checkPrivate(),this.db?.close(),await function(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",(()=>t())),Pc(n).then((()=>{}))}(this.dbName),this.db=void 0,this.initPromise=void 0}async save(e,t){await this.checkPrivate();const{storeName:n,set:r,connectionStoreNames:i,modelKeyValues:o}=this.saveMetadata(e),s=this.db.transaction([n,...Array.from(r.values())],"readwrite"),a=s.objectStore(n),c=await this._get(a,o);this.validateSaveCondition(t,c);const u=[];for await(const e of i){const{storeName:t,item:n,instance:r,keys:i}=e,a=s.objectStore(t),c=i.map((e=>n[e])),l=await this._get(a,c)?be.UPDATE:be.INSERT;if(Ut(c,o)||l===be.INSERT){const e=await a.index("byPk").getKey(this.canonicalKeyPath(c));await a.put(n,e),u.push([r,l])}}return await s.done,u}async query(e,t,n){await this.checkPrivate();const{storeName:r,namespaceName:i,queryByKey:o,predicates:s,hasSort:a,hasPagination:c}=this.queryMetadata(e,t,n),u=await(async()=>{if(o){const e=await this.getByKey(r,o);return e?[e]:[]}if(s){const e=await this.filterOnPredicate(r,s);return this.inMemoryPagination(e,n)}if(a){const e=await this.getAll(r);return this.inMemoryPagination(e,n)}return c?this.enginePagination(r,n):this.getAll(r)})();return this.load(i,e.name,u)}async queryOne(e,t=we.FIRST){await this.checkPrivate();const n=this.getStorenameForModel(e),r=await this.db.transaction([n],"readonly").objectStore(n).openCursor(void 0,t===we.FIRST?"next":"prev"),i=r?r.value:void 0;return i&&this.modelInstanceCreator(e,i)}async batchSave(e,t){if(await this.checkPrivate(),0===t.length)return[];const n=e.name,r=this.namespaceResolver(e),i=this.getStorenameForModel(e),o=[],s=this.db.transaction(i,"readwrite"),{store:a}=s;for(const i of t){const t=this.modelInstanceCreator(e,i),s=dt(n,t,this.schema.namespaces[r],this.modelInstanceCreator,this.getModelConstructorByModelName),c=this.getIndexKeyValuesFromModel(t),{_deleted:u}=i,l=a.index("byPk"),d=await l.getKey(this.canonicalKeyPath(c));if(u)o.push([i,be.DELETE]),d&&await a.delete(d);else{const{instance:e}=s.find((({instance:e})=>{const t=this.getIndexKeyValuesFromModel(e);return Ut(t,c)}));o.push([e,d?be.UPDATE:be.INSERT]),await a.put(e,d)}}return await s.done,o}async deleteItem(e){const t=e.map((({storeName:e})=>e)),n=this.db.transaction([...t],"readwrite");for await(const t of e){const{storeName:e,items:r}=t,i=n.objectStore(e);for await(const e of r)if(e){let t;if("object"==typeof e){const n=this.getIndexKeyValuesFromModel(e);t=await i.index("byPk").getKey(this.canonicalKeyPath(n))}else{const n=e.toString();t=await i.index("byPk").getKey(n)}void 0!==t&&await i.delete(t)}}}async checkPrivate(){return await new Promise((e=>{const t=m();let n;const r=()=>{ht=!1,e(!0)},i=async()=>{n&&n.result&&"function"==typeof n.result.close&&await n.result.close(),await indexedDB.deleteDatabase(t),ht=!0,e(!1)};if(!0===ht)return i();!1!==ht&&null!==indexedDB?(n=indexedDB.open(t),n.onerror=r,n.onsuccess=i):r()}))?(qc.error("IndexedDB not supported in this browser's private mode"),Promise.reject("IndexedDB not supported in this browser's private mode")):Promise.resolve()}async setSafariCompatabilityMode(){this.safariCompatabilityMode=await(async()=>{try{const e=m(),t="indexedDBFeatureProbeStore",n="idx";if(null===indexedDB)return!1;if(void 0!==pt)return pt;const r=await new Promise((r=>{const i=indexedDB.open(e);i.onerror=()=>{r(!1)},i.onsuccess=()=>{const e=i.result;r(e)},i.onupgradeneeded=e=>{const i=e?.target?.result;i.onerror=()=>{r(!1)},i.createObjectStore(t,{autoIncrement:!0}).createIndex(n,["id"])}}));if(!r)throw new Error("Could not open probe DB");const i=r.transaction(t,"readwrite");i.objectStore(t).add({id:1}),i.commit();const o=await new Promise((e=>{const i=r.transaction(t,"readonly").objectStore(t).index(n).get([1]);i.onerror=()=>{e(!1)},i.onsuccess=t=>{e(t?.target?.result)}}));r&&"function"==typeof r.close&&await r.close(),await indexedDB.deleteDatabase(e),pt=void 0===o}catch(e){pt=!1}return pt})(),!0===this.safariCompatabilityMode&&qc.debug("IndexedDB Adapter is running in Safari Compatability Mode")}getNamespaceAndModelFromStorename(e){const[t,...n]=e.split("_");return{namespaceName:t,modelName:n.join("_")}}createObjectStoreForModel(e,t,n,r){const i=e.createObjectStore(n,{autoIncrement:!0}),{indexes:o}=this.schema.namespaces[t].relationships[r];return o.forEach((([e,t,n])=>{i.createIndex(e,t,n)})),i}async getByKey(e,t){return await this._get(e,t)}async getAll(e){return this.db.getAll(e)}matchingIndexQueries(e,t,n){const r=[],i=new Map;for(const e of t)i.set(String(e.field),e);const o=n.objectStore(e);for(const t of o.indexNames){const n=o.index(t),s=Array.isArray(n.keyPath)?n.keyPath:[n.keyPath],a=[];for(const e of s){const t=i.get(e);if(!t||null===t.operand||void 0===t.operand)break;a.push(t.operand)}a.length===s.length&&r.push((()=>this.db.transaction(e).objectStore(e).index(t).getAll(this.canonicalKeyPath(a))))}return r}async baseQueryIndex(e,t,n){let{predicates:r,type:i}=t;for(;1===r.length&&We(r[0])&&"not"!==r[0].type;)({type:i}=r[0]),r=r[0].predicates;const o=r.filter((e=>Ke(e)&&"eq"===e.operator)),s=n||this.db.transaction(e);let a={};if("or"===i){const t=await Promise.all(r.filter((e=>We(e)&&"and"===e.type)).map((t=>this.baseQueryIndex(e,t,s)))).then((e=>e.filter((e=>1===e.indexedQueries.length)).map((e=>e.indexedQueries)))),n=r.filter((e=>Ke(e))).map((t=>this.matchingIndexQueries(e,[t],s))),i=[...t,...n].map((e=>e[0])).filter((e=>e));a=r.length>i.length?{groupType:null,indexedQueries:[]}:{groupType:"or",indexedQueries:i}}else a="and"===i?{groupType:i,indexedQueries:this.matchingIndexQueries(e,o,s)}:{groupType:null,indexedQueries:[]};return n||await s.done,a}async filterOnPredicate(e,t){const{predicates:n,type:r}=t,{groupType:i,indexedQueries:o}=await this.baseQueryIndex(e,t);let s;if("and"===i&&o.length>0)s=await o[0]();else if("or"===i&&o.length>0&&o.length<=7){const e=new Map;for(const t of o){const n=await t();for(const t of n){const n=JSON.stringify(t);e.set(n,t)}}s=Array.from(e.values())}else s=await this.getAll(e);const a=n?s.filter((e=>st(e,r,n))):s;return a}inMemoryPagination(e,t){return wt(e,t)}async enginePagination(e,t){let n;if(t){const{page:r=0,limit:i=0}=t,o=Math.max(0,r*i)||0;let s=await this.db.transaction(e).objectStore(e).openCursor();s&&o>0&&await s.advance(o);const a=[],c="number"==typeof i&&i>0;for(;s&&s.value&&(a.push(s.value),!c||a.length!==i);)s=await s.continue();n=a}else n=await this.db.getAll(e);return n}};class Gc{constructor(){this.db=new Map,this.getAllKeys=async()=>Array.from(this.db.keys()),this.multiGet=async e=>e.reduce(((e,t)=>(e.push([t,this.db.get(t)]),e)),[]),this.multiRemove=async(e,t)=>{e.forEach((e=>this.db.delete(e))),"function"==typeof t&&t()},this.multiSet=async(e,t)=>{e.forEach((([e,t])=>{this.setItem(e,t)})),"function"==typeof t&&t()},this.setItem=async(e,t)=>this.db.set(e,t),this.removeItem=async e=>this.db.delete(e),this.getItem=async e=>this.db.get(e)}}const Kc="@AmplifyDatastore",Wc="Data",zc=new Map;class Vc{constructor(){this._collectionInMemoryIndex=new Map,this.storage=new Gc}getCollectionIndex(e){return this._collectionInMemoryIndex.has(e)||this._collectionInMemoryIndex.set(e,new Map),this._collectionInMemoryIndex.get(e)}getMonotonicFactory(e){return zc.has(e)||zc.set(e,mt()),zc.get(e)}async init(){this._collectionInMemoryIndex.clear();const e=await this.storage.getAllKeys(),t=[];for(const n of e){const[e,r,i,o,s]=n.split("::");if(e===Kc)if(i===Wc){let e;if(void 0===s){const t=o,n=this.getMonotonicFactory(r)(),i=this.getLegacyKeyForItem(r,t),s=this.getKeyForItem(r,t,n),a=await this.storage.getItem(i);await this.storage.setItem(s,a),await this.storage.removeItem(i),e=n}else e=o;this.getCollectionIndex(r).set(s,e)}else"Collection"===i&&t.push(n)}t.length>0&&await this.storage.multiRemove(t)}async save(e,t,n,r){const i=$t(n),o=this.getCollectionIndex(t)?.get(i)||this.getMonotonicFactory(t)(),s=this.getKeyForItem(t,r,o);this.getCollectionIndex(t)?.set(r,o),await this.storage.setItem(s,JSON.stringify(e))}async batchSave(e,t,n){if(0===t.length)return[];const r=[],i=this.getCollectionIndex(e),o=new Set,s=new Set,a=[],c={};for(const r of t){const t=n.map((e=>r[e])),{_deleted:u}=r,l=i.get(t.join(Xe))||this.getMonotonicFactory(e)(),d=this.getKeyForItem(e,t.join(Xe),l);a.push(d),c[d]={ulid:l,model:r},u?o.add(d):s.add(d)}const u=(await this.storage.multiGet(a)).filter((([,e])=>!!e)).reduce(((e,[t])=>e.add(t)),new Set);await new Promise(((e,t)=>{if(0===o.size)return void e();const r=Array.from(o);r.forEach((e=>{const t=n.map((t=>c[e].model[t])).join(Xe);i.delete(t)})),this.storage.multiRemove(r,(n=>{n&&n.length>0?t(n):e()}))})),await new Promise(((e,t)=>{if(0===s.size)return void e();const r=Array.from(s).map((e=>[e,JSON.stringify(c[e].model)]));s.forEach((e=>{const{model:t,ulid:r}=c[e],o=n.map((e=>t[e])).join(Xe);i.set(o,r)})),this.storage.multiSet(r,(n=>{n&&n.length>0?t(n):e()}))}));for(const e of a)o.has(e)&&u.has(e)?r.push([c[e].model,be.DELETE]):s.has(e)&&r.push([c[e].model,u.has(e)?be.UPDATE:be.INSERT]);return r}async get(e,t){const n=this.getCollectionIndex(t).get(e),r=this.getKeyForItem(t,e,n),i=await this.storage.getItem(r);return i&&JSON.parse(i)}async getOne(e,t){const n=this.getCollectionIndex(t),[r,i]=e===we.FIRST?(()=>{let e,t;for([e,t]of n)break;return[e,t]})():(()=>{let e,t;for([e,t]of n);return[e,t]})(),o=this.getKeyForItem(t,r,i),s=o&&await this.storage.getItem(o);return s&&JSON.parse(s)||void 0}async getAll(e,t){const n=this.getCollectionIndex(e),{page:r=0,limit:i=0}=t||{},o=Math.max(0,r*i)||0,s=i>0?o+i:void 0,a=[];let c=0;for(const[t,r]of n)if(c++,!(c<=o)&&(a.push(this.getKeyForItem(e,t,r)),c===s))break;return(await this.storage.multiGet(a)).filter((([,e])=>e)).map((([,e])=>JSON.parse(e)))}async delete(e,t){const n=this.getCollectionIndex(t).get(e),r=this.getKeyForItem(t,e,n);this.getCollectionIndex(t).delete(e),await this.storage.removeItem(r)}async clear(){const e=(await this.storage.getAllKeys()).filter((e=>e.startsWith(Kc)));await this.storage.multiRemove(e),this._collectionInMemoryIndex.clear()}getKeyForItem(e,t,n){return`${this.getKeyPrefixForStoreItems(e)}::${n}::${t}`}getLegacyKeyForItem(e,t){return`${this.getKeyPrefixForStoreItems(e)}::${t}`}getKeyPrefixForStoreItems(e){return`${Kc}::${e}::${Wc}`}}var Hc=new class extends Uc{async preSetUpChecks(){}async preOpCheck(){}async initDb(){const e=new Vc;return await e.init(),e}async clear(){await this.db.clear(),this.db=void 0,this.initPromise=void 0}async batchSave(e,t){if(0===t.length)return[];const n=e.name,r=this.namespaceResolver(e),i=xt(r,n),o=qt(this.schema.namespaces[r],n),s=[];for(const i of t){const t=this.modelInstanceCreator(e,i),o=dt(n,t,this.schema.namespaces[r],this.modelInstanceCreator,this.getModelConstructorByModelName),a=this.getIndexKeyValuesPath(t),{instance:c}=o.find((({instance:e})=>{const t=this.getIndexKeyValuesPath(e);return Ut([t],[a])}));s.push(c)}return this.db.batchSave(i,s,o)}async _get(e,t){const n=t.join(Xe);return await this.db.get(n,e)}async save(e,t){const{storeName:n,connectionStoreNames:r,modelKeyValues:i}=this.saveMetadata(e),o=await this._get(n,i);this.validateSaveCondition(t,o);const s=[];for await(const e of r){const{storeName:t,item:n,instance:r,keys:o}=e,a=o.map((e=>n[e])),c=await this._get(t,a)?be.UPDATE:be.INSERT;(Ut(a,i)||c===be.INSERT)&&(await this.db.save(n,t,o,a.join(Xe)),s.push([r,c]))}return s}async query(e,t,n){const{storeName:r,namespaceName:i,queryByKey:o,predicates:s,hasSort:a,hasPagination:c}=this.queryMetadata(e,t,n),u=await(async()=>{if(o){const e=o.join(Xe),t=await this.getByKey(r,e);return t?[t]:[]}if(s){const e=await this.filterOnPredicate(r,s);return this.inMemoryPagination(e,n)}if(a||c){const e=await this.getAll(r);return this.inMemoryPagination(e,n)}return this.getAll(r)})();return this.load(i,e.name,u)}async getByKey(e,t){return await this.db.get(t,e)}async getAll(e){return this.db.getAll(e)}async filterOnPredicate(e,t){const{predicates:n,type:r}=t,i=await this.getAll(e),o=n?i.filter((e=>st(e,r,n))):i;return o}inMemoryPagination(e,t){return wt(e,t)}async queryOne(e,t=we.FIRST){const n=this.getStorenameForModel(e),r=await this.db.getOne(t,n);return r&&this.modelInstanceCreator(e,r)}async deleteItem(e){for await(const t of e){const{storeName:e,items:n}=t;for await(const t of n)if(t&&"object"==typeof t){const n=this.getIndexKeyValuesPath(t);await this.db.delete(n,e)}}}getIndexKeyValuesPath(e){return this.getIndexKeyValuesFromModel(e).join(Xe)}};const Jc=()=>wc&&window.indexedDB||Es()&&self.indexedDB?Bc:Hc,Qc=new Wi("DataStore");class Yc{constructor(e,t,n,r,i,o){this.schema=e,this.namespaceResolver=t,this.getModelConstructorByModelName=n,this.modelInstanceCreator=r,this.adapter=i,this.sessionId=o,this.adapter=this.adapter||Jc(),this.pushStream=new ec}static getNamespace(){return{name:it,relationships:{},enums:{},models:{},nonModels:{}}}async init(){if(void 0!==this.initialized)return void await this.initialized;let e,t;Qc.debug("Starting Storage"),this.initialized=new Promise(((n,r)=>{e=n,t=r})),this.adapter.setUp(this.schema,this.namespaceResolver,this.modelInstanceCreator,this.getModelConstructorByModelName,this.sessionId).then(e,t),await this.initialized}async save(e,t,n,r){if(await this.init(),!this.adapter)throw new Error("Storage adapter is missing");const i=await this.adapter.save(e,t);return i.forEach((o=>{const[s,a]=o,c=!!n;let u;if((a===be.UPDATE||a===be.INSERT)&&!c&&(u=this.getChangedFieldsInput(e,s,r),null===u))return i;const l=u||s,d=Object.getPrototypeOf(s).constructor;this.pushStream.next({model:d,opType:a,element:l,mutator:n,condition:t&&Xa.getPredicates(t,!1)||null,savedElement:s})})),i}async delete(e,t,n){if(await this.init(),!this.adapter)throw new Error("Storage adapter is missing");let r,i;[r,i]=await this.adapter.delete(e,t);const o=ct(e)?e:Object.getPrototypeOf(e||{}).constructor,s=this.namespaceResolver(o),a=this.schema.namespaces[s].models[o.name],c=new Set(r.map((e=>bc(a,e))));return ct(e)||Array.isArray(i)||(i=[i]),i.forEach((r=>{const i=Object.getPrototypeOf(r).constructor;let o;if(!ct(e)){const e=bc(a,r);o=c.has(e)?Xa.getPredicates(t,!1):void 0}this.pushStream.next({model:i,opType:be.DELETE,element:r,mutator:n,condition:o||null})})),[r,i]}async query(e,t,n){if(await this.init(),!this.adapter)throw new Error("Storage adapter is missing");return this.adapter.query(e,t,n)}async queryOne(e,t=we.FIRST){if(await this.init(),!this.adapter)throw new Error("Storage adapter is missing");return this.adapter.queryOne(e,t)}observe(e,t,n){const r=!e,{predicates:i,type:o}=t&&Xa.getPredicates(t,!1)||{};let s=this.pushStream.pipe(ms((({mutator:e})=>!n||e!==n))).pipe(ys((({mutator:e,...t})=>t)));return r||(s=s.pipe(ms((({model:t,element:n})=>e===t&&(!i||!o||st(n,o,i)))))),s}async clear(e=!0){if(this.initialized=void 0,!this.adapter)throw new Error("Storage adapter is missing");await this.adapter.clear(),e&&this.pushStream.complete()}async batchSave(e,t,n){if(await this.init(),!this.adapter)throw new Error("Storage adapter is missing");const r=await this.adapter.batchSave(e,t);return r.forEach((([t,r])=>{this.pushStream.next({model:e,opType:r,element:t,mutator:n,condition:null})})),r}getChangedFieldsInput(e,t,n){if(!n||!n.length)return null;const[r,i]=n,o={},s=r.map((e=>e.path&&e.path[0])),a=Object.getPrototypeOf(e).constructor,c=this.namespaceResolver(a),{fields:u}=this.schema.namespaces[c].models[a.name],{primaryKey:l,compositeKeys:d=[]}=this.schema.namespaces[c].keys?.[a.name]||{};if(s.forEach((e=>{const n=De(u[e]?.association);if(Array.isArray(n)){for(const e of n)if(!bt(i[e],t[e])){o[e]=void 0===t[e]?null:t[e];for(const n of d)if(n.has(e))for(const e of n)o[e]=t[e]}}else{const r=n||e;if(!bt(i[r],t[r])){o[r]=void 0===t[r]?null:t[r];for(const e of d)if(e.has(r))for(const n of e)o[n]=t[n]}}})),0===Object.keys(o).length)return null;if(l&&l.length)for(const e of l)o[e]=t[e];const{id:h,_version:p,_lastChangedAt:f,_deleted:y}=t;return{...o,id:h,_version:p,_lastChangedAt:f,_deleted:y}}}class Xc{constructor(e,t,n,r,i,o){this.mutex=new nc,this.storage=new Yc(e,t,n,r,i,o)}runExclusive(e){return this.mutex.runExclusive(e.bind(this,this.storage))}async save(e,t,n,r){return this.runExclusive((i=>i.save(e,t,n,r)))}async delete(e,t,n){return this.runExclusive((r=>{if(ct(e)){const i=e;return r.delete(i,t,n)}{const i=e;return r.delete(i,t,n)}}))}async query(e,t,n){return this.runExclusive((r=>r.query(e,t,n)))}async queryOne(e,t=we.FIRST){return this.runExclusive((n=>n.queryOne(e,t)))}static getNamespace(){return Yc.getNamespace()}observe(e,t,n){return this.storage.observe(e,t,n)}async clear(){await this.runExclusive((e=>e.clear()))}batchSave(e,t){return this.storage.batchSave(e,t)}async init(){return this.storage.init()}}const Zc=(new As).networkMonitor();class eu{constructor(){this.connectionStatus={online:!1}}status(){if(this.observer)throw new Error("Subscriber already exists");return new Ur((e=>(this.observer=e,this.subscription=Zc.subscribe((({online:t})=>{this.connectionStatus.online=t;const n={...this.connectionStatus};e.next(n)})),()=>{clearTimeout(this.timeout),this.unsubscribe()})))}unsubscribe(){this.subscription&&(clearTimeout(this.timeout),this.subscription.unsubscribe())}async stop(){this.unsubscribe()}socketDisconnected(){this.observer&&"function"==typeof this.observer.next&&(this.observer.next({online:!1}),this.timeout=setTimeout((()=>{const e={...this.connectionStatus};this.observer.next(e)}),5e3))}}class tu{constructor(e,t){this.outbox=e,this.ownSymbol=t}async merge(e,t,n){let r;const i=await this.outbox.getForModel(e,t,n),o=t._deleted;return 0===i.length&&(o?(r=be.DELETE,await e.delete(t,void 0,this.ownSymbol)):[[,r]]=await e.save(t,void 0,this.ownSymbol)),r}async mergePage(e,t,n,r){const i=new Map;for(const e of n){const t=bc(r,e);i.set(t,e)}const o=[...i.values()];return e.batchSave(t,o,this.ownSymbol)}}class nu{constructor(e,t,n,r){this.schema=e,this._MutationEvent=t,this.modelInstanceCreator=n,this.ownSymbol=r}async enqueue(e,t){await e.runExclusive((async e=>{const n=this.schema.namespaces[rt].models.MutationEvent,r=Xa.createFromAST(n,{and:[{modelId:{eq:t.modelId}},{id:{ne:this.inProgressMutationEventId}}]}),[i]=await e.query(this._MutationEvent,r);if(void 0===i)return void await e.save(t,void 0,this.ownSymbol);const{operation:o}=t;if(i.operation===oc.CREATE)if(o===oc.DELETE)await e.delete(this._MutationEvent,r);else{const n=this.mergeUserFields(i,t);await e.save(this._MutationEvent.copyOf(i,(e=>{e.data=n.data})),void 0,this.ownSymbol)}else{const{condition:n}=t,o=JSON.parse(n);let s;0===Object.keys(o).length&&(s=this.mergeUserFields(i,t),await e.delete(this._MutationEvent,r)),s=s||t,await e.save(s,void 0,this.ownSymbol)}}))}async dequeue(e,t,n){const r=await this.peek(e);return t&&await this.syncOutboxVersionsOnDequeue(e,t,r,n),r&&await e.delete(r),this.inProgressMutationEventId=void 0,r}async peek(e){const t=await e.queryOne(this._MutationEvent,we.FIRST);return this.inProgressMutationEventId=t?t.id:void 0,t}async getForModel(e,t,n){const r=this.schema.namespaces[rt].models.MutationEvent,i=bc(n,t);return await e.query(this._MutationEvent,Xa.createFromAST(r,{and:{modelId:{eq:i}}}))}async getModelIds(e){const t=await e.query(this._MutationEvent),n=new Set;return t.forEach((({modelId:e})=>n.add(e))),n}async syncOutboxVersionsOnDequeue(e,t,n,r){if(n?.operation!==r)return;const{_version:i,_lastChangedAt:o,_deleted:s,...a}=t,c=this.removeTimestampFields(n.model,a),u=JSON.parse(n.data);if(!u)return;const{_version:l,_lastChangedAt:d,_deleted:h,...p}=u;if(!function(e,t,n=!1){const r=Object.keys(e);for(const i of r)if(!bt(e[i],t[i],n))return!1;return!0}(this.removeTimestampFields(n.model,p),c,!0))return;const f=this.schema.namespaces[rt].models.MutationEvent,y=bc(this.schema.namespaces.user.models[n.model],t),m=Xa.createFromAST(f,{and:[{modelId:{eq:y}},{id:{ne:this.inProgressMutationEventId}}]}),g=await e.query(this._MutationEvent,m);if(!g.length)return;const v=g.map((e=>{const t={...JSON.parse(e.data),_version:i,_lastChangedAt:o};return this._MutationEvent.copyOf(e,(e=>{e.data=JSON.stringify(t)}))}));await e.delete(this._MutationEvent,m),await Promise.all(v.map((async t=>e.save(t,void 0,this.ownSymbol))))}mergeUserFields(e,t){const{_version:n,_lastChangedAt:r,_deleted:i,...o}=JSON.parse(e.data),{_version:s,_lastChangedAt:a,_deleted:c,...u}=JSON.parse(t.data),l=JSON.stringify({_version:n,_lastChangedAt:r,_deleted:i,...o,...u});return this.modelInstanceCreator(this._MutationEvent,{...t,data:l})}removeTimestampFields(e,t){const n="createdAt",r="updatedAt";let i=n,o=r;const s=this.schema.namespaces[nt].models[e].attributes?.find((e=>"model"===e.type)),a=s?.properties?.timestamps;return a&&(i=a[n],o=a[r]),delete t[i],delete t[o],t}}const ru=e=>/^Connection failed: Connection Timeout/.test(e.message),iu=e=>mc(e)>=500,ou={BadModel:()=>!1,BadRecord:e=>{const{message:t}=e;return/^Cannot return \w+ for [\w-_]+ type/.test(t)||/^Variable '.+' has coerced Null value for NonNull type/.test(t)},ConfigError:()=>!1,Transient:e=>ru(e)||iu(e),Unauthorized:e=>"Unauthorized"===e.message||401===mc(e)},su={BadModel:()=>!1,BadRecord:()=>!1,ConfigError:()=>!1,Transient:e=>{const t=cu(e);return ru(t)||iu(t)},Unauthorized:e=>{const t=cu(e);return/Connection failed.+Unauthorized/.test(t.message)}},au={BadModel:()=>!1,BadRecord:e=>/^Cannot return \w+ for [\w-_]+ type/.test(e.message),ConfigError:()=>!1,Transient:e=>ru(e)||iu(e),Unauthorized:e=>"Unauthorized"===e.errorType};function cu(e){const{errors:[t]}=e;return t}function uu(e){return du(ou,e)}function lu(e){return du(au,e)}function du(e,t){const n=[...Object.keys(e)];for(const r of n){const n=e[r];if(n?.(t))return r}return"Unknown"}const hu=new Wi("DataStore");class pu{constructor(e,t,n,r,i,o,s={},a,c,u,l){this.schema=e,this.storage=t,this.userClasses=n,this.outbox=r,this.modelInstanceCreator=i,this._MutationEvent=o,this.amplifyConfig=s,this.authModeStrategy=a,this.errorHandler=c,this.conflictHandler=u,this.amplifyContext=l,this.typeQuery=new WeakMap,this.processing=!1,this.runningProcesses=new Ga,this.amplifyContext.InternalAPI=this.amplifyContext.InternalAPI||Ua,this.generateQueries()}generateQueries(){Object.values(this.schema.namespaces).forEach((e=>{Object.values(e.models).filter((({syncable:e})=>e)).forEach((t=>{const[n]=lc(e,t,"CREATE"),[r]=lc(e,t,"UPDATE"),[i]=lc(e,t,"DELETE");this.typeQuery.set(t,[n,r,i])}))}))}isReady(){return void 0!==this.observer}start(){return this.runningProcesses=new Ga,new Ur((e=>{this.observer=e;try{this.resume()}catch(e){throw hu.error("mutations processor start error",e),e}return this.runningProcesses.addCleaner((async()=>{this.removeObserver(),this.pause()}))}))}async stop(){this.removeObserver(),await this.runningProcesses.close(),await this.runningProcesses.open()}removeObserver(){this.observer?.complete?.(),this.observer=void 0}async resume(){this.runningProcesses.isOpen&&await this.runningProcesses.add((async e=>{if(this.processing||!this.isReady()||!this.runningProcesses.isOpen)return;let t;this.processing=!0;const n=nt;for(;this.processing&&this.runningProcesses.isOpen&&void 0!==(t=await this.outbox.peek(this.storage));){const{model:r,operation:i,data:o,condition:s}=t,a=this.userClasses[r];let c,u,l;try{const d=(await fc({authModeStrategy:this.authModeStrategy,defaultAuthMode:this.amplifyConfig.aws_appsync_authenticationType,modelName:r,schema:this.schema}))[i.toUpperCase()];let h=0;const p=async()=>{try{hu.debug(`Attempting mutation with authMode: ${d[h]}`);const c=await this.jitteredRetry(n,r,i,o,s,a,this._MutationEvent,t,d[h],e);return hu.debug(`Mutation sent successfully with authMode: ${d[h]}`),c}catch(e){if(h++,h>=d.length){hu.debug(`Mutation failed with authMode: ${d[h-1]}`);try{await this.errorHandler({recoverySuggestion:"Ensure app code is up to date, auth directives exist and are correct on each model, and that server-side data has not been invalidated by a schema change. If the problem persists, search for or create an issue: https://github.com/aws-amplify/amplify-js/issues",localModel:null,message:e.message,model:a.name,operation:u,errorType:uu(e),process:Te.sync,remoteModel:null,cause:e})}catch(e){hu.error("Mutation error handler failed with:",e)}throw e}return hu.debug(`Mutation failed with authMode: ${d[h-1]}. Retrying with authMode: ${d[h]}`),p()}};[c,u,l]=await p()}catch(e){if("Offline"===e.message||"RetryMutation"===e.message)continue}if(void 0===c){hu.debug("done retrying"),await this.storage.runExclusive((async e=>{await this.outbox.dequeue(e)}));continue}const d=c.data[u];let h=!1;await this.storage.runExclusive((async e=>{await this.outbox.dequeue(e,d,i),h=void 0!==await this.outbox.peek(e)})),this.observer?.next?.({operation:i,modelDefinition:l,model:d,hasMore:h})}this.pause()}),"mutation resume loop")}async jitteredRetry(e,t,n,r,i,o,s,a,c,u){return ds((async(t,n,r,i,o,s,a)=>{const[u,l,d,h,p]=this.createQueryVariables(e,t,n,r,i),f=await vc(c,this.amplifyConfig),y={query:u,variables:l,authMode:c,authToken:f};let m=0;const g=this.opTypeFromTransformerOperation(n),v={category:Zr.DataStore,action:ii.GraphQl};do{try{return[await this.amplifyContext.InternalAPI.graphql(y,void 0,v),h,p]}catch(t){if(!(t.errors&&t.errors.length>0))throw new as(t);{const[r]=t.errors,{originalError:{code:i=null}={}}=r;if("Unauthorized"===r.errorType)throw new as("Unauthorized");if("Network Error"===r.message||"ERR_NETWORK"===i){if(!this.processing)throw new as("Offline");throw new Error("Network Error")}if("ConflictUnhandled"===r.errorType){let t;if(m++,m>10)t=Ve;else try{t=await this.conflictHandler({modelConstructor:o,localModel:this.modelInstanceCreator(o,l.input),remoteModel:this.modelInstanceCreator(o,r.data),operation:g,attempts:m})}catch(e){hu.warn("conflict trycatch",e);continue}if(t===Ve){const[[,t,n]]=lc(this.schema.namespaces[e],p,"GET"),r=await vc(c,this.amplifyConfig);return[await this.amplifyContext.InternalAPI.graphql({query:n,variables:{id:l.input.id},authMode:c,authToken:r},void 0,v),t,p]}const n=dc(this.schema.namespaces[e].relationships,p,g,o,t,d,s,this.modelInstanceCreator,a.id);throw await this.storage.save(n),new as("RetryMutation")}try{this.errorHandler({recoverySuggestion:"Ensure app code is up to date, auth directives exist and are correct on each model, and that server-side data has not been invalidated by a schema change. If the problem persists, search for or create an issue: https://github.com/aws-amplify/amplify-js/issues",localModel:l.input,message:r.message,operation:n,errorType:uu(r),errorInfo:r.errorInfo,process:Te.mutate,cause:r,remoteModel:r.data?this.modelInstanceCreator(o,r.data):null})}catch(e){hu.warn("Mutation error handler failed with:",e)}finally{return r.data?[{data:{[h]:r.data}},h,p]:[]}}}}while(y)}),[t,n,r,i,o,s,a],mu,u)}createQueryVariables(e,t,n,r,i){const o=this.schema.namespaces[e].models[t],{primaryKey:s}=this.schema.namespaces[e].keys[t],a=o.attributes?.find((e=>"auth"===e.type)),c=a?.properties?.rules.map((e=>e.ownerField)).filter((e=>e))||["owner"],u=this.typeQuery.get(o),[,l,d]=u.find((([e])=>e===n)),{_version:h,...p}=JSON.parse(r),f={};if(s&&s.length)for(const e of s)f[e]=p[e];else f[Ye]=p.id;let y;if(n===oc.DELETE)y=f;else{y={};const e=Object.values(o.fields);for(const{name:t,type:r,association:i,isReadOnly:o}of e)if(!(o||c.includes(t)&&null===p[t]))if(Ue(r)){if(De(i)&&"BELONGS_TO"===i.connectionType){const e=jt(i);if(e)for(const t of e)y[t]=p[t]}}else(n!==oc.UPDATE||Object.prototype.hasOwnProperty.call(p,t))&&(y[t]=p[t])}const m={...y,_version:h},g=JSON.parse(i);return[d,{input:m,...n===oc.CREATE?{}:{condition:Object.keys(g).length>0?g:null}},g,l,o]}opTypeFromTransformerOperation(e){switch(e){case oc.CREATE:return be.INSERT;case oc.DELETE:return be.DELETE;case oc.UPDATE:return be.UPDATE;case oc.GET:break;default:throw new Error(`Invalid operation ${e}`)}}pause(){this.processing=!1}}const fu=3e5,yu=eo(fu),mu=(e,t,n)=>{const r=yu(e);return!1===r&&"Network Error"===(n||{}).message?fu:r},gu=new Wi("DataStore");var vu,bu;!function(e){e.CONNECTED="CONNECTED"}(vu||(vu={})),function(e){e[e.none=0]="none",e[e.unauth=1]="unauth",e[e.auth=2]="auth"}(bu||(bu={}));class wu{constructor(e,t,n={},r,i,o={InternalAPI:Ua}){this.schema=e,this.syncPredicates=t,this.amplifyConfig=n,this.authModeStrategy=r,this.errorHandler=i,this.amplifyContext=o,this.typeQuery=new WeakMap,this.buffer=[],this.runningProcesses=new Ga}buildSubscription(e,t,n,r,i,o,s=!1){const{aws_appsync_authenticationType:a}=this.amplifyConfig,{isOwner:c,ownerField:u,ownerValue:l}=this.getAuthorizationInfo(t,r,a,i,o)||{},[d,h,p]=function(e,t,n,r,i,o=!1){const s=ac(e,t),{name:a}=t,c=`on${n}${a}`,u=[],l=[];return o&&(u.push(`$filter: ModelSubscription${a}FilterInput`),l.push("filter: $filter")),r&&(u.push(`$${i}: String!`),l.push(`${i}: $${i}`)),[n,c,`subscription operation${u.length?`(${u.join(",")})`:""}{\n\t\t\t${c}${l.length?`(${l.join(",")})`:""}{\n\t\t\t\t${s}\n\t\t\t}\n\t\t}`]}(e,t,n,c,u,s);return{authMode:o,opType:d,opName:h,query:p,isOwner:c,ownerField:u,ownerValue:l}}getAuthorizationInfo(e,t,n,r,i){const o=uc(e);if("iam"===i&&o.find((e=>"private"===e.authStrategy&&"iam"===e.provider))&&t===bu.unauth)return null;const s=o.filter((e=>"groups"===e.authStrategy&&["userPools","oidc"].includes(e.provider)));if(("oidc"===i||"userPool"===i)&&s.find((e=>{if(r)return[...function(e,t){let n=e[t.groupClaim]||[];if("string"==typeof n){let e;try{e=JSON.parse(n)}catch(t){e=n}n=[].concat(e)}return n}(r,e)].find((t=>e.groups.find((e=>e===t))))})))return{authMode:i,isOwner:!1};let a;return a||(("oidc"===i||"userPool"===i?o.filter((e=>"owner"===e.authStrategy&&("oidc"===e.provider||"userPools"===e.provider))):[]).forEach((t=>{const n=r?.[t.identityClaim],o=!0!==e.fields[t.ownerField]?.isArray&&!t.areSubscriptionsPublic;n&&(a={authMode:i,isOwner:o,ownerField:t.ownerField,ownerValue:String(n)})})),a||{authMode:i||n,isOwner:!1})}hubQueryCompletionListener(e,t){const{payload:{event:n}}=t;n===ps.SUBSCRIPTION_ACK&&e()}start(){this.runningProcesses=this.runningProcesses||new Ga;return[new Ur((e=>{const t=[];let n,r={},i=bu.none;return this.runningProcesses.add((async()=>{try{const e=(await Qs()).tokens?.accessToken;i=e?bu.auth:bu.unauth}catch(e){}try{const e=await Qs();n=e.tokens?.idToken?.payload}catch(e){}Object.values(this.schema.namespaces).forEach((o=>{Object.values(o.models).filter((({syncable:e})=>e)).forEach((s=>this.runningProcesses.isOpen&&this.runningProcesses.add((async()=>{const a=(await fc({authModeStrategy:this.authModeStrategy,defaultAuthMode:this.amplifyConfig.aws_appsync_authenticationType,modelName:s.name,schema:this.schema})).READ;r={...r,[s.name]:{[oc.CREATE]:[],[oc.UPDATE]:[],[oc.DELETE]:[]}};const c=[oc.CREATE,oc.UPDATE,oc.DELETE],u={[oc.CREATE]:0,[oc.UPDATE]:0,[oc.DELETE]:0},l=Xa.getPredicates(this.syncPredicates.get(s),!1),d=void 0!==l,h=async(c,p=d)=>{const{opType:f,opName:y,query:m,isOwner:g,ownerField:v,ownerValue:b,authMode:w}=this.buildSubscription(o,s,c,i,n,a[u[c]],p),S=await vc(w,this.amplifyConfig),E={},A={category:Zr.DataStore,action:ii.Subscribe};if(p&&l&&(E.filter=hc(l)),g){if(!b)return void e.error("Owner field required, sign in is needed in order to perform this operation");E[v]=b}gu.debug(`Attempting ${c} subscription with authMode: ${a[u[c]]}`);const T=this.amplifyContext.InternalAPI.graphql({query:m,variables:E,authMode:w,authToken:S},void 0,A);let I;r[s.name][f].push(T.subscribe({next:e=>{const{data:t,errors:n}=e;if(Array.isArray(n)&&n.length>0){const e=n.map((({message:e})=>e));return gu.warn(`Skipping incoming subscription. Messages: ${e.join("\n")}`),void this.drainBuffer()}const r=Xa.getPredicates(this.syncPredicates.get(s),!1),{[y]:i}=t;this.passesPredicateValidation(i,r)&&this.pushToBuffer(f,s,i),this.drainBuffer()},error:async t=>{const{errors:[{message:n=""}={}]}=t;if(p&&this.catchRTFError(n,s,l))return r[s.name][f].forEach((e=>e.unsubscribe())),r[s.name][f]=[],void h(c,!1);if(n.includes(ps.REALTIME_SUBSCRIPTION_INIT_ERROR)||n.includes(ps.CONNECTION_FAILED)){if(r[s.name][f].forEach((e=>e.unsubscribe())),r[s.name][f]=[],u[c]++,!(u[c]>=a.length))return gu.debug(`${c} subscription failed with authMode: ${a[u[c]-1]}. Retrying with authMode: ${a[u[c]]}`),void h(c);gu.debug(`${c} subscription failed with authMode: ${a[u[c]-1]}`)}gu.warn("subscriptionError",n);try{await this.errorHandler({recoverySuggestion:"Ensure app code is up to date, auth directives exist and are correct on each model, and that server-side data has not been invalidated by a schema change. If the problem persists, search for or create an issue: https://github.com/aws-amplify/amplify-js/issues",localModel:null,message:n,model:s.name,operation:c,errorType:(i=t,du(su,i)),process:Te.subscribe,remoteModel:null,cause:t})}catch(e){gu.error("Subscription error handler failed with:",e)}var i;"function"==typeof I&&I(),n.includes('"errorType":"Unauthorized"')||n.includes('"errorType":"OperationDisabled"')||e.error(n)}})),t.push((async()=>{let e,t;await new Promise((n=>{I=n,e=this.hubQueryCompletionListener.bind(this,n),t=ss.listen("api",e)})),t()})())};c.forEach((e=>h(e)))}))))})),this.runningProcesses.isOpen&&this.runningProcesses.add((()=>Promise.all(t).then((()=>{e.next(vu.CONNECTED)}))))}),"subscription processor new subscriber"),this.runningProcesses.addCleaner((async()=>{Object.keys(r).forEach((e=>{r[e][oc.CREATE].forEach((e=>{e.unsubscribe()})),r[e][oc.UPDATE].forEach((e=>{e.unsubscribe()})),r[e][oc.DELETE].forEach((e=>{e.unsubscribe()}))}))}))})),new Ur((e=>(this.dataObserver=e,this.drainBuffer(),this.runningProcesses.addCleaner((async()=>{this.dataObserver=null})))))]}async stop(){await this.runningProcesses.close(),await this.runningProcesses.open()}passesPredicateValidation(e,t){if(!t)return!0;const{predicates:n,type:r}=t;return st(e,r,n)}pushToBuffer(e,t,n){this.buffer.push([e,t,n])}drainBuffer(){this.dataObserver&&(this.buffer.forEach((e=>{this.dataObserver.next(e)})),this.buffer=[])}catchRTFError(e,t,n){const r={"UnknownArgument: Unknown field argument filter":pc.UnknownField,"Filters exceed maximum attributes limit":pc.MaxAttributes,"Filters combination exceed maximum limit":pc.MaxCombinations,"filter uses same fieldName multiple time":pc.RepeatedFieldname,"The variables input contains a field name 'not'":pc.NotGroup,"The variables input contains a field that is not defined for input object type":pc.FieldNotInType},[i,o]=Object.entries(r).find((([t])=>e.includes(t)))||[];if(void 0!==o){const r=function(e,t,n){const r=function(e){const t=new Set;if(!e||!Array.isArray(e.predicates))return t;const{predicates:n}=e,r=[...n];for(;r.length>0;){const e=r.pop();Ke(e)?t.add(e.field):We(e)&&r.push(...e.predicates)}return t}(n),i=[...r].join(", "),o=function(e){const t=uc(e),n=new Set;for(const e of t)e.groupsField&&!e.groups.length?n.add(e.groupsField):e.ownerField&&n.add(e.ownerField);return n}(t),s=[...o].join(", "),a=function(e){if(!e||!Array.isArray(e.predicates))return 0;let t=0;const n=[e];for(;n.length>0;){const e=n.pop();if(We(e)){const{predicates:r,type:i}=e;"or"===i&&r.length>1&&(t+=r.length),n.push(...r)}}return t||1}(n),c=function(e){if(!e||!Array.isArray(e.predicates))return null;const t=[hc(e)],n=e=>{const t={};for(const n of e){const[e]=Object.keys(n);if(t[e])return e;t[e]=!0}return null};for(;t.length>0;){const e=t.pop(),[r]=Object.keys(e),i=e[r];if(!Array.isArray(i))return null;const o=i.filter((e=>!Array.isArray(Object.values(e)[0]))),s=i.filter((e=>Array.isArray(Object.values(e)[0])));if("and"===r){const e=n(o);if(e)return e}t.push(...s)}return null}(n);switch(e){case pc.UnknownField:return"Your API was generated with an older version of the CLI that doesn't support backend subscription filtering.To enable backend subscription filtering, upgrade your Amplify CLI to the latest version and push your app by running `amplify upgrade` followed by `amplify push`";case pc.MaxAttributes:{let e=`Your selective sync expression for ${t.name} contains ${r.size} different model fields: ${i}.\n\n`;return o.size>0&&(e+=`Note: the number of fields you can use with selective sync is affected by @auth rules configured on the model.\n\nDynamic auth modes, such as owner auth and dynamic group auth each utilize 1 field.\nYou currently have ${o.size} dynamic auth mode(s) configured on this model: ${s}.`),e}case pc.MaxCombinations:{let e=`Your selective sync expression for ${t.name} contains ${a} field combinations (total number of predicates in an OR expression).\n\n`;return o.size>0&&(e+=`Note: the number of fields you can use with selective sync is affected by @auth rules configured on the model.\n\nDynamic auth modes, such as owner auth and dynamic group auth factor in to the number of combinations you're using.\nYou currently have ${o.size} dynamic auth mode(s) configured on this model: ${s}.`),e}case pc.RepeatedFieldname:return`Your selective sync expression for ${t.name} contains multiple entries for ${c} in the same AND group.`;case pc.NotGroup:return`Your selective sync expression for ${t.name} uses a \`not\` group. If you'd like to filter subscriptions in the backend, rewrite your expression using \`ne\` or \`notContains\` operators.`;case pc.FieldNotInType:return""}}(o,t,n);return gu.warn(`Backend subscriptions filtering error.\nSubscriptions filtering will be applied clientside.\n\n${e}\n${r}`),!0}return!1}}const Su={items:[],nextToken:null,startedAt:null},Eu=new Wi("DataStore");class Au{constructor(e,t,n={},r,i,o){this.schema=e,this.syncPredicates=t,this.amplifyConfig=n,this.authModeStrategy=r,this.errorHandler=i,this.amplifyContext=o,this.typeQuery=new WeakMap,this.runningProcesses=new Ga,o.InternalAPI=o.InternalAPI||Ua,this.generateQueries()}generateQueries(){Object.values(this.schema.namespaces).forEach((e=>{Object.values(e.models).filter((({syncable:e})=>e)).forEach((t=>{const[[,...n]]=lc(e,t,"LIST");this.typeQuery.set(t,n)}))}))}graphqlFilterFromPredicate(e){if(!this.syncPredicates)return null;const t=Xa.getPredicates(this.syncPredicates.get(e),!1);return t?hc(t):null}async retrievePage(e,t,n,r=null,i,o){const[s,a]=this.typeQuery.get(e),c={limit:r,nextToken:n,lastSync:t,filter:i},u=(await fc({authModeStrategy:this.authModeStrategy,defaultAuthMode:this.amplifyConfig.aws_appsync_authenticationType,modelName:e.name,schema:this.schema})).READ;let l=0;const d=async()=>{if(!this.runningProcesses.isOpen)throw new Error("sync.retreievePage termination was requested. Exiting.");try{Eu.debug(`Attempting sync with authMode: ${u[l]}`);const t=await this.jitteredRetry({query:a,variables:c,opName:s,modelDefinition:e,authMode:u[l],onTerminate:o});return Eu.debug(`Sync successful with authMode: ${u[l]}`),t}catch(e){if(l++,l>=u.length){const t=u[l-1];if(Eu.debug(`Sync failed with authMode: ${t}`,e),gc(e)||yc(e))return Eu.warn(`User is unauthorized to query ${s} with auth mode ${t}. No data could be returned.`),{data:{[s]:Su}};throw e}return Eu.debug(`Sync failed with authMode: ${u[l-1]}. Retrying with authMode: ${u[l]}`),d()}},{data:h}=await d(),{[s]:p}=h,{items:f,nextToken:y,startedAt:m}=p;return{nextToken:y,startedAt:m,items:f}}async jitteredRetry({query:e,variables:t,opName:n,modelDefinition:r,authMode:i,onTerminate:o}){return hs((async(e,t)=>{try{const n=await vc(i,this.amplifyConfig),r={category:Zr.DataStore,action:ii.GraphQl};return await this.amplifyContext.InternalAPI.graphql({query:e,variables:t,authMode:i,authToken:n},void 0,r)}catch(e){const t=gc(e)||yc(e);if(t)throw Eu.error("Sync processor retry error:",e),new as(t);const i=Boolean(e?.data?.[n]?.items),o=e?.errors&&e.errors.some((e=>"Unauthorized"===e.errorType)),s=e?.errors&&e.errors.filter((e=>"Unauthorized"!==e.errorType)),a=e;if(i&&(a.data[n].items=a.data[n].items.filter((e=>null!==e))),i&&s?.length&&(await Promise.all(s.map((async e=>{try{await this.errorHandler({recoverySuggestion:"Ensure app code is up to date, auth directives exist and are correct on each model, and that server-side data has not been invalidated by a schema change. If the problem persists, search for or create an issue: https://github.com/aws-amplify/amplify-js/issues",localModel:null,message:e.message,model:r.name,operation:n,errorType:lu(e),process:Te.sync,remoteModel:null,cause:e})}catch(e){Eu.error("Sync error handler failed with:",e)}}))),ss.dispatch("datastore",{event:"nonApplicableDataReceived",data:{errors:s,modelName:r.name}})),o)throw this.errorHandler({recoverySuggestion:"Ensure app code is up to date, auth directives exist and are correct on each model, and that server-side data has not been invalidated by a schema change. If the problem persists, search for or create an issue: https://github.com/aws-amplify/amplify-js/issues",localModel:null,message:e.message,model:r.name,operation:n,errorType:lu(e.errors[0]),process:Te.sync,remoteModel:null,cause:e}),new as(e);if(a.data?.[n]?.items?.length)return a;throw e}}),[e,t],void 0,o)}start(e){const{maxRecordsToSync:t,syncPageSize:n}=this.amplifyConfig,r=new Map,i=new Ur((i=>{const o=Object.values(this.schema.namespaces).reduce(((t,n)=>{for(const r of Array.from(n.modelTopologicalOrdering.keys())){const i=e.get(n.models[r]);t.set(n.models[r],i)}return t}),new Map),s=Array.from(o.entries()).filter((([{syncable:e}])=>e)).map((([e,[o,s]])=>this.runningProcesses.isOpen&&this.runningProcesses.add((async a=>{let c=!1,u=null,l=null,d=null,h=0;const p=this.graphqlFilterFromPredicate(e),f=this.schema.namespaces[o].modelTopologicalOrdering.get(e.name).map((e=>r.get(`${o}_${e}`))),y=new Promise((async r=>{await Promise.all(f);do{if(!this.runningProcesses.isOpen)return Eu.debug(`Sync processor has been stopped, terminating sync for ${e.name}`),void r();const f=Math.min(t-h,n);try{({items:d,nextToken:u,startedAt:l}=await this.retrievePage(e,s,u,f,p,a))}catch(t){try{await this.errorHandler({recoverySuggestion:"Ensure app code is up to date, auth directives exist and are correct on each model, and that server-side data has not been invalidated by a schema change. If the problem persists, search for or create an issue: https://github.com/aws-amplify/amplify-js/issues",localModel:null,message:t.message,model:e.name,operation:null,errorType:lu(t),process:Te.sync,remoteModel:null,cause:t})}catch(e){Eu.error("Sync error handler failed with:",e)}c=!0,d=[]}h+=d.length,c=null===u||h>=t,i.next({namespace:o,modelDefinition:e,items:d,done:c,startedAt:l,isFullSync:!s})}while(!c);r()}));r.set(`${o}_${e.name}`,y),await y}),`adding model ${e.name}`)));Promise.all(s).then((()=>{i.complete()}))}));return i}async stop(){Eu.debug("stopping sync processor"),await this.runningProcesses.close(),await this.runningProcesses.open(),Eu.debug("sync processor stopped")}}const Tu=new Wi("DataStore"),Iu=Symbol("sync");var Nu;!function(e){e.SYNC_ENGINE_STORAGE_SUBSCRIBED="storageSubscribed",e.SYNC_ENGINE_SUBSCRIPTIONS_ESTABLISHED="subscriptionsEstablished",e.SYNC_ENGINE_SYNC_QUERIES_STARTED="syncQueriesStarted",e.SYNC_ENGINE_SYNC_QUERIES_READY="syncQueriesReady",e.SYNC_ENGINE_MODEL_SYNCED="modelSynced",e.SYNC_ENGINE_OUTBOX_MUTATION_ENQUEUED="outboxMutationEnqueued",e.SYNC_ENGINE_OUTBOX_MUTATION_PROCESSED="outboxMutationProcessed",e.SYNC_ENGINE_OUTBOX_STATUS="outboxStatus",e.SYNC_ENGINE_NETWORK_STATUS="networkStatus",e.SYNC_ENGINE_READY="ready"}(Nu||(Nu={}));class Ou{getModelSyncedStatus(e){return this.modelSyncedStatus.get(e)}constructor(e,t,n,r,i,o,s,a,c,u={},l,d,h){this.schema=e,this.namespaceResolver=t,this.modelClasses=n,this.userModelClasses=r,this.storage=i,this.modelInstanceCreator=o,this.syncPredicates=c,this.amplifyConfig=u,this.authModeStrategy=l,this.amplifyContext=d,this.connectivityMonitor=h,this.online=!1,this.modelSyncedStatus=new WeakMap,this.connectionDisrupted=!1,this.runningProcesses=new Ga,this.waitForSleepState=new Promise((e=>{this.syncQueriesObservableStartSleeping=e}));const p=this.modelClasses.MutationEvent;this.outbox=new nu(this.schema,p,o,Iu),this.modelMerger=new tu(this.outbox,Iu),this.syncQueriesProcessor=new Au(this.schema,this.syncPredicates,this.amplifyConfig,this.authModeStrategy,a,this.amplifyContext),this.subscriptionsProcessor=new wu(this.schema,this.syncPredicates,this.amplifyConfig,this.authModeStrategy,a,this.amplifyContext),this.mutationsProcessor=new pu(this.schema,this.storage,this.userModelClasses,this.outbox,this.modelInstanceCreator,p,this.amplifyConfig,this.authModeStrategy,a,s,this.amplifyContext),this.datastoreConnectivity=this.connectivityMonitor||new eu}start(e){return new Ur((t=>{Tu.log("starting sync engine...");let n=[];this.runningProcesses.add((async()=>{try{await this.setupModels(e)}catch(e){return void t.error(e)}const r=new Promise(((e,r)=>{const i=e,o=r;this.datastoreConnectivity.status().subscribe((async({online:e})=>this.runningProcesses.isOpen&&this.runningProcesses.add((async r=>{if(e&&!this.online){this.online=e,t.next({type:Nu.SYNC_ENGINE_NETWORK_STATUS,data:{active:this.online}}),this.stopDisruptionListener=this.startDisruptionListener();const[i,s]=this.subscriptionsProcessor.start();try{await new Promise(((e,t)=>{r.then(t);const o=i.subscribe({next:t=>{t===vu.CONNECTED&&e()},error:e=>{t(e),this.disconnectionHandler()(e)}});n.push(o)}))}catch(e){return t.error(e),void o()}Tu.log("Realtime ready"),t.next({type:Nu.SYNC_ENGINE_SUBSCRIPTIONS_ESTABLISHED});try{await new Promise(((e,r)=>{const i=this.syncQueriesObservable().subscribe({next:n=>{const{type:r}=n;r===Nu.SYNC_ENGINE_SYNC_QUERIES_READY&&e(),t.next(n)},complete:()=>{e()},error:e=>{r(e)}});i&&n.push(i)}))}catch(e){return t.error(e),void o()}n.push(this.mutationsProcessor.start().subscribe((({modelDefinition:e,model:n,hasMore:r})=>this.runningProcesses.add((async()=>{const i=this.userModelClasses[e.name],o=this.modelInstanceCreator(i,n);await this.storage.runExclusive((t=>this.modelMerger.merge(t,o,e))),t.next({type:Nu.SYNC_ENGINE_OUTBOX_MUTATION_PROCESSED,data:{model:i,element:o}}),t.next({type:Nu.SYNC_ENGINE_OUTBOX_STATUS,data:{isEmpty:!r}})}),"mutation processor event")))),n.push(s.subscribe((([e,t,n])=>this.runningProcesses.add((async()=>{const e=this.userModelClasses[t.name],r=this.modelInstanceCreator(e,n);await this.storage.runExclusive((e=>this.modelMerger.merge(e,r,t)))}),"subscription dataSubsObservable event"))))}else e||(this.online=e,t.next({type:Nu.SYNC_ENGINE_NETWORK_STATUS,data:{active:this.online}}),n.forEach((e=>{e.unsubscribe()})),n=[]);i()}),"datastore connectivity event")))}));this.storage.observe(null,null,Iu).pipe(ms((({model:e})=>!0===this.getModelDefinition(e).syncable))).subscribe({next:async({opType:e,model:n,element:i,condition:o})=>this.runningProcesses.add((async()=>{const s=this.schema.namespaces[this.namespaceResolver(n)],a=this.modelClasses.MutationEvent,c=this.getModelDefinition(n),u=function(e,t){return e&&Array.isArray(e.predicates)?hc(e,Mt(t)):{}}(o,c),l=dc(s.relationships,this.getModelDefinition(n),e,n,i,u,a,this.modelInstanceCreator);await this.outbox.enqueue(this.storage,l),t.next({type:Nu.SYNC_ENGINE_OUTBOX_MUTATION_ENQUEUED,data:{model:n,element:i}}),t.next({type:Nu.SYNC_ENGINE_OUTBOX_STATUS,data:{isEmpty:!1}}),await r,this.online&&this.mutationsProcessor.resume()}),"storage event")}),t.next({type:Nu.SYNC_ENGINE_STORAGE_SUBSCRIBED});const i=void 0===await this.outbox.peek(this.storage);t.next({type:Nu.SYNC_ENGINE_OUTBOX_STATUS,data:{isEmpty:i}}),await r,t.next({type:Nu.SYNC_ENGINE_READY})}),"sync start")}))}async getModelsMetadataWithNextFullSync(e){return new Map((await this.runningProcesses.add((()=>this.getModelsMetadata()),"sync/index getModelsMetadataWithNextFullSync")).map((({namespace:t,model:n,lastSync:r,lastFullSync:i,fullSyncInterval:o})=>{const s=!i||i+o<e?0:r;return[this.schema.namespaces[t].models[n],[t,s]]})))}syncQueriesObservable(){return this.online?new Ur((e=>{let t;this.runningProcesses.isOpen&&this.runningProcesses.add((async n=>{let r=!1;for(;!e.closed&&!r;){const i=new WeakMap,o=await this.getModelsMetadataWithNextFullSync(Date.now()),s=new Set(o.keys());let a,c,u,l,d,h;await new Promise(((r,h)=>{this.runningProcesses.isOpen||r(),n.then((()=>{r()})),t=this.syncQueriesProcessor.start(o).subscribe({next:async({namespace:n,modelDefinition:o,items:h,done:p,startedAt:f,isFullSync:y})=>{const m=this.userModelClasses[o.name];if(i.has(m)||(i.set(m,{new:0,updated:0,deleted:0}),u=gt(),d=void 0===d?f:Math.max(d,f)),await this.storage.runExclusive((async e=>{const t=await this.outbox.getModelIds(e),n=[],r=h.filter((e=>{const r=bc(o,e);return!t.has(r)||(n.push(e),!1)})),s=[];for(const t of n){const n=await this.modelMerger.merge(e,t,o);void 0!==n&&s.push([t,n])}s.push(...await this.modelMerger.mergePage(e,m,r,o));const a=i.get(m);s.forEach((([,e])=>{switch(e){case be.INSERT:a.new++;break;case be.UPDATE:a.updated++;break;case be.DELETE:a.deleted++;break;default:throw new Error(`Invalid opType ${e}`)}}))})),p){const{name:d}=o;let h=await this.getModelMetadata(n,d);const{lastFullSync:p,fullSyncInterval:g}=h;c=g,a=void 0===a?p:Math.max(a,y?f:p),h=this.modelClasses.ModelMetadata.copyOf(h,(e=>{e.lastSync=f,e.lastFullSync=y?f:h.lastFullSync})),await this.storage.save(h,void 0,Iu);const v=i.get(m);this.modelSyncedStatus.set(m,!0),e.next({type:Nu.SYNC_ENGINE_MODEL_SYNCED,data:{model:m,isFullSync:y,isDeltaSync:!y,counts:v}}),s.delete(o),0===s.size&&(l=gt()-u,r(),e.next({type:Nu.SYNC_ENGINE_SYNC_QUERIES_READY}),t.unsubscribe())}},error:t=>{e.error(t)}}),e.next({type:Nu.SYNC_ENGINE_SYNC_QUERIES_STARTED,data:{models:Array.from(s).map((({name:e})=>e))}})})),h=a?a+c-(d+l):c-l,Tu.debug(`Next fullSync in ${h/1e3} seconds. (${new Date(Date.now()+h)})`),await this.runningProcesses.add((async e=>{let t;const n=new Promise((e=>{t=e,setTimeout(t,h)}));return e.then((()=>{r=!0,this.syncQueriesObservableStartSleeping(),t()})),this.unsleepSyncQueriesObservable=t,this.syncQueriesObservableStartSleeping(),n}),"syncQueriesObservable sleep"),this.unsleepSyncQueriesObservable=null,this.waitForSleepState=new Promise((e=>{this.syncQueriesObservableStartSleeping=e}))}}),"syncQueriesObservable main")})):function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Ss(e,function(e){return(n=(t=e)[t.length-1])&&ur(n.schedule)?e.pop():void 0;var t,n}(e))}({})}disconnectionHandler(){return e=>{ps.CONNECTION_CLOSED!==e&&ps.TIMEOUT_DISCONNECT!==e||this.datastoreConnectivity.socketDisconnected()}}unsubscribeConnectivity(){this.datastoreConnectivity.unsubscribe()}async stop(){Tu.debug("stopping sync engine"),this.unsubscribeConnectivity(),this.stopDisruptionListener&&this.stopDisruptionListener(),await this.mutationsProcessor.stop(),await this.subscriptionsProcessor.stop(),await this.datastoreConnectivity.stop(),await this.syncQueriesProcessor.stop(),await this.runningProcesses.close(),await this.runningProcesses.open(),Tu.debug("sync engine stopped and ready to restart")}async setupModels(e){const{fullSyncInterval:t}=e,n=this.modelClasses.ModelMetadata,r=[];let i;Object.values(this.schema.namespaces).forEach((e=>{Object.values(e.models).filter((({syncable:e})=>e)).forEach((t=>{if(r.push([e.name,t]),e.name===nt){const e=this.userModelClasses[t.name];this.modelSyncedStatus.set(e,!1)}}))}));const o=r.map((async([e,r])=>{const o=await this.getModelMetadata(e,r.name),s=Xa.getPredicates(this.syncPredicates.get(r),!1),a=s?JSON.stringify(s):null;if(void 0===o)[[i]]=await this.storage.save(this.modelInstanceCreator(n,{model:r.name,namespace:e,lastSync:null,fullSyncInterval:t,lastFullSync:null,lastSyncPredicate:a}),void 0,Iu);else{const e=(o.lastSyncPredicate?o.lastSyncPredicate:null)!==a;[[i]]=await this.storage.save(n.copyOf(o,(n=>{n.fullSyncInterval=t,e&&(n.lastSync=null,n.lastFullSync=null,n.lastSyncPredicate=a)})))}return i})),s={};for(const e of await Promise.all(o)){const{model:t}=e;s[t]=e}return s}async getModelsMetadata(){const e=this.modelClasses.ModelMetadata;return await this.storage.query(e)}async getModelMetadata(e,t){const n=this.modelClasses.ModelMetadata,r=Xa.createFromAST(this.schema.namespaces[rt].models[n.name],{and:[{namespace:{eq:e}},{model:{eq:t}}]}),[i]=await this.storage.query(n,r,{page:0,limit:1});return i}getModelDefinition(e){const t=this.namespaceResolver(e);return this.schema.namespaces[t].models[e.name]}static getNamespace(){return{name:rt,relationships:{},enums:{OperationType:{name:"OperationType",values:["CREATE","UPDATE","DELETE"]}},nonModels:{},models:{MutationEvent:{name:"MutationEvent",pluralName:"MutationEvents",syncable:!1,fields:{id:{name:"id",type:"ID",isRequired:!0,isArray:!1},model:{name:"model",type:"String",isRequired:!0,isArray:!1},data:{name:"data",type:"String",isRequired:!0,isArray:!1},modelId:{name:"modelId",type:"String",isRequired:!0,isArray:!1},operation:{name:"operation",type:{enum:"Operationtype"},isArray:!1,isRequired:!0},condition:{name:"condition",type:"String",isArray:!1,isRequired:!0}}},ModelMetadata:{name:"ModelMetadata",pluralName:"ModelsMetadata",syncable:!1,fields:{id:{name:"id",type:"ID",isRequired:!0,isArray:!1},namespace:{name:"namespace",type:"String",isRequired:!0,isArray:!1},model:{name:"model",type:"String",isRequired:!0,isArray:!1},lastSync:{name:"lastSync",type:"Int",isRequired:!1,isArray:!1},lastFullSync:{name:"lastFullSync",type:"Int",isRequired:!1,isArray:!1},fullSyncInterval:{name:"fullSyncInterval",type:"Int",isRequired:!0,isArray:!1},lastSyncPredicate:{name:"lastSyncPredicate",type:"String",isRequired:!1,isArray:!1}}}}}}startDisruptionListener(){return ss.listen("api",(e=>{if("PubSub"===e.source&&e.payload.event===Yo)switch(e.payload.data.connectionState){case fs.ConnectionDisrupted:this.connectionDisrupted=!0;break;case fs.Connected:this.connectionDisrupted&&this.scheduleSync(),this.connectionDisrupted=!1}}))}scheduleSync(){return this.runningProcesses.isOpen&&this.runningProcesses.add((()=>this.waitForSleepState.then((()=>{this.unsleepSyncQueriesObservable()}))))}}const _u=[...Ja],Cu=new Map,Pu=(e,t)=>{const n=t||new Je;return Cu.set(n,e),n},ku=e=>{if(!Cu.has(e))throw new Error("Invalid predicate. Terminate your predicate with a valid condition (e.g., `p => p.field.eq('value')`) or pass `Predicates.ALL`.");return Cu.get(e)},xu={and:"or",or:"and",not:"and",eq:"ne",ne:"eq",gt:"le",ge:"lt",lt:"ge",le:"gt",contains:"notContains",notContains:"contains"};class Du{constructor(e,t,n){this.field=e,this.operator=t,this.operands=n,this.validate()}copy(){return[new Du(this.field,this.operator,[...this.operands]),void 0]}toAST(){return{[this.field]:{[this.operator]:"between"===this.operator?[this.operands[0],this.operands[1]]:this.operands[0]}}}negated(e){return"between"===this.operator?new Ru(e,void 0,void 0,"or",[new Du(this.field,"lt",[this.operands[0]]),new Du(this.field,"gt",[this.operands[1]])]):"beginsWith"===this.operator?new Ru(e,void 0,void 0,"not",[new Du(this.field,"beginsWith",[this.operands[0]])]):new Du(this.field,xu[this.operator],this.operands)}async fetch(){return Promise.reject("No implementation needed [yet].")}async matches(e){const t=e[this.field],n={eq:()=>t===this.operands[0],ne:()=>t!==this.operands[0],gt:()=>t>this.operands[0],ge:()=>t>=this.operands[0],lt:()=>t<this.operands[0],le:()=>t<=this.operands[0],contains:()=>t?.indexOf(this.operands[0])>-1,notContains:()=>!t||-1===t.indexOf(this.operands[0]),beginsWith:()=>t?.startsWith(this.operands[0]),between:()=>t>=this.operands[0]&&t<=this.operands[1]}[this.operator];if(n)return n();throw new Error(`Invalid operator given: ${this.operator}`)}validate(){const e=e=>{const t=1===e?"argument is":"arguments are";return()=>{if(this.operands.length!==e)return`Exactly ${e} ${t} required.`}},t={eq:e(1),ne:e(1),gt:e(1),ge:e(1),lt:e(1),le:e(1),contains:e(1),notContains:e(1),beginsWith:e(1),between:()=>e(2)()||(this.operands[0]>this.operands[1]?"The first argument must be less than or equal to the second argument.":null)}[this.operator];if(!t)throw new Error(`Non-existent operator: \`${this.operator}()\``);{const e=t();if("string"==typeof e)throw new Error(`Incorrect usage of \`${this.operator}()\`: ${e}`)}}}const Mu=(()=>{let e=1;return()=>"group_"+e++})();class Ru{constructor(e,t,n,r,i,o=!1){this.model=e,this.field=t,this.relationshipType=n,this.operator=r,this.operands=i,this.isOptimized=o,this.groupId=Mu()}copy(e){const t=new Ru(this.model,this.field,this.relationshipType,this.operator,[]);let n=e===this?t:void 0;return this.operands.forEach((r=>{const[i,o]=r.copy(e);t.operands.push(i),n=n||o})),[t,n]}withFieldConditionsOnly(e){const t=e!==("not"===this.operator);return new Ru(this.model,void 0,void 0,e?xu[this.operator]:this.operator,this.operands.filter((e=>e instanceof Du)).map((e=>t?e.negated(this.model):e)))}optimized(e=!0){const t=this.operands.map((e=>e instanceof Ru?e.optimized("not"===this.operator):e));if(!e&&["and","or"].includes(this.operator)&&!this.field&&1===t.length){const e=t[0];if(!(e instanceof Du))return e;if("between"!==e.operator)return e}return new Ru(this.model,this.field,this.relationshipType,this.operator,t,!0)}async fetch(e,t=[],n=!1){if(!this.isOptimized)return this.optimized().fetch(e);const r=[],i=n?xu[this.operator]:this.operator,o=n!==("not"===this.operator),s=this.operands.filter((e=>e instanceof Ru)),a=this.operands.filter((e=>e instanceof Du));for(const n of s){const s=await n.fetch(e,[...t,this.groupId],o);if(0!==s.length)if(n.field){const t=Lc.from(this.model,n.field);if(!t)throw new Error("Missing field metadata.");{const n=[];for(const e of s){const r=[];for(let n=0;n<t.localJoinFields.length;n++)r.push({[t.localJoinFields[n]]:{eq:e[t.remoteJoinFields[n]]}});n.push({and:r})}const i=Xa.createFromAST(this.model.schema,{or:n});r.push(await e.query(this.model.builder,i))}}else r.push(s);else{if("and"===i)return[];r.push([])}}if(a.length>0){const t=this.withFieldConditionsOnly(o).toStoragePredicate();r.push(await e.query(this.model.builder,t))}else 0===a.length&&0===r.length&&r.push(await e.query(this.model.builder));const c=e=>JSON.stringify(this.model.pkField.map((t=>e[t])));let u;if("and"===i){if(0===r.length)return[];for(const e of r)if(void 0===u)u=new Map(e.map((e=>[c(e),e])));else{const t=new Map(e.map((e=>[c(e),e])));for(const e of u.keys())t.has(e)||u.delete(e)}}else if("or"===i||"not"===i){u=new Map;for(const e of r)for(const t of e)u.set(c(t),t)}return Array.from(u?.values()||[])}async matches(e,t=!1){const n=this.field&&!t?await e[this.field]:e;if(!n)return!1;if("HAS_MANY"===this.relationshipType&&"function"==typeof n[Symbol.asyncIterator]){for await(const e of n)if(await this.matches(e,!0))return!0;return!1}if("or"===this.operator)return async function(e,t){for(const n of e)if(await t(n))return!0;return!1}(this.operands,(e=>e.matches(n)));if("and"===this.operator)return async function(e,t){for(const n of e)if(!await t(n))return!1;return!0}(this.operands,(e=>e.matches(n)));if("not"===this.operator){if(1!==this.operands.length)throw new Error("Invalid arguments! `not()` accepts exactly one predicate expression.");return!await this.operands[0].matches(n)}throw new Error("Invalid group operator!")}toAST(){if(this.field)throw new Error("Nested type conditions are not supported!");return{[this.operator]:this.operands.map((e=>e.toAST()))}}toStoragePredicate(){return Xa.createFromAST(this.model.schema,this.toAST())}toJSON(){return{...this,model:this.model.schema.name}}}function Fu(e,t=!0,n,r,i){const o=new Ru(e,n,void 0,"and",[]),s=r&&i?r:o,a=r&&i?i:o,c={};Pu(s,c);const u=()=>{const[n,r]=s.copy(a);return{query:n,newTail:r,newLink:Fu(e,t,void 0,n,r)}};["and","or"].forEach((r=>{c[r]=i=>{const{query:o,newTail:s}=u(),a=i(Fu(e,t));if(!Array.isArray(a))throw new Error(`Invalid predicate. \`${r}\` groups must return an array of child conditions.`);return s?.operands.push(new Ru(e,n,void 0,r,a.map((e=>ku(e))))),Pu(o)}})),c.not=r=>{const{query:i,newTail:o}=u();return o?.operands.push(new Ru(e,n,void 0,"not",[ku(r(Fu(e,t)))])),Pu(i)};for(const n in e.schema.allFields)Object.defineProperty(c,n,{enumerable:!0,get:()=>{const r=e.schema.allFields[n];if(r.association){if(t){if("BELONGS_TO"===r.association.connectionType||"HAS_ONE"===r.association.connectionType||"HAS_MANY"===r.association.connectionType){const e=r.type.modelConstructor;if(!e)throw new Error("Related model metadata is missing. This is a bug! Please report it.");const[i,o]=s.copy(a),c=new Ru(e,n,r.association.connectionType,"and",[]);return o.operands.push(c),Fu(e,t,void 0,i,c)}throw new Error("Related model definition doesn't have a typedef. This is a bug! Please report it.")}throw new Error("Predication on releated models is not supported in this context.")}return _u.reduce(((e,t)=>({...e,[t]:(...e)=>{const{query:r,newTail:i}=u(),o=e.map((e=>void 0===e?null:e));return i?.operands.push(new Du(n,t,o)),Pu(r)}})),{})}});return c}function Lu(e){return Fu(e,!1)}_e(!0),function(){function e(t){if(!T(t))return t;if(Array.isArray(t))return t.map(e);if(P(t))return new Map(Array.from(t.entries()).map((function(t){return[t[0],e(t[1])]})));if(k(t))return new Set(Array.from(t).map(e));var n=Object.create(Object.getPrototypeOf(t));for(var r in t)n[r]=e(t[r]);return O(t,ce)&&(n[ce]=t[ce]),n}function t(t){return A(t)?e(t):t}var n="add";!function(e,t){pe[e]||(pe[e]=t)}("Patches",{$:function(t,r){return r.forEach((function(r){for(var i=r.path,o=r.op,s=t,a=0;a<i.length-1;a++){var c=N(s),u=""+i[a];0!==c&&1!==c||"__proto__"!==u&&"constructor"!==u||E(24),"function"==typeof s&&"prototype"===u&&E(24),"object"!=typeof(s=_(s,u))&&E(15,i.join("/"))}var l=N(s),d=e(r.value),h=i[i.length-1];switch(o){case"replace":switch(l){case 2:return s.set(h,d);case 3:E(16);default:return s[h]=d}case n:switch(l){case 1:return s.splice(h,0,d);case 2:return s.set(h,d);case 3:return s.add(d);default:return s[h]=d}case"remove":switch(l){case 1:return s.splice(h,1);case 2:return s.delete(h);case 3:return s.delete(r.value);default:return delete s[h]}default:E(17,o)}})),t},R:function(e,r,i,o){switch(e.i){case 0:case 4:case 2:return function(e,r,i,o){var s=e.t,a=e.o;I(e.D,(function(e,c){var u=_(s,e),l=_(a,e),d=c?O(s,e)?"replace":n:"remove";if(u!==l||"replace"!==d){var h=r.concat(e);i.push("remove"===d?{op:d,path:h}:{op:d,path:h,value:l}),o.push(d===n?{op:"remove",path:h}:"remove"===d?{op:n,path:h,value:t(u)}:{op:"replace",path:h,value:t(u)})}}))}(e,r,i,o);case 5:case 1:return function(e,r,i,o){var s=e.t,a=e.D,c=e.o;if(c.length<s.length){var u=[c,s];s=u[0],c=u[1];var l=[o,i];i=l[0],o=l[1]}for(var d=0;d<s.length;d++)if(a[d]&&c[d]!==s[d]){var h=r.concat([d]);i.push({op:"replace",path:h,value:t(c[d])}),o.push({op:"replace",path:h,value:t(s[d])})}for(var p=s.length;p<c.length;p++){var f=r.concat([p]);i.push({op:n,path:f,value:t(c[p])})}s.length<c.length&&o.push({op:"replace",path:r.concat(["length"]),value:s.length})}(e,r,i,o);case 3:return function(e,t,r,i){var o=e.t,s=e.o,a=0;o.forEach((function(e){if(!s.has(e)){var o=t.concat([a]);r.push({op:"remove",path:o,value:e}),i.unshift({op:n,path:o,value:e})}a++})),a=0,s.forEach((function(e){if(!o.has(e)){var s=t.concat([a]);r.push({op:n,path:s,value:e}),i.unshift({op:"remove",path:s,value:e})}a++}))}(e,r,i,o)}},M:function(e,t,n,r){n.push({op:"replace",path:[],value:t===ae?void 0:t}),r.push({op:"replace",path:[],value:e.t})}})}();const ju=new Wi("DataStore"),$u=mt(Date.now()),Uu="schemaVersion";let qu;const Bu=new WeakMap,Gu=new WeakMap,Ku=e=>{const t=Bu.get(e);return t?qu.namespaces[t].models[e.name]:void 0},Wu=e=>ct(e)&&Bu.has(e),zu=e=>{const t=Bu.get(e);if(!t)throw new Error(`Namespace Resolver for '${e.name}' not found! This is probably a bug in '@amplify-js/datastore'.`);return t},Vu=e=>{if(!e)throw new Error("Missing modelConstructor");const t=Ku(e);if(!t)throw new Error("Missing modelSchema");const n=Mt(t);if(!n)throw new Error("Could not determine PK");return Fu({builder:e,schema:t,pkField:n})};let Hu,Ju,Qu,Yu;const Xu=new WeakMap;var Zu;!function(e){e.Detached="Detached",e.DataStore="DataStore",e.API="API"}(Zu||(Zu={}));const el=new WeakMap;function tl(e,t){return Array.isArray(e)?e.map((e=>tl(e,t))):e&&el.set(e,t),e}const nl=e=>el.has(e)?el.get(e):Zu.Detached,rl=e=>{if(void 0!==qu)return console.warn("The schema has already been initialized"),Ju;ju.log("validating schema",{schema:e}),ol(e.codegenVersion);const t={name:nt,...e};ju.log("DataStore","Init models"),Ju=sl(t),ju.log("DataStore","Models initialized");const n={name:tt,relationships:{},enums:{},nonModels:{},models:{Setting:{name:"Setting",pluralName:"Settings",syncable:!1,fields:{id:{name:"id",type:"ID",isRequired:!0,isArray:!1},key:{name:"key",type:"String",isRequired:!0,isArray:!1},value:{name:"value",type:"String",isRequired:!0,isArray:!1}}}}},r=Xc.getNamespace(),i=Ou.getNamespace();return Qu=sl(n),Yu=sl(r),Hu=sl(i),qu={namespaces:{[n.name]:n,[t.name]:t,[r.name]:r,[i.name]:i},version:e.version,codegenVersion:e.codegenVersion},Object.keys(qu.namespaces).forEach((e=>{const[t,n]=Lt(qu.namespaces[e]);qu.namespaces[e].relationships=t,qu.namespaces[e].keys=n;const r=new Map;Object.values(qu.namespaces[e].models).forEach((t=>{const n=[];Object.values(t.fields).filter((e=>e.association&&"BELONGS_TO"===e.association.connectionType&&e.type.model!==t.name)).forEach((e=>n.push(e.type.model))),r.set(t.name,n),Object.values(t.fields).forEach((e=>{const t=Ju[e.type.model];ct(t)&&Object.defineProperty(e.type,"modelConstructor",{get:()=>{const e=Ku(t);if(!e)throw new Error(`Could not find model definition for ${t.name}`);return{builder:t,schema:e,pkField:Mt(e)}}})}));const{indexes:i}=qu.namespaces[e].relationships[t.name],o=new Set;for(const e of i)for(const t of e[1])o.add(t);t.allFields={...Object.fromEntries([...o.values()].map((e=>[e,{name:e,type:"ID",isArray:!1}]))),...t.fields}}));const i=new Map;let o=1e3;for(;o>0&&0!==r.size;){if(o--,0===o)throw new Error("Models are not topologically sortable. Please verify your schema.");for(const e of Array.from(r.keys())){const t=r.get(e);t?.every((e=>i.has(e)))&&i.set(e,t)}Array.from(i.keys()).forEach((e=>r.delete(e)))}qu.namespaces[e].modelTopologicalOrdering=i})),Ju},il=()=>{if(void 0===qu){const e="Schema is not initialized. DataStore will not function as expected. This could happen if you have multiple versions of DataStore installed. Please see https://docs.amplify.aws/lib/troubleshooting/upgrading/q/platform/js/#check-for-duplicate-versions";throw ju.error(e),new Error(e)}},ol=e=>{let t=!1;try{const n=e.split("."),[r,i]=n;t=3===Number(r)&&Number(i)>=2}catch(t){console.log(`Error parsing codegen version: ${e}\n${t}`)}if(!t){const t=`Models were generated with an unsupported version of codegen. Codegen artifacts are from ${e||"an unknown version"}, whereas ^3.2.0 is required. Update to the latest CLI and run 'amplify codegen models'.`;throw ju.error(t),new Error(t)}},sl=e=>{const t={};return Object.entries(e.models).forEach((([n,r])=>{const i=fl(r);t[n]=i,Bu.set(i,e.name)})),Object.entries(e.nonModels||{}).forEach((([e,n])=>{const r=bl(n);t[e]=r})),t},al=new WeakSet;function cl(e,t){return al.add(t),new e(t)}const ul=e=>(t,n)=>{const r=e.fields[t];if(void 0!==r){const{type:i,isRequired:o,isArrayNullable:s,name:a,isArray:c}=r,u=!!(ke(e)?(e=>{const t=e.attributes?.find((e=>"model"===e.type)),n=t?.properties?.timestamps;return{createdAt:"createdAt",updatedAt:"updatedAt",...n||{}}})(e):{})[a];if((!c&&o||c&&!s)&&!u&&null==n)throw new Error(`Field ${a} is required`);if(ke(e)&&!Ft(e)&&Mt(e).includes(t)&&""===n)throw ju.error(Ze,{k:t,value:n}),new Error(Ze);if($e(i)){const e=ve.getJSType(i),t=ve.getValidationFunction(i);if("AWSJSON"===i){if(typeof n===e)return;if("string"==typeof n)try{return void JSON.parse(n)}catch(e){throw new Error(`Field ${a} is an invalid JSON object. ${n}`)}}if(c){let r=e;if(o||(r=`${e} | null | undefined`),!Array.isArray(n)&&!s)throw new Error(`Field ${a} should be of type [${r}], ${typeof n} received. ${n}`);if(!ot(n)&&n.some((t=>ot(t)?o:typeof t!==e))){const e=n.map((e=>null===e?"null":typeof e)).join(",");throw new Error(`All elements in the ${a} array should be of type ${r}, [${e}] received. ${n}`)}if(t&&!ot(n)){if(!n.map((e=>ot(e)?!(!ot(e)||o):t(e))).every((e=>e)))throw new Error(`All elements in the ${a} array should be of type ${i}, validation failed for one or more elements. ${n}`)}}else if(o||void 0!==n){if(typeof n!==e&&null!==n)throw new Error(`Field ${a} should be of type ${e}, ${typeof n} received. ${n}`);if(!ot(n)&&t&&!t(n))throw new Error(`Field ${a} should be of type ${i}, validation failed. ${n}`)}}else if(qe(i)&&!ot(n)){const e=qu.namespaces.user.nonModels[i.nonModel],t=ul(e);if(c){let r=i.nonModel;if(o||(r=`${i.nonModel} | null | undefined`),!Array.isArray(n))throw new Error(`Field ${a} should be of type [${r}], ${typeof n} received. ${n}`);n.forEach((n=>{if(ot(n)&&o||"object"!=typeof n&&void 0!==n)throw new Error(`All elements in the ${a} array should be of type ${i.nonModel}, [${typeof n}] received. ${n}`);ot(n)||Object.keys(e.fields).forEach((e=>{t(e,n[e])}))}))}else{if("object"!=typeof n)throw new Error(`Field ${a} should be of type ${i.nonModel}, ${typeof n} recieved. ${n}`);Object.keys(e.fields).forEach((e=>{t(e,n[e])}))}}}},ll=(e,t,n)=>{const{isArray:r,type:i}=e.fields[t]||{};if("string"==typeof n&&(r||"AWSJSON"===i||qe(i)||Ue(i)))try{return JSON.parse(n)}catch{}return"number"==typeof n&&"Boolean"===i?Boolean(n):n},dl=new WeakMap,hl=(e,t,n)=>{const r=ul(t);Object.entries(e).forEach((([e,i])=>{const o=ll(t,e,i);r(e,o),n[e]=o}))},pl=(e,t)=>{for(const n of Object.keys(e.fields))void 0===t[n]&&(t[n]=null)},fl=e=>{const t=class{constructor(t){let n=[];const r=Oe(this,(n=>{hl(t,e,n);const r=al.has(t),i=r?t:{},{id:o}=i;if(Ft(e)){const t=null!=o?o:e.syncable?m():$u();n.id=t}else(e=>{const t=Dt(e);return!(!t||!Le(t))&&t.properties.fields[0]===Ye})(e)&&(n.id=n.id||m());r||gl(n,e);const{_version:s,_lastChangedAt:a,_deleted:c}=i;e.syncable&&(n._version=s,n._lastChangedAt=a,n._deleted=c)}),(e=>n=e)),i=Oe(r,(t=>{pl(e,t)}));return dl.set(i,n),i}static copyOf(t,n){const r=Object.getPrototypeOf(t||{}).constructor;if(!Wu(r)){const e="The source object is not a valid model";throw ju.error(e,{source:t}),new Error(e)}let i=[];const o=Oe(t,(r=>{n(r),Mt(e).forEach((e=>{r[e]!==t[e]&&ju.warn(`copyOf() does not update PK fields. The '${e}' update is being ignored.`,{source:t}),r[e]=t[e]}));const i=ul(e);Object.entries(r).forEach((([t,n])=>{const r=ll(e,t,n);i(t,r)})),pl(e,r)}),(e=>i=e)),s=Gu.has(t);if(i.length||s)if(s){const[n,r]=Gu.get(t),s=function(e,t,n){const r=t.concat(n);let i;return Oe(e,(e=>{Ce(e,r)}),(e=>{i=e})),i}(r,n,i);Gu.set(o,[s,r]),vl(s,e)}else Gu.set(o,[i,t]),vl(i,e);else Gu.set(o,[[],t]);return tl(o,Zu.DataStore)}static fromJSON(n){if(Array.isArray(n))return n.map((e=>this.fromJSON(e)));const r=cl(t,n),i=ul(e);return Object.entries(r).forEach((([e,t])=>{i(e,t)})),tl(r,Zu.DataStore)}};t[ce]=!0,Object.defineProperty(t,"name",{value:e.name});const n=Lc.allFrom({builder:t,schema:e,pkField:Mt(e)});for(const r of n){const{field:n}=r;Object.defineProperty(t.prototype,e.fields[n].name,{set(t){if("object"==typeof t||void 0===t){if(t&&Object.prototype.hasOwnProperty.call(t,"_version")){const i=Object.getPrototypeOf(t||{}).constructor;if(!Wu(i)){const r=`Value passed to ${e.name}.${n} is not a valid instance of a model`;throw ju.error(r,{model:t}),new Error(r)}if(i.name.toLowerCase()!==r.remoteModelConstructor.name.toLowerCase()){const i=`Value passed to ${e.name}.${n} is not an instance of ${r.remoteModelConstructor.name}`;throw ju.error(i,{model:t}),new Error(i)}}if(r.isComplete){for(let e=0;e<r.localJoinFields.length;e++)this[r.localJoinFields[e]]=t?.[r.remoteJoinFields[e]];(Xu.has(this)?Xu.get(this):Xu.set(this,{}).get(this))[n]=t||void 0}}},get(){const t=Xu.has(this)?Xu.get(this):Xu.set(this,{}).get(this);if(!Object.prototype.hasOwnProperty.call(t,n)){if(nl(this)!==Zu.DataStore){if(nl(this)===Zu.API)throw new Error("Lazy loading from API is not yet supported!");return"HAS_MANY"===r.type?new ml([]):Promise.resolve(void 0)}{const i=Ol.query(r.remoteModelConstructor,(e=>e.and((e=>r.remoteJoinFields.map(((t,n)=>e[t].eq(this[r.localJoinFields[n]])))))));"HAS_MANY"===r.type?t[n]=new ml(i):t[n]=i.then((t=>{if(t.length>1){const t=new Error(`\n\t\t\t\t\t\t\t\t\tData integrity error.\n\t\t\t\t\t\t\t\t\tToo many records found for a HAS_ONE/BELONGS_TO field '${e.name}.${n}'\n\t\t\t\t\t\t\t\t`);throw console.error(t),t}return t[0]}))}}return t[n]}})}return t};class yl extends Promise{}class ml{constructor(e){this.values=e}[Symbol.asyncIterator](){let e,t=0;return{next:async()=>{if(e||(e=await this.values),t<e.length){const n={value:e[t],done:!1};return t++,n}return{value:null,done:!0}}}}async toArray({max:e=Number.MAX_SAFE_INTEGER}={}){const t=[];let n=0;for await(const r of this){if(!(n<e))break;t.push(r),n++}return t}}const gl=(e,t)=>{const n=Object.keys(e),{fields:r}=t;n.forEach((e=>{if(r[e]&&r[e].isReadOnly)throw new Error(`${e} is read-only.`)}))},vl=(e,t)=>{const n=e.map((e=>[e.path[0],e.value])),{fields:r}=t;n.forEach((([e,t])=>{if(t&&r[e]&&r[e].isReadOnly)throw new Error(`${e} is read-only.`)}))},bl=e=>{const t=class{constructor(t){return Oe(this,(n=>{hl(t,e,n)}))}};return t[ce]=!0,Object.defineProperty(t,"name",{value:e.name}),function(e){ut.add(e)}(t),t};function wl(e){return"string"==typeof e}function Sl(e){const{localModel:t,modelConstructor:n,remoteModel:r}=e,{_version:i}=r;return cl(n,{...t,_version:i})}function El(e){ju.warn(e)}function Al(e,t){let n;switch(e){case tt:n=Qu[t];break;case nt:n=Ju[t];break;case rt:n=Hu[t];break;case it:n=Yu[t];break;default:throw new Error(`Invalid namespace: ${e}`)}if(Wu(n))return n;{const n=`Model name is not valid for namespace. modelName: ${t}, namespace: ${e}`;throw ju.error(n),new Error(n)}}let Tl;var Il;!function(e){e.NotRunning="Not Running",e.Starting="Starting",e.Running="Running",e.Stopping="Stopping",e.Clearing="Clearing"}(Il||(Il={}));class Nl{constructor(){this.InternalAPI=Ua,this.Cache=$a,this.amplifyConfig={},this.syncPredicates=new WeakMap,this.amplifyContext={InternalAPI:this.InternalAPI},this.runningProcesses=new Ga,this.state=Il.NotRunning,this.start=async()=>this.runningProcesses.add((async()=>{if(this.state=Il.Starting,void 0!==this.initialized)return void await this.initialized;ju.debug("Starting DataStore"),this.initialized=new Promise(((e,t)=>{this.initResolve=e,this.initReject=t})),this.storage=new Xc(qu,zu,Al,cl,this.storageAdapter,this.sessionId),await this.storage.init(),il(),await async function(e,t){const n=Qu.Setting,r=qu.namespaces[tt].models.Setting;await e.runExclusive((async e=>{const[i]=await e.query(n,Xa.createFromAST(r,{and:{key:{eq:Uu}}}),{page:0,limit:1});void 0!==i&&void 0!==i.value?JSON.parse(i.value)!==t&&await e.clear(!1):await e.save(cl(n,{key:Uu,value:JSON.stringify(t)}))}))}(this.storage,qu.version);const{aws_appsync_graphqlEndpoint:e}=this.amplifyConfig;if(e){ju.debug("GraphQL endpoint available",e),this.syncPredicates=await this.processSyncExpressions(),this.sync=new Ou(qu,zu,Hu,Ju,this.storage,cl,this.conflictHandler,this.errorHandler,this.syncPredicates,this.amplifyConfig,this.authModeStrategy,this.amplifyContext,this.connectivityMonitor);const t=1e3*this.fullSyncInterval*60;Tl=this.sync.start({fullSyncInterval:t}).subscribe({next:({type:e,data:t})=>{e===("undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node?Nu.SYNC_ENGINE_SYNC_QUERIES_READY:Nu.SYNC_ENGINE_STORAGE_SUBSCRIBED)&&this.initResolve(),ss.dispatch("datastore",{event:e,data:t})},error:e=>{ju.warn("Sync error",e),this.initReject()}})}else ju.warn("Data won't be synchronized. No GraphQL endpoint configured. Did you forget `Amplify.configure(awsconfig)`?",{config:this.amplifyConfig}),this.initResolve();await this.initialized,this.state=Il.Running}),"datastore start").catch(this.handleAddProcError("DataStore.start()")),this.query=async(e,t,n)=>this.runningProcesses.add((async()=>{let r;if(await this.start(),!this.storage)throw new Error("No storage to query");if(!Wu(e)){const t="Constructor is not for a valid model";throw ju.error(t,{modelConstructor:e}),new Error(t)}"string"==typeof t&&void 0!==n&&ju.warn("Pagination is ignored when querying by id");const i=Ku(e);if(!i)throw new Error("Invalid model definition provided!");const o=this.processPagination(i,n),s=Mt(i);if(wl(t)){if(s.length>1){const e="Models with composite primary keys cannot be queried by a single key value. Use object literal syntax for composite keys instead: https://docs.amplify.aws/lib/datastore/advanced-workflows/q/platform/js/#querying-records-with-custom-primary-keys";throw ju.error(e,{keyFields:s}),new Error(e)}const n=Xa.createFromFlatEqualities(i,{[s[0]]:t});r=await this.storage.query(e,n,o)}else if(Ge(t,i)){const n=Xa.createForPk(i,t);r=await this.storage.query(e,n,o)}else if(!t||Va(t))r=await(this.storage?.query(e,void 0,o));else{const n=Fu({builder:e,schema:i,pkField:Mt(i)}),s=ku(t(n));r=await s.fetch(this.storage),r=wt(r,o)}return tl(wl(t)||Ge(t,i)?r[0]:r,Zu.DataStore)}),"datastore query").catch(this.handleAddProcError("DataStore.query()")),this.save=async(e,t)=>this.runningProcesses.add((async()=>{if(await this.start(),!this.storage)throw new Error("No storage to save to");const n=Gu.get(e),r=dl.has(e)?[dl.get(e),{}]:void 0,i=n||r,o=e?e.constructor:void 0;if(!Wu(o)){const t="Object is not an instance of a valid model";throw ju.error(t,{model:e}),new Error(t)}const s=Ku(o);if(!s)throw new Error("Model Definition could not be found for model");const a={builder:o,schema:s,pkField:Mt(s)};await this.storage.runExclusive((async t=>{const n=Lc.allFrom(a).filter((e=>"BELONGS_TO"===e.type));for(const r of n){const n=r.createRemoteQueryObject(e);if(null!==n&&0===(await t.query(r.remoteModelConstructor,Xa.createFromFlatEqualities(r.remoteDefinition,n))).length)throw new Error([`Data integrity error. You tried to save a ${s.name} (${JSON.stringify(e)})`,`but the instance assigned to the "${r.field}" property`,"does not exist in the local database. If you're trying to create the related",`"${r.remoteDefinition?.name}", you must save it independently first.`].join(" "))}}));const c=t?ku(t(Lu(a))).toStoragePredicate():void 0,[u]=await this.storage.runExclusive((async t=>(await t.save(e,c,void 0,i),t.query(o,Xa.createForPk(s,e)))));return tl(u,Zu.DataStore)}),"datastore save").catch(this.handleAddProcError("DataStore.save()")),this.setConflictHandler=e=>{const{DataStore:t}=e;return t&&t.conflictHandler?t.conflictHandler:(()=>this.conflictHandler===Sl)()&&e.conflictHandler?e.conflictHandler:this.conflictHandler||Sl},this.setErrorHandler=e=>{const{DataStore:t}=e;return t&&t.errorHandler?t.errorHandler:(()=>this.errorHandler===El)()&&e.errorHandler?e.errorHandler:this.errorHandler||El},this.delete=async(e,t)=>this.runningProcesses.add((async()=>{if(await this.start(),!this.storage)throw new Error("No storage to delete from");let n;if(!e){const t="Model or Model Constructor required";throw ju.error(t,{modelOrConstructor:e}),new Error(t)}if(Wu(e)){const r=e;if(!t){const e="Id to delete or criteria required. Do you want to delete all? Pass Predicates.ALL";throw ju.error(e,{identifierOrCriteria:t}),new Error(e)}const i=Ku(r);if(!i)throw new Error("Could not find model definition for modelConstructor.");if("string"==typeof t){const e=Mt(i);if(e.length>1){const t="Models with composite primary keys cannot be deleted by a single key value, unless using a predicate. Use object literal syntax for composite keys instead: https://docs.amplify.aws/lib/datastore/advanced-workflows/q/platform/js/#querying-records-with-custom-primary-keys";throw ju.error(t,{keyFields:e}),new Error(t)}n=Xa.createFromFlatEqualities(i,{[e[0]]:t})}else if(n=Ge(t,i)?Xa.createForPk(i,t):ku(t(Lu({builder:r,schema:i,pkField:Mt(i)}))).toStoragePredicate(),!n||!Xa.isValidPredicate(n)){const e="Criteria required. Do you want to delete all? Pass Predicates.ALL";throw ju.error(e,{condition:n}),new Error(e)}const[o]=await this.storage.delete(r,n);return tl(o,Zu.DataStore)}{const r=e,i=Object.getPrototypeOf(r||{}).constructor;if(!Wu(i)){const e="Object is not an instance of a valid model";throw ju.error(e,{model:r}),new Error(e)}const o=Ku(i);if(!o)throw new Error("Could not find model definition for modelConstructor.");const s=Xa.createForPk(o,r);if(t){if("function"!=typeof t){const e="Invalid criteria";throw ju.error(e,{identifierOrCriteria:t}),new Error(e)}n=ku(t(Lu({builder:i,schema:o,pkField:Mt(o)}))).toStoragePredicate()}else n=s;const[[a]]=await this.storage.delete(r,n);return tl(a,Zu.DataStore)}}),"datastore delete").catch(this.handleAddProcError("DataStore.delete()")),this.observe=(e,t)=>{let n;const r=e&&Wu(e)?e:void 0;if(e&&void 0===r){const n=e,r=n&&Object.getPrototypeOf(n).constructor;if(Wu(r))return t&&ju.warn("idOrCriteria is ignored when using a model instance",{model:n,identifierOrCriteria:t}),this.observe(r,n.id);{const e="The model is not an instance of a PersistentModelConstructor";throw ju.error(e,{model:n}),new Error(e)}}if(t&&r&&Ge(t,Ku(r))){const e="Object literal syntax cannot be used with observe. Use a predicate instead: https://docs.amplify.aws/lib/datastore/data-access/q/platform/js/#predicates";throw ju.error(e,{objectLiteral:t}),new Error(e)}if(void 0!==t&&void 0===r){const e="Cannot provide criteria without a modelConstructor";throw ju.error(e,t),new Error(e)}if(r&&!Wu(r)){const e="Constructor is not for a valid model";throw ju.error(e,{modelConstructor:r}),new Error(e)}return r&&"string"==typeof t?n=ku(Vu(r).id.eq(t)):r&&"function"==typeof t&&(n=ku(t(Vu(r)))),new Ur((e=>{let t;return this.runningProcesses.add((async()=>{await this.start(),t=this.storage.observe(r).pipe(ms((({model:e})=>zu(e)===nt))).subscribe({next:t=>this.runningProcesses.isOpen&&this.runningProcesses.add((async()=>{let r=t;if("DELETE"!==t.opType){const e=Ku(t.model),n=Mt(e),i=((e,t)=>{const n={};return t.forEach((t=>n[t]=e[t])),n})(t.element,n),o=await this.query(t.model,i);r={...r,element:o}}n&&!await n.matches(r.element)||e.next(r)}),"datastore observe message handler"),error:t=>{e.error(t)},complete:()=>{e.complete()}})}),"datastore observe observable initialization").catch(this.handleAddProcError("DataStore.observe()")).catch((t=>{e.error(t)})),this.runningProcesses.addCleaner((async()=>{t&&t.unsubscribe()}),"DataStore.observe() cleanup")}))},this.observeQuery=(e,t,n)=>new Ur((r=>{const i=new Map,o=new Map;let s,a,c=[];const u=()=>{const e=p();f(e)},l=new kt({callback:u,errorHandler:r.error,maxInterval:2e3}),{sort:d}=n||{},h=d?{sort:d}:void 0;if(!Ku(e))throw new Error("Could not find model definition.");e&&"function"==typeof t?a=ku(t(Vu(e))):Va(t)&&(a=void 0),this.runningProcesses.add((async()=>{try{(await this.query(e,t,h)).forEach((t=>{const n=bc(Ku(e),t);i.set(n,t)})),s=this.observe(e).subscribe((({element:e,model:t,opType:n})=>this.runningProcesses.isOpen&&this.runningProcesses.add((async()=>{const r=bc(Ku(t),e);if(a&&!await a.matches(e)){if("UPDATE"!==n||!i.has(r)&&!o.has(r))return;c.push(r)}"DELETE"===n?c.push(r):o.set(r,e);const s=this.sync?.getModelSyncedStatus(t)??!1;(o.size-c.length>=this.syncPageSize||s)&&l.resolve(),l.start()}),"handle observeQuery observed event"))),u()}catch(e){r.error(e)}}),"datastore observequery startup").catch(this.handleAddProcError("DataStore.observeQuery()")).catch((e=>{r.error(e)}));const p=()=>{const t=this.sync?.getModelSyncedStatus(e)??!1,r=[...Array.from(i.values()),...Array.from(o.values())];i.clear(),r.forEach((t=>{const n=bc(Ku(e),t);i.set(n,t)})),c.forEach((e=>i.delete(e)));const s=Array.from(i.values());return n?.sort&&y(s),{items:s,isSynced:t}},f=e=>{r.next(e),o.clear(),c=[]},y=t=>{const r=Ku(e),i=this.processPagination(r,n),o=Qe.getPredicates(i.sort);if(o.length){const e=vt(o);t.sort(e)}},m=ss.listen("datastore",(({payload:t})=>{const{event:n,data:r}=t;n===Nu.SYNC_ENGINE_MODEL_SYNCED&&r?.model?.name===e.name&&(u(),m())}));return this.runningProcesses.addCleaner((async()=>{s&&s.unsubscribe()}),"datastore observequery cleaner")})),this.configure=(e={})=>{this.amplifyContext.InternalAPI=this.InternalAPI;const{DataStore:t,authModeStrategyType:n,maxRecordsToSync:r,syncPageSize:i,fullSyncInterval:o,syncExpressions:s,authProviders:a,storageAdapter:c,...u}=e,l=Js.getConfig().API?.GraphQL,d={aws_appsync_graphqlEndpoint:l?.endpoint,aws_appsync_authenticationType:l?.defaultAuthMode,aws_appsync_region:l?.region,aws_appsync_apiKey:l?.apiKey};switch(this.amplifyConfig={...this.amplifyConfig,...u,...l&&d},this.conflictHandler=this.setConflictHandler(e),this.errorHandler=this.setErrorHandler(e),t&&t.authModeStrategyType||n||Ee.DEFAULT){case Ee.MULTI_AUTH:this.authModeStrategy=(this.amplifyContext,async({schema:e,modelName:t})=>{let n;try{const e=await Qs();e.tokens.accessToken&&(n=e)}catch(e){}const{attributes:r}=e.namespaces.user.models[t];if(r){const e=r.find((e=>"auth"===e.type));if(e?.properties?.rules){const t=function(e){const t=[me.CUSTOM,me.OWNER,me.GROUPS,me.PRIVATE,me.PUBLIC],n=[ge.FUNCTION,ge.USER_POOLS,ge.OIDC,ge.IAM,ge.API_KEY];return[...e].sort(((e,r)=>e.allow===r.allow?n.indexOf(Wa(e))-n.indexOf(Wa(r)):t.indexOf(e.allow)-t.indexOf(r.allow)))}(e.properties.rules);return function({rules:e,currentUser:t}){const n=new Set;return e.forEach((e=>{switch(e.allow){case me.CUSTOM:e.provider&&e.provider!==ge.FUNCTION||n.add("lambda");break;case me.GROUPS:case me.OWNER:t&&(e.provider===ge.USER_POOLS?n.add("userPool"):e.provider===ge.OIDC&&n.add("oidc"));break;case me.PRIVATE:t&&(e.provider&&e.provider!==ge.USER_POOLS?e.provider===ge.IAM&&n.add("iam"):n.add("userPool"));break;case me.PUBLIC:e.provider===ge.IAM?n.add("iam"):e.provider&&e.provider!==ge.API_KEY||n.add("apiKey")}})),Array.from(n)}({currentUser:n,rules:t})}}return[]});break;case Ee.DEFAULT:default:this.authModeStrategy=Ka}this.amplifyConfig.authProviders=t&&t.authProviders||a,this.syncExpressions=t&&t.syncExpressions||s||this.syncExpressions,this.maxRecordsToSync=t&&t.maxRecordsToSync||r||this.maxRecordsToSync||1e4,this.amplifyConfig.maxRecordsToSync=this.maxRecordsToSync,this.syncPageSize=t&&t.syncPageSize||i||this.syncPageSize||1e3,this.amplifyConfig.syncPageSize=this.syncPageSize,this.fullSyncInterval=t&&t.fullSyncInterval||o||this.fullSyncInterval||1440,this.storageAdapter=t&&t.storageAdapter||c||this.storageAdapter||void 0,this.sessionId=this.retrieveSessionId()}}getModuleName(){return"DataStore"}handleAddProcError(e){return t=>{throw t.message.startsWith("BackgroundManagerNotOpenError")?new Error([`DataStoreStateError: Tried to execute \`${e}\` while DataStore was "${this.state}".`,'This can only be done while DataStore is "Started" or "Stopped". To remedy:',"Ensure all calls to `stop()` and `clear()` have completed first.","If this is not possible, retry the operation until it succeeds."].join("\n")):t}}async clear(){il(),this.state=Il.Clearing,await this.runningProcesses.close(),void 0===this.storage&&(this.storage=new Xc(qu,zu,Al,cl,this.storageAdapter,this.sessionId),await this.storage.init()),Tl&&!Tl.closed&&Tl.unsubscribe(),this.sync&&await this.sync.stop(),await this.storage.clear(),this.initialized=void 0,this.storage=void 0,this.sync=void 0,this.syncPredicates=new WeakMap,await this.runningProcesses.open(),this.state=Il.NotRunning}async stop(){this.state=Il.Stopping,await this.runningProcesses.close(),Tl&&!Tl.closed&&Tl.unsubscribe(),this.sync&&await this.sync.stop(),this.initialized=void 0,this.sync=void 0,await this.runningProcesses.open(),this.state=Il.NotRunning}processPagination(e,t){let n;const{limit:r,page:i,sort:o}=t||{};if(void 0!==r||void 0!==i||void 0!==o){if(void 0!==i&&void 0===r)throw new Error("Limit is required when requesting a page");if(void 0!==i){if("number"!=typeof i)throw new Error("Page should be a number");if(i<0)throw new Error("Page can't be negative")}if(void 0!==r){if("number"!=typeof r)throw new Error("Limit should be a number");if(r<0)throw new Error("Limit can't be negative")}return o&&(n=Qe.createFromExisting(e,o)),{limit:r,page:i,sort:n}}}async processSyncExpressions(){if(!this.syncExpressions||!this.syncExpressions.length)return new WeakMap;const e=await Promise.all(this.syncExpressions.map((async e=>{const{modelConstructor:t,conditionProducer:n}=await e,r=Ku(t),i=await this.unwrapPromise(n);return Va(i)?[r,null]:[r,ku(i(Lu({builder:t,schema:r,pkField:Mt(r)}))).toStoragePredicate()]})));return this.weakMapFromEntries(e)}async unwrapPromise(e){try{return await e()||e}catch(t){if(t instanceof TypeError)return e;throw t}}weakMapFromEntries(e){return e.reduce(((e,[t,n])=>{if(e.has(t)){const{name:n}=t;return ju.warn(`You can only utilize one Sync Expression per model.\n          Subsequent sync expressions for the ${n} model will be ignored.`),e}return n&&e.set(t,n),e}),new WeakMap)}retrieveSessionId(){try{const e=sessionStorage.getItem("datastoreSessionId");if(e){const{aws_appsync_graphqlEndpoint:t}=this.amplifyConfig,n=t.split("/")[2],[r]=n.split(".");return`${e}-${r}`}}catch{}}}const Ol=new Nl;Ol.configure({}),ss.listen("core",(e=>{"configure"===e.payload.event&&Ol.configure({})}));const _l={USER:nt,traverseModel:dt,validatePredicate:st,isNonModelConstructor:e=>ut.has(e),isModelConstructor:ct}})(),r})()));
//# sourceMappingURL=aws-amplify-datastore.min.js.map