!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("aws_amplify_core"),require("graphql")):"function"==typeof define&&define.amd?define("aws_amplify_api-graphql",["aws_amplify_core","graphql"],t):"object"==typeof exports?exports["aws_amplify_api-graphql"]=t(require("aws_amplify_core"),require("graphql")):e["aws_amplify_api-graphql"]=t(e.aws_amplify_core,e.graphql)}(self,((e,t)=>(()=>{"use strict";var n={556:t=>{t.exports=e},49:e=>{e.exports=t}},r={};function o(e){var t=r[e];if(void 0!==t)return t.exports;var i=r[e]={exports:{}};return n[e](i,i.exports,o),i.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};o.r(i),o.d(i,{CONNECTION_STATE_CHANGE:()=>W,CONTROL_MSG:()=>Ye,ConnectionState:()=>Xe,GraphQLAPI:()=>Dr,GraphQLAPIClass:()=>Pr,GraphQLAuthError:()=>Yn,__amplify:()=>Xn,__authMode:()=>Zn,__authToken:()=>er,__headers:()=>tr,events:()=>s,getInternals:()=>nr,graphqlOperation:()=>Lr});var s={};o.r(s),o.d(s,{closeAll:()=>gr,connect:()=>yr,post:()=>br});var a=o(556);const c="x-amz-user-agent";var u,l,d,p,h,f,y,b,g,m,S,v,w,E,C;!function(e){e.WebUnknown="0",e.React="1",e.NextJs="2",e.Angular="3",e.VueJs="4",e.Nuxt="5",e.Svelte="6",e.ServerSideUnknown="100",e.ReactSSR="101",e.NextJsSSR="102",e.AngularSSR="103",e.VueJsSSR="104",e.NuxtSSR="105",e.SvelteSSR="106",e.ReactNative="201",e.Expo="202"}(u||(u={})),function(e){e.AI="ai",e.API="api",e.Auth="auth",e.Analytics="analytics",e.DataStore="datastore",e.Geo="geo",e.InAppMessaging="inappmessaging",e.Interactions="interactions",e.Predictions="predictions",e.PubSub="pubsub",e.PushNotification="pushnotification",e.Storage="storage"}(l||(l={})),(C=d||(d={})).CreateConversation="1",C.GetConversation="2",C.ListConversations="3",C.DeleteConversation="4",C.SendMessage="5",C.ListMessages="6",C.OnMessage="7",C.Generation="8",C.UpdateConversation="9",function(e){e.Record="1",e.IdentifyUser="2"}(p||(p={})),function(e){e.GraphQl="1",e.Get="2",e.Post="3",e.Put="4",e.Patch="5",e.Del="6",e.Head="7"}(h||(h={})),function(e){e.SignUp="1",e.ConfirmSignUp="2",e.ResendSignUpCode="3",e.SignIn="4",e.FetchMFAPreference="6",e.UpdateMFAPreference="7",e.SetUpTOTP="10",e.VerifyTOTPSetup="11",e.ConfirmSignIn="12",e.DeleteUserAttributes="15",e.DeleteUser="16",e.UpdateUserAttributes="17",e.FetchUserAttributes="18",e.ConfirmUserAttribute="22",e.SignOut="26",e.UpdatePassword="27",e.ResetPassword="28",e.ConfirmResetPassword="29",e.FederatedSignIn="30",e.RememberDevice="32",e.ForgetDevice="33",e.FetchDevices="34",e.SendUserAttributeVerificationCode="35",e.SignInWithRedirect="36",e.StartWebAuthnRegistration="37",e.CompleteWebAuthnRegistration="38",e.ListWebAuthnCredentials="39",e.DeleteWebAuthnCredential="40"}(f||(f={})),function(e){e.Subscribe="1",e.GraphQl="2"}(y||(y={})),function(e){e.SearchByText="0",e.SearchByCoordinates="1",e.SearchForSuggestions="2",e.SearchByPlaceId="3",e.SaveGeofences="4",e.GetGeofence="5",e.ListGeofences="6",e.DeleteGeofences="7"}(b||(b={})),function(e){e.SyncMessages="1",e.IdentifyUser="2",e.NotifyMessageInteraction="3"}(g||(g={})),function(e){e.None="0"}(m||(m={})),function(e){e.Convert="1",e.Identify="2",e.Interpret="3"}(S||(S={})),function(e){e.Subscribe="1"}(v||(v={})),function(e){e.InitializePushNotifications="1",e.IdentifyUser="2"}(w||(w={})),function(e){e.UploadData="1",e.DownloadData="2",e.List="3",e.Copy="4",e.Remove="5",e.GetProperties="6",e.GetUrl="7",e.GetDataAccess="8",e.ListCallerAccessGrants="9"}(E||(E={}));const _="6.10.2",T=()=>"undefined"!=typeof global,N=()=>"undefined"!=typeof window,A=()=>"undefined"!=typeof document,O=()=>"undefined"!=typeof process,k=(e,t)=>!!Object.keys(e).find((e=>e.startsWith(t))),I=[{platform:u.Expo,detectionMethod:function(){return T()&&void 0!==global.expo}},{platform:u.ReactNative,detectionMethod:function(){return"undefined"!=typeof navigator&&void 0!==navigator.product&&"ReactNative"===navigator.product}},{platform:u.NextJs,detectionMethod:function(){return N()&&window.next&&"object"==typeof window.next}},{platform:u.Nuxt,detectionMethod:function(){return N()&&(void 0!==window.__NUXT__||void 0!==window.$nuxt)}},{platform:u.Angular,detectionMethod:function(){const e=Boolean(A()&&document.querySelector("[ng-version]")),t=Boolean(N()&&void 0!==window.ng);return e||t}},{platform:u.React,detectionMethod:function(){const e=e=>e.startsWith("_react")||e.startsWith("__react");return A()&&Array.from(document.querySelectorAll("[id]")).some((t=>Object.keys(t).find(e)))}},{platform:u.VueJs,detectionMethod:function(){return N()&&k(window,"__VUE")}},{platform:u.Svelte,detectionMethod:function(){return N()&&k(window,"__SVELTE")}},{platform:u.WebUnknown,detectionMethod:function(){return N()}},{platform:u.NextJsSSR,detectionMethod:function(){return T()&&(k(global,"__next")||k(global,"__NEXT"))}},{platform:u.NuxtSSR,detectionMethod:function(){return T()&&void 0!==global.__NUXT_PATHS__}},{platform:u.ReactSSR,detectionMethod:function(){return O()&&void 0!==process.env&&!!Object.keys(process.env).find((e=>e.includes("react")))}},{platform:u.VueJsSSR,detectionMethod:function(){return T()&&k(global,"__VUE")}},{platform:u.AngularSSR,detectionMethod:function(){return O()&&"object"==typeof process.env&&process.env.npm_lifecycle_script?.startsWith("ng ")||!1}},{platform:u.SvelteSSR,detectionMethod:function(){return O()&&void 0!==process.env&&!!Object.keys(process.env).find((e=>e.includes("svelte")))}}];let R;const L=[];let P=!1;const D=()=>{if(!R){if(R=I.find((e=>e.detectionMethod()))?.platform||u.ServerSideUnknown,P)for(;L.length;)L.pop()?.();else L.forEach((e=>{e()}));x(u.ServerSideUnknown,10),x(u.WebUnknown,10)}return R};function x(e,t){R!==e||P||setTimeout((()=>{R=void 0,P=!0,setTimeout(D,1e3)}),t)}const M={},q="aws-amplify",U=e=>e.replace(/\+.*/,"");new class{constructor(){this.userAgent=`${q}/${U(_)}`}get framework(){return D()}get isReactNative(){return this.framework===u.ReactNative||this.framework===u.Expo}observeFrameworkChanges(e){(e=>{P||L.push(e)})(e)}};const G=e=>(({category:e,action:t}={})=>{const n=[[q,U(_)]];if(e&&n.push([e,t]),n.push(["framework",D()]),e&&t){const r=((e,t)=>M[e]?.[t]?.additionalDetails)(e,t);r&&r.forEach((e=>{n.push(e)}))}return n})(e).map((([e,t])=>e&&t?`${e}/${t}`:e)).join(" "),$=[400,401,403],j=["BadRequestException","UnauthorizedException"],W="ConnectionStateChange";var H,K,z;!function(e){e.GQL_CONNECTION_INIT="connection_init",e.GQL_CONNECTION_ERROR="connection_error",e.GQL_CONNECTION_ACK="connection_ack",e.GQL_START="start",e.GQL_START_ACK="start_ack",e.DATA="data",e.GQL_CONNECTION_KEEP_ALIVE="ka",e.GQL_STOP="stop",e.GQL_COMPLETE="complete",e.GQL_ERROR="error",e.EVENT_SUBSCRIBE="subscribe",e.EVENT_PUBLISH="publish",e.EVENT_SUBSCRIBE_ACK="subscribe_success",e.EVENT_PUBLISH_ACK="publish_success",e.EVENT_STOP="unsubscribe",e.EVENT_COMPLETE="unsubscribe_success"}(H||(H={})),function(e){e[e.PENDING=0]="PENDING",e[e.CONNECTED=1]="CONNECTED",e[e.FAILED=2]="FAILED"}(K||(K={})),function(e){e[e.CLOSED=0]="CLOSED",e[e.READY=1]="READY",e[e.CONNECTING=2]="CONNECTING"}(z||(z={}));const B={accept:"application/json, text/javascript","content-encoding":"amz-1.0","content-type":"application/json; charset=UTF-8"},F=3e5;var V=function(e,t){return V=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},V(e,t)};function J(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}V(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function Q(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function Y(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function X(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Z(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function ee(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}function te(e){return this instanceof te?(this.v=e,this):new te(e)}function ne(e){return"function"==typeof e}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var re,oe=((re=function(e){var t;t=this,Error.call(t),t.stack=(new Error).stack,this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}).prototype=Object.create(Error.prototype),re.prototype.constructor=re,re);function ie(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var se=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,n,r,o;if(!this.closed){this.closed=!0;var i=this._parentage;if(i)if(this._parentage=null,Array.isArray(i))try{for(var s=X(i),a=s.next();!a.done;a=s.next())a.value.remove(this)}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else i.remove(this);var c=this.initialTeardown;if(ne(c))try{c()}catch(e){o=e instanceof oe?e.errors:[e]}var u=this._finalizers;if(u){this._finalizers=null;try{for(var l=X(u),d=l.next();!d.done;d=l.next()){var p=d.value;try{ce(p)}catch(e){o=null!=o?o:[],e instanceof oe?o=ee(ee([],Z(o)),Z(e.errors)):o.push(e)}}}catch(e){n={error:e}}finally{try{d&&!d.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}}if(o)throw new oe(o)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)ce(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&ie(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&ie(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}();function ae(e){return e instanceof se||e&&"closed"in e&&ne(e.remove)&&ne(e.add)&&ne(e.unsubscribe)}function ce(e){ne(e)?e():e.unsubscribe()}se.EMPTY;var ue=null,le=null,de=void 0,pe=!1,he=!1,fe={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=fe.delegate;return(null==o?void 0:o.setTimeout)?o.setTimeout.apply(o,ee([e,t],Z(n))):setTimeout.apply(void 0,ee([e,t],Z(n)))},clearTimeout:function(e){var t=fe.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function ye(e){fe.setTimeout((function(){if(!ue)throw e;ue(e)}))}function be(){}var ge=me("C",void 0,void 0);function me(e,t,n){return{kind:e,value:t,error:n}}var Se=null,ve=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,ae(t)&&t.add(n)):n.destination=Ae,n}return J(t,e),t.create=function(e,t,n){return new _e(e,t,n)},t.prototype.next=function(e){this.isStopped?Ne(function(e){return me("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?Ne(me("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?Ne(ge,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(se),we=Function.prototype.bind;function Ee(e,t){return we.call(e,t)}var Ce=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){Te(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){Te(e)}else Te(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){Te(e)}},e}(),_e=function(e){function t(t,n,r){var o,i,s=e.call(this)||this;return ne(t)||!t?o={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:s&&he?((i=Object.create(t)).unsubscribe=function(){return s.unsubscribe()},o={next:t.next&&Ee(t.next,i),error:t.error&&Ee(t.error,i),complete:t.complete&&Ee(t.complete,i)}):o=t,s.destination=new Ce(o),s}return J(t,e),t}(ve);function Te(e){var t;pe?(t=e,pe&&Se&&(Se.errorThrown=!0,Se.error=t)):ye(e)}function Ne(e,t){var n=le;n&&fe.setTimeout((function(){return n(e,t)}))}var Ae={closed:!0,next:be,error:function(e){throw e},complete:be},Oe="function"==typeof Symbol&&Symbol.observable||"@@observable";function ke(e){return e}var Ie=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r,o=this,i=(r=e)&&r instanceof ve||function(e){return e&&ne(e.next)&&ne(e.error)&&ne(e.complete)}(r)&&ae(r)?e:new _e(e,t,n);return function(e){if(pe){var t=!Se;if(t&&(Se={errorThrown:!1,error:null}),e(),t){var n=Se,r=n.errorThrown,o=n.error;if(Se=null,r)throw o}}else e()}((function(){var e=o,t=e.operator,n=e.source;i.add(t?t.call(i,n):n?o._subscribe(i):o._trySubscribe(i))})),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=Re(t))((function(t,r){var o=new _e({next:function(t){try{e(t)}catch(e){r(e),o.unsubscribe()}},error:r,complete:t});n.subscribe(o)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[Oe]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0===(n=e).length?ke:1===n.length?n[0]:function(e){return n.reduce((function(e,t){return t(e)}),e)})(this);var n},e.prototype.toPromise=function(e){var t=this;return new(e=Re(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function Re(e){var t;return null!==(t=null!=e?e:de)&&void 0!==t?t:Promise}var Le,Pe=o(49);!function(e){e.DEBUG="DEBUG",e.ERROR="ERROR",e.INFO="INFO",e.WARN="WARN",e.VERBOSE="VERBOSE",e.NONE="NONE"}(Le||(Le={}));const De={VERBOSE:1,DEBUG:2,INFO:3,WARN:4,ERROR:5,NONE:6};class xe{constructor(e,t=Le.WARN){this.name=e,this.level=t,this._pluggables=[]}_padding(e){return e<10?"0"+e:""+e}_ts(){const e=new Date;return[this._padding(e.getMinutes()),this._padding(e.getSeconds())].join(":")+"."+e.getMilliseconds()}configure(e){return e?(this._config=e,this._config):this._config}_log(e,...t){let n=this.level;if(xe.LOG_LEVEL&&(n=xe.LOG_LEVEL),"undefined"!=typeof window&&window.LOG_LEVEL&&(n=window.LOG_LEVEL),!(De[e]>=De[n]))return;let r=console.log.bind(console);e===Le.ERROR&&console.error&&(r=console.error.bind(console)),e===Le.WARN&&console.warn&&(r=console.warn.bind(console)),xe.BIND_ALL_LOG_LEVELS&&(e===Le.INFO&&console.info&&(r=console.info.bind(console)),e===Le.DEBUG&&console.debug&&(r=console.debug.bind(console)));const o=`[${e}] ${this._ts()} ${this.name}`;let i="";if(1===t.length&&"string"==typeof t[0])i=`${o} - ${t[0]}`,r(i);else if(1===t.length)i=`${o} ${t[0]}`,r(o,t[0]);else if("string"==typeof t[0]){let e=t.slice(1);1===e.length&&(e=e[0]),i=`${o} - ${t[0]} ${e}`,r(`${o} - ${t[0]}`,e)}else i=`${o} ${t}`,r(o,t);for(const e of this._pluggables){const t={message:i,timestamp:Date.now()};e.pushLogs([t])}}log(...e){this._log(Le.INFO,...e)}info(...e){this._log(Le.INFO,...e)}warn(...e){this._log(Le.WARN,...e)}error(...e){this._log(Le.ERROR,...e)}debug(...e){this._log(Le.DEBUG,...e)}verbose(...e){this._log(Le.VERBOSE,...e)}addPluggable(e){e&&"Logging"===e.getCategoryName()&&(this._pluggables.push(e),e.configure(this._config))}listPluggables(){return this._pluggables}}xe.LOG_LEVEL=null,xe.BIND_ALL_LOG_LEVELS=!1;class Me extends Error{constructor({message:e,name:t,recoverySuggestion:n,underlyingError:r}){super(e),this.name=t,this.underlyingError=r,this.recoverySuggestion=n,this.constructor=Me,Object.setPrototypeOf(this,Me.prototype)}}const qe="undefined"!=typeof Symbol?Symbol("amplify_default"):"@@amplify_default",Ue=new xe("Hub");class Ge{constructor(e){this.listeners=new Map,this.protectedChannels=["core","auth","api","analytics","interactions","pubsub","storage","ui","xr"],this.name=e}_remove(e,t){const n=this.listeners.get(e);n?this.listeners.set(e,[...n.filter((({callback:e})=>e!==t))]):Ue.warn(`No listeners for ${e}`)}dispatch(e,t,n,r){"string"==typeof e&&this.protectedChannels.indexOf(e)>-1&&(r===qe||Ue.warn(`WARNING: ${e} is protected and dispatching on it can have unintended consequences`));const o={channel:e,payload:{...t},source:n,patternInfo:[]};try{this._toListeners(o)}catch(e){Ue.error(e)}}listen(e,t,n="noname"){let r;if("function"!=typeof t)throw new Me({name:"NoHubcallbackProvidedException",message:"No callback supplied to Hub"});r=t;let o=this.listeners.get(e);return o||(o=[],this.listeners.set(e,o)),o.push({name:n,callback:r}),()=>{this._remove(e,r)}}_toListeners(e){const{channel:t,payload:n}=e,r=this.listeners.get(t);r&&r.forEach((r=>{Ue.debug(`Dispatching to ${t} with `,n);try{r.callback(e)}catch(e){Ue.error(e)}}))}}new Ge("__default__"),new Ge("internal-hub");class $e extends Error{constructor(){super(...arguments),this.nonRetryable=!0}}const je={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let We;const He=new Uint8Array(16);function Ke(){if(!We&&(We="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!We))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return We(He)}const ze=[];for(let e=0;e<256;++e)ze.push((e+256).toString(16).slice(1));const Be=function(e,t,n){if(je.randomUUID&&!t&&!e)return je.randomUUID();const r=(e=e||{}).random||(e.rng||Ke)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return ze[e[t+0]]+ze[e[t+1]]+ze[e[t+2]]+ze[e[t+3]]+"-"+ze[e[t+4]]+ze[e[t+5]]+"-"+ze[e[t+6]]+ze[e[t+7]]+"-"+ze[e[t+8]]+ze[e[t+9]]+"-"+ze[e[t+10]]+ze[e[t+11]]+ze[e[t+12]]+ze[e[t+13]]+ze[e[t+14]]+ze[e[t+15]]}(r)},Fe=e=>e&&e.nonRetryable,Ve={convert(e,t={urlSafe:!1,skipPadding:!1}){const n="string"==typeof e?e:function(e){return Array.from(e,(e=>String.fromCodePoint(e))).join("")}(e);let r=(()=>{if("undefined"!=typeof window&&"function"==typeof window.btoa)return window.btoa;if("function"==typeof btoa)return btoa;throw new Me({name:"Base64EncoderError",message:"Cannot resolve the `btoa` function from the environment."})})()(n);return t.urlSafe&&(r=r.replace(/\+/g,"-").replace(/\//g,"_")),t.skipPadding&&(r=r.replace(/=/g,"")),r}};function Je(e=3e5){return t=>{const n=2**t*100+100*Math.random();return!(n>e)&&n}}const Qe=new xe("retryUtil");var Ye,Xe;function Ze(e){return function(t){if(function(e){return ne(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function et(e,t,n,r,o){return new tt(e,t,n,r,o)}!function(e){e.CONNECTION_CLOSED="Connection closed",e.CONNECTION_FAILED="Connection failed",e.REALTIME_SUBSCRIPTION_INIT_ERROR="AppSync Realtime subscription init error",e.SUBSCRIPTION_ACK="Subscription ack",e.TIMEOUT_DISCONNECT="Timeout disconnect"}(Ye||(Ye={})),function(e){e.Connected="Connected",e.ConnectedPendingNetwork="ConnectedPendingNetwork",e.ConnectionDisrupted="ConnectionDisrupted",e.ConnectionDisruptedPendingNetwork="ConnectionDisruptedPendingNetwork",e.Connecting="Connecting",e.ConnectedPendingDisconnect="ConnectedPendingDisconnect",e.Disconnected="Disconnected",e.ConnectedPendingKeepAlive="ConnectedPendingKeepAlive"}(Xe||(Xe={}));var tt=function(e){function t(t,n,r,o,i,s){var a=e.call(this,t)||this;return a.onFinalize=i,a.shouldUnsubscribe=s,a._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,a._error=o?function(e){try{o(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return J(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(ve),nt=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function rt(e){return ne(null==e?void 0:e.then)}function ot(e){return ne(e[Oe])}function it(e){return Symbol.asyncIterator&&ne(null==e?void 0:e[Symbol.asyncIterator])}function st(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var at="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function ct(e){return ne(null==e?void 0:e[at])}function ut(e){return function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),i=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",(function(e){return function(t){return Promise.resolve(t).then(e,u)}})),r[Symbol.asyncIterator]=function(){return this},r;function s(e,t){o[e]&&(r[e]=function(t){return new Promise((function(n,r){i.push([e,t,n,r])>1||a(e,t)}))},t&&(r[e]=t(r[e])))}function a(e,t){try{(n=o[e](t)).value instanceof te?Promise.resolve(n.value.v).then(c,u):l(i[0][2],n)}catch(e){l(i[0][3],e)}var n}function c(e){a("next",e)}function u(e){a("throw",e)}function l(e,t){e(t),i.shift(),i.length&&a(i[0][0],i[0][1])}}(this,arguments,(function(){var t,n,r;return Y(this,(function(o){switch(o.label){case 0:t=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,te(t.read())];case 3:return n=o.sent(),r=n.value,n.done?[4,te(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,te(r)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function lt(e){return ne(null==e?void 0:e.getReader)}function dt(e){if(e instanceof Ie)return e;if(null!=e){if(ot(e))return o=e,new Ie((function(e){var t=o[Oe]();if(ne(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(nt(e))return r=e,new Ie((function(e){for(var t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()}));if(rt(e))return n=e,new Ie((function(e){n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,ye)}));if(it(e))return pt(e);if(ct(e))return t=e,new Ie((function(e){var n,r;try{for(var o=X(t),i=o.next();!i.done;i=o.next()){var s=i.value;if(e.next(s),e.closed)return}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}e.complete()}));if(lt(e))return pt(ut(e))}var t,n,r,o;throw st(e)}function pt(e){return new Ie((function(t){(function(e,t){var n,r,o,i;return Q(this,void 0,void 0,(function(){var s,a;return Y(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=X(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,o,(t=e[n](t)).done,t.value)}))}}}(e),c.label=1;case 1:return[4,n.next()];case 2:if((r=c.sent()).done)return[3,4];if(s=r.value,t.next(s),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),o={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(i=n.return)?[4,i.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}class ht{networkMonitor(e){const t=(()=>{if("undefined"==typeof self)return!1;const e=self;return void 0!==e.WorkerGlobalScope&&self instanceof e.WorkerGlobalScope})()?self:"undefined"!=typeof window&&window;return t?new Ie((e=>{e.next({online:t.navigator.onLine});const n=()=>{e.next({online:!0})},r=()=>{e.next({online:!1})};return t.addEventListener("online",n),t.addEventListener("offline",r),ht._observers.push(e),()=>{t.removeEventListener("online",n),t.removeEventListener("offline",r),ht._observers=ht._observers.filter((t=>t!==e))}})):dt([{online:!0}])}static _observerOverride(e){for(const t of this._observers)t.closed?this._observers=this._observers.filter((e=>e!==t)):t?.next&&t.next(e)}}ht._observers=[];const ft=()=>(new ht).networkMonitor(),yt={KEEP_ALIVE_MISSED:{keepAliveState:"unhealthy"},KEEP_ALIVE:{keepAliveState:"healthy"},CONNECTION_ESTABLISHED:{connectionState:"connected"},CONNECTION_FAILED:{intendedConnectionState:"disconnected",connectionState:"disconnected"},CLOSING_CONNECTION:{intendedConnectionState:"disconnected"},OPENING_CONNECTION:{intendedConnectionState:"connected",connectionState:"connecting"},CLOSED:{connectionState:"disconnected"},ONLINE:{networkState:"connected"},OFFLINE:{networkState:"disconnected"}};class bt{constructor(){this._networkMonitoringSubscription=void 0,this._linkedConnectionState={networkState:"connected",connectionState:"disconnected",intendedConnectionState:"disconnected",keepAliveState:"healthy"},this._initialNetworkStateSubscription=ft().subscribe((({online:e})=>{this.record(e?yt.ONLINE:yt.OFFLINE),this._initialNetworkStateSubscription?.unsubscribe()})),this._linkedConnectionStateObservable=new Ie((e=>{e.next(this._linkedConnectionState),this._linkedConnectionStateObserver=e}))}enableNetworkMonitoring(){this._initialNetworkStateSubscription?.unsubscribe(),void 0===this._networkMonitoringSubscription&&(this._networkMonitoringSubscription=ft().subscribe((({online:e})=>{this.record(e?yt.ONLINE:yt.OFFLINE)})))}disableNetworkMonitoring(){this._networkMonitoringSubscription?.unsubscribe(),this._networkMonitoringSubscription=void 0}get connectionStateObservable(){let e;return this._linkedConnectionStateObservable.pipe((n=e=>this.connectionStatesTranslator(e),Ze((function(e,t){var r=0;e.subscribe(et(t,(function(e){t.next(n.call(undefined,e,r++))})))})))).pipe((t=t=>{const n=t!==e;return e=t,n},Ze((function(e,n){var r=0;e.subscribe(et(n,(function(e){return t.call(void 0,e,r++)&&n.next(e)})))}))));var t,n}record(e){"connected"===e.intendedConnectionState?this.enableNetworkMonitoring():"disconnected"===e.intendedConnectionState&&this.disableNetworkMonitoring();const t={...this._linkedConnectionState,...e};this._linkedConnectionState={...t},this._linkedConnectionStateObserver?.next(this._linkedConnectionState)}connectionStatesTranslator({connectionState:e,networkState:t,intendedConnectionState:n,keepAliveState:r}){return"connected"===e&&"disconnected"===t?Xe.ConnectedPendingNetwork:"connected"===e&&"disconnected"===n?Xe.ConnectedPendingDisconnect:"disconnected"===e&&"connected"===n&&"disconnected"===t?Xe.ConnectionDisruptedPendingNetwork:"disconnected"===e&&"connected"===n?Xe.ConnectionDisrupted:"connected"===e&&"unhealthy"===r?Xe.ConnectedPendingKeepAlive:"connecting"===e?Xe.Connecting:"disconnected"===e?Xe.Disconnected:Xe.Connected}}var gt;!function(e){e.START_RECONNECT="START_RECONNECT",e.HALT_RECONNECT="HALT_RECONNECT"}(gt||(gt={}));class mt{constructor(){this.reconnectObservers=[]}addObserver(e){this.reconnectObservers.push(e)}record(e){e===gt.START_RECONNECT&&void 0===this.reconnectSetTimeoutId&&void 0===this.reconnectIntervalId&&(this.reconnectSetTimeoutId=setTimeout((()=>{this._triggerReconnect(),this.reconnectIntervalId=setInterval((()=>{this._triggerReconnect()}),6e4)}),5e3)),e===gt.HALT_RECONNECT&&(this.reconnectIntervalId&&(clearInterval(this.reconnectIntervalId),this.reconnectIntervalId=void 0),this.reconnectSetTimeoutId&&(clearTimeout(this.reconnectSetTimeoutId),this.reconnectSetTimeoutId=void 0))}close(){this.reconnectObservers.forEach((e=>{e.complete?.()}))}_triggerReconnect(){this.reconnectObservers.forEach((e=>{e.next?.()}))}}const St=URL,vt=URLSearchParams,wt=/^https:\/\/\w{26}\.appsync-api\.\w{2}(?:(?:-\w{2,})+)-\d\.amazonaws.com(?:\.cn)?\/graphql$/i,Et=/^https:\/\/\w{26}\.\w+-api\.\w{2}(?:(?:-\w{2,})+)-\d\.amazonaws.com(?:\.cn)?\/event$/i,Ct="/realtime",_t=async e=>{const{appSyncGraphqlEndpoint:t,query:n,libraryConfigHeaders:r=()=>({}),additionalHeaders:o={},authToken:i}=e;let s={};const a=await r();if("function"==typeof o){const e={url:t||"",queryString:n||""};s=await o(e)}else s=o;return i&&(s={...s,Authorization:i}),{additionalCustomHeaders:s,libraryConfigHeaders:a}},Tt=e=>Object.keys(e).map((e=>e.toLowerCase())).sort().join(";"),Nt="X-Amz-Date".toLowerCase(),At="X-Amz-Security-Token".toLowerCase(),Ot="aws4_request",kt="AWS4-HMAC-SHA256";var It=64,Rt=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Lt=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],Pt=Math.pow(2,53)-1,Dt=function(){function e(){this.state=Int32Array.from(Lt),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return e.prototype.update=function(e){if(this.finished)throw new Error("Attempted to update an already finished hash.");var t=0,n=e.byteLength;if(this.bytesHashed+=n,8*this.bytesHashed>Pt)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;n>0;)this.buffer[this.bufferLength++]=e[t++],n--,this.bufferLength===It&&(this.hashBuffer(),this.bufferLength=0)},e.prototype.digest=function(){if(!this.finished){var e=8*this.bytesHashed,t=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),n=this.bufferLength;if(t.setUint8(this.bufferLength++,128),n%It>=56){for(var r=this.bufferLength;r<It;r++)t.setUint8(r,0);this.hashBuffer(),this.bufferLength=0}for(r=this.bufferLength;r<56;r++)t.setUint8(r,0);t.setUint32(56,Math.floor(e/4294967296),!0),t.setUint32(60,e),this.hashBuffer(),this.finished=!0}var o=new Uint8Array(32);for(r=0;r<8;r++)o[4*r]=this.state[r]>>>24&255,o[4*r+1]=this.state[r]>>>16&255,o[4*r+2]=this.state[r]>>>8&255,o[4*r+3]=this.state[r]>>>0&255;return o},e.prototype.hashBuffer=function(){for(var e=this.buffer,t=this.state,n=t[0],r=t[1],o=t[2],i=t[3],s=t[4],a=t[5],c=t[6],u=t[7],l=0;l<It;l++){if(l<16)this.temp[l]=(255&e[4*l])<<24|(255&e[4*l+1])<<16|(255&e[4*l+2])<<8|255&e[4*l+3];else{var d=this.temp[l-2],p=(d>>>17|d<<15)^(d>>>19|d<<13)^d>>>10,h=((d=this.temp[l-15])>>>7|d<<25)^(d>>>18|d<<14)^d>>>3;this.temp[l]=(p+this.temp[l-7]|0)+(h+this.temp[l-16]|0)}var f=(((s>>>6|s<<26)^(s>>>11|s<<21)^(s>>>25|s<<7))+(s&a^~s&c)|0)+(u+(Rt[l]+this.temp[l]|0)|0)|0,y=((n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10))+(n&r^n&o^r&o)|0;u=c,c=a,a=s,s=i+f|0,i=o,o=r,r=n,n=f+y|0}t[0]+=n,t[1]+=r,t[2]+=o,t[3]+=i,t[4]+=s,t[5]+=a,t[6]+=c,t[7]+=u},e}(),xt="undefined"!=typeof Buffer&&Buffer.from?function(e){return Buffer.from(e,"utf8")}:e=>(new TextEncoder).encode(e);function Mt(e){return e instanceof Uint8Array?e:"string"==typeof e?xt(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(e)}var qt=function(){function e(e){this.secret=e,this.hash=new Dt,this.reset()}return e.prototype.update=function(e){var t;if(("string"==typeof(t=e)?0!==t.length:0!==t.byteLength)&&!this.error)try{this.hash.update(Mt(e))}catch(e){this.error=e}},e.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},e.prototype.digest=function(){return Q(this,void 0,void 0,(function(){return Y(this,(function(e){return[2,this.digestSync()]}))}))},e.prototype.reset=function(){if(this.hash=new Dt,this.secret){this.outer=new Dt;var e=function(e){var t=Mt(e);if(t.byteLength>It){var n=new Dt;n.update(t),t=n.digest()}var r=new Uint8Array(It);return r.set(t),r}(this.secret),t=new Uint8Array(It);t.set(e);for(var n=0;n<It;n++)e[n]^=54,t[n]^=92;for(this.hash.update(e),this.outer.update(t),n=0;n<e.byteLength;n++)e[n]=0}},e}();const Ut={},Gt={};for(let e=0;e<256;e++){let t=e.toString(16).toLowerCase();1===t.length&&(t=`0${t}`),Ut[e]=t,Gt[t]=e}const $t=(e,t)=>{const n=new qt(e??void 0);return n.update(t),n.digestSync()},jt=(e,t)=>function(e){let t="";for(let n=0;n<e.byteLength;n++)t+=Ut[e[n]];return t}($t(e,t)),Wt=e=>Object.entries(e).map((([e,t])=>({key:e.toLowerCase(),value:t?.trim().replace(/\s+/g," ")??""}))).sort(((e,t)=>e.key<t.key?-1:1)).map((e=>`${e.key}:${e.value}\n`)).join(""),Ht=e=>encodeURIComponent(e).replace(/[!'()*]/g,Kt),Kt=e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`,zt=(e,t=!0)=>e?t?encodeURIComponent(e).replace(/%2F/g,"/"):e:"/",Bt=e=>null==e?"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855":Ft(e)?jt(null,e):"UNSIGNED-PAYLOAD",Ft=e=>"string"==typeof e||ArrayBuffer.isView(e)||Vt(e),Vt=e=>"function"==typeof ArrayBuffer&&e instanceof ArrayBuffer||"[object ArrayBuffer]"===Object.prototype.toString.call(e),Jt=(e,t)=>{const n=(({credentials:e,signingDate:t=new Date,signingRegion:n,signingService:r,uriEscapePath:o=!0})=>{const{accessKeyId:i,secretAccessKey:s,sessionToken:a}=e,{longDate:c,shortDate:u}=(e=>{const t=e.toISOString().replace(/[:-]|\.\d{3}/g,"");return{longDate:t,shortDate:t.slice(0,8)}})(t);return{accessKeyId:i,credentialScope:`${u}/${n}/${r}/${Ot}`,longDate:c,secretAccessKey:s,sessionToken:a,shortDate:u,signingRegion:n,signingService:r,uriEscapePath:o}})(t),{accessKeyId:r,credentialScope:o,longDate:i,sessionToken:s}=n,a={...e.headers};a.host=e.url.host,a[Nt]=i,s&&(a[At]=s);const c={...e,headers:a},u=((e,{credentialScope:t,longDate:n,secretAccessKey:r,shortDate:o,signingRegion:i,signingService:s,uriEscapePath:a})=>{const c=(({body:e,headers:t,method:n,url:r},o=!0)=>{return[n,zt(r.pathname,o),(i=r.searchParams,Array.from(i).sort((([e,t],[n,r])=>e===n?t<r?-1:1:e<n?-1:1)).map((([e,t])=>`${Ht(e)}=${Ht(t)}`)).join("&")),Wt(t),Tt(t),Bt(e)].join("\n");var i})(e,a),u=((e,t,n)=>[kt,e,t,n].join("\n"))(n,t,jt(null,c)),l=jt(((e,t,n,r)=>{const o=$t(`AWS4${e}`,t),i=$t(o,n),s=$t(i,r);return $t(s,Ot)})(r,o,i,s),u);return l})(c,n),l=`Credential=${r}/${o}`,d=`SignedHeaders=${Tt(a)}`,p=`Signature=${u}`;return a.authorization=`${kt} ${l}, ${d}, ${p}`,c},Qt=new a.ConsoleLogger("AWSAppSyncRealTimeProvider Auth"),Yt=async({host:e})=>{const t=await(0,a.fetchAuthSession)();return{Authorization:t?.tokens?.accessToken?.toString(),host:e}},Xt=async({apiKey:e,host:t})=>({host:t,"x-amz-date":(new Date).toISOString().replace(/[:-]|\.\d{3}/g,""),"x-api-key":e}),Zt=async({payload:e,canonicalUri:t,appSyncGraphqlEndpoint:n,region:r})=>{const o={region:r,service:"appsync"},i=(await(0,a.fetchAuthSession)()).credentials,s={url:`${n}${t}`,data:e,method:"POST",headers:{...B}};return Jt({headers:s.headers,method:s.method,url:new St(s.url),body:s.data},{credentials:i,signingRegion:o.region,signingService:o.service}).headers},en=async({host:e,additionalCustomHeaders:t})=>{if(!t?.Authorization)throw new Error("No auth token specified");return{Authorization:t.Authorization,host:e}},tn=async({apiKey:e,authenticationType:t,canonicalUri:n,appSyncGraphqlEndpoint:r,region:o,additionalCustomHeaders:i,payload:s})=>{const a={apiKey:Xt,iam:Zt,oidc:Yt,userPool:Yt,lambda:en,none:en};if(t&&a[t]){const c=a[t],u=r?new St(r).host:void 0,l="apiKey"===t?e:void 0;return Qt.debug(`Authenticating with ${JSON.stringify(t)}`),await c({payload:s,canonicalUri:n,appSyncGraphqlEndpoint:r,apiKey:l,region:o,host:u,additionalCustomHeaders:i})}Qt.debug(`Authentication type ${t} not supported`)},nn=e=>{a.Hub.dispatch("api",e,"PubSub",qe)};class rn{constructor(e){this.subscriptionObserverMap=new Map,this.socketStatus=z.CLOSED,this.keepAliveTimeout=F,this.promiseArray=[],this.connectionStateMonitor=new bt,this.reconnectionMonitor=new mt,this._establishConnection=async(e,t)=>{this.logger.debug(`Establishing WebSocket connection to ${e}`);try{await this._openConnection(e,t),await this._initiateHandshake()}catch(e){const{errorType:t,errorCode:n}=e;throw $.includes(n)||j.includes(t)?new $e(t):t?new Error(t):e}},this.logger=new a.ConsoleLogger(e.providerName),this.wsProtocolName=e.wsProtocolName,this.wsConnectUri=e.connectUri,this.connectionStateMonitorSubscription=this._startConnectionStateMonitoring()}close(){return this.socketStatus=z.CLOSED,this.connectionStateMonitor.record(yt.CONNECTION_FAILED),this.connectionStateMonitorSubscription.unsubscribe(),this.reconnectionMonitor.close(),new Promise(((e,t)=>{this.awsRealTimeSocket?(this.awsRealTimeSocket.onclose=t=>{this.subscriptionObserverMap=new Map,this.awsRealTimeSocket=void 0,e()},this.awsRealTimeSocket.onerror=e=>{t(e)},this.awsRealTimeSocket.close()):e()}))}subscribe(e,t){return new Ie((n=>{if(!e?.appSyncGraphqlEndpoint)return;let r=!1;const o=Be(),i=()=>{r||(r=!0,this._startSubscriptionWithAWSAppSyncRealTime({options:e,observer:n,subscriptionId:o,customUserAgentDetails:t}).catch((e=>{this.logger.debug(`${Ye.REALTIME_SUBSCRIPTION_INIT_ERROR}: ${e}`),this.connectionStateMonitor.record(yt.CLOSED)})).finally((()=>{r=!1})))},s=new Ie((e=>{this.reconnectionMonitor.addObserver(e)})).subscribe((()=>{i()}));return i(),async()=>{await this._cleanupSubscription(o,s)}}))}async connect(e){this.socketStatus!==z.READY&&await this._connectWebSocket(e)}async publish(e,t){if(this.socketStatus!==z.READY)throw new Error("Subscription has not been initialized");return this._publishMessage(e,t)}async _connectWebSocket(e){const{apiKey:t,appSyncGraphqlEndpoint:n,authenticationType:r,region:o}=e,{additionalCustomHeaders:i}=await _t(e);this.connectionStateMonitor.record(yt.OPENING_CONNECTION),await this._initializeWebSocketConnection({apiKey:t,appSyncGraphqlEndpoint:n,authenticationType:r,region:o,additionalCustomHeaders:i})}async _publishMessage(e,t){const n=Be(),{additionalCustomHeaders:r,libraryConfigHeaders:o}=await _t(e),i=await this._prepareSubscriptionPayload({options:e,subscriptionId:n,customUserAgentDetails:t,additionalCustomHeaders:r,libraryConfigHeaders:o,publish:!0});return new Promise(((e,t)=>{if(this.awsRealTimeSocket){const r=t=>{const o=JSON.parse(t.data);o.id===n&&"publish_success"===o.type&&(this.awsRealTimeSocket&&this.awsRealTimeSocket.removeEventListener("message",r),e()),o.erroredEvents&&o.erroredEvents.length};this.awsRealTimeSocket.addEventListener("message",r),this.awsRealTimeSocket.addEventListener("close",(()=>{t(new Error("WebSocket is closed"))})),this.awsRealTimeSocket.send(i)}}))}async _cleanupSubscription(e,t){t?.unsubscribe();try{await this._waitForSubscriptionToBeConnected(e);const{subscriptionState:t}=this.subscriptionObserverMap.get(e)||{};if(!t)return;if(t!==K.CONNECTED)throw new Error("Subscription never connected");this._sendUnsubscriptionMessage(e)}catch(e){this.logger.debug(`Error while unsubscribing ${e}`)}finally{this._removeSubscriptionObserver(e)}}_startConnectionStateMonitoring(){return this.connectionStateMonitor.connectionStateObservable.subscribe((e=>{nn({event:W,data:{provider:this,connectionState:e},message:`Connection state is ${e}`}),this.connectionState=e,e===Xe.ConnectionDisrupted&&this.reconnectionMonitor.record(gt.START_RECONNECT),[Xe.Connected,Xe.ConnectedPendingDisconnect,Xe.ConnectedPendingKeepAlive,Xe.ConnectedPendingNetwork,Xe.ConnectionDisruptedPendingNetwork,Xe.Disconnected].includes(e)&&this.reconnectionMonitor.record(gt.HALT_RECONNECT)}))}async _startSubscriptionWithAWSAppSyncRealTime({options:e,observer:t,subscriptionId:n,customUserAgentDetails:r}){const{query:o,variables:i}=e,{additionalCustomHeaders:s,libraryConfigHeaders:a}=await _t(e);this.subscriptionObserverMap.set(n,{observer:t,query:o??"",variables:i??{},subscriptionState:K.PENDING,startAckTimeoutId:void 0});const c=await this._prepareSubscriptionPayload({options:e,subscriptionId:n,customUserAgentDetails:r,additionalCustomHeaders:s,libraryConfigHeaders:a});try{await this._connectWebSocket(e)}catch(e){return void this._logStartSubscriptionError(n,t,e)}const{subscriptionFailedCallback:u,subscriptionReadyCallback:l}=this.subscriptionObserverMap.get(n)??{};this.subscriptionObserverMap.set(n,{observer:t,subscriptionState:K.PENDING,query:o??"",variables:i??{},subscriptionReadyCallback:l,subscriptionFailedCallback:u,startAckTimeoutId:setTimeout((()=>{this._timeoutStartSubscriptionAck(n)}),15e3)}),this.awsRealTimeSocket&&this.awsRealTimeSocket.send(c)}_logStartSubscriptionError(e,t,n){this.logger.debug({err:n});const r=String(n.message??"");if(this.connectionStateMonitor.record(yt.CLOSED),this.connectionState!==Xe.ConnectionDisruptedPendingNetwork){Fe(n)?t.error({errors:[{...new Pe.GraphQLError(`${Ye.CONNECTION_FAILED}: ${r}`)}]}):this.logger.debug(`${Ye.CONNECTION_FAILED}: ${r}`);const{subscriptionFailedCallback:o}=this.subscriptionObserverMap.get(e)||{};"function"==typeof o&&o()}}async _waitForSubscriptionToBeConnected(e){const t=this.subscriptionObserverMap.get(e);if(t){const{subscriptionState:n}=t;if(n===K.PENDING)return new Promise(((n,r)=>{const{observer:o,subscriptionState:i,variables:s,query:a}=t;this.subscriptionObserverMap.set(e,{observer:o,subscriptionState:i,variables:s,query:a,subscriptionReadyCallback:n,subscriptionFailedCallback:r})}))}}_sendUnsubscriptionMessage(e){try{if(this.awsRealTimeSocket&&this.awsRealTimeSocket.readyState===WebSocket.OPEN&&this.socketStatus===z.READY){const t=this._unsubscribeMessage(e),n=JSON.stringify(t);this.awsRealTimeSocket.send(n)}}catch(e){this.logger.debug({err:e})}}_removeSubscriptionObserver(e){this.subscriptionObserverMap.delete(e),setTimeout(this._closeSocketIfRequired.bind(this),1e3)}_closeSocketIfRequired(){if(!(this.subscriptionObserverMap.size>0))if(this.awsRealTimeSocket)if(this.connectionStateMonitor.record(yt.CLOSING_CONNECTION),this.awsRealTimeSocket.bufferedAmount>0)setTimeout(this._closeSocketIfRequired.bind(this),1e3);else{this.logger.debug("closing WebSocket..."),this.keepAliveTimeoutId&&clearTimeout(this.keepAliveTimeoutId),this.keepAliveAlertTimeoutId&&clearTimeout(this.keepAliveAlertTimeoutId);const e=this.awsRealTimeSocket;e.onclose=null,e.onerror=null,e.close(1e3),this.awsRealTimeSocket=void 0,this.socketStatus=z.CLOSED,this.connectionStateMonitor.record(yt.CLOSED)}else this.socketStatus=z.CLOSED}_handleIncomingSubscriptionMessage(e){if("string"!=typeof e.data)return;const[t,n]=this._handleSubscriptionData(e);if(t)return;const{type:r,id:o,payload:i}=n,{observer:s=null,query:a="",variables:c={},startAckTimeoutId:u,subscriptionReadyCallback:l,subscriptionFailedCallback:d}=this.subscriptionObserverMap.get(o)||{};if(r===H.GQL_START_ACK||r===H.EVENT_SUBSCRIBE_ACK){this.logger.debug(`subscription ready for ${JSON.stringify({query:a,variables:c})}`),"function"==typeof l&&l(),u&&clearTimeout(u),nn({event:Ye.SUBSCRIPTION_ACK,data:{query:a,variables:c},message:"Connection established for subscription"});const e=K.CONNECTED;return s&&this.subscriptionObserverMap.set(o,{observer:s,query:a,variables:c,startAckTimeoutId:void 0,subscriptionState:e,subscriptionReadyCallback:l,subscriptionFailedCallback:d}),void this.connectionStateMonitor.record(yt.CONNECTION_ESTABLISHED)}if(r===H.GQL_CONNECTION_KEEP_ALIVE)return this.keepAliveTimeoutId&&clearTimeout(this.keepAliveTimeoutId),this.keepAliveAlertTimeoutId&&clearTimeout(this.keepAliveAlertTimeoutId),this.keepAliveTimeoutId=setTimeout((()=>{this._errorDisconnect(Ye.TIMEOUT_DISCONNECT)}),this.keepAliveTimeout),this.keepAliveAlertTimeoutId=setTimeout((()=>{this.connectionStateMonitor.record(yt.KEEP_ALIVE_MISSED)}),65e3),void this.connectionStateMonitor.record(yt.KEEP_ALIVE);if(r===H.GQL_ERROR){const e=K.FAILED;s&&(this.subscriptionObserverMap.set(o,{observer:s,query:a,variables:c,startAckTimeoutId:u,subscriptionReadyCallback:l,subscriptionFailedCallback:d,subscriptionState:e}),this.logger.debug(`${Ye.CONNECTION_FAILED}: ${JSON.stringify(i??n)}`),s.error({errors:[{...new Pe.GraphQLError(`${Ye.CONNECTION_FAILED}: ${JSON.stringify(i??n)}`)}]}),u&&clearTimeout(u),"function"==typeof d&&d())}}_errorDisconnect(e){this.logger.debug(`Disconnect error: ${e}`),this.awsRealTimeSocket&&(this.connectionStateMonitor.record(yt.CLOSED),this.awsRealTimeSocket.close()),this.socketStatus=z.CLOSED}_timeoutStartSubscriptionAck(e){const t=this.subscriptionObserverMap.get(e);if(t){const{observer:n,query:r,variables:o}=t;if(!n)return;this.subscriptionObserverMap.set(e,{observer:n,query:r,variables:o,subscriptionState:K.FAILED}),this.connectionStateMonitor.record(yt.CLOSED),this.logger.debug("timeoutStartSubscription",JSON.stringify({query:r,variables:o}))}}_initializeWebSocketConnection({appSyncGraphqlEndpoint:e,authenticationType:t,apiKey:n,region:r,additionalCustomHeaders:o}){if(this.socketStatus!==z.READY)return new Promise((async(i,s)=>{if(this.promiseArray.push({res:i,rej:s}),this.socketStatus===z.CLOSED)try{this.socketStatus=z.CONNECTING;const i="{}",s=await tn({authenticationType:t,payload:i,canonicalUri:this.wsConnectUri,apiKey:n,appSyncGraphqlEndpoint:e,region:r,additionalCustomHeaders:o}),a=s?JSON.stringify(s):"",c=`header-${Ve.convert(a,{urlSafe:!0,skipPadding:!0})}`,u=(e=>{const t=(e=>{if(!e)return{};if("Authorization"in e){const{Authorization:t,...n}=e;return n}return e})(e),n=new vt;return Object.entries(t).forEach((([e,t])=>{n.append(e,t)})),n})(o),l=((e,t)=>{const n=(e=>{let t=e??"";return t=null!==t.match(Et)?t.concat(Ct).replace("ddpg-api","grt-gamma").replace("appsync-api","appsync-realtime-api"):null===t.match(wt)?t.concat(Ct):t.replace("appsync-api","appsync-realtime-api").replace("gogi-beta","grt-beta").replace("ddpg-api","grt-gamma"),t=t.replace("https://","wss://").replace("http://","ws://"),new St(t)})(e),r=new vt(n.search);for(const[e,n]of t.entries())r.append(e,n);return n.search=r.toString(),n.toString()})(e,u);await this._establishRetryableConnection(l,c),this.promiseArray.forEach((({res:e})=>{this.logger.debug("Notifying connection successful"),e()})),this.socketStatus=z.READY,this.promiseArray=[]}catch(e){this.logger.debug("Connection exited with",e),this.promiseArray.forEach((({rej:t})=>{t(e)})),this.promiseArray=[],this.awsRealTimeSocket&&this.awsRealTimeSocket.readyState===WebSocket.OPEN&&this.awsRealTimeSocket.close(3001),this.awsRealTimeSocket=void 0,this.socketStatus=z.CLOSED}}))}async _establishRetryableConnection(e,t){this.logger.debug("Establishing retryable connection"),await((e,t,n=3e5,r)=>async function(e,t,n,r){if("function"!=typeof e)throw Error("functionToRetry must be a function");return new Promise((async(o,i)=>{let s,a,c=0,u=!1,l=()=>{};for(r&&r.then((()=>{u=!0,clearTimeout(s),l()}));!u;){c++,Qe.debug(`${e.name} attempt #${c} with this vars: ${JSON.stringify(t)}`);try{return void o(await e(...t))}catch(r){if(a=r,Qe.debug(`error on ${e.name}`,r),Fe(r))return Qe.debug(`${e.name} non retryable error`,r),void i(r);const o=n(c,t,r);if(Qe.debug(`${e.name} retrying in ${o} ms`),!1===o||u)return void i(r);await new Promise((e=>{l=e,s=setTimeout(l,o)}))}}i(a)}))}(e,t,Je(n),r))(this._establishConnection.bind(this),[e,t],5e3)}async _openConnection(e,t){return new Promise(((n,r)=>{const o=this._getNewWebSocket(e,[this.wsProtocolName,t]);o.onerror=()=>{this.logger.debug("WebSocket connection error")},o.onclose=()=>{r(new Error("Connection handshake error"))},o.onopen=()=>{this.awsRealTimeSocket=o,n()}}))}_getNewWebSocket(e,t){return new WebSocket(e,t)}async _initiateHandshake(){return new Promise(((e,t)=>{if(!this.awsRealTimeSocket)return void t(new Error("awsRealTimeSocket undefined"));let n=!1;this.awsRealTimeSocket.onerror=e=>{this.logger.debug(`WebSocket error ${JSON.stringify(e)}`)},this.awsRealTimeSocket.onclose=e=>{this.logger.debug(`WebSocket closed ${e.reason}`),t(new Error(JSON.stringify(e)))},this.awsRealTimeSocket.onmessage=r=>{if("string"!=typeof r.data)return;this.logger.debug(`subscription message from AWS AppSyncRealTime: ${r.data} `);const o=JSON.parse(r.data),{type:i}=o,s=this._extractConnectionTimeout(o);if(i===H.GQL_CONNECTION_ACK)return n=!0,this._registerWebsocketHandlers(s),void e("Connected to AWS AppSyncRealTime");if(i===H.GQL_CONNECTION_ERROR){const{errorType:e,errorCode:n}=this._extractErrorCodeAndType(o);t({errorType:e,errorCode:n})}};const r={type:H.GQL_CONNECTION_INIT};this.awsRealTimeSocket.send(JSON.stringify(r));const o=e=>{e||(this.connectionStateMonitor.record(yt.CONNECTION_FAILED),t(new Error("Connection timeout: ack from AWSAppSyncRealTime was not received after 15000 ms")))};setTimeout((()=>{o(n)}),15e3)}))}_registerWebsocketHandlers(e){this.awsRealTimeSocket&&(this.keepAliveTimeout=e,this.awsRealTimeSocket.onmessage=this._handleIncomingSubscriptionMessage.bind(this),this.awsRealTimeSocket.onerror=e=>{this.logger.debug(e),this._errorDisconnect(Ye.CONNECTION_CLOSED)},this.awsRealTimeSocket.onclose=e=>{this.logger.debug(`WebSocket closed ${e.reason}`),this._errorDisconnect(Ye.CONNECTION_CLOSED)})}}const on="AWSAppSyncEventsProvider",sn=new class extends rn{constructor(){super({providerName:on,wsProtocolName:"aws-appsync-event-ws",connectUri:""})}getProviderName(){return on}async connect(e){super.connect(e)}subscribe(e,t){return super.subscribe(e,t).pipe()}async publish(e,t){super.publish(e,t)}async _prepareSubscriptionPayload({options:e,subscriptionId:t,customUserAgentDetails:n,additionalCustomHeaders:r,libraryConfigHeaders:o,publish:i}){const{appSyncGraphqlEndpoint:s,authenticationType:a,query:u,apiKey:l,region:d}=e,p=JSON.stringify({channel:u}),h={id:t,channel:u,authorization:{...{...await tn({apiKey:l,appSyncGraphqlEndpoint:s,authenticationType:a,payload:p,canonicalUri:"",region:d,additionalCustomHeaders:r}),...o,...r,[c]:G(n)}},type:i?H.EVENT_PUBLISH:H.EVENT_SUBSCRIBE};return JSON.stringify(h)}_handleSubscriptionData(e){this.logger.debug(`subscription message from AWS AppSync Events: ${e.data}`);const{id:t="",event:n,type:r}=JSON.parse(String(e.data)),{observer:o=null,query:i="",variables:s={}}=this.subscriptionObserverMap.get(t)||{};if(this.logger.debug({id:t,observer:o,query:i,variables:s}),r===H.DATA&&n){const e=JSON.parse(n);return o?o.next({id:t,type:r,event:e}):this.logger.debug(`observer not found for id: ${t}`),[!0,{id:t,type:r,payload:e}]}return[!1,{id:t,type:r,payload:n}]}_unsubscribeMessage(e){return{id:e,type:H.EVENT_STOP}}_extractConnectionTimeout(e){const{connectionTimeoutMs:t=F}=e;return t}_extractErrorCodeAndType(e){const{errors:[{errorType:t="",errorCode:n=0}={}]=[]}=e;return{errorCode:n,errorType:t}}};class an extends Me{get response(){return this._response?cn(this._response):void 0}constructor(e){super(e),this.constructor=an,Object.setPrototypeOf(this,an.prototype),e.response&&(this._response=e.response)}}const cn=e=>({...e,headers:{...e.headers}});class un extends an{constructor(e){super(e),this.constructor=un,Object.setPrototypeOf(this,un.prototype)}}class ln extends un{constructor(e={}){super({name:"CanceledError",message:"Request is canceled by user",...e}),this.constructor=ln,Object.setPrototypeOf(this,ln.prototype)}}const dn=e=>!!e&&e instanceof ln;var pn;(pn||(pn={})).InvalidApiName="InvalidApiName",pn.InvalidApiName;const hn=e=>{const{headers:t,statusCode:n}=e;return{...fn(e)?e.$metadata:{},httpStatusCode:n,requestId:t["x-amzn-requestid"]??t["x-amzn-request-id"]??t["x-amz-request-id"],extendedRequestId:t["x-amz-id-2"],cfId:t["x-amz-cf-id"]}},fn=e=>"object"==typeof e?.$metadata,yn=async e=>{if(!e)return;const t=await(async e=>{if(!e||e.statusCode<300)return;const t=await(async e=>{if(!e.body)throw new Error("Missing response payload");const t=await e.body.json();return Object.assign(t,{$metadata:hn(e)})})(e),n=(e=>{const[t]=e.toString().split(/[,:]+/);return t.includes("#")?t.split("#")[1]:t})(e.headers["x-amzn-errortype"]??t.code??t.__type??"UnknownError"),r=t.message??t.Message??"Unknown error",o=new Error(r);return Object.assign(o,{name:n,$metadata:hn(e)})})(bn(e));if(t){const n=await(e.body?.text());return gn(t,{statusCode:e.statusCode,headers:e.headers,body:n})}},bn=e=>{let t;const n=new Proxy(e.body,{get:(e,n,r)=>"json"===n?async()=>{t||(t=e.text());try{return JSON.parse(await t)}catch(e){return{}}}:"text"===n?async()=>(t||(t=e.text()),t):Reflect.get(e,n,r)});return new Proxy(e,{get:(e,t,r)=>"body"===t?n:Reflect.get(e,t,r)})},gn=(e,t)=>{const n=new un({name:e?.name,message:e.message,underlyingError:e,response:t});return Object.assign(n,{$metadata:e.$metadata})},mn=new a.ConsoleLogger("RestApis"),Sn=({headers:e},t)=>!e.authorization&&!e["x-api-key"]&&!!t;var vn;!function(e){e.NoEndpointId="NoEndpointId",e.PlatformNotSupported="PlatformNotSupported",e.Unknown="Unknown",e.NetworkError="NetworkError"}(vn||(vn={}));const wn=["AuthFailure","InvalidSignatureException","RequestExpired","RequestInTheFuture","RequestTimeTooSkewed","SignatureDoesNotMatch","BadRequestException"],En=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException"],Cn=["TimeoutError","RequestTimeout","RequestTimeoutException"],_n=(e,t)=>429===e||!!t&&En.includes(t),Tn=e=>[vn.NetworkError,"ERR_NETWORK"].includes(e?.name),Nn=(e,t)=>!!e&&[500,502,503,504].includes(e)||!!t&&Cn.includes(t),An=3e5,On=e=>{const t=Je(An)(e);return!1===t?An:t},kn=({maxAttempts:e=3,retryDecider:t,computeDelay:n,abortSignal:r})=>{if(e<1)throw new Error("maxAttempts must be greater than 0");return(o,i)=>async function(s){let a,c,u=i.attemptsCount??0;const l=()=>{if(c)return Rn(c,u),c;throw Rn(a,u),a};for(;!r?.aborted&&u<e;){try{c=await o(s),a=void 0}catch(e){a=e,c=void 0}u=(i.attemptsCount??0)>u?i.attemptsCount??0:u+1,i.attemptsCount=u;const{isCredentialsExpiredError:d,retryable:p}=await t(c,a,i);if(!p)return l();if(i.isCredentialsExpired=!!d,!r?.aborted&&u<e){const e=n(u);await In(e,r)}}if(r?.aborted)throw new Error("Request aborted.");return l()}},In=(e,t)=>{if(t?.aborted)return Promise.resolve();let n,r;const o=new Promise((t=>{r=t,n=setTimeout(t,e)}));return t?.addEventListener("abort",(function e(o){clearTimeout(n),t?.removeEventListener("abort",e),r()})),o},Rn=(e,t)=>{"[object Object]"===Object.prototype.toString.call(e)&&(e.$metadata={...e.$metadata??{},attempts:t})},Ln=e=>new Date(Date.now()+e),Pn=({userAgentHeader:e="x-amz-user-agent",userAgentValue:t=""})=>n=>async function(r){if(0===t.trim().length)return await n(r);{const o=e.toLowerCase();return r.headers[o]=r.headers[o]?`${r.headers[o]} ${t}`:t,await n(r)}},Dn=(e,t)=>(n,r)=>{const o={};let i=t=>e(t,r);for(let e=t.length-1;e>=0;e--)i=(0,t[e])(r)(i,o);return i(n)},xn=e=>{let t;return()=>(t||(t=e()),t)},Mn=e=>!["HEAD","GET","DELETE"].includes(e.toUpperCase()),qn=async({url:e,method:t,headers:n,body:r},{abortSignal:o,cache:i,withCrossDomainCredentials:s})=>{let a;try{a=await fetch(e,{method:t,headers:n,body:Mn(t)?r:void 0,signal:o,cache:i,credentials:s?"include":"same-origin"})}catch(e){if(e instanceof TypeError)throw new Me({name:vn.NetworkError,message:"A network error has occurred.",underlyingError:e});throw e}const c={};return a.headers?.forEach(((e,t)=>{c[t.toLowerCase()]=e})),{statusCode:a.status,headers:c,body:null,body:Object.assign(a.body??{},{text:xn((()=>a.text())),blob:xn((()=>a.blob())),json:xn((()=>a.json()))})}},Un=Dn(qn,[Pn,kn,({credentials:e,region:t,service:n,uriEscapePath:r=!0})=>{let o;return(i,s)=>async function(a){o=o??0;const c={credentials:"function"==typeof e?await e({forceRefresh:!!s?.isCredentialsExpired}):e,signingDate:Ln(o),signingRegion:t,signingService:n,uriEscapePath:r},u=await Jt(a,c),l=await i(u),d=(({headers:e}={})=>e?.date??e?.Date??e?.["x-amz-date"])(l);return d&&(o=((e,t)=>((e,t)=>Math.abs(Ln(t).getTime()-e)>=3e5)(e,t)?e-Date.now():t)(Date.parse(d),o)),l}}]),Gn=Dn(qn,[Pn,kn]),$n="execute-api",jn="us-east-1",Wn=/^.+\.([a-z0-9-]+)\.([a-z0-9-]+)\.amazonaws\.com/,Hn=async e=>{try{const{credentials:t}=await e.Auth.fetchAuthSession();if(t)return t}catch(e){mn.debug("No credentials available, the request will be unsigned.")}return null},Kn=new WeakMap,zn=(e,{url:t,options:n,abortController:r})=>{const o=r??new AbortController,i=function(e,t){const n=e=>!!t,r=new AbortController,o=r.signal,i=t?.signal;let s;const a=async()=>{try{const t=await(n(),e());if(t.statusCode>=300)throw await yn(t);return t}catch(e){const t=i??o,n=s??t.reason;if("AbortError"===e.name||!0===t?.aborted){const t=new ln({...n&&{message:n},underlyingError:e,recoverySuggestion:"The API request was explicitly canceled. If this is not intended, validate if you called the `cancel()` function on the API request erroneously."});throw mn.debug(e),t}throw mn.debug(e),e}};if(n())return a();{const e=e=>{!0!==o.aborted&&(r.abort(e),e&&o.reason!==e&&(s=e))};return{response:a(),cancel:e}}}((async()=>(async(e,t,n,r)=>{const{url:o,method:i,headers:s,body:a,withCredentials:c,abortSignal:u}=t,l=a?a instanceof FormData?a:JSON.stringify(a??""):void 0,d=((e,t)=>{const n={};for(const t in e)n[t.toLowerCase()]=e[t];return t&&(n["content-type"]="application/json; charset=UTF-8",t instanceof FormData&&delete n["content-type"]),n})(s,a),p={url:o,headers:d,method:i,body:l},h={retryDecider:(y=yn,async(e,t)=>{const n=t??await y(e)??void 0,r=n?.code||n?.name,o=e?.statusCode;return{retryable:Tn(t)||_n(o,r)||(e=>!!e&&wn.includes(e))(r)||Nn(o,r)}}),computeDelay:On,withCrossDomainCredentials:c,abortSignal:u},f=n(p,r);var y;let b;const g=await Hn(e);if(f&&g){const e=(e=>{const{service:t=$n,region:n=jn}={},{hostname:r}=e,[,o,i]=Wn.exec(r)??[];return o===$n?{service:o,region:i??n}:"appsync-api"===o?{service:"appsync",region:i??n}:{service:t,region:n}})(o),t=r?.service??e.service,n=r?.region??e.region;b=await Un(p,{...h,credentials:g,region:n,service:t})}else b=await Gn(p,{...h});return{statusCode:b.statusCode,headers:b.headers,body:b.body}})(e,{url:t,method:"POST",...n,abortSignal:o.signal},Sn,n?.signingServiceInfo)),o),s=i.finally((()=>{Kn.delete(s)}));return s},Bn=(e,t)=>{const n=Kn.get(e);return!!n&&(n.abort(t),t&&n.signal.reason!==t&&(n.signal.reason=t),!0)},Fn=(e,t)=>{Kn.set(e,t)},Vn=e=>{const t=e.libraryOptions?.API?.GraphQL?.headers,n=e.libraryOptions?.API?.GraphQL?.withCredentials;return{headers:t,withCredentials:n}};function Jn(e){return e.errors&&Array.isArray(e.errors)&&e.errors.forEach((e=>{var t;t=e,(t?.originalError?.name?.startsWith("UnauthorizedException")||t.message?.startsWith("Connection failed:")&&t.message?.includes("Permission denied"))&&(e.message="Unauthorized",e.recoverySuggestion="If you're calling an Amplify-generated API, make sure to set the \"authMode\" in generateClient({ authMode: '...' }) to the backend authorization rule's auth provider ('apiKey', 'userPool', 'iam', 'oidc', 'lambda')")})),e}class Qn extends Me{constructor(e){super(e),this.constructor=Qn,Object.setPrototypeOf(this,Qn.prototype)}}var Yn;!function(e){e.NO_API_KEY="No api-key configured",e.NO_CURRENT_USER="No current user",e.NO_CREDENTIALS="No credentials",e.NO_FEDERATED_JWT="No federated jwt",e.NO_AUTH_TOKEN="No auth token specified"}(Yn||(Yn={}));const Xn=Symbol("amplify"),Zn=Symbol("authMode"),er=Symbol("authToken"),tr=Symbol("headers");function nr(e){const t=e;return{amplify:t[Xn],authMode:t[Zn],authToken:t[er],headers:t[tr]}}const rr={name:"NoApiKey",message:Yn.NO_API_KEY,recoverySuggestion:'The API request was made with `authMode: "apiKey"` but no API Key was passed into `Amplify.configure()`. Review if your API key is passed into the `Amplify.configure()` function.'},or={name:"NoCredentials",message:Yn.NO_CREDENTIALS,recoverySuggestion:'The API request was made with `authMode: "iam"` but no authentication credentials are available.\n\nIf you intended to make a request using an authenticated role, review if your user is signed in before making the request.\n\nIf you intend to make a request using an unauthenticated role or also known as "guest access", verify if "Auth.Cognito.allowGuestAccess" is set to "true" in the `Amplify.configure()` function.'},ir={name:"NoValidAuthTokens",message:Yn.NO_FEDERATED_JWT,recoverySuggestion:"If you intended to make an authenticated API request, review if the current user is signed in."},sr={name:"NoSignedUser",message:Yn.NO_CURRENT_USER,recoverySuggestion:"Review the underlying exception field for more details. If you intended to make an authenticated API request, review if the current user is signed in."},ar={name:"NoAuthorizationHeader",message:Yn.NO_AUTH_TOKEN,recoverySuggestion:'The API request was made with `authMode: "lambda"` but no `authToken` is set. Review if a valid authToken is passed into the request options or in the `Amplify.configure()` function.'},cr={name:"NoEndpoint",message:"No GraphQL endpoint configured in `Amplify.configure()`.",recoverySuggestion:"Review if the GraphQL API endpoint is set in the `Amplify.configure()` function."};async function ur(e,t,n,r={}){let o={};switch(t){case"apiKey":if(!n)throw new Qn(rr);o={"X-Api-Key":n};break;case"iam":if(void 0===(await e.Auth.fetchAuthSession()).credentials)throw new Qn(or);break;case"oidc":case"userPool":{let t;try{t=(await e.Auth.fetchAuthSession()).tokens?.accessToken.toString()}catch(e){throw new Qn({...sr,underlyingError:e})}if(!t)throw new Qn(ir);o={Authorization:t};break}case"lambda":if("object"==typeof r&&!r.Authorization)throw new Qn(ar);o={Authorization:r.Authorization}}return o}function lr(e){if(!e)return!1;const t=e;return Array.isArray(t.errors)&&t.errors.length>0}const dr="x-amz-user-agent";const pr=(e,t)=>e?"identityPool"===e?"iam":e:t,hr=()=>{const e=a.Amplify.getConfig(),t=e.API?.Events;if(!t)throw new Error("Amplify configuration is missing. Have you called Amplify.configure()?");const n=pr(t.defaultAuthMode,"apiKey");return{appSyncGraphqlEndpoint:t.endpoint,region:t.region,authenticationType:n,apiKey:t.apiKey}},fr=e=>{if(Array.isArray(e))return e.map(((e,t)=>{const n=JSON.stringify(e);if(void 0===n)throw new Error(`Event must be a valid JSON value. Received ${e} at index ${t}`);return n}));const t=JSON.stringify(e);if(void 0===t)throw new Error(`Event must be a valid JSON value. Received ${e}`);return[t]};async function yr(e,t){const n=hr();let r;return n.authenticationType=pr(t?.authMode,n.authenticationType),await sn.connect(n),{subscribe:(t,o)=>{const i={...n,query:e};return i.authenticationType=pr(o?.authMode,i.authenticationType),r=sn.subscribe(i).subscribe(t),r},close:()=>{r&&r.unsubscribe()}}}async function br(e,t,n){const r=hr();r.authenticationType=pr(n?.authMode,r.authenticationType);const o="/"===e[0]?e:`/${e}`,i={...r,query:o,variables:fr(t),authToken:n?.authToken},s=new AbortController,c=await async function(e,t,n={},r,o){const{region:i,appSyncGraphqlEndpoint:s,authenticationType:a,query:c,variables:u}=t;if(!s)throw new Error("No endpoint");const{withCredentials:l}=Vn(e),d=await async function(e,t,n,r){const{apiKey:o,appSyncGraphqlEndpoint:i,authenticationType:s,query:a,variables:c,authToken:u}=t,{headers:l}=Vn(e);let d;if("function"==typeof n){const e={method:"POST",url:new St(i).toString(),queryString:a};d=await n(e)}else d=n;return u&&(d={...d,Authorization:u}),{...await ur(e,s,o,d),...l&&await l({query:a,variables:c}),...d,[dr]:G(r)}}(e,t,n,o),p={channel:c,events:u},h=["apiKey","none"].includes(a)?void 0:{service:"appsync",region:i},{body:f}=await zn(e,{url:new St(s),options:{headers:d,body:p,signingServiceInfo:h,withCredentials:l},abortController:r}),y=await f.json();if(lr(y))throw Jn(y);return y}(a.Amplify,i,{},s);if(c.failed?.length>0)return c.failed}async function gr(){await sn.close()}Symbol(),new WeakMap;const mr=Symbol("INTERNAL_USER_AGENT_OVERRIDE");var Sr;!function(e){e.CreateConversation="1",e.GetConversation="2",e.ListConversations="3",e.DeleteConversation="4",e.SendMessage="5",e.ListMessages="6",e.OnMessage="7",e.Generation="8"}(Sr||(Sr={}));const vr={},wr=new Array(64);for(let e=0,t="A".charCodeAt(0),n="Z".charCodeAt(0);e+t<=n;e++){const n=String.fromCharCode(e+t);vr[n]=e,wr[e]=n}for(let e=0,t="a".charCodeAt(0),n="z".charCodeAt(0);e+t<=n;e++){const n=String.fromCharCode(e+t),r=e+26;vr[n]=r,wr[r]=n}for(let e=0;e<10;e++){vr[e.toString(10)]=e+52;const t=e.toString(10),n=e+52;vr[t]=n,wr[n]=t}function Er(e){return Ze((function(t,n){var r,o=null,i=!1;o=t.subscribe(et(n,void 0,void 0,(function(s){r=dt(e(s,Er(e)(t))),o?(o.unsubscribe(),o=null,r.subscribe(n)):i=!0}))),i&&(o.unsubscribe(),o=null,r.subscribe(n))}))}vr["+"]=62,wr[62]="+",vr["/"]=63,wr[63]="/";const Cr="AWSAppSyncRealTimeProvider";class _r extends rn{constructor(){super({providerName:Cr,wsProtocolName:"graphql-ws",connectUri:"/connect"})}getProviderName(){return Cr}subscribe(e,t){return super.subscribe(e,t)}async _prepareSubscriptionPayload({options:e,subscriptionId:t,customUserAgentDetails:n,additionalCustomHeaders:r,libraryConfigHeaders:o}){const{appSyncGraphqlEndpoint:i,authenticationType:s,query:a,variables:u,apiKey:l,region:d}=e,p={query:a,variables:u},h=JSON.stringify(p),f={id:t,payload:{data:h,extensions:{authorization:{...{...await tn({apiKey:l,appSyncGraphqlEndpoint:i,authenticationType:s,payload:h,canonicalUri:"",region:d,additionalCustomHeaders:r}),...o,...r,[c]:G(n)}}}},type:H.GQL_START};return JSON.stringify(f)}_handleSubscriptionData(e){this.logger.debug(`subscription message from AWS AppSync RealTime: ${e.data}`);const{id:t="",payload:n,type:r}=JSON.parse(String(e.data)),{observer:o=null,query:i="",variables:s={}}=this.subscriptionObserverMap.get(t)||{};return this.logger.debug({id:t,observer:o,query:i,variables:s}),r===H.DATA&&n&&n.data?(o?o.next(n):this.logger.debug(`observer not found for id: ${t}`),[!0,{id:t,type:r,payload:n}]):[!1,{id:t,type:r,payload:n}]}_unsubscribeMessage(e){return{id:e,type:H.GQL_STOP}}_extractConnectionTimeout(e){const{payload:{connectionTimeoutMs:t=F}={}}=e;return t}_extractErrorCodeAndType(e){const{payload:{errors:[{errorType:t="",errorCode:n=0}={}]=[]}={}}=e;return{errorCode:n,errorType:t}}}var Tr;!function(e){e.NoAuthSession="NoAuthSession",e.NoRegion="NoRegion",e.NoCustomEndpoint="NoCustomEndpoint"}(Tr||(Tr={}));const Nr={[Tr.NoAuthSession]:{message:"Auth session should not be empty."},[Tr.NoRegion]:{message:"Missing region."},[Tr.NoCustomEndpoint]:{message:"Custom endpoint region is present without custom endpoint."}},Ar=new a.ConsoleLogger("GraphQLAPI resolveConfig"),Or=e=>{const t=e.getConfig();t.API?.GraphQL||Ar.warn("The API configuration is missing. This is likely due to Amplify.configure() not being called prior to generateClient().");const{apiKey:n,customEndpoint:r,customEndpointRegion:o,defaultAuthMode:i,endpoint:s,region:a}=t.API?.GraphQL??{};return function(e,t){const{message:n,recoverySuggestion:r}=Nr[t];if(!e)throw new Qn({name:t,message:n,recoverySuggestion:r})}(!(!r&&o),Tr.NoCustomEndpoint),{apiKey:n,customEndpoint:r,customEndpointRegion:o,defaultAuthMode:i,endpoint:s,region:a}},kr=e=>({data:{},errors:[new Pe.GraphQLError(e.message,null,null,null,null,e)]}),Ir="x-amz-user-agent";class Rr{constructor(){this.appSyncRealTime=new _r,this._api={post:zn,cancelREST:Bn,isCancelErrorREST:dn,updateRequestToBeCancellable:Fn}}getModuleName(){return"InternalGraphQLAPI"}getGraphqlOperationType(e){const t=(0,Pe.parse)(e).definitions,[{operation:n}]=t;return n}graphql(e,{query:t,variables:n={},authMode:r,authToken:o},i,s){const a="string"==typeof t?(0,Pe.parse)(t):(0,Pe.parse)((0,Pe.print)(t)),[c={}]=a.definitions.filter((e=>"OperationDefinition"===e.kind)),{operation:u}=c,l=i||{};switch(u){case"query":case"mutation":{const t=new AbortController;let i;return i=(e=>"function"!=typeof e)(e)?this._graphql(e,{query:a,variables:n,authMode:r},l,t,s,o):e((async e=>await this._graphql(e,{query:a,variables:n,authMode:r},l,t,s,o))),this._api.updateRequestToBeCancellable(i,t),i}case"subscription":return this._graphqlSubscribe(e,{query:a,variables:n,authMode:r},l,s,o);default:throw new Error(`invalid operation type: ${u}`)}}async _graphql(e,{query:t,variables:n,authMode:r},o={},i,s,a){const{apiKey:c,region:u,endpoint:l,customEndpoint:d,customEndpointRegion:p,defaultAuthMode:h}=Or(e),f=r||h||"iam",y="identityPool"===f?"iam":f,{headers:b,withCredentials:g}=Vn(e);let m;if("function"==typeof o){const e={method:"POST",url:new St(d||l||"").toString(),queryString:(0,Pe.print)(t)};m=await o(e)}else m=o;a&&(m={...m,Authorization:a});const S=await ur(e,y,c,m),v={...!d&&S,...d&&(p?S:{})||{},...b&&await b({query:(0,Pe.print)(t),variables:n}),...m,...!d&&{[Ir]:G(s)}},w={query:(0,Pe.print)(t),variables:n||null};let E;E=d&&!p||"oidc"!==y&&"userPool"!==y&&"iam"!==y&&"lambda"!==y?void 0:{service:p?"execute-api":"appsync",region:p||u};const C=d||l;if(!C)throw kr(new Qn(cr));let _;try{const{body:t}=await this._api.post(e,{url:new St(C),options:{headers:v,body:w,signingServiceInfo:E,withCredentials:g},abortController:i});_=await t.json()}catch(e){if(this.isCancelError(e))throw e;_=kr(e)}if(lr(_))throw Jn(_);return _}isCancelError(e){return this._api.isCancelErrorREST(e)}cancel(e,t){return this._api.cancelREST(e,t)}_graphqlSubscribe(e,{query:t,variables:n,authMode:r},o={},i,s){const a=Or(e),c=r||a?.defaultAuthMode||"iam",u="identityPool"===c?"iam":c,{headers:l}=Vn(e);return this.appSyncRealTime.subscribe({query:(0,Pe.print)(t),variables:n,appSyncGraphqlEndpoint:a?.endpoint,region:a?.region,authenticationType:u,apiKey:a?.apiKey,additionalHeaders:o,authToken:s,libraryConfigHeaders:l},i).pipe(Er((e=>{if(e.errors)throw Jn(e);throw e})))}}new Rr;const Lr=(e,t={},n)=>({query:e,variables:t,authToken:n});class Pr extends Rr{getModuleName(){return"GraphQLAPI"}graphql(e,t,n){const r={category:l.API,action:h.GraphQl};if(function(e){return mr in e}(t)){const{[mr]:o,...i}=t;return super.graphql(e,i,n,{...r,...o})}return super.graphql(e,t,n,{...r})}isCancelError(e){return super.isCancelError(e)}cancel(e,t){return super.cancel(e,t)}}const Dr=new Pr;return i})()));
//# sourceMappingURL=aws-amplify-api-graphql.min.js.map